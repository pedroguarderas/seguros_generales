<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Leonardo Vélez y Pedro Guarderas">

<title>7&nbsp; Modelos de pérdida agregada – Matemáticas Actuariales para Seguros Generales</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./lectura_07.html" rel="next">
<link href="./lectura_05.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-257450a62f84a916ff723c9590a8c97c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/foldbox/foldbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
window.MathJax = {
  tex: {
    macros: {
      R: "\\mathbb{R}",
      C: "\\mathbb{C}",
      N: "\\mathbb{N}",
      Z: "\\mathbb{Z}",
      Fo: "\\mathscr{F}",
      E: "\\mathbb{E}",
      V: "\\mathbb{V}",
      D: "\\partial",
      F: "\\mathcal{F}",
      arginf: "\\operatorname{arginf}",
      argsup: "\\operatorname{argsup}",
      DFT: "\\operatorname{DFT}",
      VaR: "\\operatorname{VaR}",
      CVaR: "\\operatorname{CVaR}",
      TVaR: "\\operatorname{TVaR}",
      EVaR: "\\operatorname{EVaR}",
      CTE: "\\operatorname{CTE}",
      ES: "\\operatorname{ES}",
      Re: "\\operatorname{Re}",
      Dif: "\\operatorname{Dif}",
      VC: "\\operatorname{VC}"
    }
  }
};
</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<style>
.Theorem {
  --color1: #c0c0c0;
  --color2: #808080;
}
.Proposition {
  --color1: #c0c0c0;
  --color2: #808080;
}
.Corollary {
  --color1: #c0c0c0;
  --color2: #808080;
}
.Conjecture {
  --color1: #c0c0c0;
  --color2: #808080;
}
.Definition {
  --color1: #c0c0c0;
  --color2: #808080;
}
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./lectura_06.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modelos de pérdida agregada</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Matemáticas Actuariales para Seguros Generales</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/pedroguarderas/seguros_generales" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Matemáticas-Actuariales-para-Seguros-Generales.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">index.html</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lectura_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Materia</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lectura_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Preliminares</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lectura_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introducción a las operaciones de seguros</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lectura_04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Probabilidad y Estadística</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lectura_05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Distribuciones</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lectura_06.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modelos de pérdida agregada</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lectura_07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Tarificación</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lectura_08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Modelos lineales generalizados (GLM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lectura_09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Reservas técnicas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lectura_10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Estimación de valores extremos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lectura_11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Bibliografía</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#mutualización-del-riesgo" id="toc-mutualización-del-riesgo" class="nav-link active" data-scroll-target="#mutualización-del-riesgo"><span class="header-section-number">7.1</span> Mutualización del riesgo</a></li>
  <li><a href="#modelo_individual" id="toc-modelo_individual" class="nav-link" data-scroll-target="#modelo_individual"><span class="header-section-number">7.2</span> Modelo individual</a>
  <ul class="collapse">
  <li><a href="#algoritmo-de-simulación" id="toc-algoritmo-de-simulación" class="nav-link" data-scroll-target="#algoritmo-de-simulación"><span class="header-section-number">7.2.1</span> Algoritmo de simulación</a></li>
  </ul></li>
  <li><a href="#modelo_colectivo" id="toc-modelo_colectivo" class="nav-link" data-scroll-target="#modelo_colectivo"><span class="header-section-number">7.3</span> Modelo colectivo</a>
  <ul class="collapse">
  <li><a href="#algoritmo-de-simulación-1" id="toc-algoritmo-de-simulación-1" class="nav-link" data-scroll-target="#algoritmo-de-simulación-1"><span class="header-section-number">7.3.1</span> Algoritmo de simulación</a></li>
  </ul></li>
  <li><a href="#modelos_mixtos" id="toc-modelos_mixtos" class="nav-link" data-scroll-target="#modelos_mixtos"><span class="header-section-number">7.4</span> Modelos mixtos</a></li>
  <li><a href="#uso_limite_central" id="toc-uso_limite_central" class="nav-link" data-scroll-target="#uso_limite_central"><span class="header-section-number">7.5</span> Teorema del límite central y su uso</a></li>
  <li><a href="#deducibles" id="toc-deducibles" class="nav-link" data-scroll-target="#deducibles"><span class="header-section-number">7.6</span> Aplicación del deducible</a>
  <ul class="collapse">
  <li><a href="#algoritmo-de-simulación-2" id="toc-algoritmo-de-simulación-2" class="nav-link" data-scroll-target="#algoritmo-de-simulación-2"><span class="header-section-number">7.6.1</span> Algoritmo de simulación</a></li>
  </ul></li>
  <li><a href="#algoritmo_panjer" id="toc-algoritmo_panjer" class="nav-link" data-scroll-target="#algoritmo_panjer"><span class="header-section-number">7.7</span> Algoritmo de Panjer</a></li>
  <li><a href="#estimacion_transformada_fourier" id="toc-estimacion_transformada_fourier" class="nav-link" data-scroll-target="#estimacion_transformada_fourier"><span class="header-section-number">7.8</span> Estimación usando la transformada de Fourier</a></li>
  <li><a href="#temporalidad_numero_reclamos" id="toc-temporalidad_numero_reclamos" class="nav-link" data-scroll-target="#temporalidad_numero_reclamos"><span class="header-section-number">7.9</span> Temporalidad y ajustes del número de reclamos</a></li>
  <li><a href="#modelos_variables_explicativas" id="toc-modelos_variables_explicativas" class="nav-link" data-scroll-target="#modelos_variables_explicativas"><span class="header-section-number">7.10</span> Modelos con variables explicativas</a></li>
  <li><a href="#proceso_estocastico_reclamos" id="toc-proceso_estocastico_reclamos" class="nav-link" data-scroll-target="#proceso_estocastico_reclamos"><span class="header-section-number">7.11</span> Proceso estocástico de reclamos totales</a>
  <ul class="collapse">
  <li><a href="#algoritmo-de-simulación-3" id="toc-algoritmo-de-simulación-3" class="nav-link" data-scroll-target="#algoritmo-de-simulación-3"><span class="header-section-number">7.11.1</span> Algoritmo de simulación</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/pedroguarderas/seguros_generales/edit/main/lectura_06.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/pedroguarderas/seguros_generales/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="modelos_perdida" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modelos de pérdida agregada</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!------------------------------------------------------------------------------------------------->
<!------------------------------------------------------------------------------------------------->
<section id="mutualización-del-riesgo" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="mutualización-del-riesgo"><span class="header-section-number">7.1</span> Mutualización del riesgo</h2>
<p>La idea de mantener un seguro está basada en la mutualización de los riesgos. La mutualización como tal nace del mismo mecanismo bajo el cual funciona un seguro, cada asegurado transfiera su riesgo individual a la compañía de seguros, la suma total de estos riesgos <span class="math inline">\(S\)</span> es el riesgo total que asume el asegurador.</p>
<p>Los riesgos de cada uno de los <span class="math inline">\(n \in \N\)</span> asegurados, pueden ser representados por variables aleatorias <span class="math inline">\(X_1,\ldots X_n\)</span>, las mismas pueden ser independientes o dependientes entre ellas. El costo total del portafolio está dado por la suma de todos estos riesgos: <span class="math display">\[
S = \sum\limits_{i=1}^n X_i
\]</span> El conocer la distribución del costo total <span class="math inline">\(S\)</span> es una tarea crucial para el asegurador.</p>
<p>El valor esperado de los reclamos totales, puede ser calculado fácilmente utilizando las propiedades de linealidad de la esperanza matemática <span class="math inline">\(\E\)</span>: <span class="math display">\[
\E[ S ]
= \E\left[ \sum\limits_{i=1}^n X_i \right]
= \sum\limits_{i=1}^n \E\left[ X_i \right]
\]</span> La varianza de la variable aleatoria del costo total <span class="math inline">\(S\)</span>, está dada por: <span class="math display">\[
\begin{split}
\V\left[ S \right]
&amp; = \V\left[ \sum\limits_{i=1}^n X_i \right] \\
&amp; = \sum\limits_{i=1}^n \V\left[ X_i \right]
+ \sum\limits_{i=1}^n \sum\limits_{j=1,j\neq i}^n \mathbb{C}\left[ X_i, X_j \right] \\
&amp; = \sum\limits_{i=1}^n \V\left[ X_i \right]
+ 2\sum\limits_{i=1}^{n-1} \sum\limits_{j=i+1}^n \mathbb{C}\left[ X_i, X_j \right]
\end{split}
\]</span></p>
<p>Muchas de las veces el número total de reclamos <span class="math inline">\(n\)</span> es incierto y por tal razón es mejor considerar que el número de siniestros vendrá dado por otra variable aleatoria discreta <span class="math inline">\(N\)</span>, que solo tomará valores en <span class="math inline">\(\N\)</span>. <span class="math display">\[
S = \sum\limits_{i=1}^N X_i
\]</span></p>
<p>Esto nos lleva a considerar diferentes modelos de agregación de reclamos o pérdidas, en inglés “loss models” <span class="citation" data-cites="PanjerLoss2012">[<a href="#ref-PanjerLoss2012" role="doc-biblioref">1</a>]</span>, <span class="citation" data-cites="LossModFur">[<a href="#ref-LossModFur" role="doc-biblioref">2</a>]</span>.</p>
<p>Estudiemos la forma general que podría tener la distribución de <span class="math inline">\(S\)</span>, sin realizar hipótesis previa sobre el comportamiento de las variables aleatorias <span class="math inline">\(X_1, \ldots, X_n\)</span> y <span class="math inline">\(N\)</span>. <span class="math display">\[
\begin{split}
F_S( s )
&amp; = P( S \leq s ) \\
&amp; = P\left( \sum\limits_{i=1}^N X_i \leq s \right) \\
&amp; = P\left( \sum\limits_{i=1}^N X_i \leq s \land N \in \N \right) \\
&amp; = P\left( \bigcup\limits_{n\in \N} \left\{ \sum\limits_{i=1}^N X_i \leq s \land N \in \{n\} \right\}\right) \\
&amp; = \sum\limits_{n=0}^{+\infty} P\left( \sum\limits_{i=1}^n X_i \leq s \land N = n \right)
\qquad \text{probabilidad de eventos disjuntos} \\
&amp; = \sum\limits_{n=0}^{+\infty} P\left( \sum\limits_{i=1}^n X_i \leq s\ \middle|\ N = n \right) P( N = n )
\qquad \text{propiedades de la probabilidad condicional} \\
&amp; = \sum\limits_{n=0}^{+\infty} \int\limits_{\left\{\sum\limits_{i=1}^n x_i \leq s\right\}} dF_n( x_1, \ldots, x_n )\ p_n
\qquad \text{$F_n$ es la distribución conjunta de $X_1, \ldots, X_n$ dado $N = n$}
\end{split}
\]</span> La última expresión nos dice que para comprender el comportamiento de los reclamos totales <span class="math inline">\(S\)</span>, debemos estudiar y estimar la frecuencia de los reclamos <span class="math inline">\(N\)</span>, además de comprender y estimar cada uno de los reclamos <span class="math inline">\(X_i\)</span> y su interacción, recordando que <span class="math inline">\(N\)</span> puede tomar valores tendiendo al infinito. En términos resumidos, hay que comprender y estimar la frecuencia y severidad de los reclamos que están asociados al riesgo cubierto.</p>
<p>Los términos integrales <span class="math inline">\(\int\limits_{\left\{\sum\limits_{i=1}^n x_i \leq s\right\}} dF_n( x_1, \ldots, x_n )\)</span> asociados a la severidad presentan un verdadero reto estadístico y computacional; años atrás se desarrollaron algoritmos para calcular estos términos <span class="citation" data-cites="aep_algo">[<a href="#ref-aep_algo" role="doc-biblioref">3</a>]</span>, <span class="citation" data-cites="gaep_algo">[<a href="#ref-gaep_algo" role="doc-biblioref">4</a>]</span>.</p>
<!------------------------------------------------------------------------------------------------->
</section>
<section id="modelo_individual" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="modelo_individual"><span class="header-section-number">7.2</span> Modelo individual</h2>
<div id="dmodind" class="Definition" title="Modelo individual">
<p></p><details class="Definition fbx-simplebox fbx-default" open=""><summary><strong>Definition 7.1: </strong>Modelo individual</summary><div>En el <strong>modelo individual</strong> de pérdida consideramos que el número de siniestros que se producirán es conocido, por ejemplo, puede ser a lo sumo el tamaño de la población asegurada, en tal caso la variable aleatoria <span class="math inline">\(N\)</span> pasa a ser una constante, que representaremos por <span class="math inline">\(n\)</span>. De esta forma, la severidad total puede ser fácilmente representada por: <span class="math display">\[
S = \sum\limits_{i=1}^n X_i
\]</span><p></p>
<p>La hipótesis más usual que sostiene a este modelo es la indenpendencia entre cada uno de los reclamos <span class="math inline">\(X_i\)</span> y <span class="math inline">\(X_j\)</span> para cualquier <span class="math inline">\(1 \leq i \neq j \leq n\)</span>.</p>
</div></details>
</div>
<p>El valor esperado de la severidad total <span class="math inline">\(S\)</span> es: <span class="math display">\[
\begin{split}
\E[S]
&amp; = \E\left[ \sum\limits_{i=1}^n X_i \right] \\
&amp; = \sum\limits_{i=1}^n \E\left[ X_i \right] \\
&amp; = n \E[X] \quad \text{si $\{X_i\}$ son idénticamente distribuidas}
\end{split}
\]</span></p>
<p>Así mismo, la varianza de <span class="math inline">\(S\)</span>: <span class="math display">\[
\begin{split}
\V\left[ S \right]
&amp; = \V\left[ \sum\limits_{i=1}^n X_i \right] \\
&amp; = \sum\limits_{i=1}^n \V\left[ X_i \right]
+ \sum\limits_{i=1}^n \sum\limits_{j=1,j\neq i}^n \mathbb{C}\left[ X_i, X_j \right] \\
&amp; = \sum\limits_{i=1}^n \V\left[ X_i \right]\quad \text{si $\{X_i\}$ si son independientes entre si} \\
&amp; = n \V\left[ X \right]\quad \text{si $\{X_i\}$ si son idénticamente distribuidas}
\end{split}
\]</span></p>
<p>Al tener un número determinado de reclamos <span class="math inline">\(n \in \N\)</span>, la distribución de probabilidad del total de reclamos <span class="math inline">\(S\)</span> puede ser calculada de la forma más sencilla: <span class="math display">\[
\begin{split}
F_S( x )
&amp; = F_{X_1} \star \cdots \star F_{X_n} ( s )\quad \text{si $\{X_i\}$ son independientes} \\
&amp; = F_{X}^{\star n}( s )\quad \text{si $\{X_i\}$ son idénticamente distribuidas}
\end{split}
\]</span></p>
<p>así mismo, si las densidades de probabilidad están bien definidas, entonces: <span class="math display">\[
\begin{split}
f_S( s )
&amp; = f_{X_1} \star \cdots \star f_{X_n} ( s )\quad \text{si $\{X_i\}$ son independientes} \\
&amp; = f_{X}^{\star n}( s )\quad \text{si $\{X_i\}$ son idénticamente distribuidas}
\end{split}
\]</span></p>
<p>Una estrategia para estimar <span class="math inline">\(F_S\)</span> o <span class="math inline">\(f_S\)</span> es utilizar la transformada de Fourier <span class="math inline">\(\Fo\)</span>, la cual convierte las convoluciones en productos y luego invertir de nuevo la transformada de Fourier: <span class="math display">\[
\begin{split}
F_S
&amp; = \Fo^{-1}\left( \Fo\left( F_S \right) \right) \\
&amp; = \Fo^{-1}\left( \Fo\left( F_{X_1} \star \cdots \star F_{X_n} \right) \right)
\quad \text{si $\{X_i\}$ son independientes} \\
&amp; = \Fo^{-1}\left( \prod\limits_{i=1}^n \Fo\left( F_{X_i} \right) \right) \\
&amp; = \Fo^{-1}\left( \Fo\left( F_{X} \right)^n \right)
\quad \text{si $\{X_i\}$ si son idénticamente distribuidas }
\end{split}
\]</span></p>
<p>de forma equivalente para la densidad <span class="math inline">\(f_S\)</span>: <span class="math display">\[
\begin{split}
f_S
&amp; = \Fo^{-1}\left( \Fo\left( f_S \right) \right) \\
&amp; = \Fo^{-1}\left( \Fo\left( f_{X_1} \star \cdots \star f_{X_n} \right) \right)
\quad \text{si $\{X_i\}$ son independientes} \\
&amp; = \Fo^{-1}\left( \prod\limits_{i=1}^n \Fo\left( f_{X_i} \right) \right) \\
&amp; = \Fo^{-1}\left( \Fo\left( f_{X} \right)^n \right)
\quad \text{si $\{X_i\}$ si son idénticamente distribuidas }
\end{split}
\]</span> Por otra parte, la función característica de la variable aleatoria <span class="math inline">\(S\)</span>, está dada para todo <span class="math inline">\(t \in \R\)</span>: <span class="math display">\[
\begin{split}
\varphi_S( t )
&amp; = \E\left[ \exp\left( it S \right) \right] \\
&amp; = \E\left[ \exp\left( it \sum\limits_{i=1}^n X_i \right) \right] \\
&amp; = \E\left[ \prod\limits_{i=1}^n \exp\left( it X_i \right) \right] \\
&amp; = \prod\limits_{i=1}^n \E\left[ \exp\left( it X_i \right) \right],\quad
\text{si $\{X_i\}$ son independientes} \\
&amp; = \prod\limits_{i=1}^n \varphi_{X_i}\left( t \right) \\
&amp; = \varphi_{X}\left( t \right)^n,\quad
\text{si $\{X\}$ son identicamente distribuidas} \\
\end{split}
\]</span></p>
<!------------------------------------------------------------------------------------------------->
<section id="algoritmo-de-simulación" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="algoritmo-de-simulación"><span class="header-section-number">7.2.1</span> Algoritmo de simulación</h3>
<p>Se puede simular la severidad total <span class="math inline">\(S\)</span> para el caso donde se asume independencia entre cada una de las severidades <span class="math inline">\(X_1, \ldots, X_n\)</span> y se conoce cada una de sus densidades de probabilidad <span class="math inline">\(f_{X_1}, \ldots, f_{X_n}\)</span> o distribuciones de probabilidad <span class="math inline">\(F_{X_1}, \ldots, F_{X_n}\)</span>.</p>
<p>Los pasos son los siguientes:</p>
<ol type="1">
<li><p>Se tiene fijo <span class="math inline">\(n \in \N\)</span>,</p></li>
<li><p>Se fija el número de simulaciones <span class="math inline">\(m \in \N\)</span></p></li>
<li><p>Para cada <span class="math inline">\(i \in \{1, \ldots, m\}\)</span> se extrae una muestra <span class="math inline">\(X_{i,1} \rightsquigarrow f_{X_1},\ldots,X_{i,n} \rightsquigarrow f_{X_n}\)</span>,</p></li>
<li><p>Para cada <span class="math inline">\(i \in \{1, \ldots, m\}\)</span> se calcula la severidad total para la muestra <span class="math inline">\(i\)</span>, <span class="math inline">\(S_i = \sum\limits_{j=1}^n X_{i,j}\)</span></p></li>
</ol>
<div id="l6ex1" class="example">
<p>El siguiente código ejemplifica el algoritmo anterior, donde se asume que cada variable aleatoria de severidad <span class="math inline">\(X_i\)</span> sigue una ley log-normal <span class="math inline">\(LN( \mu_i, \sigma_i )\)</span> con parámetros <span class="math inline">\(\mu_i, \sigma_i\)</span>, para cada <span class="math inline">\(i \in \{1,\ldots, n\}\)</span>. El reclamo total <span class="math inline">\(S = \sum\limits_{i=1}^n X_i\)</span> sigue una ley de probabilidad que estará dada por la convolución de cada una de las leyes de probabilidad de cada reclamo <span class="math inline">\(X_i\)</span>, sin embargo estas leyes en este ejemplo son log-normales y no se conoce una forma explícita analítica para la convolución de log-normales. Por tal razón, debemos aproximar la distribución de probabilidad de <span class="math inline">\(F_S\)</span> a partir de la distribución empírica.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">set.seed</span>(<span class="dv">94312</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># 1. número de distribuciones</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co"># parámetros para las n distribuciones</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>mu <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="dv">1</span>, <span class="dv">2</span>, <span class="at">length.out =</span> n )</span>
<span id="cb1-7"><a href="#cb1-7"></a>sigma <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="dv">2</span>, <span class="dv">3</span>, <span class="at">length.out =</span> n )</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co"># 2. número de simulaciones</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>m <span class="ot">&lt;-</span> <span class="fl">1e3</span> </span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co"># 3. simulación de severidades</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>X <span class="ot">&lt;-</span> <span class="fu">lapply</span>( </span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span>m, </span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="at">FUN =</span> <span class="cf">function</span>( i ) {</span>
<span id="cb1-16"><a href="#cb1-16"></a>    <span class="fu">return</span>( <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span>n, <span class="at">FUN =</span> <span class="cf">function</span>( j ) <span class="fu">rlnorm</span>( <span class="dv">1</span>, <span class="at">meanlog =</span> mu[ j ], <span class="at">sdlog =</span> sigma[ j ] ) ) )</span>
<span id="cb1-17"><a href="#cb1-17"></a>  } </span>
<span id="cb1-18"><a href="#cb1-18"></a>)</span>
<span id="cb1-19"><a href="#cb1-19"></a></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="co"># 4. simulación de severidad total</span></span>
<span id="cb1-21"><a href="#cb1-21"></a>S <span class="ot">&lt;-</span> <span class="fu">sapply</span>( X, <span class="at">FUN =</span> sum )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Como mencionamos, en este ejemplo, la densidad de probabilidad de la severidad <span class="math inline">\(S\)</span> resulta de la convolución de las <span class="math inline">\(n\)</span> densidades individuales <span class="math inline">\(f_S = f_{X_1} \star \cdots \star f_{X_n}\)</span>, la cual no presenta una forma analítica conocida.</p>
<p>De la imposibilidad anterior, se puede ver la utilidad de trabajar con la muestra aleatoria de la variable <span class="math inline">\(S\)</span>. De esta manera, se puede estimar la distribución acumulada de probabilidad <span class="math inline">\(F_S\)</span> a partir de la distribución empírica <span class="math inline">\(F_m\)</span> generada con la muestra <span class="math inline">\(\{S_i\}\)</span>. <span class="math display">\[
F_S( s ) \approx F_m( s ) = \frac{1}{m} \sum\limits_{i=1}^m \mathbf {1}_{(-\infty,s]}( S_i )
\]</span> el resultado de concentración <a href="lectura_04.html#ddkw">5.32</a> nos brinda un criterio de convergencia de <span class="math inline">\(F_m\)</span> a <span class="math inline">\(F_S\)</span></p>
<p>Para construir <span class="math inline">\(F_m\)</span> en R, se puede utilizar la función ya empaquetada <code>ecdf</code> (empirical cumulative distribution function).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># estimación distribución acumulada empírica de S</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>Fm <span class="ot">&lt;-</span> <span class="fu">ecdf</span>( S )</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># esperanza empírica</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>EeS <span class="ot">&lt;-</span> <span class="fu">mean</span>( S )</span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># esperanza teórica</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>ES <span class="ot">&lt;-</span> <span class="fu">sum</span>( <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span>n, <span class="at">FUN =</span> <span class="cf">function</span>( i ) <span class="fu">exp</span>( mu[i] <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> sigma[i]<span class="sc">^</span><span class="dv">2</span> ) ) )</span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a>s <span class="ot">&lt;-</span> <span class="fu">sort</span>( <span class="fu">unique</span>( S ) )</span>
<span id="cb2-11"><a href="#cb2-11"></a>Fms <span class="ot">&lt;-</span> <span class="fu">sapply</span>( s, <span class="at">FUN =</span> Fm )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>smax <span class="ot">&lt;-</span> <span class="fl">2.0e5</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="fu">geom_step</span>( <span class="fu">aes</span>( <span class="at">x =</span> s, <span class="at">y =</span> Fms ), <span class="at">colour =</span> <span class="st">'dodgerblue4'</span>, <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span> </span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="fu">geom_vline</span>( <span class="at">xintercept =</span> <span class="fu">c</span>( EeS, ES ), <span class="at">colour =</span> <span class="fu">c</span>( <span class="st">'olivedrab3'</span>, <span class="st">'gold3'</span> ), <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, smax, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb3-7"><a href="#cb3-7"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, smax, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb3-8"><a href="#cb3-8"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, smax ), </span>
<span id="cb3-9"><a href="#cb3-9"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb3-11"><a href="#cb3-11"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb3-12"><a href="#cb3-12"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="fl">0.0</span>, <span class="fl">1.0</span> ), </span>
<span id="cb3-13"><a href="#cb3-13"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="fl">0.005</span>, <span class="fl">0.005</span> ) ) <span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$s$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb3-15"><a href="#cb3-15"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$F_m(s)$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb3-16"><a href="#cb3-16"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Para calcular la esperanza de la severidad total <span class="math inline">\(S\)</span>, también se puede usar una aproximación a la integral de Riemann-Stieltjes utilizando la distribución acumulada empírica <span class="math inline">\(F_m\)</span>. <span class="math display">\[
\E[ S ] = \int\limits_{\R} s dF_S( s )
\approx \int\limits_{\R} s dF_m( s )
\approx \sum\limits_{i=1}^N s_{i} \left( F_m( s_{i+1} ) - F_m( s_{i} ) \right)
\]</span></p>
<p>Esta aproximación en R puede ser implementada de la siguiente forma:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>N <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>s <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="fu">min</span>( S ), <span class="fu">max</span>( S ), <span class="at">length.out =</span> N )</span>
<span id="cb4-3"><a href="#cb4-3"></a>EmS <span class="ot">&lt;-</span> <span class="fu">sum</span>( s[<span class="sc">-</span>N] <span class="sc">*</span> <span class="fu">diff</span>( <span class="fu">sapply</span>( s, <span class="at">FUN =</span> Fm ) ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>De ello, tenemos los siguientes resultados de cálculo para el valor esperado de la severidad total: <span class="math display">\[
\begin{split}
\E[S] = \sum\limits_{i=1}^n e^{ \mu_i + \frac{1}{2} \sigma_i^2 } &amp; = 34562.7208, \\
\overline{S} = \frac{1}{m} \sum\limits_{i=1}^m S_i &amp; = 33515.9195, \\
\sum\limits_{i=1}^N s_{i} \left( F_m( s_{i+1} ) - F_m( s_{i} ) \right) &amp; = 33494.1981
\end{split}
\]</span></p>
</div>
<p>Lo bueno de poseer una buena aproximación a la distribución acumulada de una variable aleatoria, es que podemos calcular otros valores de importancia relacionados a la variable aleatoria y no tan solo utilizar medidas de tendencia central. Sin embargo, para que esta aproximación sea útil se requiere reducir el error de probabilidad <a href="lectura_04.html#ddkw">5.32</a>.</p>
<div id="l6ex2" class="example">
<p>Podemos considerar el caso sencillo donde el valor posible de severidad es determinista, es decir para cada póliza <span class="math inline">\(i\in \{1,\ldots,n\}\)</span>, el valor de severidad probable es único <span class="math inline">\(M &gt; 0\)</span> si en caso se da un evento <span class="math inline">\(A_i\)</span>, esto lo podemos expresar como <span class="math inline">\(X_i = M \mathbf{1}_{A_i}\)</span> donde M es constante. Así, la pérdida total está dada por: <span class="math display">\[
S = \sum\limits_{i=1}^n X_i = \sum\limits_{i=1}^n M \mathbf{1}_{A_i}
\]</span></p>
<p>El valor total esperado de reclamos está dado por: <span class="math display">\[
\E[ S ]
= \sum\limits_{i=1}^n \E\left[ M \mathbf{1}_{A_i} \right]
= M \sum\limits_{i=1}^n P( A_i )
\]</span> la última igualdad resulta de las propiedades de la función indicatriz <a href="lectura_04.html#indicatriz">5.11</a>.</p>
<p>Si en caso todos los <span class="math inline">\(P(A_i) = p\)</span> tienen la misma probabilidad, el valor total esperado de reclamos toma la siguiente forma: <span class="math display">\[
\E[S] = n M p
\]</span></p>
</div>
<!------------------------------------------------------------------------------------------------->
</section>
</section>
<section id="modelo_colectivo" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="modelo_colectivo"><span class="header-section-number">7.3</span> Modelo colectivo</h2>
<div id="dmodcol" class="Definition" title="Modelo colectivo">
<p></p><details class="Definition fbx-simplebox fbx-default" open=""><summary><strong>Definition 7.2: </strong>Modelo colectivo</summary><div>El <strong>modelo colectivo</strong> de riesgo considera un número de reclamos descritos por una variable aleatoria discreta <span class="math inline">\(N\)</span>. Los reclamos corresponden a un número de pólizas en un periodo específico, el valor de cada reclamo <span class="math inline">\(i \in \{1,\ldots,N\}\)</span> está representado por las variables aleatorias <span class="math inline">\(X_i\)</span>. Usualmente, se considera que cada uno de los reclamos <span class="math inline">\(X_i\)</span> están idénticamente distribuidos. <span class="math display">\[
S =
\left\{
\begin{array}{ll}
\sum\limits_{i=1}^N X_i &amp; \text{si}\ N &gt; 0 \\
0 &amp; \text{si}\ N = 0
\end{array}
\right.
\]</span> o de forma más compacta, se puede definir <span class="math inline">\(S = \sum\limits_{i=1}^N X_i\)</span>, donde se asume que la suma es igual a <span class="math inline">\(0\)</span> si el número de elementos en la suma <span class="math inline">\(N = 0\)</span>.<p></p>
</div></details>
</div>
<p>El valor esperado del total de reclamos <span class="math inline">\(S\)</span>, está dado por: <span class="math display">\[
\begin{split}
\E[S]
&amp; = \E\left[ \sum\limits_{i=1}^N X_i \right] \\
&amp; = \sum\limits_{n=0}^{+\infty} \E\left[ \sum\limits_{i=1}^n X_i\ \middle|\ N = n \right]P( N = n )
\quad \text{utilizando la esperanza condicional} \\
&amp; = 0 P( N = 0 ) + \sum\limits_{n=1}^{+\infty} \E\left[ \sum\limits_{i=1}^n X_i\ \middle|\ N = n \right]P( N = n ) \\
&amp; = \sum\limits_{n=1}^{+\infty} \sum\limits_{i=1}^n \E\left[ X_i \mid N = n \right]P( N = n )
\quad \text{linealidad de la esperanza} \\
&amp; = \sum\limits_{n=0}^{+\infty} n \E\left[ X \mid N = n \right]P( N = n )
\quad \text{si $\{X_i\}$ son idénticamente distribuidas} \\
&amp; = \E\left[ X \right] \sum\limits_{n=0}^{+\infty} n P( N = n )
\quad \text{si $X$ y $N$ son independientes} \\
&amp; = \E[ N ] \E[ X ]
\end{split}
\]</span></p>
<p>También podemos calcular la varianza de los reclamos totales <span class="math inline">\(S\)</span>, para ello necesitamos calcular su segundo momento: <span class="math display">\[
\begin{split}
\E[S^2]
&amp; = \E\left[ \left( \sum\limits_{i=1}^N X_i \right)^2 \right] \\
&amp; = \sum\limits_{n=0}^\infty \E\left[ \sum\limits_{i, j=1}^n X_i X_j \middle| N = n \right] P( N = n )
\quad \text{propiedades de la esperanza condicional} \\
&amp; = \sum\limits_{n=0}^\infty \sum\limits_{i, j=1}^n \E\left[ X_i X_j \right] P( N = n )
\quad \text{si $\{X_i\}$ y $N$ son independientes} \\
&amp; = \sum\limits_{n=0}^\infty \left( \sum\limits_{i=1}^n \E\left[ X_i^2 \right]
+ \sum\limits_{i,j=1,i\neq j}^n \E\left[ X_i X_j \right] \right) P( N = n ) \\
&amp; = \sum\limits_{n=0}^\infty \left( n \E\left[ X^2 \right] + n(n-1) \E\left[ X \right]^2 \right) P( N = n )
\quad \text{si $\{X_i\}$ son i.i.d} \\
&amp; = \E\left[N\right] \E\left[X^2\right] + \E\left[N^2\right] \E\left[X\right]^2
- \E\left[N\right] \E\left[X\right]^2 \\
&amp; = \E\left[N\right] \V\left[X\right] + \E\left[N^2\right] \E\left[X\right]^2
\end{split}
\]</span></p>
<p>finalmente la varianza de <span class="math inline">\(S\)</span> tiene la siguiente expresión: <span class="math display">\[
\begin{split}
\V\left[S\right]
&amp; = \E\left[S^2\right] - \E\left[S\right]^2 \\
&amp; = \E\left[N\right] \V\left[X\right]
+ \E\left[N^2\right] \E\left[X\right]^2 - \E\left[N\right]^2 \E\left[X\right]^2 \\
&amp; = \E\left[N\right] \V\left[X\right] + \V\left[N\right] \E\left[X\right]^2
\end{split}
\]</span></p>
<p>La distribución acumulada del reclamo total <span class="math inline">\(S\)</span> tiene la forma: <span class="math display">\[
\begin{split}
F_S( s )
&amp; = P( S \leq s ) \\
&amp; = P\left( \sum\limits_{i=1}^N X_i \leq s \right) \\
&amp; = \sum\limits_{n=0}^{+\infty} P\left( \sum\limits_{i=1}^n X_i \leq s \middle| N = n \right) P( N = n )\quad
\text{utilizando la probabilidad condicional} \\
&amp; = \sum\limits_{n=0}^{+\infty} P\left( \sum\limits_{i=1}^n X_i \leq s \right) p_n\quad
\text{si $X_i$ y $N$ son independientes} \\
&amp; = \sum\limits_{n=0}^{+\infty} F_{X_1} \star \cdots \star F_{X_n}( s ) p_n\quad
\text{si $\{X_i\}$ son independientes} \\
&amp; = \sum\limits_{n=0}^{+\infty} F^{\star n}_{X}( s ) p_n\quad
\text{si $\{X_i\}$ son idénticamente distribuidas}
\end{split}
\]</span> tomando <span class="math inline">\(F^{\star 0}_{X}( s ) = 1\)</span>.</p>
<p>El último resultado muestra que la distribución de probabilidad de <span class="math inline">\(S\)</span> no es más que una mixtura de las distribuciones para los modelos individuales <span class="math inline">\(F^{\star n}_{X}\)</span>, tomando para mezclarlas las probabilidades <span class="math inline">\(p_n = P( N = n )\)</span> de la variable aleatoria discreta <span class="math inline">\(N\)</span> que describe la frecuencia de los reclamos.</p>
<p>Al igual que para el modelo individual, podemos estimar <span class="math inline">\(F_S\)</span> o <span class="math inline">\(f_S\)</span> utilizando la transformada de Fourier <span class="math inline">\(\Fo\)</span>: <span class="math display">\[
\begin{split}
F_S
&amp; = \Fo^{-1}\left( \Fo\left( F_S \right) \right) \\
&amp; = \Fo^{-1}\left( \Fo\left( \sum\limits_{n=0}^{+\infty} F_{X_1} \star \cdots \star F_{X_n}( s ) p_n \right) \right)
\quad \text{si $\{X_i\}$ son independientes} \\
&amp; = \Fo^{-1}\left( \sum\limits_{n=0}^{+\infty} \prod\limits_{i=1}^n \Fo\left( F_{X_i} \right) p_n \right) \\
&amp; = \Fo^{-1}\left( \sum\limits_{n=0}^{+\infty} \Fo\left( F_{X} \right)^n p_n \right)
\quad \text{si $\{X_i\}$ si son idénticamente distribuidas }
\end{split}
\]</span></p>
<p>de forma equivalente para la densidad <span class="math inline">\(f_S\)</span>: <span class="math display">\[
\begin{split}
f_S
&amp; = \Fo^{-1}\left( \Fo\left( f_S \right) \right) \\
&amp; = \Fo^{-1}\left( \Fo\left( \sum\limits_{n=0}^{+\infty} f_{X_1} \star \cdots \star f_{X_n}( s ) p_n \right) \right)
\quad \text{si $\{X_i\}$ son independientes} \\
&amp; = \Fo^{-1}\left( \sum\limits_{n=0}^{+\infty} \prod\limits_{i=1}^n \Fo\left( f_{X_i} \right) p_n \right) \\
&amp; = \Fo^{-1}\left( \sum\limits_{n=0}^{+\infty} \Fo\left( f_{X} \right)^n p_n \right)
\quad \text{si $\{X_i\}$ si son idénticamente distribuidas }
\end{split}
\]</span></p>
<p>En la práctica es imposible realizar la suma hasta infinito, por esto, se puede utilizar una aproximación escogiendo un número máximo <span class="math inline">\(M \in \N\)</span> de términos en la suma, obteniendo así las aproximaciones.</p>
<p>Por otra parte, la función característica de la variable aleatoria <span class="math inline">\(S\)</span>, está dada para todo <span class="math inline">\(t \in \R\)</span>: <span class="math display">\[
\begin{split}
\varphi_S( t )
&amp; = \E\left[ \exp\left( it S \right) \right] \\
&amp; = \E\left[ \exp\left( it \sum\limits_{i=1}^N X_i \right) \right] \\
&amp; = \sum\limits_{n=0}^{+\infty}
\E\left[ \exp\left( it \sum\limits_{i=1}^n X_i \right) \middle| N = n \right] P( N = n ) \\
&amp; = \sum\limits_{n=0}^{+\infty}
\E\left[ \prod\limits_{i=1}^n \exp\left( it X_i \right) \middle| N = n \right] p_n \\
&amp; = \sum\limits_{n=0}^{+\infty} \prod\limits_{i=1}^n
\E\left[ \exp\left( it X_i \right) \middle| N = n \right] p_n,\quad
\text{si $\{X_i\}$ son independientes} \\
&amp; = \sum\limits_{n=0}^{+\infty} \prod\limits_{i=1}^n \varphi_{X_i}\left( t \right) p_n,\quad
\text{si $\{X_i\}$ y $N$ son independientes} \\
&amp; = \sum\limits_{n=0}^{+\infty} \varphi_{X}\left( t \right)^n p_n,\quad
\text{si $\{X\}$ son identicamente distribuidas} \\
&amp; = \E\left[ \varphi_{X}\left( t \right)^N \right] \\
&amp; = \E\left[ \exp\left( N \log\left( \varphi_{X}\left( t \right) \right) \right) \right] \\
&amp; = \varphi_N\left( -i\log\left( \varphi_{X}\left( t \right) \right) \right) \\
\end{split}
\]</span></p>
<!------------------------------------------------------------------------------------------------->
<section id="algoritmo-de-simulación-1" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="algoritmo-de-simulación-1"><span class="header-section-number">7.3.1</span> Algoritmo de simulación</h3>
<p>La variable del reclamo total <span class="math inline">\(S\)</span> puede ser simulada mediante el siguiente método montecarlo:</p>
<p>Si <span class="math inline">\(N\)</span> sigue una ley discreta <span class="math inline">\(f_N\)</span> y cada valor severidad <span class="math inline">\(X\)</span> son idénticamente distribuidos con ley <span class="math inline">\(f_X\)</span>.</p>
<ol type="1">
<li><p>Seleccionar el número de simulaciones <span class="math inline">\(m\)</span>,</p></li>
<li><p>Se genera una muestra de tamaño <span class="math inline">\(m\)</span> de variables <span class="math inline">\(N_1, \ldots, N_m\)</span> con ley <span class="math inline">\(f_N\)</span>,</p></li>
<li><p>Se genera para cada <span class="math inline">\(i \in \{1,\ldots,m\}\)</span> una muestra de tamaño <span class="math inline">\(N_i\)</span> de variables aleatorias <span class="math inline">\(X_{i,1}, \ldots X_{i,N_i}\)</span> con ley <span class="math inline">\(f_X\)</span>,</p></li>
<li><p>Se calcula los reclamos totales <span class="math inline">\(S_1, \ldots, S_m\)</span> para cada simulación <span class="math inline">\(i = \{1, \ldots, m\}\)</span>, mediante la siguiente suma <span class="math inline">\(S_i = \sum\limits_{j=1}^{N_i} X_{i,j}\)</span>.</p></li>
</ol>
<p>En el lenguaje de programación R, este método de simulación puede ser fácilmente implementado, utilizando las funciones de aplicación vectorial <code>sapply</code> y <code>lapply</code>.</p>
<div id="l6ex3" class="example">
<p>Consideramos el caso de un modelo colectivo para el cuál el conteo de siniestros <span class="math inline">\(N \rightsquigarrow Pois( \lambda )\)</span> y la distribución de cada uno de los reclamos <span class="math inline">\(\{X_i\}_{i\in \N}\)</span>, está dada por la misma distribución de probabilidad <span class="math inline">\(X \rightsquigarrow LN( \mu, \sigma )\)</span>, siendo además cada uno de los reclamos independientes entre si.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># 1. selección de simulaciones</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>m <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># 2. especificación de los parámetros para las distribuciones</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>u <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>s <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>l <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb5-8"><a href="#cb5-8"></a></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co"># 3. simulación del conteo de siniestros</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>N <span class="ot">&lt;-</span> <span class="fu">rpois</span>( <span class="at">n =</span> m, <span class="at">lambda =</span> l )</span>
<span id="cb5-11"><a href="#cb5-11"></a></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co"># 4. simulación de la severidad de los reclamos</span></span>
<span id="cb5-13"><a href="#cb5-13"></a>X <span class="ot">&lt;-</span> <span class="fu">lapply</span>( N, <span class="at">FUN =</span> <span class="cf">function</span>( n ) <span class="fu">rlnorm</span>( n, <span class="at">meanlog =</span> u, <span class="at">sdlog =</span> s ) )</span>
<span id="cb5-14"><a href="#cb5-14"></a></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co"># 5. reclamo total, agregación por cada simulación</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>S <span class="ot">&lt;-</span> <span class="fu">sapply</span>( X, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">sum</span>( x, <span class="at">na.rm =</span> <span class="cn">TRUE</span> ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Es de notar que un algoritmo como el descrito anteriormente tiene una falencia cuando la frecuencia de siniestros es poco observada, esto sucede cuando la probabilidad <span class="math inline">\(P( N = 0 )\)</span> es alta y por tal razón para generar suficientes reclamos y así poder tener cálculos con una buena aproximación numérica, se necesitarán muchas simulaciones.</p>
<p>Para ciertos casos particulares, el modelo colectivo puede ser muchas veces calculado de forma similar a un modelo individual. Por ejemplo, si consideramos el caso cuando la variable aleatoria del conteo de siniestros <span class="math inline">\(N \rightsquigarrow Bin( n, p )\)</span> sigue una distribución binomial con parámetros <span class="math inline">\(n\)</span> y <span class="math inline">\(p\)</span> y los reclamos individuales <span class="math inline">\(\{ X_i \}\)</span> son i.i.d. A partir de esto, el reclamo total <span class="math inline">\(S\)</span> puede ser expresado de dos formas: <span class="math display">\[
S = \sum\limits_{k=0}^{N} X_k
= \sum\limits_{k=0}^n B_k X_k
\]</span> donde las variables aleatorias <span class="math inline">\(B_k \rightsquigarrow Ber( p )\)</span> son independientes de las variables aleatorias <span class="math inline">\(X_k\)</span> de cada uno de los reclamos. Así el modelo colectivo se transforma en un modelo individual con <span class="math inline">\(n\)</span> constante y valores de reclamos individuales dados por la variable aleatoria <span class="math inline">\(Y_k = B_k X_k\)</span>.</p>
<p>Para este caso en particular: <span class="math display">\[
\begin{split}
\E[ S ]
&amp; = \E\left[ \sum\limits_{k=0}^{n} B_k X_k \right] \\
&amp; = \sum\limits_{k=0}^{n} \E\left[ B_k X_k \right] \\
&amp; = n \E[ B X ] \\
&amp; = n \E[ B ] \E[ X ] \\
&amp; = n p \E[ X ]
\end{split}
\]</span></p>
<p>así mismo: <span class="math display">\[
\begin{split}
\V[ S ]
&amp; = n \V[ B X ] \\
&amp; = n \left( \E[ B^2 X^2 ] - \E[ B X ]^2 \right) \\
&amp; = n \left( \E[ B^2 ] \E[ X^2 ] - \E[ B ]^2 \E[ X ]^2 \right) \\
&amp; = n \left( p \E[ X^2 ] - p^2 \E[ X ]^2 \right) \\
&amp; = n \left( p \E[ X^2 ] - p \E[ X ]^2 + p \E[ X ]^2  - p^2 \E[ X ]^2 \right) \\
&amp; = n \left( p \V[ X ] + p ( 1 - p ) \E[ X ]^2 \right) \\
&amp; = n \left( \E[B] \V[ X ] + \V[B] \E[ X ]^2 \right)
\end{split}
\]</span></p>
<div id="l6ex4" class="example">
<p>Hacemos uso del algoritmo de simulación, pero bajo la consideración anterior donde el conteo de siniestros <span class="math inline">\(N \rightsquigarrow Bin( n, p )\)</span>, en algunos casos se puede considerar <span class="math inline">\(n\)</span> como el número de pólizas vendidas, esto supone que solo se presenta un reclamo por póliza. Por su parte, consideraremos los reclamos <span class="math inline">\(X_i \rightsquigarrow LN( \mu, \sigma )\)</span>, para todo <span class="math inline">\(i \in \{1,\ldots,n\}\)</span>.</p>
<p>Si consideramos generar la simulación como un modelo individual, generamos variables aleatorias <span class="math inline">\(B_i \rightsquigarrow Ber(p)\)</span>, para todo <span class="math inline">\(i \in \{1,\ldots,n\}\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>m <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>p <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>mu <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>sigma <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>B <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="dv">1</span><span class="sc">:</span>m, <span class="at">FUN =</span> <span class="cf">function</span>( i ) <span class="fu">rbinom</span>( n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> p ) )</span>
<span id="cb6-7"><a href="#cb6-7"></a>X <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="dv">1</span><span class="sc">:</span>m, <span class="at">FUN =</span> <span class="cf">function</span>( i ) <span class="fu">rlnorm</span>( n, <span class="at">meanlog =</span> mu, <span class="at">sdlog =</span> sigma ) )</span>
<span id="cb6-8"><a href="#cb6-8"></a>S <span class="ot">&lt;-</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span>m, <span class="at">FUN =</span> <span class="cf">function</span>( i ) <span class="fu">sum</span>( B[[ i ]] <span class="sc">*</span> X[[ i ]], <span class="at">na.rm =</span> <span class="cn">TRUE</span> ) )</span>
<span id="cb6-9"><a href="#cb6-9"></a></span>
<span id="cb6-10"><a href="#cb6-10"></a>EeS <span class="ot">&lt;-</span> <span class="fu">mean</span>( S )</span>
<span id="cb6-11"><a href="#cb6-11"></a>ES <span class="ot">&lt;-</span> n <span class="sc">*</span> p <span class="sc">*</span> <span class="fu">exp</span>( mu <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> sigma<span class="sc">^</span><span class="dv">2</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[
\begin{split}
\E[S] = n p e^{ \mu + \frac{1}{2} \sigma^2 } &amp; = 219326.6317, \\
\overline{S} = \frac{1}{m} \sum\limits_{i=1}^m S_i &amp; = 219346.3972,
\end{split}
\]</span></p>
</div>
<p>Es importante observar que si la frecuencia de reclamos es superior a <span class="math inline">\(1\)</span>, sea esta por póliza, individuo o en general por unidad asegurada, la aproximación anterior no es la correcta si no se realiza un ajuste al valor <span class="math inline">\(n\)</span> que es el número máximo de siniestros. También, se puede considerar que las variables de los reclamos es la suma total de reclamos por póliza.</p>
<p>Por otra parte, es de notar que en el cálculo hay un gasto innecesario de valores simulados de reclamos <span class="math inline">\(X_i\)</span>, ya que algunos se multiplicaran por <span class="math inline">\(B_i\)</span>, la cual solo toma valores <span class="math inline">\(\{0,1\}\)</span>.</p>
<!------------------------------------------------------------------------------------------------->
</section>
</section>
<section id="modelos_mixtos" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="modelos_mixtos"><span class="header-section-number">7.4</span> Modelos mixtos</h2>
<div id="dmodmix" class="Definition" title="Modelo mixto">
<p></p><details class="Definition fbx-simplebox fbx-default" open=""><summary><strong>Definition 7.3: </strong>Modelo mixto</summary><div>En algunos casos en particular se considera un modelo de agregación que es una mixtura entre el modelo individual y el modelo colectivo. Se parte de considerar un número <span class="math inline">\(n\)</span> de unidades aseguradas, donde para cada unidad <span class="math inline">\(i \in \{1, \ldots, n\}\)</span> se considera que puede presentar una cantidad de reclamos dados por una variable aleatoria discreta <span class="math inline">\(N_i\)</span>, cada uno de las <span class="math inline">\(i\)</span> unidades pueden presentar un número de reclamos <span class="math inline">\(X_{i,1}, \ldots, X_{i,N_i}\)</span>. De agregar el total de reclamos, se tiene la expresión: <span class="math display">\[
S
= \sum\limits_{i=1}^n \sum\limits_{j=1}^{N_i} X_{i,j}
\]</span><p></p>
</div></details>
</div>
<p>Si en caso todos los reclamos <span class="math inline">\(X_{i,j}\)</span> son idénticamente distribuidos entre unidades aseguradas y reclamos, entonces el reclamo total anterior puede ser visto como un modelo colectivo de pérdida: <span class="math display">\[
S
= \sum\limits_{j=1}^{N} X_j
\]</span> tomando el conteo de siniestros como la variable aleatoria <span class="math inline">\(N = \sum\limits_{i=1}^n N_i\)</span>.</p>
<p>El mismo modelo mixto, también puede ser interpretado como un modelo individual de pérdida, con una suma constante de siniestros. <span class="math display">\[
S
= \sum\limits_{i=1}^n Y_i
\]</span></p>
<p>donde cada variable aleatoria <span class="math inline">\(Y_i = \sum\limits_{j=1}^{N_i} X_{i,j}\)</span>.</p>
<!------------------------------------------------------------------------------------------------->
</section>
<section id="uso_limite_central" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="uso_limite_central"><span class="header-section-number">7.5</span> Teorema del límite central y su uso</h2>
<p>En varias situaciones es difícil determinar la distribución de los reclamos totales <span class="math inline">\(S\)</span>, como ya hemos visto no hay una forma explícita sencilla.</p>
<p>Para tener una primera aproximación a la distribución, se puede utilizar el teorema del límite central <a href="lectura_04.html#tlc">5.28</a>, para ello se requiere un gran número de elementos en la suma de los reclamos totales <span class="math inline">\(S\)</span>. Como ya lo muestra la desigualdad <a href="lectura_04.html#beress">5.31</a>, la convergencia requiere un número de términos inversamente proporcional al cuadrado del error de aproximación. Sin embargo, si en caso el número de reclamos <span class="math inline">\(n\)</span> no es lo suficientemente grande como para obtener un error de aproximación deseado, podemos hacer uso de un resultado más fuerte como la desigualdad de concentración de <a href="lectura_04.html#beress">5.31</a>, la misma no solo implica el teorema del límite central, sino que además proporciona una acotación y velocidad de convergencia conforme se aumenta <span class="math inline">\(n\)</span>. Esta desigualdad puede ser de gran utilidad para tener una acotación de la distribución de los reclamos totales, para cualquier valor de <span class="math inline">\(n\)</span>.</p>
<p>Más claramente, para el caso del modelo individual, donde <span class="math inline">\(n\)</span> es una constante, el teorema <a href="lectura_04.html#beress">5.31</a> nos proporciona la siguiente desigualdad: <span class="math display">\[
\begin{split}
\underset{u\in \R}{\sup}\left( 1 + |u|^3 \right)\left| P\left( \frac{S - \E[S]}{\sqrt{\V[S]}}  \leq u\right) - \Phi( u ) \right|
&amp; \leq \frac{C}{\sqrt{n}} \frac{\E\left[\left|X - \E[X]\right|^3\right]}{\sqrt{\V[X]}^3} \\
\left( 1 + |u|^3 \right)\left| P\left( \frac{S - \E[S]}{\sqrt{\V[S]}}  \leq u\right) - \Phi( u ) \right|
&amp; \leq \frac{C}{\sqrt{n}} \frac{\E\left[\left|X - \E[X]\right|^3\right]}{\sqrt{\V[X]}^3},\qquad \forall u \in \R \\
\end{split}
\]</span> Para simplificar la manipulación de las expresiones podemos tomar: <span class="math inline">\(\tau = \frac{\E\left[\left|X - \E[X]\right|^3\right]}{\sqrt{\V[X]}^3}\)</span> <span class="math display">\[\begin{gather*}
-\frac{C}{\sqrt{n}} \tau
\leq \left( 1 + |u|^3 \right)\left( P\left( \frac{S - \E[S]}{\sqrt{\V[S]}}  \leq u\right) - \Phi( u ) \right)
\leq \frac{C}{\sqrt{n}} \tau \\
\Phi( u ) - \frac{C}{\sqrt{n}\left( 1 + |u|^3 \right)} \tau
\leq P\left( \frac{S - \E[S]}{\sqrt{\V[S]}}  \leq u\right)
\leq \Phi( u ) + \frac{C}{\sqrt{n}\left( 1 + |u|^3 \right)} \tau  \\
\Phi( u ) - \frac{C}{\sqrt{n}\left( 1 + |u|^3 \right)} \tau
\leq P\left( S \leq \E[S] + \sqrt{\V[S]} u\right)
\leq \Phi( u ) + \frac{C}{\sqrt{n}\left( 1 + |u|^3 \right)} \tau \\
\max\left( \Phi\left( \frac{s - \E[S]}{\sqrt{\V[S]}} \right) - \frac{C}{\sqrt{n}\left( 1 + \left| \frac{s - \E[S]}{\sqrt{\V[S]}} \right|^3 \right)} \tau, 0 \right)
\leq P\left( S \leq s \right)
\leq \min\left( \Phi\left( \frac{s - \E[S]}{\sqrt{\V[S]}} \right) + \frac{C}{\sqrt{n}\left( 1 + \left|\frac{s - \E[S]}{\sqrt{\V[S]}}\right|^3 \right)} \tau, 1 \right)
\end{gather*}\]</span> cambiando la variable <span class="math inline">\(s = \E[S] + \sqrt{\V[S]} u\)</span>. El <span class="math inline">\(\max\)</span> y <span class="math inline">\(\min\)</span> resultan debido a que una probabilidad siempre está acotada en el rango de <span class="math inline">\(0\)</span> a <span class="math inline">\(1\)</span>.</p>
<p>El ejemplo a continuación muestra un claro uso del resultado anterior.</p>
<div id="l6ex5" class="example">
<p>En este caso en particular consideramos un modelo individual con reclamos determinados por variables aleatorias que siguen una distribución <span class="math inline">\(LN( \mu, \sigma )\)</span> y un número de <span class="math inline">\(n = 7000\)</span> reclamos. Además, como es usual asumimos que las variables aleatorias de los reclamos <span class="math inline">\(X_1, \ldots, X_n\)</span> son i.i.d.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>n <span class="ot">&lt;-</span> <span class="fl">7e3</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>mu <span class="ot">&lt;-</span> <span class="fl">4.0</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>sigma <span class="ot">&lt;-</span> <span class="fl">2.0</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>EX <span class="ot">&lt;-</span> <span class="fu">exp</span>( mu <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> sigma<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb7-5"><a href="#cb7-5"></a>VX <span class="ot">&lt;-</span> ( <span class="fu">exp</span>( sigma<span class="sc">^</span><span class="dv">2</span> ) <span class="sc">-</span> <span class="dv">1</span> ) <span class="sc">*</span> <span class="fu">exp</span>( <span class="dv">2</span> <span class="sc">*</span> mu <span class="sc">+</span> sigma<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb7-6"><a href="#cb7-6"></a>ES <span class="ot">&lt;-</span> n <span class="sc">*</span> EX</span>
<span id="cb7-7"><a href="#cb7-7"></a>VS <span class="ot">&lt;-</span> n <span class="sc">*</span> VX</span>
<span id="cb7-8"><a href="#cb7-8"></a></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co"># utilizamos simulación, no hay forma analítica para la distribución de la suma de log-normales</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>m <span class="ot">&lt;-</span> <span class="fl">5e3</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>S <span class="ot">&lt;-</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span>m, <span class="at">FUN =</span> <span class="cf">function</span>( i ) <span class="fu">sum</span>( <span class="fu">rlnorm</span>( n, <span class="at">meanlog =</span> mu, <span class="at">sdlog =</span> sigma ) ) )</span>
<span id="cb7-12"><a href="#cb7-12"></a>FS <span class="ot">&lt;-</span> <span class="fu">ecdf</span>( S ) </span>
<span id="cb7-13"><a href="#cb7-13"></a></span>
<span id="cb7-14"><a href="#cb7-14"></a>C <span class="ot">&lt;-</span> <span class="fl">0.7655</span> <span class="sc">+</span> <span class="dv">8</span> <span class="sc">*</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="dv">1</span>) ) <span class="co"># constante universal del teorema</span></span>
<span id="cb7-15"><a href="#cb7-15"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>( x ) ( <span class="fu">abs</span>( x <span class="sc">-</span> EX )<span class="sc">^</span><span class="dv">3</span> ) <span class="sc">*</span> <span class="fu">dlnorm</span>( x, <span class="at">meanlog =</span> mu, <span class="at">sdlog =</span> sigma )</span>
<span id="cb7-16"><a href="#cb7-16"></a></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co"># forzando este término, la distribución log-normal no tiene función generadora de momentos</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>tau <span class="ot">&lt;-</span> <span class="fu">integrate</span>( <span class="at">f =</span> f, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="fl">1e10</span>, <span class="at">subdivisions =</span> <span class="fl">1e4</span>, <span class="at">rel.tol =</span> <span class="fl">1e-10</span> )<span class="sc">$</span>value <span class="sc">/</span> <span class="fu">sqrt</span>( VX )<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb7-19"><a href="#cb7-19"></a></span>
<span id="cb7-20"><a href="#cb7-20"></a>s <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="dv">0</span>, <span class="fl">6e6</span>, <span class="at">length =</span> <span class="dv">5000</span> )</span>
<span id="cb7-21"><a href="#cb7-21"></a>Fms <span class="ot">&lt;-</span> <span class="fu">sapply</span>( s, <span class="at">FUN =</span> FS )</span>
<span id="cb7-22"><a href="#cb7-22"></a></span>
<span id="cb7-23"><a href="#cb7-23"></a>u <span class="ot">&lt;-</span> ( s <span class="sc">-</span> ES ) <span class="sc">/</span> <span class="fu">sqrt</span>( VS )</span>
<span id="cb7-24"><a href="#cb7-24"></a>r <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">abs</span>( u )<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb7-25"><a href="#cb7-25"></a>Fmax <span class="ot">&lt;-</span> <span class="fu">pmin</span>( <span class="fu">pnorm</span>( u ) <span class="sc">+</span> C <span class="sc">*</span> tau <span class="sc">/</span> ( <span class="fu">sqrt</span>( n ) <span class="sc">*</span> r ), <span class="dv">1</span> ) <span class="co"># cota superior</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>Fmin <span class="ot">&lt;-</span> <span class="fu">pmax</span>( <span class="fu">pnorm</span>( u ) <span class="sc">-</span> C <span class="sc">*</span> tau <span class="sc">/</span> ( <span class="fu">sqrt</span>( n ) <span class="sc">*</span> r ), <span class="dv">0</span> ) <span class="co"># cota inferior</span></span>
<span id="cb7-27"><a href="#cb7-27"></a>Phi <span class="ot">&lt;-</span> <span class="fu">sapply</span>( s, <span class="at">FUN =</span> <span class="cf">function</span>( s ) <span class="fu">pnorm</span>( ( s <span class="sc">-</span> ES ) <span class="sc">/</span> <span class="fu">sqrt</span>( VS ) ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Como se puede ver en el siguiente gráfico, la acotación funciona muy bien y al aumentar el número de siniestros <span class="math inline">\(n\)</span> se disminuye el rango de la acotación, proporcionando así una mejor estimación de la distribución de los reclamos totales <span class="math inline">\(S\)</span>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>ylim <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">1</span> )</span>
<span id="cb8-2"><a href="#cb8-2"></a>ybrk <span class="ot">&lt;-</span> <span class="fu">seq</span>( ylim[<span class="dv">1</span>], ylim[<span class="dv">2</span>], <span class="fl">0.1</span> )</span>
<span id="cb8-3"><a href="#cb8-3"></a>ylbl <span class="ot">&lt;-</span> <span class="fu">formatC</span>( ybrk, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> )</span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a>xlim <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">min</span>( s ), <span class="fu">max</span>( s ) )</span>
<span id="cb8-6"><a href="#cb8-6"></a>xbrk <span class="ot">&lt;-</span> <span class="fu">seq</span>( xlim[<span class="dv">1</span>], xlim[<span class="dv">2</span>], <span class="at">length =</span> <span class="dv">11</span> )</span>
<span id="cb8-7"><a href="#cb8-7"></a>xlbl <span class="ot">&lt;-</span> <span class="fu">paste0</span>( <span class="fu">formatC</span>( xbrk <span class="sc">/</span> <span class="fl">1e6</span>, <span class="at">digits =</span> <span class="dv">1</span>, <span class="at">format =</span> <span class="st">'f'</span> ), <span class="st">'M'</span> )</span>
<span id="cb8-8"><a href="#cb8-8"></a></span>
<span id="cb8-9"><a href="#cb8-9"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> s, <span class="at">y =</span> Phi ), <span class="at">colour =</span> <span class="st">'orange2'</span>, <span class="at">linewidth =</span> <span class="dv">2</span> ) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>  <span class="fu">geom_step</span>( <span class="fu">aes</span>( <span class="at">x =</span> s, <span class="at">y =</span> Fms ), <span class="at">colour =</span> <span class="st">'dodgerblue3'</span>,  <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> s, <span class="at">y =</span> Fmax ), <span class="at">colour =</span> <span class="st">'olivedrab3'</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> s, <span class="at">y =</span> Fmin ), <span class="at">colour =</span> <span class="st">'olivedrab3'</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> xbrk,</span>
<span id="cb8-15"><a href="#cb8-15"></a>                      <span class="at">labels =</span> xlbl, </span>
<span id="cb8-16"><a href="#cb8-16"></a>                      <span class="at">limits =</span> xlim, </span>
<span id="cb8-17"><a href="#cb8-17"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="fl">0.01</span>, <span class="fl">0.01</span> ) ) <span class="sc">+</span></span>
<span id="cb8-18"><a href="#cb8-18"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks =</span> ybrk,</span>
<span id="cb8-19"><a href="#cb8-19"></a>                      <span class="at">labels =</span> ylbl,</span>
<span id="cb8-20"><a href="#cb8-20"></a>                      <span class="at">limits =</span> ylim,</span>
<span id="cb8-21"><a href="#cb8-21"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="fl">0.01</span>, <span class="fl">0.01</span> ) ) <span class="sc">+</span></span>
<span id="cb8-22"><a href="#cb8-22"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$S$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb8-23"><a href="#cb8-23"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$F_S$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb8-24"><a href="#cb8-24"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb8-25"><a href="#cb8-25"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">"none"</span> )</span>
<span id="cb8-26"><a href="#cb8-26"></a>plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<p>Es de notar que las variables aleatorias de los reclamos pueden seguir cualquier otra distribución, el método no depende de la distribución en cuestión, sino de que la variable que representa los reclamos tenga esperanza finita, varianza finita y la variación de tercer orden <span class="math inline">\(\E\left[\left|X - \E[X]\right|^3 \right] &lt; +\infty\)</span>, también sea finita.</p>
<p>En la práctica se suele tomar lo que se conoce como una aproximación por el teorema de límite central.</p>
<p><span class="math display">\[
P( S \leq s )
\approx \Phi\left( \frac{s - \E[S]}{\sqrt{\V[S]}} \right)
\]</span></p>
<p>Esto es válido siempre y cuando la cota del error de aproximación <span class="math inline">\(\frac{C}{\sqrt{n}\left( 1 + \left|\frac{s - \E[S]}{\sqrt{\V[S]}}\right|^3 \right)} \tau\)</span>, sea lo suficientemente pequeña. Además, es de notar que se está trabajando con valores que solo están entre <span class="math inline">\(0\)</span> y <span class="math inline">\(1\)</span>, pequeñas variaciones pueden ser muy relevantes al nivel del ajuste de las distribuciones acumuladas.</p>
<p>Finalmente, debemos tomar en cuenta que las cotas, superior como inferior, no son funciones de de distribución acumuladas en la variable <span class="math inline">\(s\)</span>, no necesariamente son siempre crecientes.</p>
<!------------------------------------------------------------------------------------------------->
</section>
<section id="deducibles" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="deducibles"><span class="header-section-number">7.6</span> Aplicación del deducible</h2>
<p>En muchas ocasiones según las condiciones de los contratos de seguro y el apetito de riesgo del asegurador, se configura funciones deducibles sobre los reclamos. El objetivo de aplicar un deducible es evitar valores de reclamo en determinados rangos que no están acorde a las configuraciones y estructuración de productos de seguro. Por ejemplo, se puede colocar un deducible para evitar el pago de valores muy pequeños de reclamos, cuya atención incluso puede implicar costos operativos o administrativos mayores al valor mismo de los reclamos, ante esta situación se coloca una cota mínima para que de esta forma el asegurado se haga cargo por su cuenta de estos valores menores.</p>
<p>Es usual colocar mínimos en las colas de la distribución de reclamos, evitando así valores muy pequeños o valores muy grandes, pero no sería sustentable, ni financieramente o económicamente, el colocar un deducible justo donde se presenta la mayor parte de los valores de reclamos. Desde la perspectiva de un asegurado, ¿De qué serviría adquirir una póliza que no cubre precisamente los siniestros más usuales?, esta no sería una póliza apetecible en el mercado y por otra parte un producto difícil de comercializar.</p>
<div id="ddeducible" class="Definition" title="Deducible">
<p></p><details class="Definition fbx-simplebox fbx-default" open=""><summary><strong>Definition 7.4: </strong>Deducible</summary><div>Formalmente, un <strong>deducible</strong> es una función <span class="math inline">\(D : \R \longrightarrow \R\)</span> a valores reales, tal que para todo valor real <span class="math inline">\(x \in \R\)</span>, se satisface la siguiente desigualdad: <span class="math inline">\(D( x ) \leq x\)</span>.<p></p>
</div></details>
</div>
<p>A continuación presentamos un lista de funciones deducibles más comunes que presenta el mercado:</p>
<ol type="1">
<li>Para evitar pérdidas pequeñas se suele configurar la función deducible <span class="math display">\[
D( X ) = \max( X - d, 0 )
\]</span> que se aplicará sobre las variables aleatorias de los reclamos <span class="math inline">\(X \rightsquigarrow F_X\)</span>. Así, el valor ya deducido <span class="math inline">\(Z = D( X ) \rightsquigarrow F_Z( z )\)</span>, donde <span class="math display">\[
F_Z( z ) = \mathbf{1}_{[0,+\infty)}( z ) F_X( z + d )
\]</span></li>
</ol>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>D <span class="ot">&lt;-</span> <span class="cf">function</span>( x, d ) <span class="fu">return</span>( <span class="fu">max</span>( x <span class="sc">-</span> d, <span class="dv">0</span> ) )</span>
<span id="cb9-2"><a href="#cb9-2"></a>d <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>alpha <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>gamma <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>tau <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>theta <span class="ot">&lt;-</span> <span class="dv">80</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>n <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a>xmax <span class="ot">&lt;-</span> <span class="fl">5e2</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="dv">0</span>, xmax, <span class="at">length =</span> n )</span>
<span id="cb9-11"><a href="#cb9-11"></a>FX <span class="ot">&lt;-</span> <span class="fu">sapply</span>( x, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">ptrbeta</span>( x, <span class="at">shape1 =</span> alpha, <span class="at">shape2 =</span> gamma, <span class="at">shape3 =</span> tau, <span class="at">scale =</span> theta ) )</span>
<span id="cb9-12"><a href="#cb9-12"></a>FDX <span class="ot">&lt;-</span> <span class="fu">sapply</span>( x, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">ifelse</span>( x <span class="sc">&gt;=</span> d, <span class="dv">1</span>, <span class="dv">0</span> ) <span class="sc">*</span> <span class="fu">ptrbeta</span>( x <span class="sc">+</span> d, <span class="at">shape1 =</span> alpha, <span class="at">shape2 =</span> gamma, <span class="at">shape3 =</span> tau, <span class="at">scale =</span> theta ) )</span>
<span id="cb9-13"><a href="#cb9-13"></a></span>
<span id="cb9-14"><a href="#cb9-14"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> x, <span class="at">y =</span> FX, <span class="at">colour =</span> <span class="st">'a'</span> ), <span class="at">linewidth =</span> <span class="dv">2</span> ) <span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> x, <span class="at">y =</span> FDX, <span class="at">colour =</span> <span class="st">'b'</span> ), <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>  <span class="fu">scale_colour_manual</span>( <span class="at">breaks =</span> <span class="fu">c</span>( <span class="st">'a'</span>, <span class="st">'b'</span> ), </span>
<span id="cb9-18"><a href="#cb9-18"></a>                       <span class="at">values =</span> <span class="fu">c</span>( <span class="st">'dodgerblue3'</span>, <span class="st">'red3'</span> ) ) <span class="sc">+</span></span>
<span id="cb9-19"><a href="#cb9-19"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, xmax, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb9-20"><a href="#cb9-20"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, xmax, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb9-21"><a href="#cb9-21"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, xmax ), </span>
<span id="cb9-22"><a href="#cb9-22"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb9-23"><a href="#cb9-23"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb9-24"><a href="#cb9-24"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb9-25"><a href="#cb9-25"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="fl">0.0</span>, <span class="fl">1.0</span> ), </span>
<span id="cb9-26"><a href="#cb9-26"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="fl">0.005</span>, <span class="fl">0.005</span> ) ) <span class="sc">+</span></span>
<span id="cb9-27"><a href="#cb9-27"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$x$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb9-28"><a href="#cb9-28"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$F_X, F_{D(X)}$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb9-29"><a href="#cb9-29"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-30"><a href="#cb9-30"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">"none"</span> )</span>
<span id="cb9-31"><a href="#cb9-31"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Para prevenir los excesos de pérdida (stop loss) se propone el deducible con un tope máximo dado por una constante <span class="math inline">\(M &gt; 0\)</span>, el cual se aplica a las variables aleatorias de los reclamos <span class="math inline">\(X \rightsquigarrow F_X\)</span>: <span class="math display">\[
D( X ) = \min( X, M )
\]</span>,</li>
</ol>
<p>en este caso, si la variable aleatoria del pago correspondiente al reclamo ya deducido <span class="math inline">\(Z = D( X ) \rightsquigarrow F_Z( z )\)</span>, donde: <span class="math display">\[
F_Z( z ) = \mathbf{1}_{(-\infty,M)}( z ) F_X( z ) + \mathbf{1}_{[M,+\infty)}( z )
\]</span></p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>D <span class="ot">&lt;-</span> <span class="cf">function</span>( x, M ) <span class="fu">return</span>( <span class="fu">min</span>( x, M ) )</span>
<span id="cb10-2"><a href="#cb10-2"></a>M <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>alpha <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>gamma <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>tau <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>theta <span class="ot">&lt;-</span> <span class="dv">80</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>n <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a>xmax <span class="ot">&lt;-</span> <span class="fl">5e2</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="dv">0</span>, xmax, <span class="at">length =</span> n )</span>
<span id="cb10-11"><a href="#cb10-11"></a>FX <span class="ot">&lt;-</span> <span class="fu">sapply</span>( x, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">ptrbeta</span>( x, <span class="at">shape1 =</span> alpha, <span class="at">shape2 =</span> gamma, <span class="at">shape3 =</span> tau, <span class="at">scale =</span> theta ) )</span>
<span id="cb10-12"><a href="#cb10-12"></a>FDX <span class="ot">&lt;-</span> <span class="fu">sapply</span>( x, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">ifelse</span>( x <span class="sc">&lt;</span> M, <span class="dv">1</span>, <span class="dv">0</span> ) <span class="sc">*</span> <span class="fu">ptrbeta</span>( x, <span class="at">shape1 =</span> alpha, <span class="at">shape2 =</span> gamma, <span class="at">shape3 =</span> tau, <span class="at">scale =</span> theta ) <span class="sc">+</span>  <span class="fu">ifelse</span>( x <span class="sc">&gt;=</span> M, <span class="dv">1</span>, <span class="dv">0</span> ) )</span>
<span id="cb10-13"><a href="#cb10-13"></a></span>
<span id="cb10-14"><a href="#cb10-14"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> x, <span class="at">y =</span> FX, <span class="at">colour =</span> <span class="st">'a'</span> ), <span class="at">linewidth =</span> <span class="dv">2</span> ) <span class="sc">+</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> x, <span class="at">y =</span> FDX, <span class="at">colour =</span> <span class="st">'b'</span> ), <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17"></a>  <span class="fu">scale_colour_manual</span>( <span class="at">breaks =</span> <span class="fu">c</span>( <span class="st">'a'</span>, <span class="st">'b'</span> ), </span>
<span id="cb10-18"><a href="#cb10-18"></a>                       <span class="at">values =</span> <span class="fu">c</span>( <span class="st">'dodgerblue3'</span>, <span class="st">'red3'</span> ) ) <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, xmax, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb10-20"><a href="#cb10-20"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, xmax, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb10-21"><a href="#cb10-21"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, xmax ), </span>
<span id="cb10-22"><a href="#cb10-22"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb10-23"><a href="#cb10-23"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb10-24"><a href="#cb10-24"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb10-25"><a href="#cb10-25"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="fl">0.0</span>, <span class="fl">1.0</span> ), </span>
<span id="cb10-26"><a href="#cb10-26"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="fl">0.005</span>, <span class="fl">0.005</span> ) ) <span class="sc">+</span></span>
<span id="cb10-27"><a href="#cb10-27"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$x$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb10-28"><a href="#cb10-28"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$F_X, F_{D(X)}$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb10-29"><a href="#cb10-29"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb10-30"><a href="#cb10-30"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">"none"</span> )</span>
<span id="cb10-31"><a href="#cb10-31"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Caso mixto para evitar pérdidas pequeñas y exceso de pérdida, se propone la siguiente composición de deducibles que se aplicará sobre las variables aleatorias de los reclamos <span class="math inline">\(X \rightsquigarrow F_X\)</span>: <span class="math display">\[
D( X ) = \min( \max( X - d, 0 ), M )
\]</span> en este caso, si la variable aleatoria del pago correspondiente al reclamo ya deducido <span class="math inline">\(Z = D( X ) \rightsquigarrow F_Z( z )\)</span>, tenemos que <span class="math inline">\(Z \rightsquigarrow F_Z\)</span>, con: <span class="math display">\[
F_Z( z ) = \mathbf{1}_{[0,M)}( z ) F_X( z + d ) + \mathbf{1}_{[M,+\infty)}( z )
\]</span></li>
</ol>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>D <span class="ot">&lt;-</span> <span class="cf">function</span>( x, M ) <span class="fu">return</span>( <span class="fu">min</span>( <span class="fu">max</span>( x <span class="sc">-</span> d ), M ) )</span>
<span id="cb11-2"><a href="#cb11-2"></a>d <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>M <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>alpha <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>gamma <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>tau <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>theta <span class="ot">&lt;-</span> <span class="dv">80</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>n <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb11-9"><a href="#cb11-9"></a></span>
<span id="cb11-10"><a href="#cb11-10"></a>xmax <span class="ot">&lt;-</span> <span class="fl">5e2</span></span>
<span id="cb11-11"><a href="#cb11-11"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="dv">0</span>, xmax, <span class="at">length =</span> n )</span>
<span id="cb11-12"><a href="#cb11-12"></a>FX <span class="ot">&lt;-</span> <span class="fu">sapply</span>( x, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">ptrbeta</span>( x, <span class="at">shape1 =</span> alpha, <span class="at">shape2 =</span> gamma, <span class="at">shape3 =</span> tau, <span class="at">scale =</span> theta ) )</span>
<span id="cb11-13"><a href="#cb11-13"></a>FDX <span class="ot">&lt;-</span> <span class="fu">sapply</span>( x, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">ifelse</span>( x <span class="sc">&lt;</span> M <span class="sc">&amp;</span> x <span class="sc">&gt;=</span> d, <span class="dv">1</span>, <span class="dv">0</span> ) <span class="sc">*</span> <span class="fu">ptrbeta</span>( x <span class="sc">+</span> d, <span class="at">shape1 =</span> alpha, <span class="at">shape2 =</span> gamma, <span class="at">shape3 =</span> tau, <span class="at">scale =</span> theta ) <span class="sc">+</span>  <span class="fu">ifelse</span>( x <span class="sc">&gt;=</span> M, <span class="dv">1</span>, <span class="dv">0</span> ) )</span>
<span id="cb11-14"><a href="#cb11-14"></a></span>
<span id="cb11-15"><a href="#cb11-15"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> x, <span class="at">y =</span> FX, <span class="at">colour =</span> <span class="st">'a'</span> ), <span class="at">linewidth =</span> <span class="dv">2</span> ) <span class="sc">+</span></span>
<span id="cb11-17"><a href="#cb11-17"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> x, <span class="at">y =</span> FDX, <span class="at">colour =</span> <span class="st">'b'</span> ), <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb11-18"><a href="#cb11-18"></a>  <span class="fu">scale_colour_manual</span>( <span class="at">breaks =</span> <span class="fu">c</span>( <span class="st">'a'</span>, <span class="st">'b'</span> ), </span>
<span id="cb11-19"><a href="#cb11-19"></a>                       <span class="at">values =</span> <span class="fu">c</span>( <span class="st">'dodgerblue3'</span>, <span class="st">'red3'</span> ) ) <span class="sc">+</span></span>
<span id="cb11-20"><a href="#cb11-20"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, xmax, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb11-21"><a href="#cb11-21"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, xmax, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb11-22"><a href="#cb11-22"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, xmax ), </span>
<span id="cb11-23"><a href="#cb11-23"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb11-24"><a href="#cb11-24"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb11-25"><a href="#cb11-25"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb11-26"><a href="#cb11-26"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="fl">0.0</span>, <span class="fl">1.0</span> ), </span>
<span id="cb11-27"><a href="#cb11-27"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="fl">0.005</span>, <span class="fl">0.005</span> ) ) <span class="sc">+</span></span>
<span id="cb11-28"><a href="#cb11-28"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$x$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb11-29"><a href="#cb11-29"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$F_X, F_{D(X)}$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb11-30"><a href="#cb11-30"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb11-31"><a href="#cb11-31"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">"none"</span> )</span>
<span id="cb11-32"><a href="#cb11-32"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li><p>Otro tipo de deducible acota el número de pagos de reclamos a un número fijo máximo de reclamos, es decir, se establece un deducible en función de la frecuencia. Usualmente, esto se realiza cuando se considera un modelo donde se dispone de la frecuencia de reclamos por póliza. <span class="math display">\[
D(N) = \min( N, W )
\]</span> con la constante <span class="math inline">\(W \in \N\)</span>. Para el reclamo total, si se considera un portafolio con <span class="math inline">\(n\)</span> pólizas tenemos las siguiente variación del modelo: <span class="math display">\[
S = \sum\limits_{i=1}^n \sum\limits_{j=1}^{D(N_i)} X_{i,j}
\]</span></p></li>
<li><p>En otros casos más elaborados se segmenta el riesgo cubierto, al existir variables explicativas de la naturaleza del riesgo <span class="math inline">\(Y_1, \ldots, Y_m\)</span>, las cuales pueden tomar valores en un conjunto <span class="math inline">\(E\)</span> solo se toma un subconjunto de valores posibles <span class="math inline">\(A\subset E\)</span>, para los cuales es válida la cobertura. Así, si un reclamo <span class="math inline">\(X\)</span> se explica o caracteriza por las variables anteriores, se configura el deducible: <span class="math display">\[
D( X ) = \mathbf{1}_{A}\left( Y_1, \ldots, Y_m \right) X
\]</span></p></li>
</ol>
<p>Un ejemplo del anterior deducible se da en el caso de seguros de salud, donde se cubre ciertos tipos de enfermedades, usualmente se evita las enfermedades de tipo catastrófico que estén ya presentes; en otros productos se evita los gastos odontológicos, etc.</p>
<p>Los deducibles, pueden ser configurados de forma genérica para todos los asegurados o incluso de forma personalizada por asegurado, según los productos que estos han adquirido. En general, al emplear deducibles para cada uno de los reclamos individuales, el reclamo total <span class="math inline">\(S\)</span> se ve modificado, y toma la forma: <span class="math display">\[
S = \sum\limits_{i=1}^{N} D_i\left( X_i \right)
\]</span> Hay casos donde se aplica el deducible al grupo de siniestros que presenta una póliza o grupo de pólizas. Esto precisamente se lo puede ver cuando se utiliza un modelo mixto de pérdida. <span class="math display">\[
S = \sum\limits_{i=1}^n D_i\left( \sum\limits_{n=1}^{N_i} X_{i,j} \right)
\]</span></p>
<p>Es de notar, que la distribución acumulada de la variable aleatoria, correspondiente a los reclamos ya deducidos, comienza a presentar singularidades, esto complica el estudio del comportamiento de los reclamos totales.</p>
<!------------------------------------------------------------------------------------------------->
<section id="algoritmo-de-simulación-2" class="level3" data-number="7.6.1">
<h3 data-number="7.6.1" class="anchored" data-anchor-id="algoritmo-de-simulación-2"><span class="header-section-number">7.6.1</span> Algoritmo de simulación</h3>
<p>Presentamos una adaptación sencilla de los algoritmos de simulación anterior, incluyendo el caso que se tenga un deducible aplicado de forma uniforme a todas las pólizas.</p>
<ol type="1">
<li><p>Seleccionar el número de simulaciones <span class="math inline">\(m\)</span>,</p></li>
<li><p>Se genera una muestra de tamaño <span class="math inline">\(m\)</span> de variables <span class="math inline">\(N_1, \ldots, N_m\)</span> con ley <span class="math inline">\(f_N\)</span>,</p></li>
<li><p>Se genera para cada <span class="math inline">\(i \in \{1,\ldots,m\}\)</span> una muestra de tamaño <span class="math inline">\(N_i\)</span> de variables aleatorias <span class="math inline">\(X_{i,1}, \ldots X_{i,N_i}\)</span> con ley <span class="math inline">\(f_X\)</span>,</p></li>
<li><p>Se establece la función deducible <span class="math inline">\(D : \R \longrightarrow \R_+\)</span> y los parámetros y condiciones necesarias para su definición,</p></li>
<li><p>Se calcula los reclamos totales utilizando el deducible <span class="math inline">\(S_1, \ldots, S_m\)</span> para cada simulación <span class="math inline">\(i = \{1, \ldots, m\}\)</span>, mediante la siguiente suma <span class="math inline">\(S_i = \sum\limits_{j=1}^{N_i} D\left( X_{i,j} \right)\)</span>,</p></li>
<li><p>Para la determinación de varios estadísticos se puede utilizar la simulación generada <span class="math inline">\(\{S_i\}\)</span> y generar la distribución de probabilidad empírica <span class="math inline">\(F_m\)</span>.</p></li>
</ol>
<div id="l6ex6" class="example">
<p>Consideremos el caso de un modelo colectivo de pérdida donde el proceso de conteo <span class="math inline">\(N \rightsquigarrow Pois( \lambda )\)</span> y la sucesión <span class="math inline">\(\{X_i\}\)</span> de reclamos individuales se considera conformada por variables i.i.d, con distribución de probabilidad <span class="math inline">\(LN( \mu, \sigma )\)</span>. El deducible a aplicar será una función mixta de la forma <span class="math inline">\(D( X ) = \min( \max( X - d, 0 ), M )\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># 1. selección de simulaciones</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>m <span class="ot">&lt;-</span> <span class="fl">5e4</span></span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co"># 2. especificación de los parámetros para las distribuciones</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>u <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>s <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>lambda <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb12-8"><a href="#cb12-8"></a></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co"># 3. se especifica la función deducible</span></span>
<span id="cb12-10"><a href="#cb12-10"></a>D <span class="ot">&lt;-</span> <span class="cf">function</span>( x, d, M ) {</span>
<span id="cb12-11"><a href="#cb12-11"></a>  <span class="fu">return</span>( <span class="fu">min</span>( <span class="fu">max</span>( x <span class="sc">-</span> d, <span class="dv">0</span> ), M ) )</span>
<span id="cb12-12"><a href="#cb12-12"></a>}</span>
<span id="cb12-13"><a href="#cb12-13"></a></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="fu">set.seed</span>( <span class="dv">312341</span> )</span>
<span id="cb12-15"><a href="#cb12-15"></a></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="co"># 4. simulación del conteo de siniestros</span></span>
<span id="cb12-17"><a href="#cb12-17"></a>N <span class="ot">&lt;-</span> <span class="fu">rpois</span>( <span class="at">n =</span> m, <span class="at">lambda =</span> lambda )</span>
<span id="cb12-18"><a href="#cb12-18"></a></span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="co"># 5. simulación de la severidad de los reclamos</span></span>
<span id="cb12-20"><a href="#cb12-20"></a>X <span class="ot">&lt;-</span> <span class="fu">lapply</span>( N, <span class="at">FUN =</span> <span class="cf">function</span>( n ) <span class="fu">rlnorm</span>( n, <span class="at">meanlog =</span> u, <span class="at">sdlog =</span> s ) )</span>
<span id="cb12-21"><a href="#cb12-21"></a></span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="co"># 6. se aplica el deducible a los reclamos</span></span>
<span id="cb12-23"><a href="#cb12-23"></a>d <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb12-24"><a href="#cb12-24"></a>M <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb12-25"><a href="#cb12-25"></a>DX <span class="ot">&lt;-</span> <span class="fu">lapply</span>( X, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">sapply</span>( x, <span class="at">FUN =</span> <span class="cf">function</span>( y ) <span class="fu">D</span>( y, d, M ) ) )</span>
<span id="cb12-26"><a href="#cb12-26"></a></span>
<span id="cb12-27"><a href="#cb12-27"></a><span class="co"># 7. reclamo total, agregación por cada simulación</span></span>
<span id="cb12-28"><a href="#cb12-28"></a>S <span class="ot">&lt;-</span> <span class="fu">sapply</span>( X, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">ifelse</span>( <span class="fu">length</span>( x ) <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">sum</span>( x, <span class="at">na.rm =</span> <span class="cn">TRUE</span> ) ) )</span>
<span id="cb12-29"><a href="#cb12-29"></a>DS <span class="ot">&lt;-</span> <span class="fu">sapply</span>( DX, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">ifelse</span>( <span class="fu">length</span>( x ) <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">sum</span>( x, <span class="at">na.rm =</span> <span class="cn">TRUE</span> ) ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>El efecto del deducible sobre la distribución del reclamo es evidente, produciendo así una densidad multimodal, como se observa en el gráfico a continuación, en el mismo incluimos dos histogramas, uno correspondiente a los reclamos totales sin aplicar el deducible y el otro el histograma de los reclamos totales aplicados el deducible.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>smax <span class="ot">&lt;-</span> lambda <span class="sc">*</span> M</span>
<span id="cb13-2"><a href="#cb13-2"></a>fmax <span class="ot">&lt;-</span> <span class="fl">0.002</span></span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="fu">geom_histogram</span>( <span class="fu">aes</span>( S, <span class="fu">after_stat</span>( density ) ), <span class="at">fill =</span> <span class="st">'olivedrab3'</span>, <span class="at">colour =</span> <span class="st">'olivedrab4'</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">bins =</span> <span class="fu">nclass.FD</span>( DS ) ) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="fu">geom_histogram</span>( <span class="fu">aes</span>( DS, <span class="fu">after_stat</span>( density ) ), <span class="at">fill =</span> <span class="st">'dodgerblue3'</span>, <span class="at">colour =</span> <span class="st">'dodgerblue4'</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">bins =</span> <span class="fu">nclass.FD</span>( DS ) ) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, smax, <span class="at">length =</span> <span class="dv">7</span> ),</span>
<span id="cb13-8"><a href="#cb13-8"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, smax, <span class="at">length =</span> <span class="dv">7</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ),</span>
<span id="cb13-9"><a href="#cb13-9"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, smax ),</span>
<span id="cb13-10"><a href="#cb13-10"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, fmax, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb13-12"><a href="#cb13-12"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, fmax, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">format =</span> <span class="st">'f'</span> ),</span>
<span id="cb13-13"><a href="#cb13-13"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, fmax ),</span>
<span id="cb13-14"><a href="#cb13-14"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb13-15"><a href="#cb13-15"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$s$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb13-16"><a href="#cb13-16"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$f_S$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb13-17"><a href="#cb13-17"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb13-18"><a href="#cb13-18"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">"none"</span> )</span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Es de notar que la probabilidad del evento <span class="math inline">\(\{S=0\}\)</span> no es nula y se debe a la aplicación del deducible. <span class="math display">\[
\begin{split}
P( S = 0 )
&amp; = P\left( \left\{ S = 0 \middle| N \in \N \right\} \right) \\
&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left\{ S = 0 \land N = n \right\} \right) \\
&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left\{ D( X_1 ) + \cdots + D( X_N ) = 0 \land N = n \right\} \right) \\
&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left\{ X_1 \leq d \land \cdots \land X_N \leq d \land N = n \right\} \right) \\
&amp; = \sum\limits_{n=0}^{+\infty} P\left( X_1 \leq d \land \cdots \land X_N \leq d \land N = n \right) \\
&amp; = \sum\limits_{n=0}^{+\infty} P\left( X_1 \leq d \land \cdots \land X_n \leq d \middle| N = n \right)P( N = n ) \\
&amp; = \sum\limits_{n=0}^{+\infty} P\left( X_1 \leq d \land \cdots \land X_n \leq d \right) P( N = n ) \\
&amp; = \sum\limits_{n=0}^{+\infty} P\left( X \leq d \right)^n p_n \\
&amp; = \E\left[ P\left( X \leq d \right)^N \right] \\
&amp; \approx \sum\limits_{n=0}^{n'} P( X \leq d )^n p_n,\quad
\text{para un valor $n'$ suficientemente grande}
\end{split}
\]</span></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>np <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>ns <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>np</span>
<span id="cb14-3"><a href="#cb14-3"></a>PS0 <span class="ot">&lt;-</span> <span class="fu">sum</span>( ( <span class="fu">plnorm</span>( d, <span class="at">meanlog =</span> u, <span class="at">sdlog =</span> s )<span class="sc">^</span>ns ) <span class="sc">*</span> <span class="fu">dpois</span>( ns, <span class="at">lambda =</span> lambda ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[
P( S = 0 ) = 0.314886664
\]</span></p>
<p>Así mismo, se puede estudiar el evento extremo, caso en el cual se paga el valor máximo que admite el deducible, en este caso en particular es <span class="math inline">\(M\)</span> por cada siniestro y si se producen <span class="math inline">\(n\)</span>, entonces como máximo se pagara <span class="math inline">\(n M\)</span>. Por tanto, nos interesa la probabilidad del evento <span class="math inline">\(\{ S\ \text{es máximo} \}\)</span>, el cual lo podemos calcular como: <span class="math display">\[
\begin{split}
P( S\ \text{es máximo} )
&amp; = P\left( \left\{ S = NM \middle| N \in \N \right\} \right) \\
&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left\{ S = N M \land N = n \right\} \right) \\
&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left\{ D( X_1 ) + \cdots + D( X_N ) = N M \land N = n \right\} \right) \\
&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left\{ X_1 - d &gt; M \land \cdots \land X_N - d  \geq M \land N = n \right\} \right) \\
&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left\{ X_1 &gt; M + d \land \cdots \land X_N \geq M + d \land N = n \right\} \right) \\
&amp; = \sum\limits_{n=0}^{+\infty} P\left( X_1 &gt; M + d \land \cdots \land X_N &gt; M + d \land N = n \right) \\
&amp; = \sum\limits_{n=0}^{+\infty} P\left( X_1 &gt; M + d \land \cdots \land X_n &gt; M + d \middle| N = n \right) P( N = n ) \\
&amp; = \sum\limits_{n=0}^{+\infty} P\left( X_1 &gt; M + d \land \cdots \land X_n &gt; M + d \right) P( N = n ) \\
&amp; = \sum\limits_{n=0}^{+\infty} P\left( X &gt; M + d \right)^n p_n \\
&amp; = \E\left[ P\left( X &gt; M + d \right)^N \right] \\
&amp; \approx \sum\limits_{n=0}^{n'} P( X &gt; M + d )^n p_n,\quad
\text{para un valor $n'$ suficientemente grande}
\end{split}
\]</span></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>PSmax <span class="ot">&lt;-</span> <span class="fu">sum</span>( ( ( <span class="dv">1</span> <span class="sc">-</span> <span class="fu">plnorm</span>( M <span class="sc">+</span> d, <span class="at">meanlog =</span> u, <span class="at">sdlog =</span> s ) )<span class="sc">^</span>ns ) <span class="sc">*</span> <span class="fu">dpois</span>( ns, <span class="at">lambda =</span> lambda ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[
P( S\ \text{es máximo} ) = 0.003299886
\]</span> Además, podemos calcular el valor máximo esperado de <span class="math inline">\(S\)</span>: <span class="math display">\[
\begin{split}
\E\left[ S \middle| S\ \text{es máximo} \right]
&amp; = \E\left[ S \middle| \left\{ S = NM \middle| N \in \N \right\} \right] \\
&amp; = \E\left[ S \middle| \bigcup\limits_{n=0}^{+\infty} \left\{ S = NM \land N = n \right\} \right] \\
&amp; = \E\left[ NM \middle| \bigcup\limits_{n=0}^{+\infty} \left\{ N = n \right\} \right] \\
&amp; = \sum\limits_{n=0}^{+\infty} \E\left[ n M \middle| N = n \right] P( N = n ) \\
&amp; = \sum\limits_{n=0}^{+\infty} n M P( N = n ) \\
&amp; = M \sum\limits_{n=0}^{+\infty} n P( N = n ) \\
&amp; = M \E\left[ N \right] \\
\end{split}
\]</span></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>ESmax <span class="ot">&lt;-</span> M <span class="sc">*</span> <span class="fu">sum</span>( ns <span class="sc">*</span> <span class="fu">dpois</span>( ns, <span class="at">lambda =</span> lambda ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[
\E\left[ S \middle| S\ \text{es máximo} \right] = 6000.00
\]</span></p>
<p>De este razonamiento se puede evidenciar que al aplicar un deducible con cota superior, se corta la cola de la distribución y por tal razón no se puede esperar valores extremos por parte de la severidad, sino tan solo por un aumento de frecuencia, e incluso el valor máximo esperado es proporcional a la cota superior <span class="math inline">\(M\)</span> veces la frecuencia esperada. De ahí que, al aplicar un deducible con cota superior no se puede esperar un encarecimiento de primas por aumento de severidad, ya que los reclamos están acotados, así como el máximo esperado; lo único que puede encarecer la prima es un aumento de frecuencia.</p>
<p>Como ya se lo mencionó, utilizando la simulación <span class="math inline">\(\{S_i\}\)</span> podemos determinar la distribución de probabilidad empírica <span class="math inline">\(F_m\)</span> que aproxima la distribución de <span class="math inline">\(F_S\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>FeS <span class="ot">&lt;-</span> <span class="fu">ecdf</span>( S )</span>
<span id="cb17-2"><a href="#cb17-2"></a>FeDS <span class="ot">&lt;-</span> <span class="fu">ecdf</span>( DS )</span>
<span id="cb17-3"><a href="#cb17-3"></a>s <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="dv">0</span>, ESmax, <span class="at">length =</span> <span class="dv">1000</span> )</span>
<span id="cb17-4"><a href="#cb17-4"></a>Fes <span class="ot">&lt;-</span> <span class="fu">sapply</span>( s, <span class="at">FUN =</span> FeS )</span>
<span id="cb17-5"><a href="#cb17-5"></a>FeDs <span class="ot">&lt;-</span> <span class="fu">sapply</span>( s, <span class="at">FUN =</span> FeDS )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>Smax <span class="ot">&lt;-</span> ESmax</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a>xbrk <span class="ot">&lt;-</span> <span class="fu">sort</span>( <span class="fu">unique</span>( <span class="fu">c</span>( d, M, <span class="fu">seq</span>( <span class="dv">0</span>, Smax, <span class="at">length =</span> <span class="dv">7</span> ) ) ) )</span>
<span id="cb18-4"><a href="#cb18-4"></a>xlbl <span class="ot">&lt;-</span> <span class="fu">formatC</span>( xbrk, <span class="at">digits =</span> <span class="dv">0</span>, <span class="at">format =</span> <span class="st">'f'</span> )</span>
<span id="cb18-5"><a href="#cb18-5"></a>xlim <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">0</span>, Smax )</span>
<span id="cb18-6"><a href="#cb18-6"></a></span>
<span id="cb18-7"><a href="#cb18-7"></a>ybrk <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">11</span> )</span>
<span id="cb18-8"><a href="#cb18-8"></a>ylbl <span class="ot">&lt;-</span> <span class="fu">formatC</span>( ybrk, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> )</span>
<span id="cb18-9"><a href="#cb18-9"></a>ylim <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">1</span> )</span>
<span id="cb18-10"><a href="#cb18-10"></a></span>
<span id="cb18-11"><a href="#cb18-11"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>  <span class="fu">geom_step</span>( <span class="fu">aes</span>( <span class="at">x =</span> s, <span class="at">y =</span> Fes, <span class="at">colour =</span> <span class="st">'a'</span> ), <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>  <span class="fu">geom_step</span>( <span class="fu">aes</span>( <span class="at">x =</span> s, <span class="at">y =</span> FeDs, <span class="at">colour =</span> <span class="st">'b'</span> ), <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14"></a>  <span class="fu">geom_vline</span>( <span class="at">xintercept =</span> <span class="fu">c</span>( d, M ), <span class="at">colour =</span> <span class="st">'orange'</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span> ) <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15"></a>  <span class="fu">geom_point</span>( <span class="fu">aes</span>( <span class="dv">0</span>, PS0 ), <span class="at">colour =</span> <span class="st">'red3'</span>, <span class="at">size =</span> <span class="dv">3</span> ) <span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16"></a>  <span class="fu">scale_colour_manual</span>( <span class="at">breaks =</span> <span class="fu">c</span>( <span class="st">'a'</span>, <span class="st">'b'</span> ),</span>
<span id="cb18-17"><a href="#cb18-17"></a>                       <span class="at">values =</span> <span class="fu">c</span>( <span class="st">'olivedrab4'</span>, <span class="st">'dodgerblue4'</span> ) ) <span class="sc">+</span></span>
<span id="cb18-18"><a href="#cb18-18"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> xbrk,</span>
<span id="cb18-19"><a href="#cb18-19"></a>                      <span class="at">labels =</span> xlbl, </span>
<span id="cb18-20"><a href="#cb18-20"></a>                      <span class="at">limits =</span> xlim, </span>
<span id="cb18-21"><a href="#cb18-21"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="fl">0.008</span>, <span class="fl">0.008</span> ) ) <span class="sc">+</span></span>
<span id="cb18-22"><a href="#cb18-22"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks =</span> ybrk,</span>
<span id="cb18-23"><a href="#cb18-23"></a>                      <span class="at">labels =</span> ylbl, </span>
<span id="cb18-24"><a href="#cb18-24"></a>                      <span class="at">limits =</span> ylim, </span>
<span id="cb18-25"><a href="#cb18-25"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="fl">0.005</span>, <span class="fl">0.005</span> ) ) <span class="sc">+</span></span>
<span id="cb18-26"><a href="#cb18-26"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$s$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb18-27"><a href="#cb18-27"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$F_{S,m},F_{S^D,m}$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb18-28"><a href="#cb18-28"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-29"><a href="#cb18-29"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">"none"</span> )</span>
<span id="cb18-30"><a href="#cb18-30"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<!------------------------------------------------------------------------------------------------->
</section>
</section>
<section id="algoritmo_panjer" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="algoritmo_panjer"><span class="header-section-number">7.7</span> Algoritmo de Panjer</h2>
<p>El siguiente algoritmo es de especial interés para determinar la densidad de probabilidad <span class="math inline">\(f_S\)</span> del total de reclamos <span class="math inline">\(S\)</span>. Se asume que el conteo de siniestro <span class="math inline">\(N\)</span> viene dado por alguna de las distribuciones en la familia <span class="math inline">\((a,b,0)\)</span> y los reclamos individuales son <span class="math inline">\(\{X_i\}\)</span> son i.i.d y también independientes de <span class="math inline">\(N\)</span>. En ese contexto podemos observar que para cualquier <span class="math inline">\(s &gt; 0\)</span>, tenemos: <span class="math display">\[
\begin{split}
f_S( s )
&amp; = \sum\limits_{n=1}^{+\infty} p_n f_X^{\star n}( s ) \\
&amp; = p_1 f_X( s ) + \sum\limits_{n=2}^{+\infty} p_n f_X^{\star n}( s ) \\
&amp; = p_1 f_X( s ) + \sum\limits_{n=1}^{+\infty} p_{n+1} f_X^{\star n + 1}( s ) \\
&amp; = p_1 f_X( s ) + \sum\limits_{n=1}^{+\infty} \left( a + \frac{b}{n+1} \right) p_{n} f_X^{\star n + 1}( s ) \\
&amp; = p_1 f_X( s )
+ \sum\limits_{n=1}^{+\infty} p_{n} \int\limits_0^s \left( a + \frac{b y}{s} \right) f_X( y ) f_X^{\star n}( s - y )\ dy \\
&amp; = p_1 f_X( s )
+ \int\limits_0^s \left( a + \frac{b y}{s} \right) f_X( y ) \sum\limits_{n=1}^{+\infty} p_{n} f_X^{\star n}( s - y )\ dy \\
&amp; = p_1 f_X( s ) + \int\limits_0^s \left( a + \frac{b y}{s} \right) f_X( y ) f_S( s - y )\ dy
\end{split}
\]</span> cuando <span class="math inline">\(s = 0\)</span>, la probabilidad se concentra en <span class="math inline">\(0\)</span>, y por tanto <span class="math inline">\(f_S( 0 ) = p_0\)</span></p>
<p>Como consecuencia del análisis anterior resulta la relación recurrente, la cual es precisamente explotada de forma numérica por el algoritmo de Panjer. <span class="math display">\[
f_S( s ) = p_1 f_X( s ) + \int\limits_0^s \left( a + \frac{b y}{s} \right) f_X( y ) f_S( s - y )\ dy,
\qquad \forall s &gt; 0
\]</span></p>
<p>Si se toma una discretización <span class="math inline">\(0 = s_0 &lt; s_1 &lt; \cdots &lt; s_n\)</span> para aproximar la integral anterior <span class="math display">\[
f_S\left( s_k \right)
= p_1 f_X\left( s_k \right) + \sum\limits_{i=0}^{k-1} \left( a + \frac{b s_i}{s_k} \right)
f_X\left( s_i \right) f_S\left( s_{k-i} \right) \left( s_{i+1} - s_i \right)
\]</span></p>
<p>Al tomar un división uniforme para la malla utilizada para aproximar la integral, por ejemplo, <span class="math inline">\(s_k = k h\)</span>, tenemos que: <span class="math display">\[
f_S\left( s_k \right)
= p_1 f_X\left( s_k \right) + h \sum\limits_{i=0}^{k-1} \left( a + \frac{b i}{k} \right)
f_X\left( s_i \right) f_S\left( s_{k-i} \right)
\]</span> de donde resulta una forma bien conocida para el algoritmo de Panjer. sin embargo, es importante tener en cuenta que una malla de paso no constante puede ser mejor adaptada para realizar la integral.</p>
<div id="l6ex7" class="example">
<p>Consideremos el caso para un reclamo total <span class="math inline">\(S\)</span> donde el conteo de los siniestros <span class="math inline">\(N \rightsquigarrow NBin( \alpha, p )\)</span> y las severidades <span class="math inline">\(\{X_i\}\)</span> son i.i.d con distribución <span class="math inline">\(LN( \mu, \sigma )\)</span>. Utilizaremos el algoritmo de Panjer para aproximar la densidad de probabilidad de <span class="math inline">\(f_S\)</span> de <span class="math inline">\(S\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>n <span class="ot">&lt;-</span> <span class="fl">7e4</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>p <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>alpha <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> p</span>
<span id="cb19-5"><a href="#cb19-5"></a>b <span class="ot">&lt;-</span> ( <span class="dv">1</span> <span class="sc">-</span> p ) <span class="sc">*</span> ( alpha <span class="sc">-</span> <span class="dv">1</span> )</span>
<span id="cb19-6"><a href="#cb19-6"></a>p0 <span class="ot">&lt;-</span> p<span class="sc">^</span>alpha</span>
<span id="cb19-7"><a href="#cb19-7"></a>u <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>s <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>smax <span class="ot">&lt;-</span> <span class="fl">5e3</span></span>
<span id="cb19-10"><a href="#cb19-10"></a>dist <span class="ot">&lt;-</span> dlnorm</span>
<span id="cb19-11"><a href="#cb19-11"></a></span>
<span id="cb19-12"><a href="#cb19-12"></a>pardist <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">meanlog =</span> u, <span class="at">sdlog =</span> s )</span>
<span id="cb19-13"><a href="#cb19-13"></a>sg <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="dv">0</span>, smax, <span class="at">length =</span> n )</span>
<span id="cb19-14"><a href="#cb19-14"></a>ds <span class="ot">&lt;-</span> <span class="fu">diff</span>( sg )</span>
<span id="cb19-15"><a href="#cb19-15"></a>fX <span class="ot">&lt;-</span> <span class="fu">sapply</span>( sg, <span class="at">FUN =</span> <span class="cf">function</span>( y ) <span class="fu">do.call</span>( dist, <span class="fu">c</span>( y, pardist ) ) )</span>
<span id="cb19-16"><a href="#cb19-16"></a></span>
<span id="cb19-17"><a href="#cb19-17"></a>fS <span class="ot">&lt;-</span> p0</span>
<span id="cb19-18"><a href="#cb19-18"></a>K <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb19-19"><a href="#cb19-19"></a>p1 <span class="ot">&lt;-</span> ( a <span class="sc">+</span> b ) <span class="sc">*</span> p0</span>
<span id="cb19-20"><a href="#cb19-20"></a><span class="cf">for</span> ( k <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n ) {</span>
<span id="cb19-21"><a href="#cb19-21"></a>  fS <span class="ot">&lt;-</span> <span class="fu">c</span>( fS, p1 <span class="sc">*</span> fX[ k ] <span class="sc">+</span> <span class="fu">sum</span>( ( a <span class="sc">+</span> b <span class="sc">*</span> sg[ K ] <span class="sc">/</span> sg[ k ] ) <span class="sc">*</span> fX[ K ] <span class="sc">*</span> fS[ <span class="fu">rev</span>( K ) ] <span class="sc">*</span> ds[ K ] ) )</span>
<span id="cb19-22"><a href="#cb19-22"></a>  K <span class="ot">&lt;-</span> <span class="fu">c</span>( K, k )</span>
<span id="cb19-23"><a href="#cb19-23"></a>}</span>
<span id="cb19-24"><a href="#cb19-24"></a></span>
<span id="cb19-25"><a href="#cb19-25"></a><span class="fu">set.seed</span>( <span class="dv">32141223</span> )</span>
<span id="cb19-26"><a href="#cb19-26"></a>m <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb19-27"><a href="#cb19-27"></a>N <span class="ot">&lt;-</span> <span class="fu">rnbinom</span>( <span class="at">n =</span> m, <span class="at">size =</span> alpha, <span class="at">prob =</span> p )</span>
<span id="cb19-28"><a href="#cb19-28"></a>X <span class="ot">&lt;-</span> <span class="fu">lapply</span>( N, <span class="at">FUN =</span> <span class="cf">function</span>( n ) <span class="fu">rlnorm</span>( n, <span class="at">meanlog =</span> u, <span class="at">sdlog =</span> s ) )</span>
<span id="cb19-29"><a href="#cb19-29"></a>S <span class="ot">&lt;-</span> <span class="fu">sapply</span>( X, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">sum</span>( x, <span class="at">na.rm =</span> <span class="cn">TRUE</span> ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>El algoritmo de Panjer suele tener problemas para ajustarse en los primeros valores de la densidad <span class="math inline">\(f_S\)</span>, tal como lo muestra el gráfico a continuación, usualmente hay una sobre estimación. Además, el algoritmo solo es válido cuando el conteo de siniestros pertenece a la familia de distribuciones <span class="math inline">\((a,b,0)\)</span>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>fmax <span class="ot">&lt;-</span> <span class="fl">0.0007</span></span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="fu">geom_histogram</span>( <span class="fu">aes</span>( S, <span class="fu">after_stat</span>( density ) ), <span class="at">fill =</span> <span class="st">'dodgerblue4'</span>, <span class="at">colour =</span> <span class="st">'white'</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">bins =</span> <span class="fu">nclass.FD</span>( S ) ) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> sg, <span class="at">y =</span> fS ), <span class="at">colour =</span> <span class="st">'purple3'</span>, <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, smax, <span class="at">length =</span> <span class="dv">7</span> ),</span>
<span id="cb20-7"><a href="#cb20-7"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, smax, <span class="at">length =</span> <span class="dv">7</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb20-8"><a href="#cb20-8"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, smax ), </span>
<span id="cb20-9"><a href="#cb20-9"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, fmax, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb20-11"><a href="#cb20-11"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, fmax, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">format =</span> <span class="st">'f'</span> ),</span>
<span id="cb20-12"><a href="#cb20-12"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, fmax ),</span>
<span id="cb20-13"><a href="#cb20-13"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb20-14"><a href="#cb20-14"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$s$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb20-15"><a href="#cb20-15"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$f_S$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb20-16"><a href="#cb20-16"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb20-17"><a href="#cb20-17"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">"none"</span> )</span>
<span id="cb20-18"><a href="#cb20-18"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>e <span class="ot">&lt;-</span> <span class="fu">cumsum</span>( fS[ <span class="sc">-</span><span class="dv">1</span> ] <span class="sc">*</span> ds ) <span class="sc">-</span> <span class="fu">ecdf</span>( S )( sg[ <span class="sc">-</span><span class="dv">1</span> ] )</span>
<span id="cb21-2"><a href="#cb21-2"></a></span>
<span id="cb21-3"><a href="#cb21-3"></a>eb <span class="ot">&lt;-</span> <span class="fu">max</span>( <span class="fu">abs</span>( e ) )</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>  <span class="fu">geom_histogram</span>( <span class="fu">aes</span>( <span class="at">x =</span> e, <span class="at">y =</span> <span class="fu">after_stat</span>( density ) ), <span class="at">fill =</span> <span class="st">'grey50'</span>, <span class="at">colour =</span> <span class="st">'dodgerblue3'</span>, <span class="at">bins =</span> <span class="fu">nclass.scott</span>( e ) ) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">labels =</span> <span class="fu">label_scientific</span>( <span class="at">digits =</span> <span class="dv">2</span> ) ) <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$e$"</span> ) ) <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g9-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<!------------------------------------------------------------------------------------------------->
</section>
<section id="estimacion_transformada_fourier" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="estimacion_transformada_fourier"><span class="header-section-number">7.8</span> Estimación usando la transformada de Fourier</h2>
<p>Se puede utilizar la transformada de Fourier para determinar la densidad de la suma <span class="math inline">\(S_n = \sum\limits_{i=1}^n X_i\)</span> de varias variables aleatorias <span class="math inline">\(X_1 \rightsquigarrow f_{X_1}, \ldots, X_n \rightsquigarrow f_{X_n}\)</span> que son independientes, pero que podrían ser o no idénticamente distribuidas. Claramente, la densidad de probabilidad de <span class="math inline">\(S\)</span> está dada por la convolución de las densidades de probabilidad de cada una de las variables aleatorias <span class="math inline">\(X_1, \ldots, X_n\)</span>. <span class="math display">\[
f_S = f_{X_1} \star \cdots \star f_{X_n}
\]</span> sin embargo esta convolución implica el realizar una interacción en <span class="math inline">\(n\)</span>-dimensiones.</p>
<p>Si las las variables aleatorias <span class="math inline">\(\{X_i\}\)</span> son independientes sabemos además que <span class="math display">\[
\Fo\left( f_S \right) = \prod\limits_{i=1}^n \Fo\left( f_{X_i} \right)
\]</span></p>
<p>Por otra parte, con lo anterior sabemos que es posible aproximar numéricamente cada <span class="math inline">\(\Fo\left( f_{X_i} \right)\)</span> con una serie <span class="math inline">\(\{\hat{f}_{i,j}\}\)</span> dada por la discretización de la transformada de Fourier y su aplicación sobre la discretización de la densidad de probabilidad <span class="math inline">\(f_{i,k} = f_{X_i}( s_k )\)</span>. Por tanto, para cada de las densidades con <span class="math inline">\(i \in \{1, \ldots, n\}\)</span> y <span class="math inline">\(\omega_j = \frac{j}{b-a}\)</span> con <span class="math inline">\(j \in \{0,\ldots, N-1\}\)</span>, se puede calcular de forma separada las aproximaciones a cada una de las transformadas <span class="math display">\[
\Fo( f_{X_i} )\left( \omega_j \right)  
\approx \hat{f}_{i,j}
= h \exp\left( -2\pi i \omega_j a \right) \left( \DFT\left[ \{f_{i,k}\} \right]  \right)_j
\]</span></p>
<p>con lo anterior, también, se puede realizar una aproximación a la trasformada de Fourier <span class="math inline">\(\Fo\left( f_S \right)\)</span> de la densidad de probabilidad que buscamos <span class="math inline">\(f_S\)</span>, como el producto de sus transformadas de Fourier. <span class="math display">\[
\Fo( f_{S} )\left( \omega_j \right)  
= \prod\limits_{i=1}^n \Fo\left( f_{X_i} \right)\left( \omega_j \right)
\approx \prod\limits_{i=1}^n \hat{f}_{i,j}
\]</span></p>
<p>utilizando la inversión de la transformada de Fourier discreta podemos calcular una serie que precisamente aproxima a la densidad <span class="math inline">\(f_S\)</span> <span class="math display">\[
\{ f_{S}( s_k ) \}
\approx \Re\left( \DFT^{-1}\left[ \left\{ \frac{1}{h} \exp\left( 2\pi i \omega_j a \right)
\prod\limits_{i=1}^n \hat{f}_{i,j} \right\} \right] \right)
\]</span></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>N <span class="ot">&lt;-</span> <span class="dv">50000</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="fu">set.seed</span>(<span class="dv">94312</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a>alpha <span class="ot">&lt;-</span> <span class="fu">sample</span>( <span class="at">x =</span> <span class="fu">seq</span>( <span class="dv">1</span>, <span class="dv">20</span>, <span class="at">length =</span> <span class="dv">40</span> ), <span class="at">size =</span> <span class="dv">50</span>, <span class="at">replace =</span> <span class="cn">TRUE</span> )</span>
<span id="cb22-4"><a href="#cb22-4"></a>theta <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>b <span class="ot">&lt;-</span> <span class="fu">sum</span>( <span class="fu">sapply</span>( alpha, <span class="at">FUN =</span> <span class="cf">function</span>( a ) <span class="fu">qgamma</span>( <span class="fl">0.99</span>, <span class="at">shape =</span> a, <span class="at">scale =</span> theta ) ) )</span>
<span id="cb22-6"><a href="#cb22-6"></a>a <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-7"><a href="#cb22-7"></a>h <span class="ot">&lt;-</span> ( b <span class="sc">-</span> a ) <span class="sc">/</span> N</span>
<span id="cb22-8"><a href="#cb22-8"></a>n <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>N</span>
<span id="cb22-9"><a href="#cb22-9"></a>s <span class="ot">&lt;-</span> a <span class="sc">+</span> n <span class="sc">*</span> h</span>
<span id="cb22-10"><a href="#cb22-10"></a>w <span class="ot">&lt;-</span> n <span class="sc">/</span> ( b <span class="sc">-</span> a )</span>
<span id="cb22-11"><a href="#cb22-11"></a>eta <span class="ot">&lt;-</span> h <span class="sc">*</span> <span class="fu">exp</span>( <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="dv">1</span>i <span class="sc">*</span> w <span class="sc">*</span> a )</span>
<span id="cb22-12"><a href="#cb22-12"></a>fX <span class="ot">&lt;-</span> <span class="fu">lapply</span>( alpha, <span class="cf">function</span>( a ) <span class="fu">sapply</span>( s, <span class="at">FUN =</span> <span class="cf">function</span>( sk ) <span class="fu">dgamma</span>( sk, <span class="at">shape =</span> a, <span class="at">scale =</span> theta ) ) )</span>
<span id="cb22-13"><a href="#cb22-13"></a>Fof <span class="ot">&lt;-</span> <span class="fu">lapply</span>( fX, <span class="at">FUN =</span> <span class="cf">function</span>( fi ) eta <span class="sc">*</span> <span class="fu">fft</span>( fi ) )</span>
<span id="cb22-14"><a href="#cb22-14"></a>FoS <span class="ot">&lt;-</span> Fof[[ <span class="dv">1</span> ]]</span>
<span id="cb22-15"><a href="#cb22-15"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>( fX ) ) {</span>
<span id="cb22-16"><a href="#cb22-16"></a>  FoS <span class="ot">&lt;-</span> FoS <span class="sc">*</span> Fof[[ i ]]</span>
<span id="cb22-17"><a href="#cb22-17"></a>}</span>
<span id="cb22-18"><a href="#cb22-18"></a>fS <span class="ot">&lt;-</span> <span class="fu">fft</span>( eta<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">*</span> FoS, <span class="at">inverse =</span> <span class="cn">TRUE</span> ) <span class="sc">/</span> ( N <span class="sc">+</span> <span class="dv">1</span> )</span>
<span id="cb22-19"><a href="#cb22-19"></a>fS <span class="ot">&lt;-</span> <span class="fu">Re</span>( fS )</span>
<span id="cb22-20"><a href="#cb22-20"></a>FS <span class="ot">&lt;-</span> <span class="fu">cumsum</span>( fS ) <span class="sc">*</span> h</span>
<span id="cb22-21"><a href="#cb22-21"></a>fs <span class="ot">&lt;-</span> <span class="fu">sapply</span>( s, <span class="at">FUN =</span> <span class="cf">function</span>( sk ) <span class="fu">dgamma</span>( sk, <span class="at">shape =</span> <span class="fu">sum</span>( alpha ), <span class="at">scale =</span> theta ) )</span>
<span id="cb22-22"><a href="#cb22-22"></a>Fs <span class="ot">&lt;-</span> <span class="fu">sapply</span>( s, <span class="at">FUN =</span> <span class="cf">function</span>( sk ) <span class="fu">pgamma</span>( sk, <span class="at">shape =</span> <span class="fu">sum</span>( alpha ), <span class="at">scale =</span> theta ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> s, <span class="at">y =</span> fs ), <span class="at">colour =</span> <span class="st">'darkred'</span>, <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span> </span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">geom_point</span>( <span class="fu">aes</span>( <span class="at">x =</span> s, <span class="at">y =</span> fS ), <span class="at">colour =</span> <span class="st">'olivedrab3'</span>, <span class="at">size =</span> <span class="fl">0.2</span> ) <span class="sc">+</span> </span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$x$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb23-5"><a href="#cb23-5"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$f_{S}(x)$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb23-6"><a href="#cb23-6"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>A pesar que la aproximación a la densidad de probabilidad parece ser buena, la condición de normalización, no es satisfecha, como muestra el siguiente ejemplo. Ello sugiere que al algoritmo de estimación de la densidad hay que realizarle algún ajuste o en su defecto incrementar la precisión numérica.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> s, <span class="at">y =</span> Fs ), <span class="at">colour =</span> <span class="st">'darkred'</span>, <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span> </span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">geom_point</span>( <span class="fu">aes</span>( <span class="at">x =</span> s, <span class="at">y =</span> FS ), <span class="at">colour =</span> <span class="st">'olivedrab3'</span>, <span class="at">size =</span> <span class="fl">0.2</span> ) <span class="sc">+</span> </span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">'dodgerblue2'</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span> ) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$x$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb24-6"><a href="#cb24-6"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$F_{S}(x)$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb24-7"><a href="#cb24-7"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g11-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>e <span class="ot">&lt;-</span> fS <span class="sc">-</span> fs</span>
<span id="cb25-2"><a href="#cb25-2"></a>eb <span class="ot">&lt;-</span> <span class="fu">max</span>( <span class="fu">abs</span>( e ) )</span>
<span id="cb25-3"><a href="#cb25-3"></a></span>
<span id="cb25-4"><a href="#cb25-4"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="fu">geom_histogram</span>( <span class="fu">aes</span>( <span class="at">x =</span> e, <span class="at">y =</span> <span class="fu">after_stat</span>( density ) ), <span class="at">fill =</span> <span class="st">'grey50'</span>, <span class="at">colour =</span> <span class="st">'dodgerblue3'</span>, <span class="at">bins =</span> <span class="fu">nclass.scott</span>( e ) ) <span class="sc">+</span> </span>
<span id="cb25-6"><a href="#cb25-6"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">labels =</span> <span class="fu">label_scientific</span>( <span class="at">digits =</span> <span class="dv">4</span> ) ) <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$e$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb25-8"><a href="#cb25-8"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g12-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Utilizando la misma idea anterior, se puede aproximar cada uno de los términos presentes en la serie que determina la densidad de probabilidad <span class="math inline">\(f_S\)</span> de un modelo colectivo. Se selecciona un número máximo <span class="math inline">\(M \in \N\)</span> de términos a ser considerados en la serie, <span class="math inline">\(M\)</span> lo suficientemente grande como para que la siguiente aproximación resulte adecuada. <span class="math display">\[
\{ f_{S}( s_k ) \}
\approx  \Re\left( \DFT^{-1}\left[ \sum\limits_{n=1}^{M} \left\{ \frac{1}{h} \exp\left( 2\pi i \omega_j a \right)
\prod\limits_{i=1}^n \hat{f}_{i,j} \right\}\ p_n \right] \right),
\qquad \forall s_k &gt; 0
\]</span></p>
<p>para el caso cuando <span class="math inline">\(s_o = 0\)</span>, tenemos que <span class="math inline">\(f_S( s_0 ) = f_S( 0 ) = p_0\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>M <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>N <span class="ot">&lt;-</span> <span class="fl">7e4</span></span>
<span id="cb26-3"><a href="#cb26-3"></a></span>
<span id="cb26-4"><a href="#cb26-4"></a>p <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>alpha <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>pn <span class="ot">&lt;-</span> <span class="fu">dnbinom</span>( <span class="dv">0</span><span class="sc">:</span>M, <span class="at">size =</span> alpha, <span class="at">prob =</span> p )</span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a>u <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb26-9"><a href="#cb26-9"></a>s <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb26-10"><a href="#cb26-10"></a></span>
<span id="cb26-11"><a href="#cb26-11"></a>b <span class="ot">&lt;-</span> <span class="fl">5e3</span></span>
<span id="cb26-12"><a href="#cb26-12"></a>a <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-13"><a href="#cb26-13"></a>h <span class="ot">&lt;-</span> ( b <span class="sc">-</span> a ) <span class="sc">/</span> N</span>
<span id="cb26-14"><a href="#cb26-14"></a>n <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>N</span>
<span id="cb26-15"><a href="#cb26-15"></a>sg <span class="ot">&lt;-</span> a <span class="sc">+</span> n <span class="sc">*</span> h</span>
<span id="cb26-16"><a href="#cb26-16"></a>w <span class="ot">&lt;-</span> n <span class="sc">/</span> ( b <span class="sc">-</span> a )</span>
<span id="cb26-17"><a href="#cb26-17"></a>eta <span class="ot">&lt;-</span> h <span class="sc">*</span> <span class="fu">exp</span>( <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="dv">1</span>i <span class="sc">*</span> w <span class="sc">*</span> a )</span>
<span id="cb26-18"><a href="#cb26-18"></a>f <span class="ot">&lt;-</span> <span class="fu">sapply</span>( sg, <span class="at">FUN =</span> <span class="cf">function</span>( sk ) <span class="fu">dlnorm</span>( sk, <span class="at">meanlog =</span> u, <span class="at">sdlog =</span> s ) )</span>
<span id="cb26-19"><a href="#cb26-19"></a>Fof <span class="ot">&lt;-</span> eta <span class="sc">*</span> <span class="fu">fft</span>( f )</span>
<span id="cb26-20"><a href="#cb26-20"></a>FoS <span class="ot">&lt;-</span> <span class="fu">rep</span>( <span class="dv">0</span>, N <span class="sc">+</span> <span class="dv">1</span> )</span>
<span id="cb26-21"><a href="#cb26-21"></a><span class="cf">for</span> ( n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M ) {</span>
<span id="cb26-22"><a href="#cb26-22"></a>  FoS <span class="ot">&lt;-</span> FoS <span class="sc">+</span> pn[ n <span class="sc">+</span> <span class="dv">1</span> ] <span class="sc">*</span> Fof<span class="sc">^</span>n</span>
<span id="cb26-23"><a href="#cb26-23"></a>}</span>
<span id="cb26-24"><a href="#cb26-24"></a>fS <span class="ot">&lt;-</span> <span class="fu">fft</span>( eta<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">*</span> FoS, <span class="at">inverse =</span> <span class="cn">TRUE</span> ) <span class="sc">/</span> ( N <span class="sc">+</span> <span class="dv">1</span> )</span>
<span id="cb26-25"><a href="#cb26-25"></a>fS <span class="ot">&lt;-</span> <span class="fu">Re</span>( fS )</span>
<span id="cb26-26"><a href="#cb26-26"></a>fS[<span class="dv">1</span>] <span class="ot">=</span> pn[<span class="dv">1</span>]</span>
<span id="cb26-27"><a href="#cb26-27"></a></span>
<span id="cb26-28"><a href="#cb26-28"></a><span class="fu">set.seed</span>( <span class="dv">32141223</span> )</span>
<span id="cb26-29"><a href="#cb26-29"></a>m <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb26-30"><a href="#cb26-30"></a>N <span class="ot">&lt;-</span> <span class="fu">rnbinom</span>( <span class="at">n =</span> m, <span class="at">size =</span> alpha, <span class="at">prob =</span> p )</span>
<span id="cb26-31"><a href="#cb26-31"></a>X <span class="ot">&lt;-</span> <span class="fu">lapply</span>( N, <span class="at">FUN =</span> <span class="cf">function</span>( n ) <span class="fu">rlnorm</span>( n, <span class="at">meanlog =</span> u, <span class="at">sdlog =</span> s ) )</span>
<span id="cb26-32"><a href="#cb26-32"></a>S <span class="ot">&lt;-</span> <span class="fu">sapply</span>( X, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">sum</span>( x, <span class="at">na.rm =</span> <span class="cn">TRUE</span> ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>fmax <span class="ot">&lt;-</span> <span class="fl">0.0007</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>smax <span class="ot">&lt;-</span> <span class="fl">5e3</span></span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="fu">geom_histogram</span>( <span class="fu">aes</span>( S, <span class="fu">after_stat</span>( density ) ), <span class="at">fill =</span> <span class="st">'dodgerblue4'</span>, <span class="at">colour =</span> <span class="st">'white'</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">bins =</span> <span class="fu">nclass.FD</span>( S ) ) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> sg, <span class="at">y =</span> fS ), <span class="at">colour =</span> <span class="st">'purple3'</span>, <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, b, <span class="at">length =</span> <span class="dv">7</span> ),</span>
<span id="cb27-8"><a href="#cb27-8"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, smax, <span class="at">length =</span> <span class="dv">7</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb27-9"><a href="#cb27-9"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, smax ), </span>
<span id="cb27-10"><a href="#cb27-10"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, fmax, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb27-12"><a href="#cb27-12"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, fmax, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">format =</span> <span class="st">'f'</span> ),</span>
<span id="cb27-13"><a href="#cb27-13"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, fmax ),</span>
<span id="cb27-14"><a href="#cb27-14"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb27-15"><a href="#cb27-15"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$s$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb27-16"><a href="#cb27-16"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$f_S$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb27-17"><a href="#cb27-17"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb27-18"><a href="#cb27-18"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">"none"</span> )</span>
<span id="cb27-19"><a href="#cb27-19"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g13-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r fold-hide number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>e <span class="ot">&lt;-</span> <span class="fu">cumsum</span>( fS[ <span class="sc">-</span><span class="dv">1</span> ] <span class="sc">*</span> <span class="fu">diff</span>( sg ) ) <span class="sc">-</span> <span class="fu">ecdf</span>( S )( sg[<span class="sc">-</span><span class="dv">1</span>] )</span>
<span id="cb28-2"><a href="#cb28-2"></a></span>
<span id="cb28-3"><a href="#cb28-3"></a>eb <span class="ot">&lt;-</span> <span class="fu">max</span>( <span class="fu">abs</span>( e ) )</span>
<span id="cb28-4"><a href="#cb28-4"></a></span>
<span id="cb28-5"><a href="#cb28-5"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="fu">geom_histogram</span>( <span class="fu">aes</span>( <span class="at">x =</span> e, <span class="at">y =</span> <span class="fu">after_stat</span>( density ) ), <span class="at">fill =</span> <span class="st">'grey50'</span>, <span class="at">colour =</span> <span class="st">'dodgerblue3'</span>, <span class="at">bins =</span> <span class="fu">nclass.FD</span>( e ) ) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">labels =</span> <span class="fu">label_scientific</span>( <span class="at">digits =</span> <span class="dv">2</span> ) ) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$e$"</span> ) ) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g14-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<!------------------------------------------------------------------------------------------------->
</section>
<section id="temporalidad_numero_reclamos" class="level2" data-number="7.9">
<h2 data-number="7.9" class="anchored" data-anchor-id="temporalidad_numero_reclamos"><span class="header-section-number">7.9</span> Temporalidad y ajustes del número de reclamos</h2>
<p>Hasta el momento no hemos tomado en cuenta cierta componente de temporalidad que muestra la frecuencia de los reclamos. Debemos ser muy consientes que los reclamos se producen en el tiempo y que el número de estos dependerá del periodo de exposición de cada uno de los asegurados, en otras palabras en la estimación de la frecuencia se debe tomar en cuenta que las pólizas tienen un periodo de cobertura, una fecha inicial y una fecha final.</p>
<p>Más puntualmente, para una inferencia sencilla si estimamos reclamos de pólizas que duran 2 años entonces la frecuencia del número de reclamos <span class="math inline">\(N\)</span> será bianual. Si por el contrario se quiere utilizar esta frecuencia para estimar el número de reclamos para pólizas con cobertura anual entonces, es necesario realizar un ajuste acorde.</p>
<div id="der" class="Definition" title="Exposición al riesgo">
<p></p><details class="Definition fbx-simplebox fbx-default" open=""><summary><strong>Definition 7.5: </strong>Exposición al riesgo</summary><div>Dando algo más de sentido matemático a este razonamiento, a cada póliza podemos asociar su respectiva <strong>exposición al riesgo</strong>, que no es más que el ancho de intervalo dado por la fecha inicial de la póliza, menos la fecha final de la póliza. Usualmente la unidad que su utiliza para medir este intervalo es en años, pero puede cambiársela, siempre y cuando la formulación del modelo sea clara y el uso de estas unidades sea consistente para cálculos futuros. Así si tenemos <span class="math inline">\(n\)</span> pólizas para cada una de ellas hay un tiempo de inicio <span class="math inline">\(s_i\)</span> y un tiempo <span class="math inline">\(e_i\)</span> final, para todo <span class="math inline">\(i \in \{1, \ldots, n\}\)</span>, así la exposición al riesgo <span class="math inline">\(ER_i\)</span> está dada por una distancia <span class="math inline">\(d\)</span> <span class="math display">\[
ER_i = d( s_i, e_i )
\]</span><p></p>
</div></details>
</div>
<p>Por ejemplo, una buena distancia puede ser <span class="math display">\[
d( s, e ) = \frac{\# \left\{ \text{días entre $s$ y $e$} \right\}}{365.25}
\]</span> En la librería <code>lubridate</code> de R, tenemos una implementación que puede utilizarse fácilmente para calcular la distancia en años entre dos fechas dadas.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ymd</span>( <span class="st">'1951-04-09'</span> )</span>
<span id="cb29-2"><a href="#cb29-2"></a>e <span class="ot">&lt;-</span> <span class="fu">ymd</span>( <span class="st">'2025-04-09'</span> )</span>
<span id="cb29-3"><a href="#cb29-3"></a>d1 <span class="ot">&lt;-</span> <span class="fu">interval</span>( s, e ) <span class="sc">/</span> <span class="fu">dyears</span>( <span class="dv">1</span> )</span>
<span id="cb29-4"><a href="#cb29-4"></a>d2 <span class="ot">&lt;-</span> <span class="fu">length</span>( <span class="fu">seq</span>( s, e, <span class="at">by =</span> <span class="st">'day'</span>) ) <span class="sc">/</span> <span class="fl">365.25</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>La idea es ajustar la estimación de la frecuencia de forma proporcional a la exposición al riesgo, esto se puede realizar postulando que la variable aleatoria del conteo de siniestros, tienen una esperanza proporcional a la exposición al riesgo. <span class="math display">\[
\E\left[ N \right] = \lambda ER
\]</span> además se puede ajustar la distribución de probabilidad que se desee estimar en función del parámetro <span class="math inline">\(\lambda\)</span>, es así que para las distribuciones de probabilidad discretas que hemos introducido con anterioridad, tenemos la siguiente modificación.</p>
<ol type="1">
<li>Para la distribución de Poisson, tenemos la ley de probabilidad <span class="math display">\[
P( N = k ) = \exp\left( -\lambda ER \right) \frac{( \lambda ER )^k}{k!}, \qquad
\forall k \in \N
\]</span> entonces <span class="math inline">\(N \rightsquigarrow Pois( \lambda ER )\)</span>.</li>
</ol>
<p>En caso de disponer de una muestra de <span class="math inline">\(N_1, \ldots, N_m\)</span> de variables aleatorias independientes, y por otra parte exposiciones al riesgo <span class="math inline">\(ER_1, \ldots, ER_m\)</span> asociadas a cada una de las variables aleatorias, de tal forma que <span class="math inline">\(N_i \rightsquigarrow Pois( \lambda ER_i )\)</span>, entonces la función de verosimilitud logarítmica toma la forma: <span class="math display">\[
\ell( \lambda )
= - \lambda \sum\limits_{i=1}^m ER_i
+ \sum\limits_{i=1}^m N_i \log\left( ER_i \right)
+ \sum\limits_{i=1}^m N_i \log\left( \lambda \right)
- \sum\limits_{i=1}^m \log\left( N_i! \right)
\]</span> en este caso el estimador por maximización de verosimilitud es bien sencillo de determinar y está dado por: <span class="math display">\[
\lambda = \frac{\sum\limits_{i=1}^m N_i}{\sum\limits_{i=1}^m ER_i }
\]</span></p>
<ol start="2" type="1">
<li>Para la distribución binomial begativa, tenemos que si <span class="math display">\[
\lambda ER = \alpha \frac{1-p}{p} \Rightarrow p = \frac{\alpha}{\lambda ER + \alpha}
\]</span> de donde la ley de probabilidad queda modificada como <span class="math display">\[
P( N = k )
= \frac{\Gamma( \alpha + k )}{\Gamma(k+1) \Gamma(\alpha)}
\left( \frac{\alpha}{\lambda ER + \alpha} \right)^\alpha \left( \frac{\lambda ER}{\lambda ER + \alpha} \right)^k, \qquad
\forall k \in \N
\]</span> entonces <span class="math inline">\(N \rightsquigarrow NBinom\left( \alpha, \frac{\alpha}{\lambda ER + \alpha} \right)\)</span>.</li>
</ol>
<p>Similar que antes, si disponemos de una muestra de <span class="math inline">\(N_1, \ldots, N_m\)</span> de variables aleatorias independientes y también exposiciones al riesgo <span class="math inline">\(ER_1, \ldots, ER_m\)</span> asociadas a cada una de las variables aleatorias, de tal forma que <span class="math inline">\(N_i \rightsquigarrow NBinom\left( \alpha, \frac{\alpha}{\lambda ER_i + \alpha} \right)\)</span>, entonces la función de verosimilitud logarítmica toma la forma: <span class="math display">\[
\begin{split}
\ell( \alpha, \lambda )
&amp; = \sum\limits_{i=1}^m \log \Gamma( \alpha + N_i )
- \sum\limits_{i=1}^m \log \Gamma( N_i + 1 )
- m \log \Gamma( \alpha ) \\
&amp; + \sum\limits_{i=1}^m N_i \log\left( \lambda \right)
+ \sum\limits_{i=1}^m N_i \log\left( ER_i \right)
- \sum\limits_{i=1}^m N_i \log\left( \lambda ER_i + \alpha \right)
+ m \alpha \log\left( \alpha \right) \\
&amp; - \alpha \sum\limits_{i=1}^m \log\left( \lambda ER_i + \alpha \right)
\end{split}
\]</span></p>
<ol start="3" type="1">
<li>Para la distribución binomial, tenemos que si <span class="math display">\[
\lambda ER = np \Rightarrow p = \frac{\lambda ER}{n}
\]</span> de donde la ley de probabilidad queda modificada como <span class="math display">\[
P( N = k ) = \binom{n}{k} \left( \frac{\lambda ER}{n} \right)^k \left( 1 - \frac{\lambda ER}{n} \right)^{n-k},
\qquad \forall k \in \{0,\ldots, n\}
\]</span> entonces <span class="math inline">\(N \rightsquigarrow Binom\left( n, \frac{\lambda ER}{n} \right)\)</span></li>
</ol>
<p>Mismo razonamiento, si disponemos de una muestra de <span class="math inline">\(N_1, \ldots, N_m\)</span> de variables aleatorias independientes y también exposiciones al riesgo <span class="math inline">\(ER_1, \ldots, ER_m\)</span> asociadas a cada una de las variables aleatorias, de tal forma que <span class="math inline">\(N_i \rightsquigarrow  Binom\left( n, \frac{\lambda ER_i}{n} \right)\)</span>, entonces la función de verosimilitud logarítmica toma la forma: <span class="math display">\[
\begin{split}
\ell( n, \lambda )
&amp; = m \log( n! )
- \sum\limits_{i=1}^m \log( N_i! )
- \sum\limits_{i=1}^m \log( (n - N_i)! ) \\
&amp; + \sum\limits_{i=1}^m N_i \log \lambda
+ \sum\limits_{i=1}^m N_i \log ER_i
- n \sum\limits_{i=1}^m N_i \\
&amp; + n \sum\limits_{i=1}^m \log\left( 1 - \frac{\lambda ER_i}{n} \right)
- \sum\limits_{i=1}^m N_i \log\left( 1 - \frac{\lambda ER_i}{n} \right)
\end{split}
\]</span></p>
<p>En los tres casos anteriores, hemos desarrollado una metodología para la estimación de la distribución de frecuencia de los reclamos, tomando en cuenta la exposición al riesgo de cada una de las pólizas a las cuales estos reclamos corresponden.</p>
<div id="l6ex8" class="example">
<p>Ahora bien, pongamos en aplicación todo lo aprendido hasta el momento. Para ello, trabajaremos con información de pólizas de un seguro de salud. La información está compuesta de dos objetos, uno la producción de pólizas y dos los reclamos de varios productos asociados al ramo.</p>
<p>La información corresponde a un seguro de salud el cual tiene pólizas individuales y colectivas, para cada una de sus contratos se especifica un deducible de la forma <span class="math inline">\(D( X ) = \min( \max( X - d, 0 ), M )\)</span>, donde precisamente <span class="math inline">\(d\)</span> es lo que se conoce como el deducible y <span class="math inline">\(M\)</span> como el monto máximo de cobertura.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">load</span>( <span class="st">'../RData/production_claims_health.RData'</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>El objeto con la producción de pólizas tienen la siguiente estructura. Es un objeto con una forma usual que uno puede encontrar en las bases de producción de un asegurador. Se incluye en particular campos de especial interés como la fecha de nacimiento <code>bdate</code>, el inicio de vigencia de la cobertura <code>start</code> y el final de vigencia de la cobertura <code>end</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>production[ <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> ] <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="fu">kable</span>(</span>
<span id="cb31-3"><a href="#cb31-3"></a>    <span class="at">label =</span> <span class="cn">NA</span>,</span>
<span id="cb31-4"><a href="#cb31-4"></a>    <span class="at">caption =</span> <span class="st">'Pólizas'</span>,</span>
<span id="cb31-5"><a href="#cb31-5"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-6"><a href="#cb31-6"></a>    <span class="at">align =</span> <span class="st">'llllrrrrrrrl'</span>,</span>
<span id="cb31-7"><a href="#cb31-7"></a>    <span class="at">digits =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span> ),</span>
<span id="cb31-8"><a href="#cb31-8"></a>    <span class="at">format.args =</span> <span class="fu">list</span>( <span class="at">big.mark =</span> <span class="st">','</span>, <span class="at">decimal.mark =</span> <span class="st">'.'</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span> ),</span>
<span id="cb31-9"><a href="#cb31-9"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-10"><a href="#cb31-10"></a>    <span class="at">centering =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-11"><a href="#cb31-11"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-12"><a href="#cb31-12"></a>    <span class="at">longtable =</span> <span class="cn">TRUE</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb31-13"><a href="#cb31-13"></a>  <span class="fu">kable_classic</span>( </span>
<span id="cb31-14"><a href="#cb31-14"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb31-15"><a href="#cb31-15"></a>    <span class="at">html_font =</span> <span class="st">"Cambria"</span>, </span>
<span id="cb31-16"><a href="#cb31-16"></a>    <span class="at">position =</span> <span class="st">'center'</span>, </span>
<span id="cb31-17"><a href="#cb31-17"></a>    <span class="at">latex_options =</span> <span class="fu">c</span>( <span class="st">'hold_position'</span>, <span class="st">'repeat_header'</span>, <span class="st">'scale_down'</span> ) ) <span class="sc">%&gt;%</span></span>
<span id="cb31-18"><a href="#cb31-18"></a>  <span class="fu">scroll_box</span>( <span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"500px"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="lightable-classic caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Pólizas</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">id</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">policy</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">insured</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">sex</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">bdate</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">premium</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">fpremium</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">start</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">end</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">type</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">deductible</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">amount</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">59f51c382ebf</td>
<td style="text-align: left;">288dd685</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">MALE</td>
<td style="text-align: right;">1986-09-14</td>
<td style="text-align: right;">297.68</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2017-12-22</td>
<td style="text-align: right;">2018-09-01</td>
<td style="text-align: right;">COL</td>
<td style="text-align: right;">25</td>
<td style="text-align: left;">11,250</td>
</tr>
<tr class="even">
<td style="text-align: left;">f1b316dbca9c</td>
<td style="text-align: left;">708ee54e</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">MALE</td>
<td style="text-align: right;">1998-11-30</td>
<td style="text-align: right;">390.00</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2018-02-22</td>
<td style="text-align: right;">2018-06-05</td>
<td style="text-align: right;">IND</td>
<td style="text-align: right;">35</td>
<td style="text-align: left;">12,250</td>
</tr>
<tr class="odd">
<td style="text-align: left;">9924a3ba6b5c</td>
<td style="text-align: left;">16fa4935</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1996-09-15</td>
<td style="text-align: right;">380.00</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2018-06-03</td>
<td style="text-align: right;">2018-08-24</td>
<td style="text-align: right;">IND</td>
<td style="text-align: right;">35</td>
<td style="text-align: left;">14,500</td>
</tr>
<tr class="even">
<td style="text-align: left;">59e63ffc9688</td>
<td style="text-align: left;">66d6f1d0</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1973-07-28</td>
<td style="text-align: right;">288.64</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2017-12-18</td>
<td style="text-align: right;">2018-12-17</td>
<td style="text-align: right;">COL</td>
<td style="text-align: right;">25</td>
<td style="text-align: left;">9,250</td>
</tr>
<tr class="odd">
<td style="text-align: left;">d28db8f7c754</td>
<td style="text-align: left;">6d64a583</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">MALE</td>
<td style="text-align: right;">1979-02-14</td>
<td style="text-align: right;">564.08</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">2018-01-11</td>
<td style="text-align: right;">2021-01-10</td>
<td style="text-align: right;">IND</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">12,750</td>
</tr>
<tr class="even">
<td style="text-align: left;">fb9e3f6e5c6f</td>
<td style="text-align: left;">b16ef666</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1964-12-19</td>
<td style="text-align: right;">375.00</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2018-01-23</td>
<td style="text-align: right;">2018-05-06</td>
<td style="text-align: right;">IND</td>
<td style="text-align: right;">25</td>
<td style="text-align: left;">15,000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">78e98ce3bcdd</td>
<td style="text-align: left;">4ab54a09</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">MALE</td>
<td style="text-align: right;">1962-07-11</td>
<td style="text-align: right;">615.00</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2020-12-02</td>
<td style="text-align: right;">2020-12-16</td>
<td style="text-align: right;">COL</td>
<td style="text-align: right;">100</td>
<td style="text-align: left;">13,750</td>
</tr>
<tr class="even">
<td style="text-align: left;">7e723f43e928</td>
<td style="text-align: left;">1f9bde7f</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1966-11-23</td>
<td style="text-align: right;">370.00</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2018-02-08</td>
<td style="text-align: right;">2018-06-05</td>
<td style="text-align: right;">IND</td>
<td style="text-align: right;">35</td>
<td style="text-align: left;">14,750</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2aac4c6a8625</td>
<td style="text-align: left;">c74ca3ae</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1984-11-02</td>
<td style="text-align: right;">478.36</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">2018-01-28</td>
<td style="text-align: right;">2018-07-05</td>
<td style="text-align: right;">IND</td>
<td style="text-align: right;">40</td>
<td style="text-align: left;">11,250</td>
</tr>
<tr class="even">
<td style="text-align: left;">08cf0c0c7a47</td>
<td style="text-align: left;">e735ef11</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1972-09-28</td>
<td style="text-align: right;">518.72</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">2018-01-11</td>
<td style="text-align: right;">2018-08-31</td>
<td style="text-align: right;">IND</td>
<td style="text-align: right;">15</td>
<td style="text-align: left;">13,750</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>Los reclamos se detallan en la tabla a continuación. En la información no se dispone del valor original del reclamo, sino tan solo del valor pagado, después de aplicar la función deducible <span class="math inline">\(D\)</span>. En la misma información se incluye el deducible <span class="math inline">\(d\)</span> y el monto de máximo de cobertura <span class="math inline">\(M\)</span> que se utilizó para aplicar la deducción.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>claims[ <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> ] <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="fu">kable</span>(</span>
<span id="cb32-3"><a href="#cb32-3"></a>    <span class="at">label =</span> <span class="cn">NA</span>,</span>
<span id="cb32-4"><a href="#cb32-4"></a>    <span class="at">caption =</span> <span class="st">'Reclamos'</span>,</span>
<span id="cb32-5"><a href="#cb32-5"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-6"><a href="#cb32-6"></a>    <span class="at">align =</span> <span class="st">'lllllrrrll'</span>,</span>
<span id="cb32-7"><a href="#cb32-7"></a>    <span class="at">digits =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span> ),</span>
<span id="cb32-8"><a href="#cb32-8"></a>    <span class="at">format.args =</span> <span class="fu">list</span>( <span class="at">big.mark =</span> <span class="st">','</span>, <span class="at">decimal.mark =</span> <span class="st">'.'</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span> ),</span>
<span id="cb32-9"><a href="#cb32-9"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-10"><a href="#cb32-10"></a>    <span class="at">centering =</span> <span class="cn">TRUE</span>,</span>
<span id="cb32-11"><a href="#cb32-11"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb32-12"><a href="#cb32-12"></a>    <span class="at">longtable =</span> <span class="cn">TRUE</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb32-13"><a href="#cb32-13"></a>  <span class="fu">kable_classic</span>( </span>
<span id="cb32-14"><a href="#cb32-14"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb32-15"><a href="#cb32-15"></a>    <span class="at">html_font =</span> <span class="st">"Cambria"</span>, </span>
<span id="cb32-16"><a href="#cb32-16"></a>    <span class="at">position =</span> <span class="st">'center'</span>, </span>
<span id="cb32-17"><a href="#cb32-17"></a>    <span class="at">latex_options =</span> <span class="fu">c</span>( <span class="st">'hold_position'</span>, <span class="st">'repeat_header'</span>, <span class="st">'scale_down'</span> ) ) <span class="sc">%&gt;%</span></span>
<span id="cb32-18"><a href="#cb32-18"></a>  <span class="fu">scroll_box</span>( <span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"500px"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="lightable-classic caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Reclamos</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">policy</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">id</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">idc</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">type</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">service</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">cdate</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">claim</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">icd</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">deductible</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">amount</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">insured</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">bdate</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">sex</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">end</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">708ee54e</td>
<td style="text-align: left;">f1b316dbca9c</td>
<td style="text-align: left;">f3481be7c3be56</td>
<td style="text-align: left;">IND</td>
<td style="text-align: left;">AMB</td>
<td style="text-align: right;">2018-04-08</td>
<td style="text-align: right;">27.95</td>
<td style="text-align: right;">M545</td>
<td style="text-align: left;">35</td>
<td style="text-align: left;">12,250</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">1998-11-30</td>
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">2018-02-22</td>
<td style="text-align: left;">2018-06-05</td>
</tr>
<tr class="even">
<td style="text-align: left;">708ee54e</td>
<td style="text-align: left;">f1b316dbca9c</td>
<td style="text-align: left;">aea75b4dbe7d32</td>
<td style="text-align: left;">IND</td>
<td style="text-align: left;">AMB</td>
<td style="text-align: right;">2018-04-06</td>
<td style="text-align: right;">35.45</td>
<td style="text-align: right;">M545</td>
<td style="text-align: left;">35</td>
<td style="text-align: left;">12,250</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">1998-11-30</td>
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">2018-02-22</td>
<td style="text-align: left;">2018-06-05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">708ee54e</td>
<td style="text-align: left;">f1b316dbca9c</td>
<td style="text-align: left;">427923d6709ea8</td>
<td style="text-align: left;">IND</td>
<td style="text-align: left;">AMB</td>
<td style="text-align: right;">2018-04-06</td>
<td style="text-align: right;">96.06</td>
<td style="text-align: right;">I10</td>
<td style="text-align: left;">35</td>
<td style="text-align: left;">12,250</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">1998-11-30</td>
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">2018-02-22</td>
<td style="text-align: left;">2018-06-05</td>
</tr>
<tr class="even">
<td style="text-align: left;">708ee54e</td>
<td style="text-align: left;">f1b316dbca9c</td>
<td style="text-align: left;">46406cc78413ac</td>
<td style="text-align: left;">IND</td>
<td style="text-align: left;">AMB</td>
<td style="text-align: right;">2018-04-07</td>
<td style="text-align: right;">71.06</td>
<td style="text-align: right;">I10</td>
<td style="text-align: left;">35</td>
<td style="text-align: left;">12,250</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">1998-11-30</td>
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">2018-02-22</td>
<td style="text-align: left;">2018-06-05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">708ee54e</td>
<td style="text-align: left;">f1b316dbca9c</td>
<td style="text-align: left;">dc95b57f0c4c93</td>
<td style="text-align: left;">IND</td>
<td style="text-align: left;">AMB</td>
<td style="text-align: right;">2018-04-05</td>
<td style="text-align: right;">93.56</td>
<td style="text-align: right;">I10</td>
<td style="text-align: left;">35</td>
<td style="text-align: left;">12,250</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">1998-11-30</td>
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">2018-02-22</td>
<td style="text-align: left;">2018-06-05</td>
</tr>
<tr class="even">
<td style="text-align: left;">66d6f1d0</td>
<td style="text-align: left;">59e63ffc9688</td>
<td style="text-align: left;">191c26c896d6f8</td>
<td style="text-align: left;">COL</td>
<td style="text-align: left;">AMB</td>
<td style="text-align: right;">2018-02-25</td>
<td style="text-align: right;">55.00</td>
<td style="text-align: right;">R10</td>
<td style="text-align: left;">25</td>
<td style="text-align: left;">9,250</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">1973-07-28</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">2017-12-18</td>
<td style="text-align: left;">2018-12-17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">66d6f1d0</td>
<td style="text-align: left;">59e63ffc9688</td>
<td style="text-align: left;">08a64b4465231f</td>
<td style="text-align: left;">COL</td>
<td style="text-align: left;">AMB</td>
<td style="text-align: right;">2018-02-25</td>
<td style="text-align: right;">52.50</td>
<td style="text-align: right;">R10</td>
<td style="text-align: left;">25</td>
<td style="text-align: left;">9,250</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">1973-07-28</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">2017-12-18</td>
<td style="text-align: left;">2018-12-17</td>
</tr>
<tr class="even">
<td style="text-align: left;">66d6f1d0</td>
<td style="text-align: left;">59e63ffc9688</td>
<td style="text-align: left;">28e2eb59a7cf35</td>
<td style="text-align: left;">COL</td>
<td style="text-align: left;">AMB</td>
<td style="text-align: right;">2018-02-23</td>
<td style="text-align: right;">42.00</td>
<td style="text-align: right;">R10</td>
<td style="text-align: left;">25</td>
<td style="text-align: left;">9,250</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">1973-07-28</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">2017-12-18</td>
<td style="text-align: left;">2018-12-17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6d64a583</td>
<td style="text-align: left;">d28db8f7c754</td>
<td style="text-align: left;">c0aa9870615af5</td>
<td style="text-align: left;">IND</td>
<td style="text-align: left;">AMB</td>
<td style="text-align: right;">2018-08-31</td>
<td style="text-align: right;">37.50</td>
<td style="text-align: right;">H57</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">12,750</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">1979-02-14</td>
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">2018-01-11</td>
<td style="text-align: left;">2021-01-10</td>
</tr>
<tr class="even">
<td style="text-align: left;">6d64a583</td>
<td style="text-align: left;">d28db8f7c754</td>
<td style="text-align: left;">afc1e924e9c9b5</td>
<td style="text-align: left;">IND</td>
<td style="text-align: left;">AMB</td>
<td style="text-align: right;">2018-09-02</td>
<td style="text-align: right;">55.00</td>
<td style="text-align: right;">H10</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">12,750</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">1979-02-14</td>
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">2018-01-11</td>
<td style="text-align: left;">2021-01-10</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>Primero definimos algunos parámetros que consideramos serán útiles en el desarrollo del ejemplo. Lo primero es definir las fechas que marcan el periodo para el cual estamos interesados en estudiar, con ello seleccionamos la periodicidad con la cual vamos a medir la frecuencia de los reclamos, en este caso de forma anual <code>year</code>. También, seleccionamos de antemano unas edades para formar grupos de riesgo por edad.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>idate <span class="ot">&lt;-</span> <span class="fu">ymd</span>( <span class="st">'2018-01-01'</span> )</span>
<span id="cb33-2"><a href="#cb33-2"></a>edate <span class="ot">&lt;-</span> <span class="fu">ymd</span>( <span class="st">'2021-01-01'</span> )</span>
<span id="cb33-3"><a href="#cb33-3"></a>sdate <span class="ot">&lt;-</span> <span class="fu">seq</span>( idate, edate, <span class="at">by =</span> <span class="st">'year'</span> )</span>
<span id="cb33-4"><a href="#cb33-4"></a>dates <span class="ot">&lt;-</span> <span class="fu">data.table</span>( <span class="at">di =</span> sdate[ <span class="sc">-</span><span class="fu">length</span>( sdate ) ], <span class="at">de =</span> sdate[ <span class="sc">-</span><span class="dv">1</span> ] )</span>
<span id="cb33-5"><a href="#cb33-5"></a>dates[ , tid <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> ]</span>
<span id="cb33-6"><a href="#cb33-6"></a>xgs <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="cn">Inf</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Para generar un modelo de pérdida, asumiremos que la frecuencia de los siniestros <span class="math inline">\(N\)</span> es independiente de los reclamos <span class="math inline">\(\{X_i\}\)</span>. Con ellos estaremos en la capacidad de formular un modelo colectivo de riesgo.</p>
<p>Ahora tratamos la información correspondiente a la producción de las pólizas, en particular extrayendo las pólizas que intersectan con los periodo de observación y creando los grupos de edades <code>xg</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>production[ , tid <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> ]</span>
<span id="cb34-2"><a href="#cb34-2"></a>prod_prep <span class="ot">&lt;-</span> <span class="fu">merge.data.table</span>( dates, production, <span class="at">by =</span> <span class="st">'tid'</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>, <span class="at">allow.cartesian =</span> <span class="cn">TRUE</span> )</span>
<span id="cb34-3"><a href="#cb34-3"></a>prod_prep[ , tid <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span> ]</span>
<span id="cb34-4"><a href="#cb34-4"></a>prod_prep <span class="ot">&lt;-</span> prod_prep[ start <span class="sc">&lt;</span> de <span class="sc">&amp;</span> end <span class="sc">&gt;=</span> di ]</span>
<span id="cb34-5"><a href="#cb34-5"></a>prod_prep[ , fi <span class="sc">:</span><span class="er">=</span> <span class="fu">pmax</span>( start, di ) ]</span>
<span id="cb34-6"><a href="#cb34-6"></a>prod_prep[ , fe <span class="sc">:</span><span class="er">=</span> <span class="fu">pmin</span>( end, de ) ]</span>
<span id="cb34-7"><a href="#cb34-7"></a>prod_prep[ , fm <span class="sc">:</span><span class="er">=</span> fi <span class="sc">+</span> ( fe <span class="sc">-</span> fi ) <span class="sc">/</span> <span class="dv">2</span> ]</span>
<span id="cb34-8"><a href="#cb34-8"></a>prod_prep[ , x <span class="sc">:</span><span class="er">=</span> <span class="fu">pmax</span>( <span class="fu">round</span>( <span class="fu">interval</span>( bdate, fm ) <span class="sc">/</span> <span class="fu">dyears</span>( <span class="dv">1</span> ), <span class="dv">0</span> ), <span class="dv">0</span> ) ]</span>
<span id="cb34-9"><a href="#cb34-9"></a>prod_prep[ , xg <span class="sc">:</span><span class="er">=</span> <span class="fu">cut</span>( <span class="at">x =</span> x, <span class="at">breaks =</span> xgs, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">ordered_result =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">FALSE</span> ) ]</span>
<span id="cb34-10"><a href="#cb34-10"></a></span>
<span id="cb34-11"><a href="#cb34-11"></a>noclaims_prep <span class="ot">&lt;-</span> <span class="fu">unique</span>( prod_prep[ , <span class="fu">list</span>( policy, id, sex, xg, bdate, di, de, <span class="at">N =</span> <span class="dv">0</span>, <span class="at">S =</span> <span class="dv">0</span> ) ] )</span>
<span id="cb34-12"><a href="#cb34-12"></a>noclaims_prep <span class="ot">&lt;-</span> noclaims_prep[ , <span class="fu">list</span>( policy, id, sex, xg, bdate, di, de, N, S ) ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Así mismo, trabajamos con la información correspondiente a los reclamos. Primeramente los agregados por código único de siniestro <code>idc</code>, fecha de siniestro <code>cdate</code> y periodo de observación <code>di</code> a <code>de</code>, esto para agrupar los reclamos que corresponden a un solo siniestros por periodo. Luego, filtramos los siniestros que solo se presentan en el periodo de observación. También, se cuenta cuantos siniestros presenta cada asegurado según por su código único de identificación <code>id</code> y también la póliza a la que pertenecen <code>policy</code>.</p>
<p>Finalmente, se hace una estadística de frecuencia por cada grupo de riesgo dados por el sexo <code>sex</code> y el grupo de edad <code>xg</code>. En particular se calcula el indicador para la familia de Panjer, esto con la finalidad de caracterizar el tipo de distribución que determina la frecuencia de los reclamos.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>claims_prep <span class="ot">&lt;-</span> claims[ , <span class="fu">list</span>( <span class="at">DX =</span> <span class="fu">sum</span>( claim ) ), by <span class="ot">=</span> <span class="fu">list</span>( policy, id, idc, type, sex, bdate, cdate ) ]</span>
<span id="cb35-2"><a href="#cb35-2"></a>claims_prep[ , x <span class="sc">:</span><span class="er">=</span> <span class="fu">round</span>( <span class="fu">interval</span>( bdate, cdate ) <span class="sc">/</span> <span class="fu">dyears</span>( <span class="dv">1</span> ), <span class="dv">0</span> ) ]</span>
<span id="cb35-3"><a href="#cb35-3"></a>claims_prep[ , xg <span class="sc">:</span><span class="er">=</span> <span class="fu">cut</span>( <span class="at">x =</span> x, <span class="at">breaks =</span> xgs, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">ordered_result =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">FALSE</span> ) ]</span>
<span id="cb35-4"><a href="#cb35-4"></a>claims_prep[ , tid <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> ]</span>
<span id="cb35-5"><a href="#cb35-5"></a>claims_prep <span class="ot">&lt;-</span> <span class="fu">merge.data.table</span>( dates, claims_prep, <span class="at">by =</span> <span class="fu">c</span>( <span class="st">'tid'</span> ), <span class="at">all.x =</span> <span class="cn">TRUE</span>, <span class="at">allow.cartesian =</span> <span class="cn">TRUE</span> )</span>
<span id="cb35-6"><a href="#cb35-6"></a>claims_prep[ , tid <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span> ]</span>
<span id="cb35-7"><a href="#cb35-7"></a>claims_prep <span class="ot">&lt;-</span> claims_prep[ cdate <span class="sc">&gt;=</span> di <span class="sc">&amp;</span> cdate <span class="sc">&lt;</span> de ]</span>
<span id="cb35-8"><a href="#cb35-8"></a>claims_prep <span class="ot">&lt;-</span> claims_prep[ , <span class="fu">list</span>( <span class="at">N =</span> .N, <span class="at">S =</span> <span class="fu">sum</span>( DX ) ), by <span class="ot">=</span> <span class="fu">list</span>( policy, id, sex, xg, bdate, di, de ) ]</span>
<span id="cb35-9"><a href="#cb35-9"></a>claims_prep <span class="ot">&lt;-</span> <span class="fu">rbind</span>( claims_prep, noclaims_prep )</span>
<span id="cb35-10"><a href="#cb35-10"></a>claims_prep <span class="ot">&lt;-</span> claims_prep[ , <span class="fu">list</span>( <span class="at">N =</span> <span class="fu">sum</span>( N ), <span class="at">S =</span> <span class="fu">sum</span>( S ) ), by <span class="ot">=</span> <span class="fu">list</span>( policy, id, sex, xg, bdate, di, de ) ]</span>
<span id="cb35-11"><a href="#cb35-11"></a></span>
<span id="cb35-12"><a href="#cb35-12"></a>count <span class="ot">&lt;-</span> <span class="fu">copy</span>( claims_prep )</span>
<span id="cb35-13"><a href="#cb35-13"></a>count <span class="ot">&lt;-</span> count[ , <span class="fu">list</span>( <span class="at">fn =</span> .N, <span class="at">S =</span> <span class="fu">sum</span>( S ) ), by <span class="ot">=</span> <span class="fu">list</span>( sex, xg, N ) ]</span>
<span id="cb35-14"><a href="#cb35-14"></a></span>
<span id="cb35-15"><a href="#cb35-15"></a>expand <span class="ot">&lt;-</span> count[ , <span class="fu">list</span>( <span class="at">N =</span> <span class="fu">max</span>( N ) ), by <span class="ot">=</span> <span class="fu">list</span>( sex, xg ) ]</span>
<span id="cb35-16"><a href="#cb35-16"></a>expand <span class="ot">&lt;-</span> expand[ , <span class="fu">list</span>( <span class="at">N =</span> <span class="fu">seq</span>( <span class="dv">0</span>, N, <span class="dv">1</span> ) ), by <span class="ot">=</span> <span class="fu">list</span>( sex, xg ) ]</span>
<span id="cb35-17"><a href="#cb35-17"></a></span>
<span id="cb35-18"><a href="#cb35-18"></a>count <span class="ot">&lt;-</span> <span class="fu">merge.data.table</span>( expand, count, <span class="at">by =</span> <span class="fu">c</span>( <span class="st">'sex'</span>, <span class="st">'xg'</span>, <span class="st">'N'</span> ), <span class="at">all.x =</span> <span class="cn">TRUE</span> )</span>
<span id="cb35-19"><a href="#cb35-19"></a>count[ <span class="fu">is.na</span>( fn ), fn <span class="sc">:</span><span class="er">=</span> <span class="dv">0</span> ]</span>
<span id="cb35-20"><a href="#cb35-20"></a>count[ <span class="fu">is.na</span>( S ), S <span class="sc">:</span><span class="er">=</span> <span class="dv">0</span> ]</span>
<span id="cb35-21"><a href="#cb35-21"></a><span class="fu">setorder</span>( count, sex, xg, N )</span>
<span id="cb35-22"><a href="#cb35-22"></a>count[ , pn <span class="sc">:</span><span class="er">=</span> fn <span class="sc">/</span> <span class="fu">sum</span>( fn ), by <span class="ot">=</span> <span class="fu">list</span>( sex, xg ) ]</span>
<span id="cb35-23"><a href="#cb35-23"></a>count[ , vn <span class="sc">:</span><span class="er">=</span> <span class="fu">shift</span>( pn, <span class="at">fill =</span> <span class="dv">0</span> ), by <span class="ot">=</span> <span class="fu">list</span>( sex, xg ) ]</span>
<span id="cb35-24"><a href="#cb35-24"></a>count[ vn <span class="sc">!=</span> <span class="dv">0</span>, vn <span class="sc">:</span><span class="er">=</span> N <span class="sc">*</span> pn <span class="sc">/</span> vn ]</span>
<span id="cb35-25"><a href="#cb35-25"></a>count[ vn <span class="sc">==</span> <span class="dv">0</span>, vn <span class="sc">:</span><span class="er">=</span> <span class="dv">0</span> ]</span>
<span id="cb35-26"><a href="#cb35-26"></a></span>
<span id="cb35-27"><a href="#cb35-27"></a>grpcl <span class="ot">&lt;-</span> <span class="fu">unique</span>( count[ , <span class="fu">list</span>( sex, xg ) ] )</span>
<span id="cb35-28"><a href="#cb35-28"></a>grpcl[ , grp <span class="sc">:</span><span class="er">=</span> <span class="fu">paste0</span>( sex, <span class="st">' '</span>, xg ) ]</span>
<span id="cb35-29"><a href="#cb35-29"></a><span class="fu">setorder</span>( grpcl, sex, xg )</span>
<span id="cb35-30"><a href="#cb35-30"></a></span>
<span id="cb35-31"><a href="#cb35-31"></a>count[ , grp <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>( <span class="fu">paste0</span>( sex, <span class="st">' '</span>, xg ), <span class="at">labels =</span> grpcl<span class="sc">$</span>grp, <span class="at">ordered =</span> <span class="cn">TRUE</span> ) ]</span>
<span id="cb35-32"><a href="#cb35-32"></a>claims_prep[ , grp <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>( <span class="fu">paste0</span>( sex, <span class="st">' '</span>, xg ), <span class="at">labels =</span> grpcl<span class="sc">$</span>grp, <span class="at">ordered =</span> <span class="cn">TRUE</span> ) ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Los grupos de riesgo, que designaremos con un índice <span class="math inline">\(g\)</span>, los hemos seleccionado para estudiar la frecuencia y severidad de los reclamos, estos son los siguientes:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>grpcl <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="fu">kable</span>(</span>
<span id="cb36-3"><a href="#cb36-3"></a>    <span class="at">label =</span> <span class="cn">NA</span>,</span>
<span id="cb36-4"><a href="#cb36-4"></a>    <span class="at">caption =</span> <span class="st">'Grupos de clasificación del riesgo'</span>,</span>
<span id="cb36-5"><a href="#cb36-5"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-6"><a href="#cb36-6"></a>    <span class="at">col.names =</span> <span class="fu">c</span>( <span class="st">'sex'</span>, <span class="st">'$x_g$'</span>, <span class="st">'grupo'</span> ),</span>
<span id="cb36-7"><a href="#cb36-7"></a>    <span class="at">align =</span> <span class="st">'lll'</span>,</span>
<span id="cb36-8"><a href="#cb36-8"></a>    <span class="at">digits =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span> ),</span>
<span id="cb36-9"><a href="#cb36-9"></a>    <span class="at">format.args =</span> <span class="fu">list</span>( <span class="at">big.mark =</span> <span class="st">','</span>, <span class="at">decimal.mark =</span> <span class="st">'.'</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span> ),</span>
<span id="cb36-10"><a href="#cb36-10"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-11"><a href="#cb36-11"></a>    <span class="at">centering =</span> <span class="cn">TRUE</span>,</span>
<span id="cb36-12"><a href="#cb36-12"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb36-13"><a href="#cb36-13"></a>  <span class="fu">kable_classic</span>( <span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">html_font =</span> <span class="st">"Cambria"</span>, <span class="at">position =</span> <span class="st">"center"</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb36-14"><a href="#cb36-14"></a>  <span class="fu">scroll_box</span>( <span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"500px"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="lightable-classic caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Grupos de clasificación del riesgo</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">sex</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">$x_g$</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">grupo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[0,20)</td>
<td style="text-align: left;">FEMALE [0,20)</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[20,40)</td>
<td style="text-align: left;">FEMALE [20,40)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[40,60)</td>
<td style="text-align: left;">FEMALE [40,60)</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[60,Inf]</td>
<td style="text-align: left;">FEMALE [60,Inf]</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[0,20)</td>
<td style="text-align: left;">MALE [0,20)</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[20,40)</td>
<td style="text-align: left;">MALE [20,40)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[40,60)</td>
<td style="text-align: left;">MALE [40,60)</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[60,Inf]</td>
<td style="text-align: left;">MALE [60,Inf]</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>El gráfico a continuación muestra el comportamiento del indicador <span class="math inline">\(v_n = n \frac{p_n}{p_{n-1}}\)</span>, para cada uno de los grupos <span class="math inline">\(g\)</span> de riesgo.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>  <span class="fu">geom_point</span>( <span class="at">data =</span> count, <span class="fu">aes</span>( <span class="at">x =</span> N, <span class="at">y =</span> vn ), <span class="at">colour =</span> <span class="st">'red3'</span>, <span class="at">size =</span> <span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>  <span class="fu">facet_wrap</span>( <span class="fu">vars</span>( grp ), <span class="at">ncol =</span> <span class="dv">4</span> ) <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$n$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb37-5"><a href="#cb37-5"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$v_n$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb37-6"><a href="#cb37-6"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">"none"</span> )</span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g15-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Como hemos evidenciado, para todos los casos en consideración el indicador <span class="math inline">\(v_n\)</span> tiene un tendencia creciente y se evidencia un crecimiento con orden lineal, esto sugiere que la distribución discreta más adecuada para explicar la frecuencia de los reclamos para cada grupo es una binomial negativa <span class="math inline">\(N \rightsquigarrow NBin( \alpha, p )\)</span>. Para la estimación por maximización de verosimilitud, hacemos uso de la función <code>fitdist</code> con la cual estimaremos los parámetros dentro de una familia de distribuciones binomiales negativas.</p>
<p>Por su parte, la función de verosimilitud logarítmica para la frecuencia tiene la siguiente forma para cada grupo <span class="math inline">\(g\)</span>. <span class="math display">\[
\begin{split}
\ell_g( \alpha, p )
&amp; = \sum\limits_{i=1}^{n_g}
\left\{ \log\left( \Gamma( \alpha + N_i ) \right)
- \log\left( \Gamma(N_i + 1) \right)
- \log\left( \Gamma(\alpha) \right)
+ \alpha \log(p)
+ N_i \log( 1 - p ) \right\} \\
&amp; = \sum\limits_{i=1}^{n_g}
\left\{ \log\left( \Gamma( \alpha + N_i ) \right)
- \log\left( \Gamma(N_i + 1) \right) \right\}
- n_g \log\left( \Gamma(\alpha) \right)
+ n_g \alpha \log(p)
+ n \log( 1 - p )
\end{split}
\]</span> Como ya lo mencionamos, para cada grupo <span class="math inline">\(g\)</span> podemos maximizar la verosimilitud logarítmica de la frecuencia utilizando la función <code>fitdist</code> del paquete <code>fitdistrplus</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>fit_count <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb38-2"><a href="#cb38-2"></a>estim_frec <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb38-3"><a href="#cb38-3"></a></span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="cf">for</span> ( g <span class="cf">in</span> grpcl<span class="sc">$</span>grp ) {</span>
<span id="cb38-5"><a href="#cb38-5"></a>  </span>
<span id="cb38-6"><a href="#cb38-6"></a>  fit_count[[ g ]] <span class="ot">&lt;-</span> fitdistrplus<span class="sc">::</span><span class="fu">fitdist</span>( </span>
<span id="cb38-7"><a href="#cb38-7"></a>    claims_prep[ grp <span class="sc">==</span> g ]<span class="sc">$</span>N, </span>
<span id="cb38-8"><a href="#cb38-8"></a>    <span class="at">distr =</span> dnbinom, </span>
<span id="cb38-9"><a href="#cb38-9"></a>    <span class="at">method =</span> <span class="st">'mle'</span>, </span>
<span id="cb38-10"><a href="#cb38-10"></a>    <span class="at">keepdata =</span> <span class="cn">TRUE</span>, </span>
<span id="cb38-11"><a href="#cb38-11"></a>    <span class="at">discrete =</span> <span class="cn">TRUE</span> )</span>
<span id="cb38-12"><a href="#cb38-12"></a>  </span>
<span id="cb38-13"><a href="#cb38-13"></a>  </span>
<span id="cb38-14"><a href="#cb38-14"></a>  estim_frec <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb38-15"><a href="#cb38-15"></a>    estim_frec,</span>
<span id="cb38-16"><a href="#cb38-16"></a>    <span class="fu">data.table</span>( <span class="at">grp =</span> g, </span>
<span id="cb38-17"><a href="#cb38-17"></a>                <span class="at">a =</span> fit_count[[ g ]]<span class="sc">$</span>estimate[<span class="dv">1</span>], </span>
<span id="cb38-18"><a href="#cb38-18"></a>                <span class="at">EN =</span> fit_count[[ g ]]<span class="sc">$</span>estimate[<span class="dv">2</span>], </span>
<span id="cb38-19"><a href="#cb38-19"></a>                <span class="at">loglik =</span> fit_count[[ g ]]<span class="sc">$</span>loglik,</span>
<span id="cb38-20"><a href="#cb38-20"></a>                <span class="at">aic =</span> fit_count[[ g ]]<span class="sc">$</span>aic,</span>
<span id="cb38-21"><a href="#cb38-21"></a>                <span class="at">bic =</span> fit_count[[ g ]]<span class="sc">$</span>bic )</span>
<span id="cb38-22"><a href="#cb38-22"></a>  )</span>
<span id="cb38-23"><a href="#cb38-23"></a>}</span>
<span id="cb38-24"><a href="#cb38-24"></a>estim_frec[ , p <span class="sc">:</span><span class="er">=</span> a <span class="sc">/</span> ( a <span class="sc">+</span> EN ) ]</span>
<span id="cb38-25"><a href="#cb38-25"></a>estim_frec[ , SDN <span class="sc">:</span><span class="er">=</span> <span class="fu">sqrt</span>( a <span class="sc">*</span> ( <span class="dv">1</span> <span class="sc">-</span> p ) <span class="sc">/</span> p<span class="sc">^</span><span class="dv">2</span> ) ]</span>
<span id="cb38-26"><a href="#cb38-26"></a>estim_frec <span class="ot">&lt;-</span> estim_frec[ , <span class="fu">list</span>( grp, a, p, EN, SDN, loglik, aic, bic )]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>En la lista que hemos creado <code>fit_count</code> hemos almacenado cada una de los objetos con las estimaciones de la frecuencia para cada uno de los grupos. A continuación, presentamos los resultados de la estimación para la frecuencia.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>estim_frec <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>  <span class="fu">kable</span>(</span>
<span id="cb39-3"><a href="#cb39-3"></a>    <span class="at">label =</span> <span class="cn">NA</span>,</span>
<span id="cb39-4"><a href="#cb39-4"></a>    <span class="at">caption =</span> <span class="st">'Estimación de frecuencia'</span>,</span>
<span id="cb39-5"><a href="#cb39-5"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb39-6"><a href="#cb39-6"></a>    <span class="at">col.names =</span> <span class="fu">c</span>( <span class="st">'$g$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">alpha$'</span>, <span class="st">'$p$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">E[ N ]$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">sqrt{</span><span class="sc">\\</span><span class="st">V[ N ]}$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">ell( n, p )$'</span>, <span class="st">'$AIC$'</span>, <span class="st">'$BIC$'</span> ),</span>
<span id="cb39-7"><a href="#cb39-7"></a>    <span class="at">align =</span> <span class="st">'lrrrrrrr'</span>,</span>
<span id="cb39-8"><a href="#cb39-8"></a>    <span class="at">digits =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>,  <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">2</span> ),</span>
<span id="cb39-9"><a href="#cb39-9"></a>    <span class="at">format.args =</span> <span class="fu">list</span>( <span class="at">big.mark =</span> <span class="st">','</span>, <span class="at">decimal.mark =</span> <span class="st">'.'</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span> ),</span>
<span id="cb39-10"><a href="#cb39-10"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb39-11"><a href="#cb39-11"></a>    <span class="at">centering =</span> <span class="cn">TRUE</span>,</span>
<span id="cb39-12"><a href="#cb39-12"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb39-13"><a href="#cb39-13"></a>  <span class="fu">kable_classic</span>( <span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">html_font =</span> <span class="st">"Cambria"</span>, <span class="at">position =</span> <span class="st">"center"</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb39-14"><a href="#cb39-14"></a>  <span class="fu">scroll_box</span>( <span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"500px"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="lightable-classic caption-top table" data-quarto-postprocess="true">
<caption>Estimación de frecuencia</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">$g$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\alpha$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$p$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\E[ N ]$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\sqrt{\V[ N ]}$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\ell( n, p )$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$AIC$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$BIC$</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FEMALE [0,20)</td>
<td style="text-align: right;">0.07114</td>
<td style="text-align: right;">0.02922</td>
<td style="text-align: right;">2.36335</td>
<td style="text-align: right;">8.99292</td>
<td style="text-align: right;">-1,159.649</td>
<td style="text-align: right;">2,323.30</td>
<td style="text-align: right;">2,332.90</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE [20,40)</td>
<td style="text-align: right;">0.06690</td>
<td style="text-align: right;">0.01515</td>
<td style="text-align: right;">4.34957</td>
<td style="text-align: right;">16.94494</td>
<td style="text-align: right;">-2,497.060</td>
<td style="text-align: right;">4,998.12</td>
<td style="text-align: right;">5,008.94</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FEMALE [40,60)</td>
<td style="text-align: right;">0.13472</td>
<td style="text-align: right;">0.01344</td>
<td style="text-align: right;">9.88593</td>
<td style="text-align: right;">27.11744</td>
<td style="text-align: right;">-3,159.785</td>
<td style="text-align: right;">6,323.57</td>
<td style="text-align: right;">6,333.88</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE [60,Inf]</td>
<td style="text-align: right;">0.16226</td>
<td style="text-align: right;">0.01003</td>
<td style="text-align: right;">16.01106</td>
<td style="text-align: right;">39.94829</td>
<td style="text-align: right;">-1,918.017</td>
<td style="text-align: right;">3,840.03</td>
<td style="text-align: right;">3,848.98</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE [0,20)</td>
<td style="text-align: right;">0.06076</td>
<td style="text-align: right;">0.02672</td>
<td style="text-align: right;">2.21317</td>
<td style="text-align: right;">9.10109</td>
<td style="text-align: right;">-1,250.564</td>
<td style="text-align: right;">2,505.13</td>
<td style="text-align: right;">2,515.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE [20,40)</td>
<td style="text-align: right;">0.05065</td>
<td style="text-align: right;">0.02508</td>
<td style="text-align: right;">1.96877</td>
<td style="text-align: right;">8.86002</td>
<td style="text-align: right;">-1,294.692</td>
<td style="text-align: right;">2,593.38</td>
<td style="text-align: right;">2,603.65</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE [40,60)</td>
<td style="text-align: right;">0.10530</td>
<td style="text-align: right;">0.01725</td>
<td style="text-align: right;">5.99728</td>
<td style="text-align: right;">18.64330</td>
<td style="text-align: right;">-2,163.142</td>
<td style="text-align: right;">4,330.28</td>
<td style="text-align: right;">4,340.30</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE [60,Inf]</td>
<td style="text-align: right;">0.17932</td>
<td style="text-align: right;">0.01091</td>
<td style="text-align: right;">16.26105</td>
<td style="text-align: right;">38.61118</td>
<td style="text-align: right;">-1,568.422</td>
<td style="text-align: right;">3,140.84</td>
<td style="text-align: right;">3,149.33</td>
</tr>
</tbody>
</table>
</div>

<p>Ahora, nos enfocamos en estudiar la severidad de los reclamos. Desde un inicio sabemos que los valores de los reclamos ya vienen censurados, a causa de la aplicación de la función deducible <span class="math inline">\(D\)</span>, como consecuencia tenemos pérdida de información que no podemos recuperar, por tal razón es de esperar que la función de distribución acumulada de los reclamos deducidos <span class="math inline">\(D(X)\)</span> tenga singularidades. Si buscamos utilizar el método de máxima verosimilitud para la estimación de la mejor distribución, debemos hacer uso de la expresión completa que presentamos en <span class="math inline">\(\ref{eq:loglik}\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>sev_claims <span class="ot">&lt;-</span> claims[ , <span class="fu">list</span>( policy, id, idc, type, sex, bdate, cdate, deductible, amount, claim ) ]</span>
<span id="cb40-2"><a href="#cb40-2"></a>sev_claims[ , x <span class="sc">:</span><span class="er">=</span> <span class="fu">round</span>( <span class="fu">interval</span>( bdate, cdate ) <span class="sc">/</span> <span class="fu">dyears</span>( <span class="dv">1</span> ), <span class="dv">0</span> ) ]</span>
<span id="cb40-3"><a href="#cb40-3"></a>sev_claims[ , xg <span class="sc">:</span><span class="er">=</span> <span class="fu">cut</span>( <span class="at">x =</span> x, <span class="at">breaks =</span> xgs, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">ordered_result =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">FALSE</span> ) ]</span>
<span id="cb40-4"><a href="#cb40-4"></a>sev_claims[ , tid <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> ]</span>
<span id="cb40-5"><a href="#cb40-5"></a>sev_claims <span class="ot">&lt;-</span> <span class="fu">merge.data.table</span>( dates, sev_claims, <span class="at">by =</span> <span class="fu">c</span>( <span class="st">'tid'</span> ), <span class="at">all.x =</span> <span class="cn">TRUE</span>, <span class="at">allow.cartesian =</span> <span class="cn">TRUE</span> )</span>
<span id="cb40-6"><a href="#cb40-6"></a>sev_claims <span class="ot">&lt;-</span> sev_claims[ cdate <span class="sc">&gt;=</span> di <span class="sc">&amp;</span> cdate <span class="sc">&lt;</span> de ]</span>
<span id="cb40-7"><a href="#cb40-7"></a>sev_claims[ , tid <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span> ]</span>
<span id="cb40-8"><a href="#cb40-8"></a>sev_claims[ , grp <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>( <span class="fu">paste0</span>( sex, <span class="st">' '</span>, xg ), <span class="at">labels =</span> grpcl<span class="sc">$</span>grp, <span class="at">ordered =</span> <span class="cn">TRUE</span> ) ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Los histogramas a continuación muestran como se distribuyen los reclamos ya censurados por cada grupos de riesgo.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>xlim <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="fl">1e3</span> )</span>
<span id="cb41-2"><a href="#cb41-2"></a>xbrk <span class="ot">&lt;-</span> <span class="fu">seq</span>( xlim[<span class="dv">1</span>], xlim[<span class="dv">2</span>], <span class="at">length =</span> <span class="dv">5</span> )</span>
<span id="cb41-3"><a href="#cb41-3"></a>xlbl <span class="ot">&lt;-</span> xbrk</span>
<span id="cb41-4"><a href="#cb41-4"></a></span>
<span id="cb41-5"><a href="#cb41-5"></a>bins <span class="ot">&lt;-</span> sev_claims[ , <span class="fu">list</span>( <span class="at">bins =</span> <span class="fu">nclass.scott</span>( claim ) ), by <span class="ot">=</span> <span class="fu">list</span>( grp ) ]</span>
<span id="cb41-6"><a href="#cb41-6"></a></span>
<span id="cb41-7"><a href="#cb41-7"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8"></a>  <span class="fu">geom_histogram</span>( <span class="at">data =</span> sev_claims, <span class="fu">aes</span>( claim, <span class="fu">after_stat</span>( density ) ), </span>
<span id="cb41-9"><a href="#cb41-9"></a>                  <span class="at">fill =</span> <span class="st">'dodgerblue3'</span>, <span class="at">colour =</span> <span class="st">'dodgerblue4'</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, </span>
<span id="cb41-10"><a href="#cb41-10"></a>                  <span class="at">bins =</span> <span class="fu">min</span>( bins<span class="sc">$</span>bins ) ) <span class="sc">+</span></span>
<span id="cb41-11"><a href="#cb41-11"></a>  <span class="fu">facet_wrap</span>( <span class="fu">vars</span>( grp ), <span class="at">scale =</span> <span class="st">'free_x'</span>, <span class="at">ncol =</span> <span class="dv">4</span> ) <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> xbrk,</span>
<span id="cb41-13"><a href="#cb41-13"></a>                      <span class="at">labels =</span> xlbl,</span>
<span id="cb41-14"><a href="#cb41-14"></a>                      <span class="at">limits =</span> xlim,</span>
<span id="cb41-15"><a href="#cb41-15"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb41-16"><a href="#cb41-16"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$D(X)$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb41-17"><a href="#cb41-17"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$f_{D(X)}$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb41-18"><a href="#cb41-18"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb41-19"><a href="#cb41-19"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">"none"</span> )</span>
<span id="cb41-20"><a href="#cb41-20"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g16-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Por no incrementar la complejidad del ejemplo, asumiremos que los reclamos <span class="math inline">\(X\)</span> por cada grupo de riesgo son i.i.d. y estos siguen como distribución alguna presente en la familia log-normal, es decir <span class="math inline">\(X \rightsquigarrow LN( \mu, \sigma )\)</span>. Además, es de notar que el razonamiento es válido para cualquier otra distribución. Más aún, sabemos que para cada reclamo <span class="math inline">\(i\)</span>-ésimo se aplicó un deducible <span class="math inline">\(d_i\)</span> y un monto máximo asegurado <span class="math inline">\(M_i\)</span> determinado por la cobertura de la póliza y estos valores a su vez determinan el deducible <span class="math inline">\(D_i\)</span>, la distribución de probabilidad para los valores aleatorios ya deducidos <span class="math inline">\(Z = D_i(X)\)</span>, según lo ya estudiado en @ref(deducibles), tiene la forma: <span class="math display">\[
F( z ) = \mathbf{1}_{[0,M_i)}( z ) F_X( z + d_i ) + \mathbf{1}_{[M_i,+\infty)}( z )
\]</span></p>
<p>Entonces, tomando en cuenta la forma general que hemos desarrollado en @ref(eq:loglik) y la forma anterior para la distribución acumulada de probabilidad, podemos determinar una expresión más precisa para la función de verosimilitud logarítmica, donde debemos tomar en cuenta las singularidades que producen los deducibles para cada póliza. <span class="math display">\[
\begin{split}
\ell( \mu, \sigma )
&amp; = \sum\limits_{x_i \in \Dif F} \log \left( f(x_i,\mu, \sigma) \right)
+ \sum\limits_{x_i \notin \Dif F} \log \left( F\left( x_i, \mu, \sigma \right) - F\left( x_i-, \mu, \sigma \right) \right) \\
&amp; = \sum\limits_{x_i \notin\{0,M_i\}} \log \left( f(x_i,\mu, \sigma) \right)
+ \sum\limits_{x_i \in\{0,M_i\}} \log \left( F\left( x_i, \mu, \sigma \right) - F\left( x_i-, \mu, \sigma \right) \right) \\
&amp; = \sum\limits_{x_i \notin \{0,M_i\}}
\log \left( \frac{1}{x_i\sqrt{2\pi} \sigma}  \exp\left( -\frac{(\ln(x_i) - \mu)^2}{\sigma^2} \right) \right)
+ \sum\limits_{x_i = M_i} \log \left( 1 - F\left( M_i-, \mu, \sigma \right) \right)
+ \sum\limits_{x_i = 0} \log \left( F\left( 0, \mu, \sigma \right) - 0 \right) \\
&amp; = -\sum\limits_{x_i \notin\{0,M_i\}} \left\{
\frac{(\ln(x_i) - \mu)^2}{\sigma^2}
+\log \left( x_i \right)
+\log \left( \sqrt{2\pi} \sigma \right) \right\}
+ \sum\limits_{x_i = M_i} \log \left( 1 - \frac{1}{\sqrt{2\pi} \sigma} \int\limits_{0}^{M_i + d_i} \frac{1}{y} \exp\left( -\frac{(\ln(y) - \mu)^2}{\sigma^2} \right)\ dy \right) \\
&amp; + \sum\limits_{x_i = 0} \log \left( \frac{1}{\sqrt{2\pi} \sigma} \int\limits_{0}^{d_i} \frac{1}{y} \exp\left( -\frac{(\ln(y) - \mu)^2}{\sigma^2} \right)\ dy \right) \\
\end{split}
\]</span></p>
<p>Preparamos la función de verosimilitud en R, en este caso debemos construirla explícitamente, sin la ayuda de alguna función en un paquete, esto se debe a que el deducible <span class="math inline">\(d\)</span> y el monto máximo de cobertura <span class="math inline">\(M\)</span> varían entre pólizas. Esta construcción debe ser realizada para cada grupo de riesgo y a su vez debemos maximizar cada una de las verosimilitudes logarítmicas, esto lo podemos realizar de forma integrada utilizando un bucle de programación <code>for</code> y el método de optimización no lineal <code>nloptr</code> del paquete con el mismo nombre.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>Fd <span class="ot">&lt;-</span> plnorm</span>
<span id="cb42-2"><a href="#cb42-2"></a>fd <span class="ot">&lt;-</span> dlnorm</span>
<span id="cb42-3"><a href="#cb42-3"></a></span>
<span id="cb42-4"><a href="#cb42-4"></a>theta0 <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">1</span> )</span>
<span id="cb42-5"><a href="#cb42-5"></a>loglik_max <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb42-6"><a href="#cb42-6"></a>estim_sev <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb42-7"><a href="#cb42-7"></a></span>
<span id="cb42-8"><a href="#cb42-8"></a><span class="cf">for</span> ( g <span class="cf">in</span> grpcl<span class="sc">$</span>grp ) {</span>
<span id="cb42-9"><a href="#cb42-9"></a>  </span>
<span id="cb42-10"><a href="#cb42-10"></a>  datsev <span class="ot">&lt;-</span> sev_claims[ grp <span class="sc">==</span> g ]</span>
<span id="cb42-11"><a href="#cb42-11"></a>  </span>
<span id="cb42-12"><a href="#cb42-12"></a>  <span class="co"># Definimos la función de verosimilitud logarítmica para cada grupo</span></span>
<span id="cb42-13"><a href="#cb42-13"></a>  lglk <span class="ot">&lt;-</span> <span class="cf">function</span>( theta ) {</span>
<span id="cb42-14"><a href="#cb42-14"></a>    </span>
<span id="cb42-15"><a href="#cb42-15"></a>    <span class="co"># suma en puntos de continuidad</span></span>
<span id="cb42-16"><a href="#cb42-16"></a>    l <span class="ot">&lt;-</span> <span class="fu">sum</span>( <span class="fu">sapply</span>( datsev[ claim <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> claim <span class="sc">&lt;</span> amount ]<span class="sc">$</span>claim,</span>
<span id="cb42-17"><a href="#cb42-17"></a>                      <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">log</span>( <span class="fu">fd</span>( x, <span class="at">meanlog =</span> theta[ <span class="dv">1</span> ], <span class="at">sdlog =</span> theta[ <span class="dv">2</span> ] ) ) ) )</span>
<span id="cb42-18"><a href="#cb42-18"></a>    </span>
<span id="cb42-19"><a href="#cb42-19"></a>    <span class="co"># suma en las discontinuidades</span></span>
<span id="cb42-20"><a href="#cb42-20"></a>    <span class="co"># singularidad en la parte superior, hacia el máximo monto</span></span>
<span id="cb42-21"><a href="#cb42-21"></a>    sg <span class="ot">&lt;-</span> datsev[ claim <span class="sc">==</span> amount, <span class="fu">list</span>( <span class="at">x =</span> amount <span class="sc">+</span> deductible ) ]</span>
<span id="cb42-22"><a href="#cb42-22"></a>    sg <span class="ot">&lt;-</span> sg<span class="sc">$</span>x</span>
<span id="cb42-23"><a href="#cb42-23"></a>    </span>
<span id="cb42-24"><a href="#cb42-24"></a>    <span class="cf">if</span> ( <span class="fu">length</span>( sg ) <span class="sc">&gt;</span> <span class="dv">0</span> ) {</span>
<span id="cb42-25"><a href="#cb42-25"></a>      l <span class="ot">&lt;-</span> l <span class="sc">+</span> <span class="fu">sum</span>( <span class="fu">sapply</span>( sg, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">log</span>( <span class="dv">1</span> <span class="sc">-</span> <span class="fu">Fd</span>( x, <span class="at">meanlog =</span> theta[ <span class="dv">1</span> ], <span class="at">sdlog =</span> theta[ <span class="dv">2</span> ] ) ) ) )  </span>
<span id="cb42-26"><a href="#cb42-26"></a>    }</span>
<span id="cb42-27"><a href="#cb42-27"></a>    </span>
<span id="cb42-28"><a href="#cb42-28"></a>    <span class="co"># singularidad en la parte inferior, hacia el deducible</span></span>
<span id="cb42-29"><a href="#cb42-29"></a>    sg <span class="ot">&lt;-</span> datsev[ claim <span class="sc">==</span> <span class="dv">0</span>, <span class="fu">list</span>( <span class="at">x =</span> deductible ) ]</span>
<span id="cb42-30"><a href="#cb42-30"></a>    sg <span class="ot">&lt;-</span> sg<span class="sc">$</span>x</span>
<span id="cb42-31"><a href="#cb42-31"></a>    </span>
<span id="cb42-32"><a href="#cb42-32"></a>    <span class="cf">if</span> ( <span class="fu">length</span>( sg ) <span class="sc">&gt;</span> <span class="dv">0</span> ) {</span>
<span id="cb42-33"><a href="#cb42-33"></a>      l <span class="ot">&lt;-</span> l <span class="sc">+</span> <span class="fu">sum</span>( <span class="fu">sapply</span>( sg, <span class="at">FUN =</span> <span class="cf">function</span>( x ) <span class="fu">log</span>( <span class="fu">Fd</span>( x, <span class="at">meanlog =</span> theta[ <span class="dv">1</span> ], <span class="at">sdlog =</span> theta[ <span class="dv">2</span> ] ) ) ) )  </span>
<span id="cb42-34"><a href="#cb42-34"></a>    }</span>
<span id="cb42-35"><a href="#cb42-35"></a>    </span>
<span id="cb42-36"><a href="#cb42-36"></a>    <span class="fu">return</span>( <span class="sc">-</span>l ) <span class="co"># con menos ya que el optimizador minimiza</span></span>
<span id="cb42-37"><a href="#cb42-37"></a>  }</span>
<span id="cb42-38"><a href="#cb42-38"></a>  </span>
<span id="cb42-39"><a href="#cb42-39"></a>  dlglk <span class="ot">&lt;-</span> <span class="cf">function</span>( x ) <span class="fu">nl.grad</span>( x, lglk )</span>
<span id="cb42-40"><a href="#cb42-40"></a>  </span>
<span id="cb42-41"><a href="#cb42-41"></a>  <span class="co"># Maximización de la verosimilitud</span></span>
<span id="cb42-42"><a href="#cb42-42"></a>  loglik_max[[ g ]] <span class="ot">&lt;-</span> <span class="fu">nloptr</span>(</span>
<span id="cb42-43"><a href="#cb42-43"></a>    <span class="at">x0 =</span> theta0,</span>
<span id="cb42-44"><a href="#cb42-44"></a>    <span class="at">eval_f =</span> lglk,</span>
<span id="cb42-45"><a href="#cb42-45"></a>    <span class="at">eval_grad_f =</span> dlglk,</span>
<span id="cb42-46"><a href="#cb42-46"></a>    <span class="at">lb =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ),</span>
<span id="cb42-47"><a href="#cb42-47"></a>    <span class="at">ub =</span> <span class="fu">c</span>( <span class="cn">Inf</span>, <span class="cn">Inf</span> ),</span>
<span id="cb42-48"><a href="#cb42-48"></a>    <span class="at">opts =</span> <span class="fu">list</span>( <span class="at">maxeval =</span> <span class="fl">1e4</span>, </span>
<span id="cb42-49"><a href="#cb42-49"></a>                 <span class="at">ftol_abs =</span> <span class="fl">1e-15</span>,</span>
<span id="cb42-50"><a href="#cb42-50"></a>                 <span class="at">xtol_abs =</span> <span class="fu">c</span>( <span class="fl">1e-12</span>, <span class="fl">1e-12</span> ),</span>
<span id="cb42-51"><a href="#cb42-51"></a>                 <span class="at">algorithm =</span> <span class="st">'NLOPT_LD_LBFGS'</span> ) )</span>
<span id="cb42-52"><a href="#cb42-52"></a>  </span>
<span id="cb42-53"><a href="#cb42-53"></a>  estim_sev <span class="ot">&lt;-</span> <span class="fu">rbind</span>( </span>
<span id="cb42-54"><a href="#cb42-54"></a>    estim_sev, </span>
<span id="cb42-55"><a href="#cb42-55"></a>    <span class="fu">data.table</span>( <span class="at">grp =</span> g, </span>
<span id="cb42-56"><a href="#cb42-56"></a>                <span class="at">n =</span> <span class="fu">nrow</span>( datsev ),</span>
<span id="cb42-57"><a href="#cb42-57"></a>                <span class="at">meanlog =</span> loglik_max[[ g ]]<span class="sc">$</span>solution[ <span class="dv">1</span> ], </span>
<span id="cb42-58"><a href="#cb42-58"></a>                <span class="at">sdlog =</span> loglik_max[[ g ]]<span class="sc">$</span>solution[ <span class="dv">2</span> ],</span>
<span id="cb42-59"><a href="#cb42-59"></a>                <span class="at">loglik =</span> <span class="sc">-</span>loglik_max[[ g ]]<span class="sc">$</span>objective )</span>
<span id="cb42-60"><a href="#cb42-60"></a>  )</span>
<span id="cb42-61"><a href="#cb42-61"></a>}</span>
<span id="cb42-62"><a href="#cb42-62"></a></span>
<span id="cb42-63"><a href="#cb42-63"></a>estim_sev[ , EX <span class="sc">:</span><span class="er">=</span> <span class="fu">exp</span>( meanlog <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> sdlog<span class="sc">^</span><span class="dv">2</span> ) ]</span>
<span id="cb42-64"><a href="#cb42-64"></a>estim_sev[ , SDX <span class="sc">:</span><span class="er">=</span> <span class="fu">sqrt</span>( ( <span class="fu">exp</span>( sdlog<span class="sc">^</span><span class="dv">2</span> ) <span class="sc">-</span> <span class="dv">1</span> ) <span class="sc">*</span> <span class="fu">exp</span>( <span class="dv">2</span> <span class="sc">*</span> meanlog <span class="sc">+</span> sdlog<span class="sc">^</span><span class="dv">2</span> ) ) ]</span>
<span id="cb42-65"><a href="#cb42-65"></a>estim_sev[ , aic <span class="sc">:</span><span class="er">=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> loglik ]</span>
<span id="cb42-66"><a href="#cb42-66"></a>estim_sev[ , bic <span class="sc">:</span><span class="er">=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>( n ) <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> loglik ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>En este caso tenemos un problema donde existe convergencia para cada una de las optimizaciones por verosimilitud sin embargo, en la práctica un bucle de esta naturaleza puede implicar un costo computacional significativo en memoría y tiempo. Dependiendo de la dimensión del problema, se recomienda usar algunas técnicas que utilicen cálculo en paralelo o manejo óptimo de memoria, en algunas otras circunstancias puede ser conveniente utilizar un método de descomposición por <em>batchs</em> de información.</p>
<p>Los resultados de la estimación mediante maximización de verosimilitud para la severidad de los reclamos, los presentamos en la tabla a continuación.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>estim_sev <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>  <span class="fu">kable</span>(</span>
<span id="cb43-3"><a href="#cb43-3"></a>    <span class="at">label =</span> <span class="cn">NA</span>,</span>
<span id="cb43-4"><a href="#cb43-4"></a>    <span class="at">caption =</span> <span class="st">'Estimación de severidad de los reclamos'</span>,</span>
<span id="cb43-5"><a href="#cb43-5"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb43-6"><a href="#cb43-6"></a>    <span class="at">col.names =</span> <span class="fu">c</span>( <span class="st">'$g$'</span>, <span class="st">'$n$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">mu$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">sigma$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">ell( </span><span class="sc">\\</span><span class="st">mu, </span><span class="sc">\\</span><span class="st">sigma )$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">E[ X ]$'</span>, </span>
<span id="cb43-7"><a href="#cb43-7"></a>                   <span class="st">'$</span><span class="sc">\\</span><span class="st">sqrt{</span><span class="sc">\\</span><span class="st">V[ X ]}$'</span>, <span class="st">'$AIC$'</span>, <span class="st">'$BIC$'</span> ),</span>
<span id="cb43-8"><a href="#cb43-8"></a>    <span class="at">align =</span> <span class="st">'lrrrrrrrr'</span>,</span>
<span id="cb43-9"><a href="#cb43-9"></a>    <span class="at">digits =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span> ),</span>
<span id="cb43-10"><a href="#cb43-10"></a>    <span class="at">format.args =</span> <span class="fu">list</span>( <span class="at">big.mark =</span> <span class="st">','</span>, <span class="at">decimal.mark =</span> <span class="st">'.'</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span> ),</span>
<span id="cb43-11"><a href="#cb43-11"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb43-12"><a href="#cb43-12"></a>    <span class="at">centering =</span> <span class="cn">TRUE</span>,</span>
<span id="cb43-13"><a href="#cb43-13"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb43-14"><a href="#cb43-14"></a>  <span class="fu">kable_classic</span>( <span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">html_font =</span> <span class="st">"Cambria"</span>, <span class="at">position =</span> <span class="st">"center"</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb43-15"><a href="#cb43-15"></a>  <span class="fu">scroll_box</span>( <span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"500px"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="lightable-classic caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Estimación de severidad de los reclamos</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">$g$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$n$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\mu$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\sigma$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\ell( \mu, \sigma )$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\E[ X ]$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\sqrt{\V[ X ]}$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$AIC$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$BIC$</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FEMALE [0,20)</td>
<td style="text-align: right;">2,127</td>
<td style="text-align: right;">3.80928</td>
<td style="text-align: right;">0.59566</td>
<td style="text-align: right;">-10,018.47</td>
<td style="text-align: right;">53.88</td>
<td style="text-align: right;">35.16</td>
<td style="text-align: right;">20,040.94</td>
<td style="text-align: right;">20,052.26</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE [20,40)</td>
<td style="text-align: right;">7,197</td>
<td style="text-align: right;">3.81895</td>
<td style="text-align: right;">0.62012</td>
<td style="text-align: right;">-34,258.09</td>
<td style="text-align: right;">55.21</td>
<td style="text-align: right;">37.81</td>
<td style="text-align: right;">68,520.18</td>
<td style="text-align: right;">68,533.94</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FEMALE [40,60)</td>
<td style="text-align: right;">12,676</td>
<td style="text-align: right;">3.85843</td>
<td style="text-align: right;">0.64676</td>
<td style="text-align: right;">-61,371.99</td>
<td style="text-align: right;">58.42</td>
<td style="text-align: right;">42.10</td>
<td style="text-align: right;">122,747.97</td>
<td style="text-align: right;">122,762.87</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE [60,Inf]</td>
<td style="text-align: right;">10,375</td>
<td style="text-align: right;">3.91002</td>
<td style="text-align: right;">0.67717</td>
<td style="text-align: right;">-51,243.42</td>
<td style="text-align: right;">62.76</td>
<td style="text-align: right;">47.87</td>
<td style="text-align: right;">102,490.83</td>
<td style="text-align: right;">102,505.33</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE [0,20)</td>
<td style="text-align: right;">2,343</td>
<td style="text-align: right;">3.81387</td>
<td style="text-align: right;">0.61320</td>
<td style="text-align: right;">-11,114.59</td>
<td style="text-align: right;">54.70</td>
<td style="text-align: right;">36.96</td>
<td style="text-align: right;">22,233.19</td>
<td style="text-align: right;">22,244.70</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE [20,40)</td>
<td style="text-align: right;">2,468</td>
<td style="text-align: right;">3.84725</td>
<td style="text-align: right;">0.66988</td>
<td style="text-align: right;">-12,008.13</td>
<td style="text-align: right;">58.65</td>
<td style="text-align: right;">44.14</td>
<td style="text-align: right;">24,020.27</td>
<td style="text-align: right;">24,031.89</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE [40,60)</td>
<td style="text-align: right;">6,614</td>
<td style="text-align: right;">3.89478</td>
<td style="text-align: right;">0.70528</td>
<td style="text-align: right;">-32,835.54</td>
<td style="text-align: right;">63.02</td>
<td style="text-align: right;">50.59</td>
<td style="text-align: right;">65,675.08</td>
<td style="text-align: right;">65,688.67</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE [60,Inf]</td>
<td style="text-align: right;">8,372</td>
<td style="text-align: right;">3.92278</td>
<td style="text-align: right;">0.66965</td>
<td style="text-align: right;">-41,363.77</td>
<td style="text-align: right;">63.24</td>
<td style="text-align: right;">47.57</td>
<td style="text-align: right;">82,731.54</td>
<td style="text-align: right;">82,745.60</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>Sumarizando, hemos determinado para cada grupo de riesgo <span class="math inline">\(g\)</span> una distribución para la variable aleatoria correspondiente al número de reclamos <span class="math inline">\(N_g \rightsquigarrow NBinom( \alpha_g, p_g )\)</span>, de igual forma hemos estimado una distribución para la severidad de los reclamos <span class="math inline">\(X \rightsquigarrow LN( \mu_g, \sigma_g )\)</span>.</p>
<p>Es de notar que la estimación de la variable <span class="math inline">\(N_g\)</span> del número de siniestro se lo realizó por individuo y por cada periodo de observación <code>di</code> a <code>de</code>, esto nos permite estimar una frecuencia anualizada, debido a los anchos de los intervalos de observación. Pero si se considera pólizas con periodos de cobertura diferentes, hay que realizar el respectivo ajuste por la exposición al riesgo.</p>
<p>El modelo de colectivo para este caso en particular debe tomar en cuenta el número de individuos asegurados <span class="math inline">\(n_g\)</span> en el total de pólizas por cada grupo de riesgo <span class="math inline">\(g\)</span>. Esto bajo el supuesto que todas las pólizas de las <span class="math inline">\(n_g\)</span> tiene la misma exposición al riesgo de un año, si no es el caso habrá que realizar ajustes en la variable <span class="math inline">\(N_g\)</span> que cuenta el número de reclamos. <span class="math display">\[
S_g = \sum\limits_{i=1}^{n_g} \sum\limits_{j=1}^{N_g} D_{g,i}\left( X_{g,i,j} \right)
\]</span></p>
<p>La perdida total que sumariza cada grupo de riesgo <span class="math inline">\(g\)</span>, es la dada por la expresión: <span class="math display">\[
S = \sum\limits_{g \in G} S_g
= \sum\limits_{g \in G} \sum\limits_{i=1}^{n_g} \sum\limits_{j=1}^{N_g} D_{g,i}\left( X_{g,i,j} \right)
\]</span> Para realizar el cálculo de los valores deducidos se puede examinar la expresión del deducible, con ello llegamos al siguiente resultado. <span class="math display">\[
\begin{split}
\E\left[D(X)\right]
&amp; = \int\limits_0^{+\infty} D( x ) dF( x ) \\
&amp; = \int\limits_0^{+\infty} \min\left( \max( x - d, 0 ), M \right) dF( x ) \\
&amp; = \int\limits_d^{M+d} ( x - d ) dF( x ) + \int\limits_{M+d}^{+\infty} M dF( x ) \\
&amp; = \int\limits_d^{M+d} x dF( x ) - d P\left( d \leq X \leq M + d \right) + M P\left( X &gt; M + d \right) \\
&amp; = \int\limits_d^{M+d} x dF( x ) - d \left( F( M + d ) - F( d ) \right) + M \left( 1 - F( M + d ) \right) \\
&amp; = \int\limits_d^{M+d} x dF( x ) + M + d\ F( d ) - ( M + d ) F( M + d )
\end{split}
\]</span></p>
<p>La integral a la izquierda pude ser calculada con el uso de una aproximación numérica a la integral. Por su parte, los términos asociados a la probabilidad pueden ser calculados utilizando la función de distribución acumulada de la variable aleatoria de los reclamos <span class="math inline">\(X\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>estim <span class="ot">&lt;-</span> <span class="fu">merge.data.table</span>( estim_frec[ , <span class="fu">list</span>( grp, EN, SDN ) ], </span>
<span id="cb44-2"><a href="#cb44-2"></a>                           estim_sev[ , <span class="fu">list</span>( grp, EX, SDX, meanlog, sdlog ) ], <span class="at">by =</span> <span class="st">'grp'</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Ahora configuramos un posible portafolio, el cual ya en la práctica debe considerar los objetivos comerciales para la venta de diferentes productos de seguro. Para cada grupo de riesgo <span class="math inline">\(g\)</span> se puede considerar un número de póliza de un determinado producto, caracterizados por su deducible <span class="math inline">\(d\)</span> y monto máximo asegurado <span class="math inline">\(M\)</span>. Así, para grupo de riesgo <span class="math inline">\(g\)</span> y producto <span class="math inline">\(r\)</span> <span class="math display">\[
S_{g,r} = \sum\limits_{i=1}^{n_{g,r}} \sum\limits_{j=1}^{N_g} D\left( X_{i,j} \right)
\]</span> El valor esperado y varianza de cada uno de estos reclamos totales por grupo de riesgo <span class="math inline">\(g\)</span> y producto <span class="math inline">\(r\)</span>, están dados por: <span class="math display">\[
\begin{split}
\E\left[ S_{g,r} \right]
&amp; = n_{g,r} \E\left[ N_g \right] \E\left[ D( X_g ) \right] \\
\V\left[ S_{g,r} \right]
&amp; = n_{g,r} \left( \E\left[ N_g \right] \V\left[ D( X_g ) \right] + \V\left[ N_g \right] \E\left[ D( X_g ) \right]^2 \right)
\end{split}
\]</span> El reclamo total por grupo de riesgo <span class="math inline">\(g\)</span>, tan solo resulta de la suma de los reclamos totales por cada producto. <span class="math display">\[
S_g = \sum\limits_{r=1}^{R} S_{g,r}
\]</span> de igual forma su valor esperado y varianza están dados por: <span class="math display">\[
\begin{split}
\E\left[ S_g \right] = \sum\limits_{r=1}^R \E\left[ S_{g,r} \right]
&amp; = \sum\limits_{r=1}^R n_{g,r} \E\left[ N_g \right] \E\left[ D( X_g ) \right] \\
\V\left[ S_{g} \right] = \sum\limits_{r=1}^R \V\left[ S_{g,r} \right]
&amp; = \sum\limits_{r=1}^R n_{g,r} \left( \E\left[ N_g \right] \V\left[ D( X_g ) \right] + \V\left[ N_g \right] \E\left[ D( X_g ) \right]^2 \right)
\end{split}
\]</span></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>prods <span class="ot">&lt;-</span> <span class="fu">data.table</span>( <span class="at">ngr =</span> <span class="fu">c</span>( <span class="dv">1000</span>, <span class="dv">800</span>, <span class="dv">600</span>, <span class="dv">400</span>, <span class="dv">200</span> ), </span>
<span id="cb45-2"><a href="#cb45-2"></a>                     <span class="at">d =</span> <span class="fu">c</span>( <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span> ), </span>
<span id="cb45-3"><a href="#cb45-3"></a>                     <span class="at">M =</span> <span class="fu">c</span>( <span class="fl">2e4</span>, <span class="fl">2e4</span>, <span class="fl">2.5e4</span>, <span class="fl">3e4</span>, <span class="fl">4e4</span> ) )</span>
<span id="cb45-4"><a href="#cb45-4"></a>prods[ , id <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> ]</span>
<span id="cb45-5"><a href="#cb45-5"></a>grpcl[ , id <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> ]</span>
<span id="cb45-6"><a href="#cb45-6"></a>prods <span class="ot">&lt;-</span> <span class="fu">merge.data.table</span>( prods, grpcl, <span class="at">by =</span> <span class="st">'id'</span>, <span class="at">allow.cartesian =</span> <span class="cn">TRUE</span> )</span>
<span id="cb45-7"><a href="#cb45-7"></a>grpcl[ , id <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span> ]</span>
<span id="cb45-8"><a href="#cb45-8"></a>prods[ , id <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span> ]</span>
<span id="cb45-9"><a href="#cb45-9"></a></span>
<span id="cb45-10"><a href="#cb45-10"></a>prods <span class="ot">&lt;-</span> <span class="fu">merge.data.table</span>( prods, estim, <span class="at">by =</span> <span class="st">'grp'</span>, <span class="at">allow.cartesian =</span> <span class="cn">TRUE</span> )</span>
<span id="cb45-11"><a href="#cb45-11"></a><span class="fu">setorder</span>( prods, sex, xg, <span class="sc">-</span>d )</span>
<span id="cb45-12"><a href="#cb45-12"></a>prods[ , r <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> ]</span>
<span id="cb45-13"><a href="#cb45-13"></a>prods[ , r <span class="sc">:</span><span class="er">=</span> <span class="fu">cumsum</span>( r ), by <span class="ot">=</span> <span class="fu">list</span>( sex, xg ) ]</span>
<span id="cb45-14"><a href="#cb45-14"></a>intf <span class="ot">&lt;-</span> <span class="cf">function</span>( meanlog, sdlog, d, M, k ) <span class="fu">integrate</span>( <span class="cf">function</span>( x ) ( x <span class="sc">-</span> d )<span class="sc">^</span>k <span class="sc">*</span> <span class="fu">fd</span>( x, <span class="at">meanlog =</span> meanlog, <span class="at">sdlog =</span> sdlog ), <span class="at">lower =</span> d, <span class="at">upper =</span> M, <span class="at">abs.tol =</span> <span class="fl">1e-15</span> )<span class="sc">$</span>value</span>
<span id="cb45-15"><a href="#cb45-15"></a></span>
<span id="cb45-16"><a href="#cb45-16"></a>prods[ , EDX <span class="sc">:</span><span class="er">=</span> <span class="fu">mapply</span>( <span class="at">FUN =</span> intf, meanlog, sdlog, d, M, <span class="dv">1</span> ) <span class="sc">+</span> M <span class="sc">*</span> ( <span class="dv">1</span> <span class="sc">-</span> <span class="fu">Fd</span>( M <span class="sc">+</span> d ) )]</span>
<span id="cb45-17"><a href="#cb45-17"></a>prods[ , EDX2 <span class="sc">:</span><span class="er">=</span> <span class="fu">mapply</span>( <span class="at">FUN =</span> intf, meanlog, sdlog, d, M, <span class="dv">2</span> ) <span class="sc">+</span> M<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> ( <span class="dv">1</span> <span class="sc">-</span> <span class="fu">Fd</span>( M <span class="sc">+</span> d ) ) ]</span>
<span id="cb45-18"><a href="#cb45-18"></a>prods[ , SDDX <span class="sc">:</span><span class="er">=</span> <span class="fu">sqrt</span>( EDX2 <span class="sc">-</span> EDX<span class="sc">^</span><span class="dv">2</span> ) ]</span>
<span id="cb45-19"><a href="#cb45-19"></a></span>
<span id="cb45-20"><a href="#cb45-20"></a>prods[ , ES <span class="sc">:</span><span class="er">=</span> ngr <span class="sc">*</span> EN <span class="sc">*</span> EDX ]</span>
<span id="cb45-21"><a href="#cb45-21"></a>prods[ , SDS <span class="sc">:</span><span class="er">=</span> <span class="fu">sqrt</span>( ngr <span class="sc">*</span> ( EN <span class="sc">*</span> SDDX<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> SDN<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> EDX<span class="sc">^</span><span class="dv">2</span> ) ) ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>prods[ , <span class="fu">list</span>( sex, xg, r, ngr, d, M, EN, SDN, EX, SDX, EDX, SDDX, ES, SDS ) ] <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>  <span class="fu">kable</span>(</span>
<span id="cb46-3"><a href="#cb46-3"></a>    <span class="at">label =</span> <span class="cn">NA</span>,</span>
<span id="cb46-4"><a href="#cb46-4"></a>    <span class="at">caption =</span> <span class="st">'Estimación de los reclamos totales'</span>,</span>
<span id="cb46-5"><a href="#cb46-5"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb46-6"><a href="#cb46-6"></a>    <span class="at">col.names =</span> <span class="fu">c</span>( <span class="st">'sex'</span>, <span class="st">'$x_g$'</span>, <span class="st">'$r$'</span>, <span class="st">'$n_{g,r}$'</span>, <span class="st">'$d$'</span>, <span class="st">'$M$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">E[ N ]$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">sqrt{</span><span class="sc">\\</span><span class="st">V[ N ]}$'</span>,</span>
<span id="cb46-7"><a href="#cb46-7"></a>                   <span class="st">'$</span><span class="sc">\\</span><span class="st">E[ X ]$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">sqrt{</span><span class="sc">\\</span><span class="st">V[ X ]}$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">E[ D(X) ]$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">sqrt{</span><span class="sc">\\</span><span class="st">V[ D(X) ]}$'</span>,</span>
<span id="cb46-8"><a href="#cb46-8"></a>                   <span class="st">'$</span><span class="sc">\\</span><span class="st">E[ S_{g,r} ]$'</span>, <span class="st">'$</span><span class="sc">\\</span><span class="st">sqrt{</span><span class="sc">\\</span><span class="st">V[ S_{g,r} ]}$'</span> ),</span>
<span id="cb46-9"><a href="#cb46-9"></a>    <span class="at">align =</span> <span class="st">'llrrrrrrrrrrr'</span>,</span>
<span id="cb46-10"><a href="#cb46-10"></a>    <span class="at">digits =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span> ),</span>
<span id="cb46-11"><a href="#cb46-11"></a>    <span class="at">format.args =</span> <span class="fu">list</span>( <span class="at">big.mark =</span> <span class="st">','</span>, <span class="at">decimal.mark =</span> <span class="st">'.'</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span> ),</span>
<span id="cb46-12"><a href="#cb46-12"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb46-13"><a href="#cb46-13"></a>    <span class="at">centering =</span> <span class="cn">TRUE</span>,</span>
<span id="cb46-14"><a href="#cb46-14"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb46-15"><a href="#cb46-15"></a>    <span class="at">longtable =</span> <span class="cn">TRUE</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb46-16"><a href="#cb46-16"></a>  <span class="fu">kable_classic</span>( </span>
<span id="cb46-17"><a href="#cb46-17"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb46-18"><a href="#cb46-18"></a>    <span class="at">html_font =</span> <span class="st">"Cambria"</span>, </span>
<span id="cb46-19"><a href="#cb46-19"></a>    <span class="at">position =</span> <span class="st">'center'</span>, </span>
<span id="cb46-20"><a href="#cb46-20"></a>    <span class="at">latex_options =</span> <span class="fu">c</span>( <span class="st">'hold_position'</span>, <span class="st">'repeat_header'</span>, <span class="st">'scale_down'</span> ) ) <span class="sc">%&gt;%</span></span>
<span id="cb46-21"><a href="#cb46-21"></a>  <span class="fu">scroll_box</span>( <span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"500px"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="lightable-classic caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Estimación de los reclamos totales</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">sex</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">$x_g$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$r$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$n_{g,r}$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$d$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$M$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\E[ N ]$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\sqrt{\V[ N ]}$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\E[ X ]$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\sqrt{\V[ X ]}$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\E[ D(X) ]$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\sqrt{\V[ D(X) ]}$</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">$\E[ S_{g,r} ]$</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">$\sqrt{\V[ S_{g,r} ]}$</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[0,20)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">2.36</td>
<td style="text-align: right;">8.99</td>
<td style="text-align: right;">53.88</td>
<td style="text-align: right;">35.16</td>
<td style="text-align: right;">34.25</td>
<td style="text-align: right;">34.76</td>
<td style="text-align: right;">80,954.12</td>
<td style="text-align: left;">9,886.63</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[0,20)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">800</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">2.36</td>
<td style="text-align: right;">8.99</td>
<td style="text-align: right;">53.88</td>
<td style="text-align: right;">35.16</td>
<td style="text-align: right;">34.25</td>
<td style="text-align: right;">34.76</td>
<td style="text-align: right;">64,763.30</td>
<td style="text-align: left;">8,842.87</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[0,20)</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">600</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">25,000</td>
<td style="text-align: right;">2.36</td>
<td style="text-align: right;">8.99</td>
<td style="text-align: right;">53.88</td>
<td style="text-align: right;">35.16</td>
<td style="text-align: right;">34.25</td>
<td style="text-align: right;">34.76</td>
<td style="text-align: right;">48,572.47</td>
<td style="text-align: left;">7,658.15</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[0,20)</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">30,000</td>
<td style="text-align: right;">2.36</td>
<td style="text-align: right;">8.99</td>
<td style="text-align: right;">53.88</td>
<td style="text-align: right;">35.16</td>
<td style="text-align: right;">34.25</td>
<td style="text-align: right;">34.76</td>
<td style="text-align: right;">32,381.65</td>
<td style="text-align: left;">6,252.86</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[0,20)</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">40,000</td>
<td style="text-align: right;">2.36</td>
<td style="text-align: right;">8.99</td>
<td style="text-align: right;">53.88</td>
<td style="text-align: right;">35.16</td>
<td style="text-align: right;">34.25</td>
<td style="text-align: right;">34.76</td>
<td style="text-align: right;">16,190.82</td>
<td style="text-align: left;">4,421.44</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[20,40)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">4.35</td>
<td style="text-align: right;">16.94</td>
<td style="text-align: right;">55.21</td>
<td style="text-align: right;">37.81</td>
<td style="text-align: right;">35.64</td>
<td style="text-align: right;">37.37</td>
<td style="text-align: right;">155,007.68</td>
<td style="text-align: left;">19,254.60</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[20,40)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">800</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">4.35</td>
<td style="text-align: right;">16.94</td>
<td style="text-align: right;">55.21</td>
<td style="text-align: right;">37.81</td>
<td style="text-align: right;">35.64</td>
<td style="text-align: right;">37.37</td>
<td style="text-align: right;">124,006.14</td>
<td style="text-align: left;">17,221.83</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[20,40)</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">600</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">25,000</td>
<td style="text-align: right;">4.35</td>
<td style="text-align: right;">16.94</td>
<td style="text-align: right;">55.21</td>
<td style="text-align: right;">37.81</td>
<td style="text-align: right;">35.64</td>
<td style="text-align: right;">37.37</td>
<td style="text-align: right;">93,004.61</td>
<td style="text-align: left;">14,914.55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[20,40)</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">30,000</td>
<td style="text-align: right;">4.35</td>
<td style="text-align: right;">16.94</td>
<td style="text-align: right;">55.21</td>
<td style="text-align: right;">37.81</td>
<td style="text-align: right;">35.64</td>
<td style="text-align: right;">37.37</td>
<td style="text-align: right;">62,003.07</td>
<td style="text-align: left;">12,177.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[20,40)</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">40,000</td>
<td style="text-align: right;">4.35</td>
<td style="text-align: right;">16.94</td>
<td style="text-align: right;">55.21</td>
<td style="text-align: right;">37.81</td>
<td style="text-align: right;">35.64</td>
<td style="text-align: right;">37.37</td>
<td style="text-align: right;">31,001.54</td>
<td style="text-align: left;">8,610.92</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[40,60)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">9.89</td>
<td style="text-align: right;">27.12</td>
<td style="text-align: right;">58.42</td>
<td style="text-align: right;">42.10</td>
<td style="text-align: right;">38.85</td>
<td style="text-align: right;">41.66</td>
<td style="text-align: right;">384,035.64</td>
<td style="text-align: left;">33,568.72</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[40,60)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">800</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">9.89</td>
<td style="text-align: right;">27.12</td>
<td style="text-align: right;">58.42</td>
<td style="text-align: right;">42.10</td>
<td style="text-align: right;">38.85</td>
<td style="text-align: right;">41.66</td>
<td style="text-align: right;">307,228.51</td>
<td style="text-align: left;">30,024.78</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[40,60)</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">600</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">25,000</td>
<td style="text-align: right;">9.89</td>
<td style="text-align: right;">27.12</td>
<td style="text-align: right;">58.42</td>
<td style="text-align: right;">42.10</td>
<td style="text-align: right;">38.85</td>
<td style="text-align: right;">41.66</td>
<td style="text-align: right;">230,421.39</td>
<td style="text-align: left;">26,002.22</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[40,60)</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">30,000</td>
<td style="text-align: right;">9.89</td>
<td style="text-align: right;">27.12</td>
<td style="text-align: right;">58.42</td>
<td style="text-align: right;">42.10</td>
<td style="text-align: right;">38.85</td>
<td style="text-align: right;">41.66</td>
<td style="text-align: right;">153,614.26</td>
<td style="text-align: left;">21,230.72</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[40,60)</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">40,000</td>
<td style="text-align: right;">9.89</td>
<td style="text-align: right;">27.12</td>
<td style="text-align: right;">58.42</td>
<td style="text-align: right;">42.10</td>
<td style="text-align: right;">38.85</td>
<td style="text-align: right;">41.66</td>
<td style="text-align: right;">76,807.13</td>
<td style="text-align: left;">15,012.39</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[60,Inf]</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">16.01</td>
<td style="text-align: right;">39.95</td>
<td style="text-align: right;">62.76</td>
<td style="text-align: right;">47.87</td>
<td style="text-align: right;">43.19</td>
<td style="text-align: right;">47.45</td>
<td style="text-align: right;">691,528.26</td>
<td style="text-align: left;">54,891.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[60,Inf]</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">800</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">16.01</td>
<td style="text-align: right;">39.95</td>
<td style="text-align: right;">62.76</td>
<td style="text-align: right;">47.87</td>
<td style="text-align: right;">43.19</td>
<td style="text-align: right;">47.45</td>
<td style="text-align: right;">553,222.61</td>
<td style="text-align: left;">49,096.01</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[60,Inf]</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">600</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">25,000</td>
<td style="text-align: right;">16.01</td>
<td style="text-align: right;">39.95</td>
<td style="text-align: right;">62.76</td>
<td style="text-align: right;">47.87</td>
<td style="text-align: right;">43.19</td>
<td style="text-align: right;">47.45</td>
<td style="text-align: right;">414,916.96</td>
<td style="text-align: left;">42,518.40</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[60,Inf]</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">30,000</td>
<td style="text-align: right;">16.01</td>
<td style="text-align: right;">39.95</td>
<td style="text-align: right;">62.76</td>
<td style="text-align: right;">47.87</td>
<td style="text-align: right;">43.19</td>
<td style="text-align: right;">47.45</td>
<td style="text-align: right;">276,611.30</td>
<td style="text-align: left;">34,716.12</td>
</tr>
<tr class="even">
<td style="text-align: left;">FEMALE</td>
<td style="text-align: left;">[60,Inf]</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">40,000</td>
<td style="text-align: right;">16.01</td>
<td style="text-align: right;">39.95</td>
<td style="text-align: right;">62.76</td>
<td style="text-align: right;">47.87</td>
<td style="text-align: right;">43.19</td>
<td style="text-align: right;">47.45</td>
<td style="text-align: right;">138,305.65</td>
<td style="text-align: left;">24,548.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[0,20)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">2.21</td>
<td style="text-align: right;">9.10</td>
<td style="text-align: right;">54.70</td>
<td style="text-align: right;">36.96</td>
<td style="text-align: right;">35.11</td>
<td style="text-align: right;">36.53</td>
<td style="text-align: right;">77,713.10</td>
<td style="text-align: left;">10,250.89</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[0,20)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">800</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">2.21</td>
<td style="text-align: right;">9.10</td>
<td style="text-align: right;">54.70</td>
<td style="text-align: right;">36.96</td>
<td style="text-align: right;">35.11</td>
<td style="text-align: right;">36.53</td>
<td style="text-align: right;">62,170.48</td>
<td style="text-align: left;">9,168.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[0,20)</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">600</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">25,000</td>
<td style="text-align: right;">2.21</td>
<td style="text-align: right;">9.10</td>
<td style="text-align: right;">54.70</td>
<td style="text-align: right;">36.96</td>
<td style="text-align: right;">35.11</td>
<td style="text-align: right;">36.53</td>
<td style="text-align: right;">46,627.86</td>
<td style="text-align: left;">7,940.31</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[0,20)</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">30,000</td>
<td style="text-align: right;">2.21</td>
<td style="text-align: right;">9.10</td>
<td style="text-align: right;">54.70</td>
<td style="text-align: right;">36.96</td>
<td style="text-align: right;">35.11</td>
<td style="text-align: right;">36.53</td>
<td style="text-align: right;">31,085.24</td>
<td style="text-align: left;">6,483.23</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[0,20)</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">40,000</td>
<td style="text-align: right;">2.21</td>
<td style="text-align: right;">9.10</td>
<td style="text-align: right;">54.70</td>
<td style="text-align: right;">36.96</td>
<td style="text-align: right;">35.11</td>
<td style="text-align: right;">36.53</td>
<td style="text-align: right;">15,542.62</td>
<td style="text-align: left;">4,584.34</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[20,40)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">1.97</td>
<td style="text-align: right;">8.86</td>
<td style="text-align: right;">58.65</td>
<td style="text-align: right;">44.14</td>
<td style="text-align: right;">39.16</td>
<td style="text-align: right;">43.65</td>
<td style="text-align: right;">77,089.70</td>
<td style="text-align: left;">11,140.40</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[20,40)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">800</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">1.97</td>
<td style="text-align: right;">8.86</td>
<td style="text-align: right;">58.65</td>
<td style="text-align: right;">44.14</td>
<td style="text-align: right;">39.16</td>
<td style="text-align: right;">43.65</td>
<td style="text-align: right;">61,671.76</td>
<td style="text-align: left;">9,964.28</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[20,40)</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">600</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">25,000</td>
<td style="text-align: right;">1.97</td>
<td style="text-align: right;">8.86</td>
<td style="text-align: right;">58.65</td>
<td style="text-align: right;">44.14</td>
<td style="text-align: right;">39.16</td>
<td style="text-align: right;">43.65</td>
<td style="text-align: right;">46,253.82</td>
<td style="text-align: left;">8,629.32</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[20,40)</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">30,000</td>
<td style="text-align: right;">1.97</td>
<td style="text-align: right;">8.86</td>
<td style="text-align: right;">58.65</td>
<td style="text-align: right;">44.14</td>
<td style="text-align: right;">39.16</td>
<td style="text-align: right;">43.65</td>
<td style="text-align: right;">30,835.88</td>
<td style="text-align: left;">7,045.81</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[20,40)</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">40,000</td>
<td style="text-align: right;">1.97</td>
<td style="text-align: right;">8.86</td>
<td style="text-align: right;">58.65</td>
<td style="text-align: right;">44.14</td>
<td style="text-align: right;">39.16</td>
<td style="text-align: right;">43.65</td>
<td style="text-align: right;">15,417.94</td>
<td style="text-align: left;">4,982.14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[40,60)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">6.00</td>
<td style="text-align: right;">18.64</td>
<td style="text-align: right;">63.02</td>
<td style="text-align: right;">50.59</td>
<td style="text-align: right;">43.54</td>
<td style="text-align: right;">50.11</td>
<td style="text-align: right;">261,139.22</td>
<td style="text-align: left;">25,962.48</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[40,60)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">800</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">6.00</td>
<td style="text-align: right;">18.64</td>
<td style="text-align: right;">63.02</td>
<td style="text-align: right;">50.59</td>
<td style="text-align: right;">43.54</td>
<td style="text-align: right;">50.11</td>
<td style="text-align: right;">208,911.37</td>
<td style="text-align: left;">23,221.55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[40,60)</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">600</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">25,000</td>
<td style="text-align: right;">6.00</td>
<td style="text-align: right;">18.64</td>
<td style="text-align: right;">63.02</td>
<td style="text-align: right;">50.59</td>
<td style="text-align: right;">43.54</td>
<td style="text-align: right;">50.11</td>
<td style="text-align: right;">156,683.53</td>
<td style="text-align: left;">20,110.45</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[40,60)</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">30,000</td>
<td style="text-align: right;">6.00</td>
<td style="text-align: right;">18.64</td>
<td style="text-align: right;">63.02</td>
<td style="text-align: right;">50.59</td>
<td style="text-align: right;">43.54</td>
<td style="text-align: right;">50.11</td>
<td style="text-align: right;">104,455.69</td>
<td style="text-align: left;">16,420.12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[40,60)</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">40,000</td>
<td style="text-align: right;">6.00</td>
<td style="text-align: right;">18.64</td>
<td style="text-align: right;">63.02</td>
<td style="text-align: right;">50.59</td>
<td style="text-align: right;">43.54</td>
<td style="text-align: right;">50.11</td>
<td style="text-align: right;">52,227.84</td>
<td style="text-align: left;">11,610.77</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[60,Inf]</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">16.26</td>
<td style="text-align: right;">38.61</td>
<td style="text-align: right;">63.24</td>
<td style="text-align: right;">47.57</td>
<td style="text-align: right;">43.64</td>
<td style="text-align: right;">47.18</td>
<td style="text-align: right;">709,672.56</td>
<td style="text-align: left;">53,625.70</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[60,Inf]</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">800</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20,000</td>
<td style="text-align: right;">16.26</td>
<td style="text-align: right;">38.61</td>
<td style="text-align: right;">63.24</td>
<td style="text-align: right;">47.57</td>
<td style="text-align: right;">43.64</td>
<td style="text-align: right;">47.18</td>
<td style="text-align: right;">567,738.05</td>
<td style="text-align: left;">47,964.28</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[60,Inf]</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">600</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">25,000</td>
<td style="text-align: right;">16.26</td>
<td style="text-align: right;">38.61</td>
<td style="text-align: right;">63.24</td>
<td style="text-align: right;">47.57</td>
<td style="text-align: right;">43.64</td>
<td style="text-align: right;">47.18</td>
<td style="text-align: right;">425,803.54</td>
<td style="text-align: left;">41,538.29</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[60,Inf]</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">30,000</td>
<td style="text-align: right;">16.26</td>
<td style="text-align: right;">38.61</td>
<td style="text-align: right;">63.24</td>
<td style="text-align: right;">47.57</td>
<td style="text-align: right;">43.64</td>
<td style="text-align: right;">47.18</td>
<td style="text-align: right;">283,869.02</td>
<td style="text-align: left;">33,915.87</td>
</tr>
<tr class="even">
<td style="text-align: left;">MALE</td>
<td style="text-align: left;">[60,Inf]</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">40,000</td>
<td style="text-align: right;">16.26</td>
<td style="text-align: right;">38.61</td>
<td style="text-align: right;">63.24</td>
<td style="text-align: right;">47.57</td>
<td style="text-align: right;">43.64</td>
<td style="text-align: right;">47.18</td>
<td style="text-align: right;">141,934.51</td>
<td style="text-align: left;">23,982.14</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</div>
<!------------------------------------------------------------------------------------------------->
</section>
<section id="modelos_variables_explicativas" class="level2" data-number="7.10">
<h2 data-number="7.10" class="anchored" data-anchor-id="modelos_variables_explicativas"><span class="header-section-number">7.10</span> Modelos con variables explicativas</h2>
<p>En algunos casos más generales, donde la población presenta heterogeneidad respecto del riesgo al cual están expuestos, como también de las dimensiones de sus reclamos, se considera que existen variables aleatorias adicionales <span class="math inline">\(Y_1, \ldots, Y_n\)</span> que determinan el número de reclamos <span class="math inline">\(N\)</span> y el valor de los siniestros <span class="math inline">\(\{X_i\}\)</span>. Es decir no hay independencia entre <span class="math inline">\(\{Y_j\}\)</span> y <span class="math inline">\(N\)</span> así como tampoco entre <span class="math inline">\(\{Y_j\}\)</span> y <span class="math inline">\(\{X_i\}\)</span>. Es así que un modelo colectivo <span class="math inline">\(S = \sum\limits_{i=1}^N X_i\)</span> su estudio, estimación y tarificación debe ser realizada de forma condicional respecto de las variables aleatorias explicativas <span class="math inline">\(\{Y_j\}\)</span>, <span class="math display">\[
\E[ S ]
= \E\left[ \E\left[ S \middle| Y_1, \ldots, Y_n \right] \right]
\]</span> de donde es necesario estimar cada una de las esperanzas condicionadas <span class="math inline">\(\E\left[ S \middle| Y_1, \ldots, Y_n \right]\)</span>.</p>
<p>En la práctica las variables explicativas <span class="math inline">\(\{ Y_j \}\)</span> suelen ser seleccionadas para caracterizar el perfil de riesgo de cada cliente. Para su selección se suele utilizar algunos criterios de tipo económico, financiero, legal y estadístico.</p>
<!------------------------------------------------------------------------------------------------->
</section>
<section id="proceso_estocastico_reclamos" class="level2" data-number="7.11">
<h2 data-number="7.11" class="anchored" data-anchor-id="proceso_estocastico_reclamos"><span class="header-section-number">7.11</span> Proceso estocástico de reclamos totales</h2>
<p>Hasta el momento no hemos considerado que los reclamos se producen en el tiempo, que cada reclamo está bien vinculado al tiempo; es más podemos identificar algunos instantes en el tiempo que le corresponde, tenemos así el tiempo cuando se suscita el siniestro o tiempo de ocurrencia, el tiempo de aviso cuando se comunica al asegurador el siniestro y un tiempo de pago. Los dos últimos no son directos asociados al evento del siniestro sino están asociados a otras variables que pueden afectar la demora para comunicar un siniestro por parte del asegurado y la demora para cancelarlo por parte del asegurador.</p>
<p>Así por tanto si tenemos una secuencia de siniestros <span class="math inline">\(\{X_n\}_{n\in\N^*}\)</span>, estos los podemos considerar ordenados en el tiempo conforme han venido presentándose en instantes <span class="math inline">\(0= T_0 \leq T_1 \leq \cdots \leq T_n \leq \cdots\)</span>, es decir se le asocia a los reclamos <span class="math inline">\(\{X_n\}\)</span> la secuencia de los <strong>tiempos de arribo</strong> <span class="math inline">\(\{T_n\}_{n\in\N}\)</span>, donde <span class="math inline">\(T_{n+1} \geq T_n\)</span>, para cualquier <span class="math inline">\(n \in \N\)</span>. Ciertamente, es de esperar que los tiempos de arribo sean variables aleatorias y están asociados a la frecuencia <span class="math inline">\(N\)</span> en un periodo dado, ya que <span class="math inline">\(N\)</span> cuenta los tiempos de arribo hasta un instante dado <span class="math inline">\(t \geq 0\)</span>, bajo esta perspectiva transformamos a <span class="math inline">\(N\)</span> en una variable aleatoria dependiente del tiempo, en lo que se conoce como un <strong>proceso estocástico</strong>. <span class="math display">\[
N( t )
= \#\left\{ n \in \N\ \middle|\ T_n \leq t \right\}
= \sum\limits_{n=0}^{+\infty} \mathbf{1}_{(-\infty,t]}\left( T_n \right)
\]</span></p>
<p>Inmediatamente de este razonamiento, resulta que los reclamos totales también se transforman en proceso estocástico, conforme se van considerando los arribos de los reclamos. <span class="math display">\[
S( t ) = \sum\limits_{i=1}^{N( t )} X_i
\]</span> donde claramente, como hemos venido haciéndolo, si <span class="math inline">\(N(t) = 0\)</span>, entonces la suma total de reclamos es cero, <span class="math inline">\(S(t) = 0\)</span>.</p>
<p>Además, junto con lo anterior, se pueden identificar las variables aleatorias de <strong>tiempos entre arribos</strong>, dadas por las diferencias entre tiempos de arribo contiguos <span class="math display">\[
W_n = T_n - T_{n-1},\quad \forall n \in \N^*
\]</span></p>
<p>Un hipótesis bien común en el modelamiento de un proceso de pérdida agregada utilizando esta aproximación es asumir que los tiempos entre arribo <span class="math inline">\(\{W_n\}\)</span> son independientes entre si, es decir, el momento que se producen cada uno de los siniestros es de forma independiente. También se suele suponer independencia entre los tiempos entre arribo <span class="math inline">\(\{W_n\}\)</span> y las variables que representan la magnitud de cada uno de los reclamos <span class="math inline">\(\{X_n\}\)</span>.</p>
<p>Los resultados para el cálculo de la esperanza y la varianza se pueden obtener de forma similar a lo que realizamos en la sección @ref(modelo_individual). <span class="math display">\[
\begin{split}
\E[S(t)]
&amp; = \E\left[ \sum\limits_{i=1}^{N(t)} X_i \right] \\
&amp; = \sum\limits_{n=0}^{+\infty} \E\left[ \sum\limits_{i=1}^n X_i\ \middle|\ N(t) = n \right]P( N(t) = n )
\quad \text{utilizando la esperanza condicional} \\
&amp; = 0 P( N(t) = 0 ) + \sum\limits_{n=1}^{+\infty}
\E\left[ \sum\limits_{i=1}^n X_i\ \middle|\ N(t) = n \right]P( N(t) = n ) \\
&amp; = \sum\limits_{n=1}^{+\infty} \sum\limits_{i=1}^n \E\left[ X_i \mid N(t) = n \right]P( N(t) = n )
\quad \text{linealidad de la esperanza} \\
&amp; = \sum\limits_{n=0}^{+\infty} n \E\left[ X \mid N(t) = n \right]P( N(t) = n )
\quad \text{si $\{X_i\}$ son idénticamente distribuidas} \\
&amp; = \E\left[ X \right] \sum\limits_{n=0}^{+\infty} n P( N(t) = n )
\quad \text{si $X$ y $N(t)$ son independientes} \\
&amp; = \E[ N(t) ] \E[ X ]
\end{split}
\]</span></p>
<p>el segundo momento de <span class="math inline">\(S(t)\)</span> se calcula de forma similar <span class="math display">\[
\begin{split}
\E[S(t)^2]
&amp; = \E\left[ \left( \sum\limits_{i=1}^{N(t)} X_i \right)^2 \right] \\
&amp; = \sum\limits_{n=0}^\infty \E\left[ \sum\limits_{i, j=1}^n X_i X_j \middle| N(t) = n \right] P( N = n )
\quad \text{propiedades de la esperanza condicional} \\
&amp; = \sum\limits_{n=0}^\infty \sum\limits_{i, j=1}^n \E\left[ X_i X_j \right] P( N(t) = n )
\quad \text{si $\{X_i\}$ y $N(t)$ son independientes} \\
&amp; = \sum\limits_{n=0}^\infty \left( \sum\limits_{i=1}^n \E\left[ X_i^2 \right]
+ \sum\limits_{i,j=1,i\neq j}^n \E\left[ X_i X_j \right] \right) P( N(t) = n ) \\
&amp; = \sum\limits_{n=0}^\infty \left( n \E\left[ X^2 \right] + n(n-1) \E\left[ X \right]^2 \right) P( N(t) = n )
\quad \text{si $\{X_i\}$ son i.i.d} \\
&amp; = \E\left[N(t)\right] \E\left[X^2\right] + \E\left[N(t)^2\right] \E\left[X\right]^2
- \E\left[N(t)\right] \E\left[X\right]^2 \\
&amp; = \E\left[N(t)\right] \V\left[X\right] + \E\left[N(t)^2\right] \E\left[X\right]^2
\end{split}
\]</span></p>
<p>y finalmente la varianza de <span class="math inline">\(S(t)\)</span> <span class="math display">\[
\begin{split}
\V\left[S(t)\right]
&amp; = \E\left[S(t)^2\right] - \E\left[S(t)\right]^2 \\
&amp; = \E\left[N(t)\right] \V\left[X\right]
+ \E\left[N(t)^2\right] \E\left[X\right]^2 - \E\left[N(t)\right]^2 \E\left[X\right]^2 \\
&amp; = \E\left[N(t)\right] \V\left[X\right] + \V\left[N(t)\right] \E\left[X\right]^2
\end{split}
\]</span> Si trabajamos bajo la hipótesis que los tiempos entre arribos <span class="math inline">\(\{W_n\}\)</span> son i.i.d, con distribución de probabilidad común <span class="math inline">\(F_W\)</span>. Podemos comprender y estudiar de una forma un poco más sencilla el proceso estocástico atado a la frecuencia de los siniestros <span class="math inline">\(N\)</span>.</p>
<p>Notemos primeramente que se tienen la siguiente igualdad entre los eventos <span class="math display">\[
\{N(t) = n\}
= \{T_n \leq \land T_{n+1} &gt; t\}
= \{T_n \leq t \} \cap \{ T_{n+1} \leq t\}^c
= \{T_n \leq t \} \setminus \{ T_{n+1} \leq t\}
\]</span> además es de observar que <span class="math inline">\(\{ T_{n+1} \leq t\} \subset \{ T_{n} \leq t\}\)</span>. Con todo esto en consideración para cualquier <span class="math inline">\(n &gt; 0\)</span>. <span class="math display">\[
\begin{split}
P( N(t) = n )
&amp; = P( T_n \leq t \land T_{n+1} &gt; t ) \\
&amp; = P( \{T_n \leq t \} \setminus \{ T_{n+1} \leq t\} ) \\
&amp; = P( T_n \leq t ) - P( T_{n+1} \leq t ) \\
&amp; = F_W^{\star n}( t ) - F_W^{\star n + 1}( t )
\end{split}
\]</span></p>
<p>el caso <span class="math inline">\(n = 0\)</span> también es sencillo <span class="math display">\[
\begin{split}
P( N(t) = 0 )
&amp; = P( T_0 \leq t \land T_1 &gt; t ) \\
&amp; = P( \{T_0 \leq t \} \setminus \{ T_1 \leq t\} ) \\
&amp; = P( T_0 \leq t ) - P( T_1 \leq t ) \\
&amp; = 1 - F_W^{\star 1}( t ) \\
&amp; = F_W^{\star 0}( t ) - F_W^{\star 1}( t )
\end{split}
\]</span></p>
<p>De lo anterior resulta que la esperanza de <span class="math inline">\(N(t)\)</span>, está dada por la siguiente serie. <span class="math display">\[
\begin{split}
\E[ N( t ) ]
&amp; = \sum\limits_{n=0}^{+\infty} n P( N(t) = n ) \\
&amp; = \sum\limits_{n=0}^{+\infty} n \left( F_W^{\star n}( t ) - F_W^{\star n + 1}( t ) \right) \\
&amp; = 0\left( F_W^{\star 0}( t ) - F_W^{\star 1}( t ) \right)
+ 1\left( F_W^{\star 1}( t ) - F_W^{\star 2}( t ) \right)
+ 2\left( F_W^{\star 2}( t ) - F_W^{\star 3}( t ) \right)
+ \cdots \\
&amp; = \sum\limits_{n=1}^{+\infty} F_W^{\star n}( t )
\end{split}
\]</span></p>
<section id="algoritmo-de-simulación-3" class="level3" data-number="7.11.1">
<h3 data-number="7.11.1" class="anchored" data-anchor-id="algoritmo-de-simulación-3"><span class="header-section-number">7.11.1</span> Algoritmo de simulación</h3>
<ol type="1">
<li><p>Se selecciona el número adecuado de simulaciones <span class="math inline">\(m \in \N^*\)</span>,</p></li>
<li><p>Se selecciona el número de simulaciones de tiempos de arribo <span class="math inline">\(M \in \N^*\)</span>,</p></li>
<li><p>Dada la distribución de los tiempos entre arribos <span class="math inline">\(F_W\)</span> para cada simulación <span class="math inline">\(i \in \{1, \ldots, m\}\)</span> se genera una muestra <span class="math inline">\(W_{i,1}, \ldots, W_{i,M}\)</span> de tamaño de <span class="math inline">\(M\)</span>,</p></li>
<li><p>Para cada simulación <span class="math inline">\(i \in \{1, \ldots, m\}\)</span> y cada <span class="math inline">\(n \in \{0, \ldots, M\}\)</span> calculamos los tiempos de arribo <span class="math inline">\(T_{i,0},\ldots, T_{i,M}\)</span> <span class="math display">\[
T_{i,0} = 0,\qquad
T_{i,n} = \sum\limits_{k=1}^n W_{i,k}
\]</span></p></li>
<li><p>Se toma una malla de discretización en el tiempo <span class="math inline">\(0 = t_0 &lt; t_1 &lt; \cdots &lt; t_p = T\)</span> y calculamos para cada simulación <span class="math inline">\(i \in \{1,\ldots,m\}\)</span> y tiempo <span class="math inline">\(t_l\)</span>, con <span class="math inline">\(l \in \{0,\ldots,p\}\)</span>. <span class="math display">\[
N_{i,l} = \#\left\{ n \in \N\ \middle|\ T_{i,n} \leq t_l \right\}
= \sum\limits_{n=0}^{M} \mathbf{1}_{(-\infty,t_l]}\left( T_n \right)
\]</span> precisamente para cada simulación <span class="math inline">\(i\)</span>, el término <span class="math inline">\(N_{i,l}\)</span> es una aproximación al proceso <span class="math inline">\(N( t_l )\)</span> evaluado en el tiempo <span class="math inline">\(t_l\)</span>. Así se puede tener la aproximación de la media <span class="math display">\[
\E\left[ N( t_l ) \right] \approx \frac{1}{m} \sum\limits_{i=1}^m N_{i,l}
\]</span></p></li>
<li><p>Con la simulación el proceso estocástico <span class="math inline">\(N\)</span> podemos ahora proceder a simular los reclamos totales. Para cada simulación <span class="math inline">\(i \in \{1,\ldots,m\}\)</span>, tomamos una muestra de forma independiente e igualmente distribuida de los reclamos individuales <span class="math inline">\(X_{i,1}, \ldots, X_{i,N_{i,p}}\)</span>, la cual tiene tamaño <span class="math inline">\(N_{i,p}\)</span>, y son tomados de la distribución de probabilidad <span class="math inline">\(F_X\)</span></p></li>
<li><p>Para cada simulación <span class="math inline">\(i \in \{1,\ldots, m\}\)</span> y cada tiempo <span class="math inline">\(t_l\)</span> con <span class="math inline">\(l \in \{0,\ldots,p\}\)</span>, calculamos la suma <span class="math display">\[
S_{i,l} = \sum\limits_{j=1}^{N_{i,l}} X_{i,j}
\]</span> cada <span class="math inline">\(S_{i,l}\)</span> es una aproximación al proceso del total de reclamos <span class="math inline">\(S(t_l)\)</span> precisamente en el tiempo <span class="math inline">\(t_l\)</span>. Así resulta la aproximación <span class="math display">\[
\E\left[ S( t_l ) \right] \approx \frac{1}{m} \sum\limits_{i=1}^m S_{i,l}
\]</span></p></li>
<li><p>Además, para cada instante <span class="math inline">\(t_l\)</span>, se puede aproximar la función de distribución acumulada <span class="math inline">\(F_{S(t_l)}\)</span> de la variable aleatoria <span class="math inline">\(S( t_l )\)</span> utilizando la distribución acumulada empírica generada con la muestra <span class="math inline">\(S_{1,l},\ldots,S_{m,l}\)</span>. Para cualquier <span class="math inline">\(s \in \R\)</span>, tenemos la aproximación <span class="math display">\[
F_{S(t_l)}( s ) \approx F_{m,l}( s )
= \frac{1}{m} \sum\limits_{i=1}^m \mathbf{1}_{(-\infty,s]}\left( S_{i,l} \right)
\]</span> El algoritmo de simulación anterior tiene una falencia, no se sabe a priori que valor <span class="math inline">\(M\)</span> se debe escoger para simular de forma correcta los procesos <span class="math inline">\(N\)</span> y <span class="math inline">\(S\)</span> hasta un tiempo máximo <span class="math inline">\(T\)</span> dado. Esto implica que si <span class="math inline">\(M\)</span> no es del tamaño adecuado, las estimaciones que se realice utilizando la simulación va a degradarse conforme avanza el tiempo.</p></li>
</ol>
<div id="l6ex9" class="example">
<p>El siguiente ejemplo es de especial atención ya que es utilizado en muchas aplicaciones, podemos considerar el caso donde el tiempo entre arribos <span class="math inline">\(\{W_n\}\)</span> es i.i.d y con distribución de probabilidad común <span class="math inline">\(F_W\)</span> dada por una ley exponencial <span class="math inline">\(Exp( \lambda )\)</span>. Un resultado clásico muestra que la suma de <span class="math inline">\(n\)</span> exponenciales sigue una ley gamma <span class="math inline">\(Gamma(n,\lambda)\)</span>, esto implica que <span class="math inline">\(T_n = W_1 + \cdots + W_n \rightsquigarrow Gamma( n, \lambda )\)</span> lo que quiere decir que la convolución <span class="math inline">\(F_W^{\star n}\)</span> es una <span class="math inline">\(Gamma( n, \lambda )\)</span>. Así por tanto, el proceso estocástico de conteo <span class="math inline">\(N(t) = \#\left\{ n \in \N\ \middle|\ T_n \leq t \right\}\)</span> tiene las siguientes probabilidades <span class="math display">\[
\begin{split}
P( N( t ) = n )
&amp; = F_W^{\star n}( t ) - F_W^{\star n + 1}( t ) \\
&amp; = \exp( -\lambda t ) \sum\limits_{k=n}^{+\infty} \frac{(\lambda t)^k}{k!}
- \exp( -\lambda t ) \sum\limits_{k={n+1}}^{+\infty} \frac{(\lambda t)^k}{k!} \\
&amp; = \exp( -\lambda t ) \frac{(\lambda t)^n}{n!}
\end{split}
\]</span></p>
<p>En conclusión <span class="math inline">\(N(t)\)</span> tiene como distribución una ley de Poisson <span class="math inline">\(Pois( \lambda t )\)</span>, en particular se conoce a <span class="math inline">\(N\)</span> como un proceso de Poisson.</p>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>m <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>lambda <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>M <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>p <span class="ot">&lt;-</span> <span class="dv">365</span></span>
<span id="cb47-5"><a href="#cb47-5"></a>u <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb47-6"><a href="#cb47-6"></a>s <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb47-7"><a href="#cb47-7"></a></span>
<span id="cb47-8"><a href="#cb47-8"></a><span class="fu">set.seed</span>( <span class="dv">432147</span> )</span>
<span id="cb47-9"><a href="#cb47-9"></a>W <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="dv">1</span><span class="sc">:</span>m, <span class="at">FUN =</span> <span class="cf">function</span>( n ) <span class="fu">rexp</span>( M, <span class="at">rate =</span> lambda ) )</span>
<span id="cb47-10"><a href="#cb47-10"></a>Tn <span class="ot">&lt;-</span> <span class="fu">lapply</span>( W, <span class="at">FUN =</span> cumsum )</span>
<span id="cb47-11"><a href="#cb47-11"></a>Tnmax <span class="ot">&lt;-</span> <span class="fu">max</span>( <span class="fu">sapply</span>( Tn, <span class="at">FUN =</span> max ) )</span>
<span id="cb47-12"><a href="#cb47-12"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="dv">0</span>, Tnmax, <span class="at">length =</span> p )</span>
<span id="cb47-13"><a href="#cb47-13"></a></span>
<span id="cb47-14"><a href="#cb47-14"></a>N <span class="ot">&lt;-</span> <span class="fu">lapply</span>( Tn, <span class="at">FUN =</span> <span class="cf">function</span>( Tk ) <span class="fu">sapply</span>( t, <span class="at">FUN =</span> <span class="cf">function</span>( t ) <span class="fu">sum</span>( Tk <span class="sc">&lt;=</span> t ) ) )</span>
<span id="cb47-15"><a href="#cb47-15"></a>Nmax <span class="ot">&lt;-</span> <span class="fu">max</span>( <span class="fu">sapply</span>( N, <span class="at">FUN =</span> <span class="cf">function</span>( Ni ) <span class="fu">last</span>( Ni ) ) )</span>
<span id="cb47-16"><a href="#cb47-16"></a></span>
<span id="cb47-17"><a href="#cb47-17"></a><span class="fu">set.seed</span>( <span class="dv">7324312</span> )</span>
<span id="cb47-18"><a href="#cb47-18"></a>X <span class="ot">&lt;-</span> <span class="fu">lapply</span>( N, <span class="at">FUN =</span> <span class="cf">function</span>( Ni ) <span class="fu">rlnorm</span>( <span class="fu">last</span>( Ni ), <span class="at">meanlog =</span> u, <span class="at">sdlog =</span> s ) )</span>
<span id="cb47-19"><a href="#cb47-19"></a>S <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="dv">1</span><span class="sc">:</span>m, <span class="at">FUN =</span> <span class="cf">function</span>( i ) {</span>
<span id="cb47-20"><a href="#cb47-20"></a>  Si <span class="ot">&lt;-</span> <span class="fu">cumsum</span>( X[[ i ]] )</span>
<span id="cb47-21"><a href="#cb47-21"></a>  <span class="fu">return</span>( <span class="fu">sapply</span>( N[[ i ]], <span class="at">FUN =</span> <span class="cf">function</span>( Nj ) <span class="fu">ifelse</span>( Nj <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, Si[ Nj ] ) ) )</span>
<span id="cb47-22"><a href="#cb47-22"></a>} )</span>
<span id="cb47-23"><a href="#cb47-23"></a>Smax <span class="ot">&lt;-</span> <span class="fu">max</span>( <span class="fu">sapply</span>( S, <span class="at">FUN =</span> <span class="cf">function</span>( Si ) <span class="fu">last</span>( Si ) ) )</span>
<span id="cb47-24"><a href="#cb47-24"></a></span>
<span id="cb47-25"><a href="#cb47-25"></a>EN <span class="ot">&lt;-</span> lambda <span class="sc">*</span> t</span>
<span id="cb47-26"><a href="#cb47-26"></a>EeN <span class="ot">&lt;-</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span>p, <span class="at">FUN =</span> <span class="cf">function</span>( l ) <span class="fu">mean</span>( <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span>m, <span class="cf">function</span>( i ) N[[ i ]][ l ] ) ) )</span>
<span id="cb47-27"><a href="#cb47-27"></a></span>
<span id="cb47-28"><a href="#cb47-28"></a>ES <span class="ot">&lt;-</span> EN <span class="sc">*</span> <span class="fu">exp</span>( u <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> s<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb47-29"><a href="#cb47-29"></a>EeS <span class="ot">&lt;-</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span>p, <span class="at">FUN =</span> <span class="cf">function</span>( l ) <span class="fu">mean</span>( <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span>m, <span class="cf">function</span>( i ) S[[ i ]][ l ] ) ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>En el gráfico a continuación presentamos todos los procesos de conteo <span class="math inline">\(N_{i}\)</span> simulados, como es de esperarse son funciones de escalera, siempre crecientes, que toman solo valores positivos.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>Sord <span class="ot">&lt;-</span> <span class="fu">order</span>( <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span>m, <span class="at">FUN =</span> <span class="cf">function</span>( j ) <span class="fu">last</span>( S[[j]] ) ) )</span>
<span id="cb48-2"><a href="#cb48-2"></a>Ndat <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="cf">for</span> ( j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m ) {</span>
<span id="cb48-4"><a href="#cb48-4"></a>  Ndat <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>( <span class="fu">list</span>( Ndat, <span class="fu">data.table</span>( <span class="at">t =</span> t, <span class="at">m =</span> <span class="fu">as.factor</span>( Sord[ j ] ), <span class="at">N =</span> N[[ j ]], <span class="at">S =</span> S[[ j ]] ) ) )</span>
<span id="cb48-5"><a href="#cb48-5"></a>}</span>
<span id="cb48-6"><a href="#cb48-6"></a>cols <span class="ot">&lt;-</span> <span class="fu">wes_palette</span>( m, <span class="at">name =</span> <span class="st">"FantasticFox1"</span>, <span class="at">type =</span> <span class="st">"continuous"</span>)</span>
<span id="cb48-7"><a href="#cb48-7"></a></span>
<span id="cb48-8"><a href="#cb48-8"></a>time <span class="ot">&lt;-</span> t </span>
<span id="cb48-9"><a href="#cb48-9"></a></span>
<span id="cb48-10"><a href="#cb48-10"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb48-11"><a href="#cb48-11"></a>  <span class="fu">geom_step</span>( <span class="at">data =</span> Ndat, <span class="fu">aes</span>( <span class="at">x =</span> t, <span class="at">y =</span> N, <span class="at">group =</span> m, <span class="at">colour =</span> m ), <span class="at">linewidth =</span> <span class="fl">0.2</span> ) <span class="sc">+</span></span>
<span id="cb48-12"><a href="#cb48-12"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> time, <span class="at">y =</span> EN, <span class="at">colour =</span> <span class="st">'a'</span> ), <span class="at">linewidth =</span> <span class="fl">1.5</span> ) <span class="sc">+</span></span>
<span id="cb48-13"><a href="#cb48-13"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> time, <span class="at">y =</span> EeN, <span class="at">colour =</span> <span class="st">'b'</span> ), <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb48-14"><a href="#cb48-14"></a>  <span class="fu">scale_color_manual</span>( <span class="at">breaks =</span> <span class="fu">c</span>( <span class="fu">as.factor</span>( <span class="dv">1</span><span class="sc">:</span>m ), <span class="st">'a'</span>, <span class="st">'b'</span> ), </span>
<span id="cb48-15"><a href="#cb48-15"></a>                      <span class="at">values =</span> <span class="fu">c</span>( cols, <span class="st">'dodgerblue3'</span>, <span class="st">'olivedrab3'</span> ) ) <span class="sc">+</span></span>
<span id="cb48-16"><a href="#cb48-16"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, Tnmax, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb48-17"><a href="#cb48-17"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, Tnmax, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb48-18"><a href="#cb48-18"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, Tnmax ), </span>
<span id="cb48-19"><a href="#cb48-19"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb48-20"><a href="#cb48-20"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, Nmax, <span class="at">length =</span> <span class="dv">11</span> ), </span>
<span id="cb48-21"><a href="#cb48-21"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, Nmax, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb48-22"><a href="#cb48-22"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, Nmax ), </span>
<span id="cb48-23"><a href="#cb48-23"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb48-24"><a href="#cb48-24"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$t$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb48-25"><a href="#cb48-25"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$N(t)$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb48-26"><a href="#cb48-26"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb48-27"><a href="#cb48-27"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">"none"</span> )</span>
<span id="cb48-28"><a href="#cb48-28"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g17-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>El gráfico a continuación presenta la simulación de los procesos correspondientes al total de reclamos, conforme avanza el tiempo. De igual manera los procesos <span class="math inline">\(S_i\)</span> son funciones de escalera, siempre crecientes, con saltos correspondientes a los reclamos individuales.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>Sqmax <span class="ot">&lt;-</span> <span class="fu">quantile</span>( <span class="fu">sapply</span>( S, <span class="at">FUN =</span> <span class="cf">function</span>( Si ) <span class="fu">last</span>( Si ) ), <span class="at">probs =</span> <span class="fl">0.99</span> )</span>
<span id="cb49-2"><a href="#cb49-2"></a></span>
<span id="cb49-3"><a href="#cb49-3"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4"></a>  <span class="fu">geom_step</span>( <span class="at">data =</span> Ndat, <span class="fu">aes</span>( <span class="at">x =</span> t, <span class="at">y =</span> S, <span class="at">group =</span> m, <span class="at">colour =</span> m ), <span class="at">linewidth =</span> <span class="fl">0.2</span> ) <span class="sc">+</span></span>
<span id="cb49-5"><a href="#cb49-5"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> time, <span class="at">y =</span> ES, <span class="at">colour =</span> <span class="st">'a'</span> ), <span class="at">linewidth =</span> <span class="fl">1.5</span> ) <span class="sc">+</span></span>
<span id="cb49-6"><a href="#cb49-6"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>( <span class="at">x =</span> time, <span class="at">y =</span> EeS, <span class="at">colour =</span> <span class="st">'b'</span> ), <span class="at">linewidth =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb49-7"><a href="#cb49-7"></a>  <span class="fu">scale_color_manual</span>( <span class="at">breaks =</span> <span class="fu">c</span>( <span class="fu">as.factor</span>( <span class="dv">1</span><span class="sc">:</span>m ), <span class="st">'a'</span>, <span class="st">'b'</span> ), </span>
<span id="cb49-8"><a href="#cb49-8"></a>                      <span class="at">values =</span> <span class="fu">c</span>( cols, <span class="st">'dodgerblue3'</span>, <span class="st">'olivedrab3'</span> ) ) <span class="sc">+</span></span>
<span id="cb49-9"><a href="#cb49-9"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, Tnmax, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb49-10"><a href="#cb49-10"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, Tnmax, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb49-11"><a href="#cb49-11"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, Tnmax ), <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb49-12"><a href="#cb49-12"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, Sqmax, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb49-13"><a href="#cb49-13"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, Sqmax, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb49-14"><a href="#cb49-14"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, Sqmax ), <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb49-15"><a href="#cb49-15"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$t$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb49-16"><a href="#cb49-16"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$S(t)$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb49-17"><a href="#cb49-17"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb49-18"><a href="#cb49-18"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">"none"</span> )</span>
<span id="cb49-19"><a href="#cb49-19"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g18-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Como se describe en el paso 8 del algoritmo de simulación, para cada tiempo <span class="math inline">\(t_l\)</span> se puede estimar la distribución de probabilidad de la variable aleatoria <span class="math inline">\(S(t_l)\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>FeS <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="dv">1</span><span class="sc">:</span>p, <span class="at">FUN =</span> <span class="cf">function</span>( l ) <span class="fu">ecdf</span>( <span class="fu">sapply</span>( S, <span class="at">FUN =</span> <span class="cf">function</span>( Si ) Si[ l ] ) ) )</span>
<span id="cb50-2"><a href="#cb50-2"></a>ns <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb50-3"><a href="#cb50-3"></a>s <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="dv">0</span>, Smax, <span class="at">length =</span> ns )</span>
<span id="cb50-4"><a href="#cb50-4"></a>Fes <span class="ot">&lt;-</span> <span class="fu">lapply</span>( FeS, <span class="at">FUN =</span> <span class="cf">function</span>( FeSl ) <span class="fu">sapply</span>( s, <span class="at">FUN =</span> FeSl ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>La figura a continuación muestra cada una de las distribuciones de probabilidad empíricas estimadas <span class="math inline">\(F_{m,l}\)</span>. Se puede observar que conforme avanza el tiempo, aumenta la probabilidad de observar valores mayores del proceso <span class="math inline">\(S\)</span> correspondiente al total de reclamos.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>FeSdat <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="cf">for</span> ( j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p ) {</span>
<span id="cb51-3"><a href="#cb51-3"></a>  FeSdat <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>( <span class="fu">list</span>( FeSdat, <span class="fu">data.table</span>( <span class="at">s =</span> s, <span class="at">m =</span> <span class="fu">as.factor</span>( j ), <span class="at">Fes =</span> Fes[[ j ]] ) ) )</span>
<span id="cb51-4"><a href="#cb51-4"></a>}</span>
<span id="cb51-5"><a href="#cb51-5"></a>cols <span class="ot">&lt;-</span> <span class="fu">wes_palette</span>( p, <span class="at">name =</span> <span class="st">"FantasticFox1"</span>, <span class="at">type =</span> <span class="st">"continuous"</span>)</span>
<span id="cb51-6"><a href="#cb51-6"></a></span>
<span id="cb51-7"><a href="#cb51-7"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb51-8"><a href="#cb51-8"></a>  <span class="fu">geom_step</span>( <span class="at">data =</span> FeSdat, <span class="fu">aes</span>( <span class="at">x =</span> s, <span class="at">y =</span> Fes, <span class="at">group =</span> m, <span class="at">colour =</span> m ), <span class="at">linewidth =</span> <span class="fl">0.1</span> ) <span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9"></a>  <span class="fu">scale_color_manual</span>( <span class="at">values =</span> <span class="fu">c</span>( cols ) ) <span class="sc">+</span></span>
<span id="cb51-10"><a href="#cb51-10"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, Smax, <span class="at">length =</span> <span class="dv">5</span> ),</span>
<span id="cb51-11"><a href="#cb51-11"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, Smax, <span class="at">length =</span> <span class="dv">5</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb51-12"><a href="#cb51-12"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, Smax ), </span>
<span id="cb51-13"><a href="#cb51-13"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">0</span> ) ) <span class="sc">+</span></span>
<span id="cb51-14"><a href="#cb51-14"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">11</span> ),</span>
<span id="cb51-15"><a href="#cb51-15"></a>                      <span class="at">labels =</span> <span class="fu">formatC</span>( <span class="fu">seq</span>( <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">11</span> ), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">'f'</span> ), </span>
<span id="cb51-16"><a href="#cb51-16"></a>                      <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">1</span> ), </span>
<span id="cb51-17"><a href="#cb51-17"></a>                      <span class="at">expand =</span> <span class="fu">c</span>( <span class="fl">0.005</span>, <span class="fl">0.005</span> ) ) <span class="sc">+</span></span>
<span id="cb51-18"><a href="#cb51-18"></a>  <span class="fu">xlab</span>( <span class="fu">TeX</span>( <span class="st">"$S$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb51-19"><a href="#cb51-19"></a>  <span class="fu">ylab</span>( <span class="fu">TeX</span>( <span class="st">"$F_{m,l}$"</span> ) ) <span class="sc">+</span> </span>
<span id="cb51-20"><a href="#cb51-20"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb51-21"><a href="#cb51-21"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">"none"</span> )</span>
<span id="cb51-22"><a href="#cb51-22"></a></span>
<span id="cb51-23"><a href="#cb51-23"></a><span class="fu">plot</span>( plt )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lectura_06_files/figure-html/l6g19-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body" role="list">
<div id="ref-PanjerLoss2012" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">A. Klugman S, H. Panjer H, E. Willmot G (2012) <span class="nocase">Loss Models, From Data to Decisions</span>, 4th ed. John Wiley &amp; Sons, Inc, Hoboken, New Jersey, United States</div>
</div>
<div id="ref-LossModFur" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">A. Klugman S, H. Panjer H, E. Willmot G (2013) <span>Loss Models, Further Topics</span>, 1st ed. John Wiley &amp; Sons, Inc, Hoboken, New Jersey, United States</div>
</div>
<div id="ref-aep_algo" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Arbenz P, Embrechts P, Puccetti G (2011) <span class="nocase">The AEP algorithm for the fast computation of the distribution of the sum of dependent random variables</span>. Bernoulli 17. doi: <a href="https://doi.org/10.3150/10-bej284">10.3150/10-bej284</a></div>
</div>
<div id="ref-gaep_algo" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Arbenz P, Embrechts P, Puccetti G (2012) <a href="http://dx.doi.org/10.1080/17442508.2011.566337"><span class="nocase">The GAEP algorithm for the fast computation of the distribution of a function of dependent random variables</span></a>. Stochastics: An International Journal of Probability and Stochastic Processes 84</div>
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./lectura_05.html" class="pagination-link" aria-label="Distribuciones">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Distribuciones</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lectura_07.html" class="pagination-link" aria-label="Tarificación">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Tarificación</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb52" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb52-1"><a href="#cb52-1"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2"></a><span class="fu"># Modelos de pérdida agregada {#modelos_perdida}</span></span>
<span id="cb52-3"><a href="#cb52-3"></a></span>
<span id="cb52-6"><a href="#cb52-6"></a><span class="in">```{r}</span></span>
<span id="cb52-7"><a href="#cb52-7"></a><span class="co">#| echo: false</span></span>
<span id="cb52-8"><a href="#cb52-8"></a><span class="co">#| warning: false</span></span>
<span id="cb52-9"><a href="#cb52-9"></a><span class="fu">source</span>(<span class="st">"_common.R"</span>)</span>
<span id="cb52-10"><a href="#cb52-10"></a><span class="in">```</span></span>
<span id="cb52-11"><a href="#cb52-11"></a></span>
<span id="cb52-12"><a href="#cb52-12"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-13"><a href="#cb52-13"></a><span class="fu">## Mutualización del riesgo</span></span>
<span id="cb52-14"><a href="#cb52-14"></a>La idea de mantener un seguro está basada en la mutualización de los riesgos. La mutualización </span>
<span id="cb52-15"><a href="#cb52-15"></a>como tal nace del mismo mecanismo bajo el cual funciona un seguro, cada asegurado transfiera </span>
<span id="cb52-16"><a href="#cb52-16"></a>su riesgo individual a la compañía de seguros, la suma total de estos riesgos $S$ es el riesgo total</span>
<span id="cb52-17"><a href="#cb52-17"></a>que asume el asegurador.</span>
<span id="cb52-18"><a href="#cb52-18"></a></span>
<span id="cb52-19"><a href="#cb52-19"></a>Los riesgos de cada uno de los $n \in \N$ asegurados, pueden ser representados por variables </span>
<span id="cb52-20"><a href="#cb52-20"></a>aleatorias $X_1,\ldots X_n$, las mismas pueden ser independientes o dependientes entre ellas. El </span>
<span id="cb52-21"><a href="#cb52-21"></a>costo total del portafolio está dado por la suma de todos estos riesgos:</span>
<span id="cb52-22"><a href="#cb52-22"></a>$$</span>
<span id="cb52-23"><a href="#cb52-23"></a>S = \sum\limits_{i=1}^n X_i</span>
<span id="cb52-24"><a href="#cb52-24"></a>$$</span>
<span id="cb52-25"><a href="#cb52-25"></a>El conocer la distribución del costo total $S$ es una tarea crucial para el asegurador.</span>
<span id="cb52-26"><a href="#cb52-26"></a></span>
<span id="cb52-27"><a href="#cb52-27"></a>El valor esperado de los reclamos totales, puede ser calculado fácilmente utilizando las</span>
<span id="cb52-28"><a href="#cb52-28"></a>propiedades de linealidad de la esperanza matemática $\E$:</span>
<span id="cb52-29"><a href="#cb52-29"></a>$$</span>
<span id="cb52-30"><a href="#cb52-30"></a>\E<span class="co">[</span><span class="ot"> S </span><span class="co">]</span></span>
<span id="cb52-31"><a href="#cb52-31"></a>= \E\left<span class="co">[</span><span class="ot"> \sum\limits_{i=1}^n X_i \right</span><span class="co">]</span> </span>
<span id="cb52-32"><a href="#cb52-32"></a>= \sum\limits_{i=1}^n \E\left<span class="co">[</span><span class="ot"> X_i \right</span><span class="co">]</span></span>
<span id="cb52-33"><a href="#cb52-33"></a>$$</span>
<span id="cb52-34"><a href="#cb52-34"></a>La varianza de la variable aleatoria del costo total $S$, está dada por:</span>
<span id="cb52-35"><a href="#cb52-35"></a>$$</span>
<span id="cb52-36"><a href="#cb52-36"></a>\begin{split}</span>
<span id="cb52-37"><a href="#cb52-37"></a>\V\left<span class="co">[</span><span class="ot"> S \right</span><span class="co">]</span></span>
<span id="cb52-38"><a href="#cb52-38"></a>&amp; = \V\left<span class="co">[</span><span class="ot"> \sum\limits_{i=1}^n X_i \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-39"><a href="#cb52-39"></a>&amp; = \sum\limits_{i=1}^n \V\left<span class="co">[</span><span class="ot"> X_i \right</span><span class="co">]</span> </span>
<span id="cb52-40"><a href="#cb52-40"></a><span class="ss">+ </span>\sum\limits_{i=1}^n \sum\limits_{j=1,j\neq i}^n \mathbb{C}\left<span class="co">[</span><span class="ot"> X_i, X_j \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-41"><a href="#cb52-41"></a>&amp; = \sum\limits_{i=1}^n \V\left<span class="co">[</span><span class="ot"> X_i \right</span><span class="co">]</span> </span>
<span id="cb52-42"><a href="#cb52-42"></a><span class="ss">+ </span>2\sum\limits_{i=1}^{n-1} \sum\limits_{j=i+1}^n \mathbb{C}\left<span class="co">[</span><span class="ot"> X_i, X_j \right</span><span class="co">]</span></span>
<span id="cb52-43"><a href="#cb52-43"></a>\end{split}</span>
<span id="cb52-44"><a href="#cb52-44"></a>$$</span>
<span id="cb52-45"><a href="#cb52-45"></a></span>
<span id="cb52-46"><a href="#cb52-46"></a>Muchas de las veces el número total de reclamos $n$ es incierto y por tal razón es mejor considerar</span>
<span id="cb52-47"><a href="#cb52-47"></a>que el número de siniestros vendrá dado por otra variable aleatoria discreta $N$, que solo tomará </span>
<span id="cb52-48"><a href="#cb52-48"></a>valores en $\N$.</span>
<span id="cb52-49"><a href="#cb52-49"></a>$$</span>
<span id="cb52-50"><a href="#cb52-50"></a>S = \sum\limits_{i=1}^N X_i</span>
<span id="cb52-51"><a href="#cb52-51"></a>$$</span>
<span id="cb52-52"><a href="#cb52-52"></a></span>
<span id="cb52-53"><a href="#cb52-53"></a>Esto nos lleva a considerar diferentes modelos de agregación de reclamos o pérdidas, en inglés</span>
<span id="cb52-54"><a href="#cb52-54"></a>"loss models" @PanjerLoss2012, @LossModFur.</span>
<span id="cb52-55"><a href="#cb52-55"></a></span>
<span id="cb52-56"><a href="#cb52-56"></a>Estudiemos la forma general que podría tener la distribución de $S$, sin realizar hipótesis previa</span>
<span id="cb52-57"><a href="#cb52-57"></a>sobre el comportamiento de las variables aleatorias $X_1, \ldots, X_n$ y $N$.</span>
<span id="cb52-58"><a href="#cb52-58"></a>$$</span>
<span id="cb52-59"><a href="#cb52-59"></a>\begin{split}</span>
<span id="cb52-60"><a href="#cb52-60"></a>F_S( s ) </span>
<span id="cb52-61"><a href="#cb52-61"></a>&amp; = P( S \leq s ) <span class="sc">\\</span></span>
<span id="cb52-62"><a href="#cb52-62"></a>&amp; = P\left( \sum\limits_{i=1}^N X_i \leq s \right) <span class="sc">\\</span></span>
<span id="cb52-63"><a href="#cb52-63"></a>&amp; = P\left( \sum\limits_{i=1}^N X_i \leq s \land N \in \N \right) <span class="sc">\\</span></span>
<span id="cb52-64"><a href="#cb52-64"></a>&amp; = P\left( \bigcup\limits_{n\in \N} \left<span class="sc">\{</span> \sum\limits_{i=1}^N X_i \leq s \land N \in <span class="sc">\{</span>n<span class="sc">\}</span> \right<span class="sc">\}</span>\right) <span class="sc">\\</span></span>
<span id="cb52-65"><a href="#cb52-65"></a>&amp; = \sum\limits_{n=0}^{+\infty} P\left( \sum\limits_{i=1}^n X_i \leq s \land N = n \right) </span>
<span id="cb52-66"><a href="#cb52-66"></a>\qquad \text{probabilidad de eventos disjuntos} <span class="sc">\\</span></span>
<span id="cb52-67"><a href="#cb52-67"></a>&amp; = \sum\limits_{n=0}^{+\infty} P\left( \sum\limits_{i=1}^n X_i \leq s\ \middle|\ N = n \right) P( N = n )</span>
<span id="cb52-68"><a href="#cb52-68"></a>\qquad \text{propiedades de la probabilidad condicional} <span class="sc">\\</span></span>
<span id="cb52-69"><a href="#cb52-69"></a>&amp; = \sum\limits_{n=0}^{+\infty} \int\limits_{\left<span class="sc">\{</span>\sum\limits_{i=1}^n x_i \leq s\right<span class="sc">\}</span>} dF_n( x_1, \ldots, x_n )\ p_n</span>
<span id="cb52-70"><a href="#cb52-70"></a>\qquad \text{$F_n$ es la distribución conjunta de $X_1, \ldots, X_n$ dado $N = n$} </span>
<span id="cb52-71"><a href="#cb52-71"></a>\end{split}</span>
<span id="cb52-72"><a href="#cb52-72"></a>$$</span>
<span id="cb52-73"><a href="#cb52-73"></a>La última expresión nos dice que para comprender el comportamiento de los reclamos totales $S$,</span>
<span id="cb52-74"><a href="#cb52-74"></a>debemos estudiar y estimar la frecuencia de los reclamos $N$, además de comprender y estimar cada</span>
<span id="cb52-75"><a href="#cb52-75"></a>uno de los reclamos $X_i$ y su interacción, recordando que $N$ puede tomar valores tendiendo al</span>
<span id="cb52-76"><a href="#cb52-76"></a>infinito. En términos resumidos, hay que comprender y estimar la frecuencia y severidad de los </span>
<span id="cb52-77"><a href="#cb52-77"></a>reclamos que están asociados al riesgo cubierto. </span>
<span id="cb52-78"><a href="#cb52-78"></a></span>
<span id="cb52-79"><a href="#cb52-79"></a>Los términos integrales $\int\limits_{\left<span class="sc">\{</span>\sum\limits_{i=1}^n x_i \leq s\right<span class="sc">\}</span>} dF_n( x_1, \ldots, x_n )$ </span>
<span id="cb52-80"><a href="#cb52-80"></a>asociados a la severidad presentan un verdadero reto estadístico y computacional; años atrás se</span>
<span id="cb52-81"><a href="#cb52-81"></a>desarrollaron algoritmos para calcular estos términos @aep_algo, @gaep_algo.</span>
<span id="cb52-82"><a href="#cb52-82"></a></span>
<span id="cb52-83"><a href="#cb52-83"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-84"><a href="#cb52-84"></a><span class="fu">## Modelo individual {#modelo_individual}</span></span>
<span id="cb52-85"><a href="#cb52-85"></a></span>
<span id="cb52-86"><a href="#cb52-86"></a></span>
<span id="cb52-87"><a href="#cb52-87"></a>::: {.Definition #dmodind title="Modelo individual"}</span>
<span id="cb52-88"><a href="#cb52-88"></a>En el **modelo individual** de pérdida consideramos que el número de siniestros que se producirán es</span>
<span id="cb52-89"><a href="#cb52-89"></a>conocido, por ejemplo, puede ser a lo sumo el tamaño de la población asegurada, en tal caso la</span>
<span id="cb52-90"><a href="#cb52-90"></a>variable aleatoria $N$ pasa a ser una constante, que representaremos por $n$. De esta forma, la</span>
<span id="cb52-91"><a href="#cb52-91"></a>severidad total puede ser fácilmente representada por: </span>
<span id="cb52-92"><a href="#cb52-92"></a>$$</span>
<span id="cb52-93"><a href="#cb52-93"></a>S = \sum\limits_{i=1}^n X_i</span>
<span id="cb52-94"><a href="#cb52-94"></a>$$</span>
<span id="cb52-95"><a href="#cb52-95"></a></span>
<span id="cb52-96"><a href="#cb52-96"></a>La hipótesis más usual que sostiene a este modelo es la indenpendencia entre cada uno de los</span>
<span id="cb52-97"><a href="#cb52-97"></a>reclamos $X_i$ y $X_j$ para cualquier $1 \leq i \neq j \leq n$.</span>
<span id="cb52-98"><a href="#cb52-98"></a>:::</span>
<span id="cb52-99"><a href="#cb52-99"></a></span>
<span id="cb52-100"><a href="#cb52-100"></a></span>
<span id="cb52-101"><a href="#cb52-101"></a>El valor esperado de la severidad total $S$ es:</span>
<span id="cb52-102"><a href="#cb52-102"></a>$$</span>
<span id="cb52-103"><a href="#cb52-103"></a>\begin{split}</span>
<span id="cb52-104"><a href="#cb52-104"></a>\E<span class="co">[</span><span class="ot">S</span><span class="co">]</span></span>
<span id="cb52-105"><a href="#cb52-105"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> \sum\limits_{i=1}^n X_i \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-106"><a href="#cb52-106"></a>&amp; = \sum\limits_{i=1}^n \E\left<span class="co">[</span><span class="ot"> X_i \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-107"><a href="#cb52-107"></a>&amp; = n \E<span class="co">[</span><span class="ot">X</span><span class="co">]</span> \quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son idénticamente distribuidas}</span>
<span id="cb52-108"><a href="#cb52-108"></a>\end{split}</span>
<span id="cb52-109"><a href="#cb52-109"></a>$$</span>
<span id="cb52-110"><a href="#cb52-110"></a></span>
<span id="cb52-111"><a href="#cb52-111"></a>Así mismo, la varianza de $S$:</span>
<span id="cb52-112"><a href="#cb52-112"></a>$$</span>
<span id="cb52-113"><a href="#cb52-113"></a>\begin{split}</span>
<span id="cb52-114"><a href="#cb52-114"></a>\V\left<span class="co">[</span><span class="ot"> S \right</span><span class="co">]</span></span>
<span id="cb52-115"><a href="#cb52-115"></a>&amp; = \V\left<span class="co">[</span><span class="ot"> \sum\limits_{i=1}^n X_i \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-116"><a href="#cb52-116"></a>&amp; = \sum\limits_{i=1}^n \V\left<span class="co">[</span><span class="ot"> X_i \right</span><span class="co">]</span> </span>
<span id="cb52-117"><a href="#cb52-117"></a><span class="ss">+ </span>\sum\limits_{i=1}^n \sum\limits_{j=1,j\neq i}^n \mathbb{C}\left<span class="co">[</span><span class="ot"> X_i, X_j \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-118"><a href="#cb52-118"></a>&amp; = \sum\limits_{i=1}^n \V\left<span class="co">[</span><span class="ot"> X_i \right</span><span class="co">]</span>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ si son independientes entre si} <span class="sc">\\</span></span>
<span id="cb52-119"><a href="#cb52-119"></a>&amp; = n \V\left<span class="co">[</span><span class="ot"> X \right</span><span class="co">]</span>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ si son idénticamente distribuidas}</span>
<span id="cb52-120"><a href="#cb52-120"></a>\end{split}</span>
<span id="cb52-121"><a href="#cb52-121"></a>$$</span>
<span id="cb52-122"><a href="#cb52-122"></a></span>
<span id="cb52-123"><a href="#cb52-123"></a>Al tener un número determinado de reclamos $n \in \N$, la distribución de probabilidad del</span>
<span id="cb52-124"><a href="#cb52-124"></a>total de reclamos $S$ puede ser calculada de la forma más sencilla:</span>
<span id="cb52-125"><a href="#cb52-125"></a>$$</span>
<span id="cb52-126"><a href="#cb52-126"></a>\begin{split}</span>
<span id="cb52-127"><a href="#cb52-127"></a>F_S( x )</span>
<span id="cb52-128"><a href="#cb52-128"></a>&amp; = F_{X_1} \star \cdots \star F_{X_n} ( s )\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-129"><a href="#cb52-129"></a>&amp; = F_{X}^{\star n}( s )\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son idénticamente distribuidas}</span>
<span id="cb52-130"><a href="#cb52-130"></a>\end{split}</span>
<span id="cb52-131"><a href="#cb52-131"></a>$$</span>
<span id="cb52-132"><a href="#cb52-132"></a></span>
<span id="cb52-133"><a href="#cb52-133"></a>así mismo, si las densidades de probabilidad están bien definidas, entonces:</span>
<span id="cb52-134"><a href="#cb52-134"></a>$$</span>
<span id="cb52-135"><a href="#cb52-135"></a>\begin{split}</span>
<span id="cb52-136"><a href="#cb52-136"></a>f_S( s )</span>
<span id="cb52-137"><a href="#cb52-137"></a>&amp; = f_{X_1} \star \cdots \star f_{X_n} ( s )\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-138"><a href="#cb52-138"></a>&amp; = f_{X}^{\star n}( s )\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son idénticamente distribuidas}</span>
<span id="cb52-139"><a href="#cb52-139"></a>\end{split}</span>
<span id="cb52-140"><a href="#cb52-140"></a>$$</span>
<span id="cb52-141"><a href="#cb52-141"></a></span>
<span id="cb52-142"><a href="#cb52-142"></a>Una estrategia para estimar $F_S$ o $f_S$ es utilizar la transformada de Fourier $\Fo$, la cual</span>
<span id="cb52-143"><a href="#cb52-143"></a>convierte las convoluciones en productos y luego invertir de nuevo la transformada de Fourier:</span>
<span id="cb52-144"><a href="#cb52-144"></a>$$</span>
<span id="cb52-145"><a href="#cb52-145"></a>\begin{split}</span>
<span id="cb52-146"><a href="#cb52-146"></a>F_S </span>
<span id="cb52-147"><a href="#cb52-147"></a>&amp; = \Fo^{-1}\left( \Fo\left( F_S \right) \right) <span class="sc">\\</span></span>
<span id="cb52-148"><a href="#cb52-148"></a>&amp; = \Fo^{-1}\left( \Fo\left( F_{X_1} \star \cdots \star F_{X_n} \right) \right)</span>
<span id="cb52-149"><a href="#cb52-149"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-150"><a href="#cb52-150"></a>&amp; = \Fo^{-1}\left( \prod\limits_{i=1}^n \Fo\left( F_{X_i} \right) \right) <span class="sc">\\</span> </span>
<span id="cb52-151"><a href="#cb52-151"></a>&amp; = \Fo^{-1}\left( \Fo\left( F_{X} \right)^n \right)</span>
<span id="cb52-152"><a href="#cb52-152"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ si son idénticamente distribuidas } </span>
<span id="cb52-153"><a href="#cb52-153"></a>\end{split}</span>
<span id="cb52-154"><a href="#cb52-154"></a>$$</span>
<span id="cb52-155"><a href="#cb52-155"></a></span>
<span id="cb52-156"><a href="#cb52-156"></a>de forma equivalente para la densidad $f_S$:</span>
<span id="cb52-157"><a href="#cb52-157"></a>$$</span>
<span id="cb52-158"><a href="#cb52-158"></a>\begin{split}</span>
<span id="cb52-159"><a href="#cb52-159"></a>f_S </span>
<span id="cb52-160"><a href="#cb52-160"></a>&amp; = \Fo^{-1}\left( \Fo\left( f_S \right) \right) <span class="sc">\\</span></span>
<span id="cb52-161"><a href="#cb52-161"></a>&amp; = \Fo^{-1}\left( \Fo\left( f_{X_1} \star \cdots \star f_{X_n} \right) \right)</span>
<span id="cb52-162"><a href="#cb52-162"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-163"><a href="#cb52-163"></a>&amp; = \Fo^{-1}\left( \prod\limits_{i=1}^n \Fo\left( f_{X_i} \right) \right) <span class="sc">\\</span> </span>
<span id="cb52-164"><a href="#cb52-164"></a>&amp; = \Fo^{-1}\left( \Fo\left( f_{X} \right)^n \right)</span>
<span id="cb52-165"><a href="#cb52-165"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ si son idénticamente distribuidas } </span>
<span id="cb52-166"><a href="#cb52-166"></a>\end{split}</span>
<span id="cb52-167"><a href="#cb52-167"></a>$$</span>
<span id="cb52-168"><a href="#cb52-168"></a>Por otra parte, la función característica de la variable aleatoria $S$, está dada para todo </span>
<span id="cb52-169"><a href="#cb52-169"></a>$t \in \R$:</span>
<span id="cb52-170"><a href="#cb52-170"></a>$$</span>
<span id="cb52-171"><a href="#cb52-171"></a>\begin{split}</span>
<span id="cb52-172"><a href="#cb52-172"></a>\varphi_S( t ) </span>
<span id="cb52-173"><a href="#cb52-173"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> \exp\left( it S \right) \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-174"><a href="#cb52-174"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> \exp\left( it \sum\limits_{i=1}^n X_i \right) \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-175"><a href="#cb52-175"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> \prod\limits_{i=1}^n \exp\left( it X_i \right) \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-176"><a href="#cb52-176"></a>&amp; = \prod\limits_{i=1}^n \E\left<span class="co">[</span><span class="ot"> \exp\left( it X_i \right) \right</span><span class="co">]</span>,\quad</span>
<span id="cb52-177"><a href="#cb52-177"></a>\text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-178"><a href="#cb52-178"></a>&amp; = \prod\limits_{i=1}^n \varphi_{X_i}\left( t \right) <span class="sc">\\</span></span>
<span id="cb52-179"><a href="#cb52-179"></a>&amp; = \varphi_{X}\left( t \right)^n,\quad</span>
<span id="cb52-180"><a href="#cb52-180"></a>\text{si $<span class="sc">\{</span>X<span class="sc">\}</span>$ son identicamente distribuidas} <span class="sc">\\</span></span>
<span id="cb52-181"><a href="#cb52-181"></a>\end{split}</span>
<span id="cb52-182"><a href="#cb52-182"></a>$$</span>
<span id="cb52-183"><a href="#cb52-183"></a></span>
<span id="cb52-184"><a href="#cb52-184"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-185"><a href="#cb52-185"></a><span class="fu">### Algoritmo de simulación</span></span>
<span id="cb52-186"><a href="#cb52-186"></a>Se puede simular la severidad total $S$ para el caso donde se asume independencia entre cada una </span>
<span id="cb52-187"><a href="#cb52-187"></a>de las severidades $X_1, \ldots, X_n$ y se conoce cada una de sus densidades de probabilidad</span>
<span id="cb52-188"><a href="#cb52-188"></a>$f_{X_1}, \ldots, f_{X_n}$ o distribuciones de probabilidad $F_{X_1}, \ldots, F_{X_n}$.</span>
<span id="cb52-189"><a href="#cb52-189"></a></span>
<span id="cb52-190"><a href="#cb52-190"></a>Los pasos son los siguientes:</span>
<span id="cb52-191"><a href="#cb52-191"></a></span>
<span id="cb52-192"><a href="#cb52-192"></a><span class="ss">1. </span>Se tiene fijo $n \in \N$,</span>
<span id="cb52-193"><a href="#cb52-193"></a></span>
<span id="cb52-194"><a href="#cb52-194"></a><span class="ss">2. </span>Se fija el número de simulaciones $m \in \N$</span>
<span id="cb52-195"><a href="#cb52-195"></a></span>
<span id="cb52-196"><a href="#cb52-196"></a><span class="ss">3. </span>Para cada $i \in <span class="sc">\{</span>1, \ldots, m<span class="sc">\}</span>$ se extrae una muestra $X_{i,1} \rightsquigarrow f_{X_1},\ldots,X_{i,n} \rightsquigarrow f_{X_n}$,</span>
<span id="cb52-197"><a href="#cb52-197"></a></span>
<span id="cb52-198"><a href="#cb52-198"></a><span class="ss">4. </span>Para cada $i \in <span class="sc">\{</span>1, \ldots, m<span class="sc">\}</span>$ se calcula la severidad total para la muestra $i$, </span>
<span id="cb52-199"><a href="#cb52-199"></a>$S_i = \sum\limits_{j=1}^n X_{i,j}$</span>
<span id="cb52-200"><a href="#cb52-200"></a></span>
<span id="cb52-201"><a href="#cb52-201"></a>::: {.example #l6ex1}</span>
<span id="cb52-202"><a href="#cb52-202"></a>El siguiente código ejemplifica el algoritmo anterior, donde se asume que cada variable aleatoria de </span>
<span id="cb52-203"><a href="#cb52-203"></a>severidad $X_i$ sigue una ley log-normal $LN( \mu_i, \sigma_i )$ con parámetros $\mu_i, \sigma_i$, </span>
<span id="cb52-204"><a href="#cb52-204"></a>para cada $i \in <span class="sc">\{</span>1,\ldots, n<span class="sc">\}</span>$. El reclamo total $S = \sum\limits_{i=1}^n X_i$ sigue una ley </span>
<span id="cb52-205"><a href="#cb52-205"></a>de probabilidad que estará dada por la convolución de cada una de las leyes de probabilidad de </span>
<span id="cb52-206"><a href="#cb52-206"></a>cada reclamo $X_i$, sin embargo estas leyes en este ejemplo son log-normales y no se conoce una </span>
<span id="cb52-207"><a href="#cb52-207"></a>forma explícita analítica para la convolución de log-normales. Por tal razón, debemos aproximar</span>
<span id="cb52-208"><a href="#cb52-208"></a>la distribución de probabilidad de $F_S$ a partir de la distribución empírica.</span>
<span id="cb52-209"><a href="#cb52-209"></a><span class="in">```{r l6c1}</span></span>
<span id="cb52-210"><a href="#cb52-210"></a><span class="in">set.seed(94312)</span></span>
<span id="cb52-211"><a href="#cb52-211"></a></span>
<span id="cb52-212"><a href="#cb52-212"></a><span class="in"># 1. número de distribuciones</span></span>
<span id="cb52-213"><a href="#cb52-213"></a><span class="in">n &lt;- 200</span></span>
<span id="cb52-214"><a href="#cb52-214"></a><span class="in"># parámetros para las n distribuciones</span></span>
<span id="cb52-215"><a href="#cb52-215"></a><span class="in">mu &lt;- seq( 1, 2, length.out = n )</span></span>
<span id="cb52-216"><a href="#cb52-216"></a><span class="in">sigma &lt;- seq( 2, 3, length.out = n )</span></span>
<span id="cb52-217"><a href="#cb52-217"></a></span>
<span id="cb52-218"><a href="#cb52-218"></a><span class="in"># 2. número de simulaciones</span></span>
<span id="cb52-219"><a href="#cb52-219"></a><span class="in">m &lt;- 1e3 </span></span>
<span id="cb52-220"><a href="#cb52-220"></a></span>
<span id="cb52-221"><a href="#cb52-221"></a><span class="in"># 3. simulación de severidades</span></span>
<span id="cb52-222"><a href="#cb52-222"></a><span class="in">X &lt;- lapply( </span></span>
<span id="cb52-223"><a href="#cb52-223"></a><span class="in">  X = 1:m, </span></span>
<span id="cb52-224"><a href="#cb52-224"></a><span class="in">  FUN = function( i ) {</span></span>
<span id="cb52-225"><a href="#cb52-225"></a><span class="in">    return( sapply( 1:n, FUN = function( j ) rlnorm( 1, meanlog = mu[ j ], sdlog = sigma[ j ] ) ) )</span></span>
<span id="cb52-226"><a href="#cb52-226"></a><span class="in">  } </span></span>
<span id="cb52-227"><a href="#cb52-227"></a><span class="in">)</span></span>
<span id="cb52-228"><a href="#cb52-228"></a></span>
<span id="cb52-229"><a href="#cb52-229"></a><span class="in"># 4. simulación de severidad total</span></span>
<span id="cb52-230"><a href="#cb52-230"></a><span class="in">S &lt;- sapply( X, FUN = sum )</span></span>
<span id="cb52-231"><a href="#cb52-231"></a><span class="in">```</span></span>
<span id="cb52-232"><a href="#cb52-232"></a></span>
<span id="cb52-233"><a href="#cb52-233"></a>Como mencionamos, en este ejemplo, la densidad de probabilidad de la severidad $S$ resulta de la</span>
<span id="cb52-234"><a href="#cb52-234"></a>convolución de las $n$ densidades individuales $f_S = f_{X_1} \star \cdots \star f_{X_n}$, la cual</span>
<span id="cb52-235"><a href="#cb52-235"></a>no presenta una forma analítica conocida. </span>
<span id="cb52-236"><a href="#cb52-236"></a></span>
<span id="cb52-237"><a href="#cb52-237"></a>De la imposibilidad anterior, se puede ver la utilidad de trabajar con la muestra aleatoria de la </span>
<span id="cb52-238"><a href="#cb52-238"></a>variable $S$. De esta manera, se puede estimar la distribución acumulada de probabilidad $F_S$ a </span>
<span id="cb52-239"><a href="#cb52-239"></a>partir de la distribución empírica $F_m$ generada con la muestra $<span class="sc">\{</span>S_i<span class="sc">\}</span>$.</span>
<span id="cb52-240"><a href="#cb52-240"></a>$$</span>
<span id="cb52-241"><a href="#cb52-241"></a>F_S( s ) \approx F_m( s ) = \frac{1}{m} \sum\limits_{i=1}^m \mathbf {1}_{(-\infty,s]}( S_i )</span>
<span id="cb52-242"><a href="#cb52-242"></a>$$</span>
<span id="cb52-243"><a href="#cb52-243"></a>el resultado de concentración \ref{ddkw} nos brinda un criterio de convergencia de </span>
<span id="cb52-244"><a href="#cb52-244"></a>$F_m$ a $F_S$</span>
<span id="cb52-245"><a href="#cb52-245"></a></span>
<span id="cb52-246"><a href="#cb52-246"></a>Para construir $F_m$ en R, se puede utilizar la función ya empaquetada <span class="in">`ecdf`</span> (empirical cumulative</span>
<span id="cb52-247"><a href="#cb52-247"></a>distribution function).</span>
<span id="cb52-248"><a href="#cb52-248"></a><span class="in">```{r l6c2}</span></span>
<span id="cb52-249"><a href="#cb52-249"></a><span class="in"># estimación distribución acumulada empírica de S</span></span>
<span id="cb52-250"><a href="#cb52-250"></a><span class="in">Fm &lt;- ecdf( S )</span></span>
<span id="cb52-251"><a href="#cb52-251"></a></span>
<span id="cb52-252"><a href="#cb52-252"></a><span class="in"># esperanza empírica</span></span>
<span id="cb52-253"><a href="#cb52-253"></a><span class="in">EeS &lt;- mean( S )</span></span>
<span id="cb52-254"><a href="#cb52-254"></a></span>
<span id="cb52-255"><a href="#cb52-255"></a><span class="in"># esperanza teórica</span></span>
<span id="cb52-256"><a href="#cb52-256"></a><span class="in">ES &lt;- sum( sapply( 1:n, FUN = function( i ) exp( mu[i] + 0.5 * sigma[i]^2 ) ) )</span></span>
<span id="cb52-257"><a href="#cb52-257"></a></span>
<span id="cb52-258"><a href="#cb52-258"></a><span class="in">s &lt;- sort( unique( S ) )</span></span>
<span id="cb52-259"><a href="#cb52-259"></a><span class="in">Fms &lt;- sapply( s, FUN = Fm )</span></span>
<span id="cb52-260"><a href="#cb52-260"></a><span class="in">```</span></span>
<span id="cb52-261"><a href="#cb52-261"></a></span>
<span id="cb52-262"><a href="#cb52-262"></a><span class="in">```{r l6g1}</span></span>
<span id="cb52-263"><a href="#cb52-263"></a><span class="in">#| warning: false</span></span>
<span id="cb52-264"><a href="#cb52-264"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-265"><a href="#cb52-265"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-266"><a href="#cb52-266"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-267"><a href="#cb52-267"></a><span class="in">smax &lt;- 2.0e5</span></span>
<span id="cb52-268"><a href="#cb52-268"></a></span>
<span id="cb52-269"><a href="#cb52-269"></a><span class="in">plt &lt;- ggplot() +</span></span>
<span id="cb52-270"><a href="#cb52-270"></a><span class="in">  geom_step( aes( x = s, y = Fms ), colour = 'dodgerblue4', linewidth = 1 ) + </span></span>
<span id="cb52-271"><a href="#cb52-271"></a><span class="in">  geom_vline( xintercept = c( EeS, ES ), colour = c( 'olivedrab3', 'gold3' ), linewidth = 1 ) +</span></span>
<span id="cb52-272"><a href="#cb52-272"></a><span class="in">  scale_x_continuous( breaks = seq( 0, smax, length = 11 ),</span></span>
<span id="cb52-273"><a href="#cb52-273"></a><span class="in">                      labels = formatC( seq( 0, smax, length = 11 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-274"><a href="#cb52-274"></a><span class="in">                      limits = c( 0, smax ), </span></span>
<span id="cb52-275"><a href="#cb52-275"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-276"><a href="#cb52-276"></a><span class="in">  scale_y_continuous( breaks = seq( 0, 1, length = 11 ),</span></span>
<span id="cb52-277"><a href="#cb52-277"></a><span class="in">                      labels = formatC( seq( 0, 1, length = 11 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-278"><a href="#cb52-278"></a><span class="in">                      limits = c( 0.0, 1.0 ), </span></span>
<span id="cb52-279"><a href="#cb52-279"></a><span class="in">                      expand = c( 0.005, 0.005 ) ) +</span></span>
<span id="cb52-280"><a href="#cb52-280"></a><span class="in">  xlab( TeX( "$s$" ) ) + </span></span>
<span id="cb52-281"><a href="#cb52-281"></a><span class="in">  ylab( TeX( "$F_m(s)$" ) ) + </span></span>
<span id="cb52-282"><a href="#cb52-282"></a><span class="in">  theme_bw()</span></span>
<span id="cb52-283"><a href="#cb52-283"></a><span class="in">plot( plt )</span></span>
<span id="cb52-284"><a href="#cb52-284"></a><span class="in">```</span></span>
<span id="cb52-285"><a href="#cb52-285"></a></span>
<span id="cb52-286"><a href="#cb52-286"></a>Para calcular la esperanza de la severidad total $S$, también se puede usar una aproximación </span>
<span id="cb52-287"><a href="#cb52-287"></a>a la integral de Riemann-Stieltjes utilizando la distribución acumulada empírica $F_m$.</span>
<span id="cb52-288"><a href="#cb52-288"></a>$$</span>
<span id="cb52-289"><a href="#cb52-289"></a>\E<span class="co">[</span><span class="ot"> S </span><span class="co">]</span> = \int\limits_{\R} s dF_S( s )</span>
<span id="cb52-290"><a href="#cb52-290"></a>\approx \int\limits_{\R} s dF_m( s )</span>
<span id="cb52-291"><a href="#cb52-291"></a>\approx \sum\limits_{i=1}^N s_{i} \left( F_m( s_{i+1} ) - F_m( s_{i} ) \right)</span>
<span id="cb52-292"><a href="#cb52-292"></a>$$</span>
<span id="cb52-293"><a href="#cb52-293"></a></span>
<span id="cb52-294"><a href="#cb52-294"></a>Esta aproximación en R puede ser implementada de la siguiente forma:</span>
<span id="cb52-295"><a href="#cb52-295"></a><span class="in">```{r l6c3}</span></span>
<span id="cb52-296"><a href="#cb52-296"></a><span class="in">N &lt;- 1e5</span></span>
<span id="cb52-297"><a href="#cb52-297"></a><span class="in">s &lt;- seq( min( S ), max( S ), length.out = N )</span></span>
<span id="cb52-298"><a href="#cb52-298"></a><span class="in">EmS &lt;- sum( s[-N] * diff( sapply( s, FUN = Fm ) ) )</span></span>
<span id="cb52-299"><a href="#cb52-299"></a><span class="in">```</span></span>
<span id="cb52-300"><a href="#cb52-300"></a></span>
<span id="cb52-301"><a href="#cb52-301"></a>De ello, tenemos los siguientes resultados de cálculo para el valor esperado de la severidad total:</span>
<span id="cb52-302"><a href="#cb52-302"></a>$$</span>
<span id="cb52-303"><a href="#cb52-303"></a>\begin{split}</span>
<span id="cb52-304"><a href="#cb52-304"></a>\E<span class="co">[</span><span class="ot">S</span><span class="co">]</span> = \sum\limits_{i=1}^n e^{ \mu_i + \frac{1}{2} \sigma_i^2 } &amp; = <span class="in">`r formatC( ES, digits = 4, format = 'f' )`</span>, <span class="sc">\\</span></span>
<span id="cb52-305"><a href="#cb52-305"></a>\overline{S} = \frac{1}{m} \sum\limits_{i=1}^m S_i &amp; = <span class="in">`r formatC( EeS, digits = 4, format = 'f' )`</span>, <span class="sc">\\</span></span>
<span id="cb52-306"><a href="#cb52-306"></a>\sum\limits_{i=1}^N s_{i} \left( F_m( s_{i+1} ) - F_m( s_{i} ) \right) &amp; = <span class="in">`r formatC( EmS, digits = 4, format = 'f' )`</span></span>
<span id="cb52-307"><a href="#cb52-307"></a>\end{split}</span>
<span id="cb52-308"><a href="#cb52-308"></a>$$</span>
<span id="cb52-309"><a href="#cb52-309"></a>:::</span>
<span id="cb52-310"><a href="#cb52-310"></a></span>
<span id="cb52-311"><a href="#cb52-311"></a>Lo bueno de poseer una buena aproximación a la distribución acumulada de una variable aleatoria, es </span>
<span id="cb52-312"><a href="#cb52-312"></a>que podemos calcular otros valores de importancia relacionados a la variable aleatoria y no tan solo </span>
<span id="cb52-313"><a href="#cb52-313"></a>utilizar medidas de tendencia central. Sin embargo, para que esta aproximación sea útil se requiere </span>
<span id="cb52-314"><a href="#cb52-314"></a>reducir el error de probabilidad \ref{ddkw}.</span>
<span id="cb52-315"><a href="#cb52-315"></a></span>
<span id="cb52-316"><a href="#cb52-316"></a>::: {.example #l6ex2}</span>
<span id="cb52-317"><a href="#cb52-317"></a>Podemos considerar el caso sencillo donde el valor posible de severidad es determinista, es decir</span>
<span id="cb52-318"><a href="#cb52-318"></a>para cada póliza $i\in <span class="sc">\{</span>1,\ldots,n<span class="sc">\}</span>$, el valor de severidad probable es único $M &gt; 0$ si en caso </span>
<span id="cb52-319"><a href="#cb52-319"></a>se da un evento $A_i$, esto lo podemos expresar como $X_i = M \mathbf{1}_{A_i}$ donde M es constante.</span>
<span id="cb52-320"><a href="#cb52-320"></a>Así, la pérdida total está dada por:</span>
<span id="cb52-321"><a href="#cb52-321"></a>$$ </span>
<span id="cb52-322"><a href="#cb52-322"></a>S = \sum\limits_{i=1}^n X_i = \sum\limits_{i=1}^n M \mathbf{1}_{A_i} </span>
<span id="cb52-323"><a href="#cb52-323"></a>$$</span>
<span id="cb52-324"><a href="#cb52-324"></a></span>
<span id="cb52-325"><a href="#cb52-325"></a>El valor total esperado de reclamos está dado por:</span>
<span id="cb52-326"><a href="#cb52-326"></a>$$</span>
<span id="cb52-327"><a href="#cb52-327"></a>\E<span class="co">[</span><span class="ot"> S </span><span class="co">]</span> </span>
<span id="cb52-328"><a href="#cb52-328"></a>= \sum\limits_{i=1}^n \E\left<span class="co">[</span><span class="ot"> M \mathbf{1}_{A_i} \right</span><span class="co">]</span></span>
<span id="cb52-329"><a href="#cb52-329"></a>= M \sum\limits_{i=1}^n P( A_i )</span>
<span id="cb52-330"><a href="#cb52-330"></a>$$</span>
<span id="cb52-331"><a href="#cb52-331"></a>la última igualdad resulta de las propiedades de la función indicatriz \ref{indicatriz}.</span>
<span id="cb52-332"><a href="#cb52-332"></a></span>
<span id="cb52-333"><a href="#cb52-333"></a>Si en caso todos los $P(A_i) = p$ tienen la misma probabilidad, el valor total esperado de reclamos</span>
<span id="cb52-334"><a href="#cb52-334"></a>toma la siguiente forma:</span>
<span id="cb52-335"><a href="#cb52-335"></a>$$</span>
<span id="cb52-336"><a href="#cb52-336"></a>\E<span class="co">[</span><span class="ot">S</span><span class="co">]</span> = n M p</span>
<span id="cb52-337"><a href="#cb52-337"></a>$$</span>
<span id="cb52-338"><a href="#cb52-338"></a>:::</span>
<span id="cb52-339"><a href="#cb52-339"></a></span>
<span id="cb52-340"><a href="#cb52-340"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-341"><a href="#cb52-341"></a><span class="fu">## Modelo colectivo {#modelo_colectivo}</span></span>
<span id="cb52-342"><a href="#cb52-342"></a></span>
<span id="cb52-343"><a href="#cb52-343"></a></span>
<span id="cb52-344"><a href="#cb52-344"></a>::: {.Definition #dmodcol title="Modelo colectivo"}</span>
<span id="cb52-345"><a href="#cb52-345"></a>El **modelo colectivo** de riesgo considera un número de reclamos descritos por una variable</span>
<span id="cb52-346"><a href="#cb52-346"></a>aleatoria discreta $N$. Los reclamos corresponden a un número de pólizas en un periodo específico,</span>
<span id="cb52-347"><a href="#cb52-347"></a>el valor de cada reclamo $i \in <span class="sc">\{</span>1,\ldots,N<span class="sc">\}</span>$ está representado por las variables aleatorias $X_i$. </span>
<span id="cb52-348"><a href="#cb52-348"></a>Usualmente, se considera que cada uno de los reclamos $X_i$ están idénticamente distribuidos.</span>
<span id="cb52-349"><a href="#cb52-349"></a>$$</span>
<span id="cb52-350"><a href="#cb52-350"></a>S = </span>
<span id="cb52-351"><a href="#cb52-351"></a>\left<span class="sc">\{</span></span>
<span id="cb52-352"><a href="#cb52-352"></a>\begin{array}{ll}</span>
<span id="cb52-353"><a href="#cb52-353"></a>\sum\limits_{i=1}^N X_i &amp; \text{si}\ N &gt; 0 <span class="sc">\\</span></span>
<span id="cb52-354"><a href="#cb52-354"></a>0 &amp; \text{si}\ N = 0</span>
<span id="cb52-355"><a href="#cb52-355"></a>\end{array}</span>
<span id="cb52-356"><a href="#cb52-356"></a>\right.</span>
<span id="cb52-357"><a href="#cb52-357"></a>$$</span>
<span id="cb52-358"><a href="#cb52-358"></a>o de forma más compacta, se puede definir $S = \sum\limits_{i=1}^N X_i$, donde se asume que la </span>
<span id="cb52-359"><a href="#cb52-359"></a>suma es igual a $0$ si el número de elementos en la suma $N = 0$.</span>
<span id="cb52-360"><a href="#cb52-360"></a>:::</span>
<span id="cb52-361"><a href="#cb52-361"></a></span>
<span id="cb52-362"><a href="#cb52-362"></a></span>
<span id="cb52-363"><a href="#cb52-363"></a>El valor esperado del total de reclamos $S$, está dado por:</span>
<span id="cb52-364"><a href="#cb52-364"></a>$$</span>
<span id="cb52-365"><a href="#cb52-365"></a>\begin{split}</span>
<span id="cb52-366"><a href="#cb52-366"></a>\E<span class="co">[</span><span class="ot">S</span><span class="co">]</span></span>
<span id="cb52-367"><a href="#cb52-367"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> \sum\limits_{i=1}^N X_i \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-368"><a href="#cb52-368"></a>&amp; = \sum\limits_{n=0}^{+\infty} \E\left<span class="co">[</span><span class="ot"> \sum\limits_{i=1}^n X_i\ \middle|\ N = n \right</span><span class="co">]</span>P( N = n )</span>
<span id="cb52-369"><a href="#cb52-369"></a>\quad \text{utilizando la esperanza condicional} <span class="sc">\\</span></span>
<span id="cb52-370"><a href="#cb52-370"></a>&amp; = 0 P( N = 0 ) + \sum\limits_{n=1}^{+\infty} \E\left<span class="co">[</span><span class="ot"> \sum\limits_{i=1}^n X_i\ \middle|\ N = n \right</span><span class="co">]</span>P( N = n ) <span class="sc">\\</span></span>
<span id="cb52-371"><a href="#cb52-371"></a>&amp; = \sum\limits_{n=1}^{+\infty} \sum\limits_{i=1}^n \E\left<span class="co">[</span><span class="ot"> X_i \mid N = n \right</span><span class="co">]</span>P( N = n )</span>
<span id="cb52-372"><a href="#cb52-372"></a>\quad \text{linealidad de la esperanza} <span class="sc">\\</span></span>
<span id="cb52-373"><a href="#cb52-373"></a>&amp; = \sum\limits_{n=0}^{+\infty} n \E\left<span class="co">[</span><span class="ot"> X \mid N = n \right</span><span class="co">]</span>P( N = n )</span>
<span id="cb52-374"><a href="#cb52-374"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son idénticamente distribuidas} <span class="sc">\\</span></span>
<span id="cb52-375"><a href="#cb52-375"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> X \right</span><span class="co">]</span> \sum\limits_{n=0}^{+\infty} n P( N = n )</span>
<span id="cb52-376"><a href="#cb52-376"></a>\quad \text{si $X$ y $N$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-377"><a href="#cb52-377"></a>&amp; = \E<span class="co">[</span><span class="ot"> N </span><span class="co">]</span> \E<span class="co">[</span><span class="ot"> X </span><span class="co">]</span> </span>
<span id="cb52-378"><a href="#cb52-378"></a>\end{split}</span>
<span id="cb52-379"><a href="#cb52-379"></a>$$</span>
<span id="cb52-380"><a href="#cb52-380"></a></span>
<span id="cb52-381"><a href="#cb52-381"></a>También podemos calcular la varianza de los reclamos totales $S$, para ello necesitamos calcular su </span>
<span id="cb52-382"><a href="#cb52-382"></a>segundo momento:</span>
<span id="cb52-383"><a href="#cb52-383"></a>$$</span>
<span id="cb52-384"><a href="#cb52-384"></a>\begin{split}</span>
<span id="cb52-385"><a href="#cb52-385"></a>\E<span class="co">[</span><span class="ot">S^2</span><span class="co">]</span></span>
<span id="cb52-386"><a href="#cb52-386"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> \left( \sum\limits_{i=1}^N X_i \right)^2 \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-387"><a href="#cb52-387"></a>&amp; = \sum\limits_{n=0}^\infty \E\left<span class="co">[</span><span class="ot"> \sum\limits_{i, j=1}^n X_i X_j \middle| N = n \right</span><span class="co">]</span> P( N = n ) </span>
<span id="cb52-388"><a href="#cb52-388"></a>\quad \text{propiedades de la esperanza condicional} <span class="sc">\\</span></span>
<span id="cb52-389"><a href="#cb52-389"></a>&amp; = \sum\limits_{n=0}^\infty \sum\limits_{i, j=1}^n \E\left<span class="co">[</span><span class="ot"> X_i X_j \right</span><span class="co">]</span> P( N = n ) </span>
<span id="cb52-390"><a href="#cb52-390"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ y $N$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-391"><a href="#cb52-391"></a>&amp; = \sum\limits_{n=0}^\infty \left( \sum\limits_{i=1}^n \E\left<span class="co">[</span><span class="ot"> X_i^2 \right</span><span class="co">]</span> </span>
<span id="cb52-392"><a href="#cb52-392"></a><span class="ss">+ </span>\sum\limits_{i,j=1,i\neq j}^n \E\left<span class="co">[</span><span class="ot"> X_i X_j \right</span><span class="co">]</span> \right) P( N = n ) <span class="sc">\\</span></span>
<span id="cb52-393"><a href="#cb52-393"></a>&amp; = \sum\limits_{n=0}^\infty \left( n \E\left<span class="co">[</span><span class="ot"> X^2 \right</span><span class="co">]</span> + n(n-1) \E\left<span class="co">[</span><span class="ot"> X \right</span><span class="co">]</span>^2 \right) P( N = n ) </span>
<span id="cb52-394"><a href="#cb52-394"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son i.i.d} <span class="sc">\\</span></span>
<span id="cb52-395"><a href="#cb52-395"></a>&amp; = \E\left<span class="co">[</span><span class="ot">N\right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot">X^2\right</span><span class="co">]</span> + \E\left<span class="co">[</span><span class="ot">N^2\right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span>^2 </span>
<span id="cb52-396"><a href="#cb52-396"></a><span class="ss">- </span>\E\left<span class="co">[</span><span class="ot">N\right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span>^2 <span class="sc">\\</span></span>
<span id="cb52-397"><a href="#cb52-397"></a>&amp; = \E\left<span class="co">[</span><span class="ot">N\right</span><span class="co">]</span> \V\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span> + \E\left<span class="co">[</span><span class="ot">N^2\right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span>^2</span>
<span id="cb52-398"><a href="#cb52-398"></a>\end{split}</span>
<span id="cb52-399"><a href="#cb52-399"></a>$$</span>
<span id="cb52-400"><a href="#cb52-400"></a></span>
<span id="cb52-401"><a href="#cb52-401"></a>finalmente la varianza de $S$ tiene la siguiente expresión:</span>
<span id="cb52-402"><a href="#cb52-402"></a>$$</span>
<span id="cb52-403"><a href="#cb52-403"></a>\begin{split}</span>
<span id="cb52-404"><a href="#cb52-404"></a>\V\left<span class="co">[</span><span class="ot">S\right</span><span class="co">]</span></span>
<span id="cb52-405"><a href="#cb52-405"></a>&amp; = \E\left<span class="co">[</span><span class="ot">S^2\right</span><span class="co">]</span> - \E\left<span class="co">[</span><span class="ot">S\right</span><span class="co">]</span>^2 <span class="sc">\\</span></span>
<span id="cb52-406"><a href="#cb52-406"></a>&amp; = \E\left<span class="co">[</span><span class="ot">N\right</span><span class="co">]</span> \V\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span> </span>
<span id="cb52-407"><a href="#cb52-407"></a><span class="ss">+ </span>\E\left<span class="co">[</span><span class="ot">N^2\right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span>^2 - \E\left<span class="co">[</span><span class="ot">N\right</span><span class="co">]</span>^2 \E\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span>^2 <span class="sc">\\</span></span>
<span id="cb52-408"><a href="#cb52-408"></a>&amp; = \E\left<span class="co">[</span><span class="ot">N\right</span><span class="co">]</span> \V\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span> + \V\left<span class="co">[</span><span class="ot">N\right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span>^2</span>
<span id="cb52-409"><a href="#cb52-409"></a>\end{split}</span>
<span id="cb52-410"><a href="#cb52-410"></a>$$</span>
<span id="cb52-411"><a href="#cb52-411"></a></span>
<span id="cb52-412"><a href="#cb52-412"></a>La distribución acumulada del reclamo total $S$ tiene la forma:</span>
<span id="cb52-413"><a href="#cb52-413"></a>$$</span>
<span id="cb52-414"><a href="#cb52-414"></a>\begin{split}</span>
<span id="cb52-415"><a href="#cb52-415"></a>F_S( s ) </span>
<span id="cb52-416"><a href="#cb52-416"></a>&amp; = P( S \leq s ) <span class="sc">\\</span></span>
<span id="cb52-417"><a href="#cb52-417"></a>&amp; = P\left( \sum\limits_{i=1}^N X_i \leq s \right) <span class="sc">\\</span></span>
<span id="cb52-418"><a href="#cb52-418"></a>&amp; = \sum\limits_{n=0}^{+\infty} P\left( \sum\limits_{i=1}^n X_i \leq s \middle| N = n \right) P( N = n )\quad </span>
<span id="cb52-419"><a href="#cb52-419"></a>\text{utilizando la probabilidad condicional} <span class="sc">\\</span></span>
<span id="cb52-420"><a href="#cb52-420"></a>&amp; = \sum\limits_{n=0}^{+\infty} P\left( \sum\limits_{i=1}^n X_i \leq s \right) p_n\quad </span>
<span id="cb52-421"><a href="#cb52-421"></a>\text{si $X_i$ y $N$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-422"><a href="#cb52-422"></a>&amp; = \sum\limits_{n=0}^{+\infty} F_{X_1} \star \cdots \star F_{X_n}( s ) p_n\quad </span>
<span id="cb52-423"><a href="#cb52-423"></a>\text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-424"><a href="#cb52-424"></a>&amp; = \sum\limits_{n=0}^{+\infty} F^{\star n}_{X}( s ) p_n\quad </span>
<span id="cb52-425"><a href="#cb52-425"></a>\text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son idénticamente distribuidas}</span>
<span id="cb52-426"><a href="#cb52-426"></a>\end{split}</span>
<span id="cb52-427"><a href="#cb52-427"></a>$$</span>
<span id="cb52-428"><a href="#cb52-428"></a>tomando $F^{\star 0}_{X}( s ) = 1$. </span>
<span id="cb52-429"><a href="#cb52-429"></a></span>
<span id="cb52-430"><a href="#cb52-430"></a>El último resultado muestra que la distribución de probabilidad de $S$ no es más que una mixtura</span>
<span id="cb52-431"><a href="#cb52-431"></a>de las distribuciones para los modelos individuales $F^{\star n}_{X}$, tomando para mezclarlas las </span>
<span id="cb52-432"><a href="#cb52-432"></a>probabilidades $p_n = P( N = n )$ de la variable aleatoria discreta $N$ que describe la frecuencia</span>
<span id="cb52-433"><a href="#cb52-433"></a>de los reclamos.</span>
<span id="cb52-434"><a href="#cb52-434"></a></span>
<span id="cb52-435"><a href="#cb52-435"></a>Al igual que para el modelo individual, podemos estimar $F_S$ o $f_S$ utilizando la transformada de </span>
<span id="cb52-436"><a href="#cb52-436"></a>Fourier $\Fo$:</span>
<span id="cb52-437"><a href="#cb52-437"></a>$$</span>
<span id="cb52-438"><a href="#cb52-438"></a>\begin{split}</span>
<span id="cb52-439"><a href="#cb52-439"></a>F_S </span>
<span id="cb52-440"><a href="#cb52-440"></a>&amp; = \Fo^{-1}\left( \Fo\left( F_S \right) \right) <span class="sc">\\</span></span>
<span id="cb52-441"><a href="#cb52-441"></a>&amp; = \Fo^{-1}\left( \Fo\left( \sum\limits_{n=0}^{+\infty} F_{X_1} \star \cdots \star F_{X_n}( s ) p_n \right) \right)</span>
<span id="cb52-442"><a href="#cb52-442"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-443"><a href="#cb52-443"></a>&amp; = \Fo^{-1}\left( \sum\limits_{n=0}^{+\infty} \prod\limits_{i=1}^n \Fo\left( F_{X_i} \right) p_n \right) <span class="sc">\\</span> </span>
<span id="cb52-444"><a href="#cb52-444"></a>&amp; = \Fo^{-1}\left( \sum\limits_{n=0}^{+\infty} \Fo\left( F_{X} \right)^n p_n \right)</span>
<span id="cb52-445"><a href="#cb52-445"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ si son idénticamente distribuidas }</span>
<span id="cb52-446"><a href="#cb52-446"></a>\end{split}</span>
<span id="cb52-447"><a href="#cb52-447"></a>$$</span>
<span id="cb52-448"><a href="#cb52-448"></a></span>
<span id="cb52-449"><a href="#cb52-449"></a>de forma equivalente para la densidad $f_S$:</span>
<span id="cb52-450"><a href="#cb52-450"></a>$$</span>
<span id="cb52-451"><a href="#cb52-451"></a>\begin{split}</span>
<span id="cb52-452"><a href="#cb52-452"></a>f_S </span>
<span id="cb52-453"><a href="#cb52-453"></a>&amp; = \Fo^{-1}\left( \Fo\left( f_S \right) \right) <span class="sc">\\</span></span>
<span id="cb52-454"><a href="#cb52-454"></a>&amp; = \Fo^{-1}\left( \Fo\left( \sum\limits_{n=0}^{+\infty} f_{X_1} \star \cdots \star f_{X_n}( s ) p_n \right) \right)</span>
<span id="cb52-455"><a href="#cb52-455"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-456"><a href="#cb52-456"></a>&amp; = \Fo^{-1}\left( \sum\limits_{n=0}^{+\infty} \prod\limits_{i=1}^n \Fo\left( f_{X_i} \right) p_n \right) <span class="sc">\\</span> </span>
<span id="cb52-457"><a href="#cb52-457"></a>&amp; = \Fo^{-1}\left( \sum\limits_{n=0}^{+\infty} \Fo\left( f_{X} \right)^n p_n \right)</span>
<span id="cb52-458"><a href="#cb52-458"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ si son idénticamente distribuidas }</span>
<span id="cb52-459"><a href="#cb52-459"></a>\end{split}</span>
<span id="cb52-460"><a href="#cb52-460"></a>$$</span>
<span id="cb52-461"><a href="#cb52-461"></a></span>
<span id="cb52-462"><a href="#cb52-462"></a>En la práctica es imposible realizar la suma hasta infinito, por esto, se puede utilizar una </span>
<span id="cb52-463"><a href="#cb52-463"></a>aproximación escogiendo un número máximo $M \in \N$ de términos en la suma, obteniendo así las </span>
<span id="cb52-464"><a href="#cb52-464"></a>aproximaciones.</span>
<span id="cb52-465"><a href="#cb52-465"></a></span>
<span id="cb52-466"><a href="#cb52-466"></a>Por otra parte, la función característica de la variable aleatoria $S$, está dada para todo </span>
<span id="cb52-467"><a href="#cb52-467"></a>$t \in \R$:</span>
<span id="cb52-468"><a href="#cb52-468"></a>$$</span>
<span id="cb52-469"><a href="#cb52-469"></a>\begin{split}</span>
<span id="cb52-470"><a href="#cb52-470"></a>\varphi_S( t ) </span>
<span id="cb52-471"><a href="#cb52-471"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> \exp\left( it S \right) \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-472"><a href="#cb52-472"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> \exp\left( it \sum\limits_{i=1}^N X_i \right) \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-473"><a href="#cb52-473"></a>&amp; = \sum\limits_{n=0}^{+\infty}</span>
<span id="cb52-474"><a href="#cb52-474"></a>\E\left<span class="co">[</span><span class="ot"> \exp\left( it \sum\limits_{i=1}^n X_i \right) \middle| N = n \right</span><span class="co">]</span> P( N = n ) <span class="sc">\\</span></span>
<span id="cb52-475"><a href="#cb52-475"></a>&amp; = \sum\limits_{n=0}^{+\infty}</span>
<span id="cb52-476"><a href="#cb52-476"></a>\E\left<span class="co">[</span><span class="ot"> \prod\limits_{i=1}^n \exp\left( it X_i \right) \middle| N = n \right</span><span class="co">]</span> p_n <span class="sc">\\</span></span>
<span id="cb52-477"><a href="#cb52-477"></a>&amp; = \sum\limits_{n=0}^{+\infty} \prod\limits_{i=1}^n </span>
<span id="cb52-478"><a href="#cb52-478"></a>\E\left<span class="co">[</span><span class="ot"> \exp\left( it X_i \right) \middle| N = n \right</span><span class="co">]</span> p_n,\quad</span>
<span id="cb52-479"><a href="#cb52-479"></a>\text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-480"><a href="#cb52-480"></a>&amp; = \sum\limits_{n=0}^{+\infty} \prod\limits_{i=1}^n \varphi_{X_i}\left( t \right) p_n,\quad</span>
<span id="cb52-481"><a href="#cb52-481"></a>\text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ y $N$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-482"><a href="#cb52-482"></a>&amp; = \sum\limits_{n=0}^{+\infty} \varphi_{X}\left( t \right)^n p_n,\quad</span>
<span id="cb52-483"><a href="#cb52-483"></a>\text{si $<span class="sc">\{</span>X<span class="sc">\}</span>$ son identicamente distribuidas} <span class="sc">\\</span></span>
<span id="cb52-484"><a href="#cb52-484"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> \varphi_{X}\left( t \right)^N \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-485"><a href="#cb52-485"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> \exp\left( N \log\left( \varphi_{X}\left( t \right) \right) \right) \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-486"><a href="#cb52-486"></a>&amp; = \varphi_N\left( -i\log\left( \varphi_{X}\left( t \right) \right) \right) <span class="sc">\\</span></span>
<span id="cb52-487"><a href="#cb52-487"></a>\end{split}</span>
<span id="cb52-488"><a href="#cb52-488"></a>$$</span>
<span id="cb52-489"><a href="#cb52-489"></a></span>
<span id="cb52-490"><a href="#cb52-490"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-491"><a href="#cb52-491"></a><span class="fu">### Algoritmo de simulación</span></span>
<span id="cb52-492"><a href="#cb52-492"></a>La variable del reclamo total $S$ puede ser simulada mediante el siguiente método montecarlo:</span>
<span id="cb52-493"><a href="#cb52-493"></a></span>
<span id="cb52-494"><a href="#cb52-494"></a>Si $N$ sigue una ley discreta $f_N$ y cada valor severidad $X$ son idénticamente distribuidos </span>
<span id="cb52-495"><a href="#cb52-495"></a>con ley $f_X$.</span>
<span id="cb52-496"><a href="#cb52-496"></a></span>
<span id="cb52-497"><a href="#cb52-497"></a><span class="ss">1. </span>Seleccionar el número de simulaciones $m$,</span>
<span id="cb52-498"><a href="#cb52-498"></a></span>
<span id="cb52-499"><a href="#cb52-499"></a><span class="ss">2. </span>Se genera una muestra de tamaño $m$ de variables $N_1, \ldots, N_m$ con ley $f_N$,</span>
<span id="cb52-500"><a href="#cb52-500"></a></span>
<span id="cb52-501"><a href="#cb52-501"></a><span class="ss">3. </span>Se genera para cada $i \in <span class="sc">\{</span>1,\ldots,m<span class="sc">\}</span>$ una muestra de tamaño $N_i$ de variables aleatorias </span>
<span id="cb52-502"><a href="#cb52-502"></a>$X_{i,1}, \ldots X_{i,N_i}$ con ley $f_X$,</span>
<span id="cb52-503"><a href="#cb52-503"></a></span>
<span id="cb52-504"><a href="#cb52-504"></a><span class="ss">4. </span>Se calcula los reclamos totales $S_1, \ldots, S_m$ para cada simulación $i = <span class="sc">\{</span>1, \ldots, m<span class="sc">\}</span>$, </span>
<span id="cb52-505"><a href="#cb52-505"></a>mediante la siguiente suma $S_i = \sum\limits_{j=1}^{N_i} X_{i,j}$.</span>
<span id="cb52-506"><a href="#cb52-506"></a></span>
<span id="cb52-507"><a href="#cb52-507"></a>En el lenguaje de programación R, este método de simulación puede ser fácilmente implementado, </span>
<span id="cb52-508"><a href="#cb52-508"></a>utilizando las funciones de aplicación vectorial <span class="in">`sapply`</span> y <span class="in">`lapply`</span>. </span>
<span id="cb52-509"><a href="#cb52-509"></a></span>
<span id="cb52-510"><a href="#cb52-510"></a>::: {.example #l6ex3}</span>
<span id="cb52-511"><a href="#cb52-511"></a>Consideramos el caso de un modelo colectivo para el cuál el conteo de siniestros </span>
<span id="cb52-512"><a href="#cb52-512"></a>$N \rightsquigarrow Pois( \lambda )$ y la distribución de cada uno de los reclamos </span>
<span id="cb52-513"><a href="#cb52-513"></a>$<span class="sc">\{</span>X_i<span class="sc">\}</span>_{i\in \N}$, está dada por la misma distribución de probabilidad </span>
<span id="cb52-514"><a href="#cb52-514"></a>$X \rightsquigarrow LN( \mu, \sigma )$, siendo además cada uno de los reclamos independientes entre</span>
<span id="cb52-515"><a href="#cb52-515"></a>si.</span>
<span id="cb52-516"><a href="#cb52-516"></a><span class="in">```{r l6c4}</span></span>
<span id="cb52-517"><a href="#cb52-517"></a><span class="in"># 1. selección de simulaciones</span></span>
<span id="cb52-518"><a href="#cb52-518"></a><span class="in">m &lt;- 1e4</span></span>
<span id="cb52-519"><a href="#cb52-519"></a></span>
<span id="cb52-520"><a href="#cb52-520"></a><span class="in"># 2. especificación de los parámetros para las distribuciones</span></span>
<span id="cb52-521"><a href="#cb52-521"></a><span class="in">u &lt;- 5</span></span>
<span id="cb52-522"><a href="#cb52-522"></a><span class="in">s &lt;- 2</span></span>
<span id="cb52-523"><a href="#cb52-523"></a><span class="in">l &lt;- 3</span></span>
<span id="cb52-524"><a href="#cb52-524"></a></span>
<span id="cb52-525"><a href="#cb52-525"></a><span class="in"># 3. simulación del conteo de siniestros</span></span>
<span id="cb52-526"><a href="#cb52-526"></a><span class="in">N &lt;- rpois( n = m, lambda = l )</span></span>
<span id="cb52-527"><a href="#cb52-527"></a></span>
<span id="cb52-528"><a href="#cb52-528"></a><span class="in"># 4. simulación de la severidad de los reclamos</span></span>
<span id="cb52-529"><a href="#cb52-529"></a><span class="in">X &lt;- lapply( N, FUN = function( n ) rlnorm( n, meanlog = u, sdlog = s ) )</span></span>
<span id="cb52-530"><a href="#cb52-530"></a></span>
<span id="cb52-531"><a href="#cb52-531"></a><span class="in"># 5. reclamo total, agregación por cada simulación</span></span>
<span id="cb52-532"><a href="#cb52-532"></a><span class="in">S &lt;- sapply( X, FUN = function( x ) sum( x, na.rm = TRUE ) )</span></span>
<span id="cb52-533"><a href="#cb52-533"></a><span class="in">```</span></span>
<span id="cb52-534"><a href="#cb52-534"></a>:::</span>
<span id="cb52-535"><a href="#cb52-535"></a></span>
<span id="cb52-536"><a href="#cb52-536"></a>Es de notar que un algoritmo como el descrito anteriormente tiene una falencia cuando la frecuencia </span>
<span id="cb52-537"><a href="#cb52-537"></a>de siniestros es poco observada, esto sucede cuando la probabilidad $P( N = 0 )$ es alta y por tal </span>
<span id="cb52-538"><a href="#cb52-538"></a>razón para generar suficientes reclamos y así poder tener cálculos con una buena aproximación </span>
<span id="cb52-539"><a href="#cb52-539"></a>numérica, se necesitarán muchas simulaciones.</span>
<span id="cb52-540"><a href="#cb52-540"></a></span>
<span id="cb52-541"><a href="#cb52-541"></a>Para ciertos casos particulares, el modelo colectivo puede ser muchas veces calculado de forma</span>
<span id="cb52-542"><a href="#cb52-542"></a>similar a un modelo individual. Por ejemplo, si consideramos el caso cuando la variable aleatoria </span>
<span id="cb52-543"><a href="#cb52-543"></a>del conteo de siniestros $N \rightsquigarrow Bin( n, p )$ sigue una distribución binomial con</span>
<span id="cb52-544"><a href="#cb52-544"></a>parámetros $n$ y $p$ y los reclamos individuales $<span class="sc">\{</span> X_i <span class="sc">\}</span>$ son i.i.d. A partir de esto, el reclamo</span>
<span id="cb52-545"><a href="#cb52-545"></a>total $S$ puede ser expresado de dos formas:</span>
<span id="cb52-546"><a href="#cb52-546"></a>$$</span>
<span id="cb52-547"><a href="#cb52-547"></a>S = \sum\limits_{k=0}^{N} X_k</span>
<span id="cb52-548"><a href="#cb52-548"></a>= \sum\limits_{k=0}^n B_k X_k</span>
<span id="cb52-549"><a href="#cb52-549"></a>$$</span>
<span id="cb52-550"><a href="#cb52-550"></a>donde las variables aleatorias $B_k \rightsquigarrow Ber( p )$ son independientes de las variables </span>
<span id="cb52-551"><a href="#cb52-551"></a>aleatorias $X_k$ de cada uno de los reclamos. Así el modelo colectivo se transforma en un modelo </span>
<span id="cb52-552"><a href="#cb52-552"></a>individual con $n$ constante y valores de reclamos individuales dados por la variable aleatoria </span>
<span id="cb52-553"><a href="#cb52-553"></a>$Y_k = B_k X_k$.</span>
<span id="cb52-554"><a href="#cb52-554"></a></span>
<span id="cb52-555"><a href="#cb52-555"></a>Para este caso en particular:</span>
<span id="cb52-556"><a href="#cb52-556"></a>$$</span>
<span id="cb52-557"><a href="#cb52-557"></a>\begin{split}</span>
<span id="cb52-558"><a href="#cb52-558"></a>\E<span class="co">[</span><span class="ot"> S </span><span class="co">]</span> </span>
<span id="cb52-559"><a href="#cb52-559"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> \sum\limits_{k=0}^{n} B_k X_k \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-560"><a href="#cb52-560"></a>&amp; = \sum\limits_{k=0}^{n} \E\left<span class="co">[</span><span class="ot"> B_k X_k \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-561"><a href="#cb52-561"></a>&amp; = n \E<span class="co">[</span><span class="ot"> B X </span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-562"><a href="#cb52-562"></a>&amp; = n \E<span class="co">[</span><span class="ot"> B </span><span class="co">]</span> \E<span class="co">[</span><span class="ot"> X </span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-563"><a href="#cb52-563"></a>&amp; = n p \E<span class="co">[</span><span class="ot"> X </span><span class="co">]</span></span>
<span id="cb52-564"><a href="#cb52-564"></a>\end{split}</span>
<span id="cb52-565"><a href="#cb52-565"></a>$$</span>
<span id="cb52-566"><a href="#cb52-566"></a></span>
<span id="cb52-567"><a href="#cb52-567"></a>así mismo:</span>
<span id="cb52-568"><a href="#cb52-568"></a>$$</span>
<span id="cb52-569"><a href="#cb52-569"></a>\begin{split}</span>
<span id="cb52-570"><a href="#cb52-570"></a>\V<span class="co">[</span><span class="ot"> S </span><span class="co">]</span></span>
<span id="cb52-571"><a href="#cb52-571"></a>&amp; = n \V<span class="co">[</span><span class="ot"> B X </span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-572"><a href="#cb52-572"></a>&amp; = n \left( \E<span class="co">[</span><span class="ot"> B^2 X^2 </span><span class="co">]</span> - \E<span class="co">[</span><span class="ot"> B X </span><span class="co">]</span>^2 \right) <span class="sc">\\</span></span>
<span id="cb52-573"><a href="#cb52-573"></a>&amp; = n \left( \E<span class="co">[</span><span class="ot"> B^2 </span><span class="co">]</span> \E<span class="co">[</span><span class="ot"> X^2 </span><span class="co">]</span> - \E<span class="co">[</span><span class="ot"> B </span><span class="co">]</span>^2 \E<span class="co">[</span><span class="ot"> X </span><span class="co">]</span>^2 \right) <span class="sc">\\</span></span>
<span id="cb52-574"><a href="#cb52-574"></a>&amp; = n \left( p \E<span class="co">[</span><span class="ot"> X^2 </span><span class="co">]</span> - p^2 \E<span class="co">[</span><span class="ot"> X </span><span class="co">]</span>^2 \right) <span class="sc">\\</span></span>
<span id="cb52-575"><a href="#cb52-575"></a>&amp; = n \left( p \E<span class="co">[</span><span class="ot"> X^2 </span><span class="co">]</span> - p \E<span class="co">[</span><span class="ot"> X </span><span class="co">]</span>^2 + p \E<span class="co">[</span><span class="ot"> X </span><span class="co">]</span>^2  - p^2 \E<span class="co">[</span><span class="ot"> X </span><span class="co">]</span>^2 \right) <span class="sc">\\</span></span>
<span id="cb52-576"><a href="#cb52-576"></a>&amp; = n \left( p \V<span class="co">[</span><span class="ot"> X </span><span class="co">]</span> + p ( 1 - p ) \E<span class="co">[</span><span class="ot"> X </span><span class="co">]</span>^2 \right) <span class="sc">\\</span></span>
<span id="cb52-577"><a href="#cb52-577"></a>&amp; = n \left( \E<span class="co">[</span><span class="ot">B</span><span class="co">]</span> \V<span class="co">[</span><span class="ot"> X </span><span class="co">]</span> + \V<span class="co">[</span><span class="ot">B</span><span class="co">]</span> \E<span class="co">[</span><span class="ot"> X </span><span class="co">]</span>^2 \right)</span>
<span id="cb52-578"><a href="#cb52-578"></a>\end{split}</span>
<span id="cb52-579"><a href="#cb52-579"></a>$$</span>
<span id="cb52-580"><a href="#cb52-580"></a></span>
<span id="cb52-581"><a href="#cb52-581"></a>::: {.example #l6ex4}</span>
<span id="cb52-582"><a href="#cb52-582"></a>Hacemos uso del algoritmo de simulación, pero bajo la consideración anterior donde el conteo </span>
<span id="cb52-583"><a href="#cb52-583"></a>de siniestros $N \rightsquigarrow Bin( n, p )$, en algunos casos se puede considerar $n$ como el </span>
<span id="cb52-584"><a href="#cb52-584"></a>número de pólizas vendidas, esto supone que solo se presenta un reclamo por póliza. Por su parte,</span>
<span id="cb52-585"><a href="#cb52-585"></a>consideraremos los reclamos $X_i \rightsquigarrow LN( \mu, \sigma )$, para todo</span>
<span id="cb52-586"><a href="#cb52-586"></a>$i \in <span class="sc">\{</span>1,\ldots,n<span class="sc">\}</span>$. </span>
<span id="cb52-587"><a href="#cb52-587"></a></span>
<span id="cb52-588"><a href="#cb52-588"></a>Si consideramos generar la simulación como un modelo individual, generamos variables aleatorias</span>
<span id="cb52-589"><a href="#cb52-589"></a>$B_i \rightsquigarrow Ber(p)$, para todo $i \in <span class="sc">\{</span>1,\ldots,n<span class="sc">\}</span>$.</span>
<span id="cb52-590"><a href="#cb52-590"></a><span class="in">```{r l6c5}</span></span>
<span id="cb52-591"><a href="#cb52-591"></a><span class="in">m &lt;- 1e4</span></span>
<span id="cb52-592"><a href="#cb52-592"></a><span class="in">n &lt;- 1000</span></span>
<span id="cb52-593"><a href="#cb52-593"></a><span class="in">p &lt;- 0.2</span></span>
<span id="cb52-594"><a href="#cb52-594"></a><span class="in">mu &lt;- 5</span></span>
<span id="cb52-595"><a href="#cb52-595"></a><span class="in">sigma &lt;- 2</span></span>
<span id="cb52-596"><a href="#cb52-596"></a><span class="in">B &lt;- lapply( 1:m, FUN = function( i ) rbinom( n, size = 1, prob = p ) )</span></span>
<span id="cb52-597"><a href="#cb52-597"></a><span class="in">X &lt;- lapply( 1:m, FUN = function( i ) rlnorm( n, meanlog = mu, sdlog = sigma ) )</span></span>
<span id="cb52-598"><a href="#cb52-598"></a><span class="in">S &lt;- sapply( 1:m, FUN = function( i ) sum( B[[ i ]] * X[[ i ]], na.rm = TRUE ) )</span></span>
<span id="cb52-599"><a href="#cb52-599"></a></span>
<span id="cb52-600"><a href="#cb52-600"></a><span class="in">EeS &lt;- mean( S )</span></span>
<span id="cb52-601"><a href="#cb52-601"></a><span class="in">ES &lt;- n * p * exp( mu + 0.5 * sigma^2 )</span></span>
<span id="cb52-602"><a href="#cb52-602"></a><span class="in">```</span></span>
<span id="cb52-603"><a href="#cb52-603"></a></span>
<span id="cb52-604"><a href="#cb52-604"></a>$$</span>
<span id="cb52-605"><a href="#cb52-605"></a>\begin{split}</span>
<span id="cb52-606"><a href="#cb52-606"></a>\E<span class="co">[</span><span class="ot">S</span><span class="co">]</span> = n p e^{ \mu + \frac{1}{2} \sigma^2 } &amp; = <span class="in">`r formatC( ES, digits = 4, format = 'f' )`</span>, <span class="sc">\\</span></span>
<span id="cb52-607"><a href="#cb52-607"></a>\overline{S} = \frac{1}{m} \sum\limits_{i=1}^m S_i &amp; = <span class="in">`r formatC( EeS, digits = 4, format = 'f' )`</span>, </span>
<span id="cb52-608"><a href="#cb52-608"></a>\end{split}</span>
<span id="cb52-609"><a href="#cb52-609"></a>$$</span>
<span id="cb52-610"><a href="#cb52-610"></a>:::</span>
<span id="cb52-611"><a href="#cb52-611"></a></span>
<span id="cb52-612"><a href="#cb52-612"></a>Es importante observar que si la frecuencia de reclamos es superior a $1$, sea esta por póliza, </span>
<span id="cb52-613"><a href="#cb52-613"></a>individuo o en general por unidad asegurada, la aproximación anterior no es la correcta si no </span>
<span id="cb52-614"><a href="#cb52-614"></a>se realiza un ajuste al valor $n$ que es el número máximo de siniestros. También, se puede </span>
<span id="cb52-615"><a href="#cb52-615"></a>considerar que las variables de los reclamos es la suma total de reclamos por póliza.</span>
<span id="cb52-616"><a href="#cb52-616"></a></span>
<span id="cb52-617"><a href="#cb52-617"></a>Por otra parte, es de notar que en el cálculo hay un gasto innecesario de valores simulados de </span>
<span id="cb52-618"><a href="#cb52-618"></a>reclamos $X_i$, ya que algunos se multiplicaran por $B_i$, la cual solo toma valores $<span class="sc">\{</span>0,1<span class="sc">\}</span>$.</span>
<span id="cb52-619"><a href="#cb52-619"></a></span>
<span id="cb52-620"><a href="#cb52-620"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-621"><a href="#cb52-621"></a><span class="fu">## Modelos mixtos {#modelos_mixtos}</span></span>
<span id="cb52-622"><a href="#cb52-622"></a></span>
<span id="cb52-623"><a href="#cb52-623"></a></span>
<span id="cb52-624"><a href="#cb52-624"></a>::: {.Definition #dmodmix title="Modelo mixto"}</span>
<span id="cb52-625"><a href="#cb52-625"></a>En algunos casos en particular se considera un modelo de agregación que es una mixtura entre el</span>
<span id="cb52-626"><a href="#cb52-626"></a>modelo individual y el modelo colectivo. Se parte de considerar un número $n$ de unidades </span>
<span id="cb52-627"><a href="#cb52-627"></a>aseguradas, donde para cada unidad $i \in <span class="sc">\{</span>1, \ldots, n<span class="sc">\}</span>$ se considera que puede presentar una </span>
<span id="cb52-628"><a href="#cb52-628"></a>cantidad de reclamos dados por una variable aleatoria discreta $N_i$, cada uno de las $i$ unidades</span>
<span id="cb52-629"><a href="#cb52-629"></a>pueden presentar un número de reclamos $X_{i,1}, \ldots, X_{i,N_i}$. De agregar el total de reclamos, </span>
<span id="cb52-630"><a href="#cb52-630"></a>se tiene la expresión:</span>
<span id="cb52-631"><a href="#cb52-631"></a>$$</span>
<span id="cb52-632"><a href="#cb52-632"></a>S </span>
<span id="cb52-633"><a href="#cb52-633"></a>= \sum\limits_{i=1}^n \sum\limits_{j=1}^{N_i} X_{i,j}</span>
<span id="cb52-634"><a href="#cb52-634"></a>$$</span>
<span id="cb52-635"><a href="#cb52-635"></a>:::</span>
<span id="cb52-636"><a href="#cb52-636"></a></span>
<span id="cb52-637"><a href="#cb52-637"></a></span>
<span id="cb52-638"><a href="#cb52-638"></a>Si en caso todos los reclamos $X_{i,j}$ son idénticamente distribuidos entre unidades aseguradas </span>
<span id="cb52-639"><a href="#cb52-639"></a>y reclamos, entonces el reclamo total anterior puede ser visto como un modelo colectivo de pérdida:</span>
<span id="cb52-640"><a href="#cb52-640"></a>$$</span>
<span id="cb52-641"><a href="#cb52-641"></a>S </span>
<span id="cb52-642"><a href="#cb52-642"></a>= \sum\limits_{j=1}^{N} X_j</span>
<span id="cb52-643"><a href="#cb52-643"></a>$$</span>
<span id="cb52-644"><a href="#cb52-644"></a>tomando el conteo de siniestros como la variable aleatoria $N = \sum\limits_{i=1}^n N_i$.</span>
<span id="cb52-645"><a href="#cb52-645"></a></span>
<span id="cb52-646"><a href="#cb52-646"></a>El mismo modelo mixto, también puede ser interpretado como un modelo individual de pérdida, con </span>
<span id="cb52-647"><a href="#cb52-647"></a>una suma constante de siniestros.</span>
<span id="cb52-648"><a href="#cb52-648"></a>$$</span>
<span id="cb52-649"><a href="#cb52-649"></a>S </span>
<span id="cb52-650"><a href="#cb52-650"></a>= \sum\limits_{i=1}^n Y_i</span>
<span id="cb52-651"><a href="#cb52-651"></a>$$</span>
<span id="cb52-652"><a href="#cb52-652"></a></span>
<span id="cb52-653"><a href="#cb52-653"></a>donde cada variable aleatoria $Y_i = \sum\limits_{j=1}^{N_i} X_{i,j}$.</span>
<span id="cb52-654"><a href="#cb52-654"></a></span>
<span id="cb52-655"><a href="#cb52-655"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-656"><a href="#cb52-656"></a><span class="fu">## Teorema del límite central y su uso {#uso_limite_central}</span></span>
<span id="cb52-657"><a href="#cb52-657"></a></span>
<span id="cb52-658"><a href="#cb52-658"></a>En varias situaciones es difícil determinar la distribución de los reclamos totales $S$, como ya </span>
<span id="cb52-659"><a href="#cb52-659"></a>hemos visto no hay una forma explícita sencilla. </span>
<span id="cb52-660"><a href="#cb52-660"></a></span>
<span id="cb52-661"><a href="#cb52-661"></a>Para tener una primera aproximación a la distribución, se puede utilizar el teorema del límite </span>
<span id="cb52-662"><a href="#cb52-662"></a>central \ref{tlc}, para ello se requiere un gran número de elementos en la suma de los reclamos </span>
<span id="cb52-663"><a href="#cb52-663"></a>totales $S$. Como ya lo muestra la desigualdad \ref{beress}, la convergencia requiere un número</span>
<span id="cb52-664"><a href="#cb52-664"></a>de términos inversamente proporcional al cuadrado del error de aproximación. Sin embargo, si en caso </span>
<span id="cb52-665"><a href="#cb52-665"></a>el número de reclamos $n$ no es lo suficientemente grande como para obtener un error de aproximación</span>
<span id="cb52-666"><a href="#cb52-666"></a>deseado, podemos hacer uso de un resultado más fuerte como la desigualdad de concentración de</span>
<span id="cb52-667"><a href="#cb52-667"></a>\ref{beress}, la misma no solo implica el teorema del límite central, sino que además </span>
<span id="cb52-668"><a href="#cb52-668"></a>proporciona una acotación y velocidad de convergencia conforme se aumenta $n$. Esta desigualdad</span>
<span id="cb52-669"><a href="#cb52-669"></a>puede ser de gran utilidad para tener una acotación de la distribución de los reclamos totales, para</span>
<span id="cb52-670"><a href="#cb52-670"></a>cualquier valor de $n$.</span>
<span id="cb52-671"><a href="#cb52-671"></a></span>
<span id="cb52-672"><a href="#cb52-672"></a>Más claramente, para el caso del modelo individual, donde $n$ es una constante, el teorema</span>
<span id="cb52-673"><a href="#cb52-673"></a>\ref{beress} nos proporciona la siguiente desigualdad:</span>
<span id="cb52-674"><a href="#cb52-674"></a>$$</span>
<span id="cb52-675"><a href="#cb52-675"></a>\begin{split}</span>
<span id="cb52-676"><a href="#cb52-676"></a>\underset{u\in \R}{\sup}\left( 1 + |u|^3 \right)\left| P\left( \frac{S - \E<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}{\sqrt{\V<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}}  \leq u\right) - \Phi( u ) \right| </span>
<span id="cb52-677"><a href="#cb52-677"></a>&amp; \leq \frac{C}{\sqrt{n}} \frac{\E\left<span class="co">[</span><span class="ot">\left|X - \E[X]\right|^3\right</span><span class="co">]</span>}{\sqrt{\V<span class="co">[</span><span class="ot">X</span><span class="co">]</span>}^3} <span class="sc">\\</span></span>
<span id="cb52-678"><a href="#cb52-678"></a>\left( 1 + |u|^3 \right)\left| P\left( \frac{S - \E<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}{\sqrt{\V<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}}  \leq u\right) - \Phi( u ) \right| </span>
<span id="cb52-679"><a href="#cb52-679"></a>&amp; \leq \frac{C}{\sqrt{n}} \frac{\E\left<span class="co">[</span><span class="ot">\left|X - \E[X]\right|^3\right</span><span class="co">]</span>}{\sqrt{\V<span class="co">[</span><span class="ot">X</span><span class="co">]</span>}^3},\qquad \forall u \in \R <span class="sc">\\</span></span>
<span id="cb52-680"><a href="#cb52-680"></a>\end{split}</span>
<span id="cb52-681"><a href="#cb52-681"></a>$$</span>
<span id="cb52-682"><a href="#cb52-682"></a>Para simplificar la manipulación de las expresiones podemos tomar:</span>
<span id="cb52-683"><a href="#cb52-683"></a>$\tau = \frac{\E\left<span class="co">[</span><span class="ot">\left|X - \E[X]\right|^3\right</span><span class="co">]</span>}{\sqrt{\V<span class="co">[</span><span class="ot">X</span><span class="co">]</span>}^3}$</span>
<span id="cb52-684"><a href="#cb52-684"></a>\begin{gather*}</span>
<span id="cb52-685"><a href="#cb52-685"></a>-\frac{C}{\sqrt{n}} \tau</span>
<span id="cb52-686"><a href="#cb52-686"></a>\leq \left( 1 + |u|^3 \right)\left( P\left( \frac{S - \E<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}{\sqrt{\V<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}}  \leq u\right) - \Phi( u ) \right) </span>
<span id="cb52-687"><a href="#cb52-687"></a>\leq \frac{C}{\sqrt{n}} \tau <span class="sc">\\</span></span>
<span id="cb52-688"><a href="#cb52-688"></a>\Phi( u ) - \frac{C}{\sqrt{n}\left( 1 + |u|^3 \right)} \tau</span>
<span id="cb52-689"><a href="#cb52-689"></a>\leq P\left( \frac{S - \E<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}{\sqrt{\V<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}}  \leq u\right) </span>
<span id="cb52-690"><a href="#cb52-690"></a>\leq \Phi( u ) + \frac{C}{\sqrt{n}\left( 1 + |u|^3 \right)} \tau  <span class="sc">\\</span></span>
<span id="cb52-691"><a href="#cb52-691"></a>\Phi( u ) - \frac{C}{\sqrt{n}\left( 1 + |u|^3 \right)} \tau</span>
<span id="cb52-692"><a href="#cb52-692"></a>\leq P\left( S \leq \E<span class="co">[</span><span class="ot">S</span><span class="co">]</span> + \sqrt{\V<span class="co">[</span><span class="ot">S</span><span class="co">]</span>} u\right) </span>
<span id="cb52-693"><a href="#cb52-693"></a>\leq \Phi( u ) + \frac{C}{\sqrt{n}\left( 1 + |u|^3 \right)} \tau <span class="sc">\\</span></span>
<span id="cb52-694"><a href="#cb52-694"></a>\max\left( \Phi\left( \frac{s - \E<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}{\sqrt{\V<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}} \right) - \frac{C}{\sqrt{n}\left( 1 + \left| \frac{s - \E<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}{\sqrt{\V<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}} \right|^3 \right)} \tau, 0 \right)</span>
<span id="cb52-695"><a href="#cb52-695"></a>\leq P\left( S \leq s \right) </span>
<span id="cb52-696"><a href="#cb52-696"></a>\leq \min\left( \Phi\left( \frac{s - \E<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}{\sqrt{\V<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}} \right) + \frac{C}{\sqrt{n}\left( 1 + \left|\frac{s - \E<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}{\sqrt{\V<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}}\right|^3 \right)} \tau, 1 \right)</span>
<span id="cb52-697"><a href="#cb52-697"></a>\end{gather*}</span>
<span id="cb52-698"><a href="#cb52-698"></a>cambiando la variable $s = \E<span class="co">[</span><span class="ot">S</span><span class="co">]</span> + \sqrt{\V<span class="co">[</span><span class="ot">S</span><span class="co">]</span>} u$.</span>
<span id="cb52-699"><a href="#cb52-699"></a>El $\max$ y $\min$ resultan debido a que una probabilidad siempre está acotada en el rango de $0$ a</span>
<span id="cb52-700"><a href="#cb52-700"></a>$1$.</span>
<span id="cb52-701"><a href="#cb52-701"></a></span>
<span id="cb52-702"><a href="#cb52-702"></a>El ejemplo a continuación muestra un claro uso del resultado anterior.</span>
<span id="cb52-703"><a href="#cb52-703"></a></span>
<span id="cb52-704"><a href="#cb52-704"></a>::: {.example #l6ex5}</span>
<span id="cb52-705"><a href="#cb52-705"></a>En este caso en particular consideramos un modelo individual con reclamos determinados por variables</span>
<span id="cb52-706"><a href="#cb52-706"></a>aleatorias que siguen una distribución $LN( \mu, \sigma )$ y un número de $n = 7000$ reclamos. </span>
<span id="cb52-707"><a href="#cb52-707"></a>Además, como es usual asumimos que las variables aleatorias de los reclamos $X_1, \ldots, X_n$ son </span>
<span id="cb52-708"><a href="#cb52-708"></a>i.i.d.</span>
<span id="cb52-709"><a href="#cb52-709"></a><span class="in">```{r l6c6}</span></span>
<span id="cb52-710"><a href="#cb52-710"></a><span class="in">n &lt;- 7e3</span></span>
<span id="cb52-711"><a href="#cb52-711"></a><span class="in">mu &lt;- 4.0</span></span>
<span id="cb52-712"><a href="#cb52-712"></a><span class="in">sigma &lt;- 2.0</span></span>
<span id="cb52-713"><a href="#cb52-713"></a><span class="in">EX &lt;- exp( mu + 0.5 * sigma^2 )</span></span>
<span id="cb52-714"><a href="#cb52-714"></a><span class="in">VX &lt;- ( exp( sigma^2 ) - 1 ) * exp( 2 * mu + sigma^2 )</span></span>
<span id="cb52-715"><a href="#cb52-715"></a><span class="in">ES &lt;- n * EX</span></span>
<span id="cb52-716"><a href="#cb52-716"></a><span class="in">VS &lt;- n * VX</span></span>
<span id="cb52-717"><a href="#cb52-717"></a></span>
<span id="cb52-718"><a href="#cb52-718"></a><span class="in"># utilizamos simulación, no hay forma analítica para la distribución de la suma de log-normales</span></span>
<span id="cb52-719"><a href="#cb52-719"></a><span class="in">m &lt;- 5e3</span></span>
<span id="cb52-720"><a href="#cb52-720"></a><span class="in">S &lt;- sapply( 1:m, FUN = function( i ) sum( rlnorm( n, meanlog = mu, sdlog = sigma ) ) )</span></span>
<span id="cb52-721"><a href="#cb52-721"></a><span class="in">FS &lt;- ecdf( S ) </span></span>
<span id="cb52-722"><a href="#cb52-722"></a></span>
<span id="cb52-723"><a href="#cb52-723"></a><span class="in">C &lt;- 0.7655 + 8 * ( 1 + exp(1) ) # constante universal del teorema</span></span>
<span id="cb52-724"><a href="#cb52-724"></a><span class="in">f &lt;- function( x ) ( abs( x - EX )^3 ) * dlnorm( x, meanlog = mu, sdlog = sigma )</span></span>
<span id="cb52-725"><a href="#cb52-725"></a></span>
<span id="cb52-726"><a href="#cb52-726"></a><span class="in"># forzando este término, la distribución log-normal no tiene función generadora de momentos</span></span>
<span id="cb52-727"><a href="#cb52-727"></a><span class="in">tau &lt;- integrate( f = f, lower = 0, upper = 1e10, subdivisions = 1e4, rel.tol = 1e-10 )$value / sqrt( VX )^3</span></span>
<span id="cb52-728"><a href="#cb52-728"></a></span>
<span id="cb52-729"><a href="#cb52-729"></a><span class="in">s &lt;- seq( 0, 6e6, length = 5000 )</span></span>
<span id="cb52-730"><a href="#cb52-730"></a><span class="in">Fms &lt;- sapply( s, FUN = FS )</span></span>
<span id="cb52-731"><a href="#cb52-731"></a></span>
<span id="cb52-732"><a href="#cb52-732"></a><span class="in">u &lt;- ( s - ES ) / sqrt( VS )</span></span>
<span id="cb52-733"><a href="#cb52-733"></a><span class="in">r &lt;- 1 + abs( u )^3</span></span>
<span id="cb52-734"><a href="#cb52-734"></a><span class="in">Fmax &lt;- pmin( pnorm( u ) + C * tau / ( sqrt( n ) * r ), 1 ) # cota superior</span></span>
<span id="cb52-735"><a href="#cb52-735"></a><span class="in">Fmin &lt;- pmax( pnorm( u ) - C * tau / ( sqrt( n ) * r ), 0 ) # cota inferior</span></span>
<span id="cb52-736"><a href="#cb52-736"></a><span class="in">Phi &lt;- sapply( s, FUN = function( s ) pnorm( ( s - ES ) / sqrt( VS ) ) )</span></span>
<span id="cb52-737"><a href="#cb52-737"></a><span class="in">```</span></span>
<span id="cb52-738"><a href="#cb52-738"></a></span>
<span id="cb52-739"><a href="#cb52-739"></a>Como se puede ver en el siguiente gráfico, la acotación funciona muy bien y al aumentar el número de </span>
<span id="cb52-740"><a href="#cb52-740"></a>siniestros $n$ se disminuye el rango de la acotación, proporcionando así una mejor estimación de la </span>
<span id="cb52-741"><a href="#cb52-741"></a>distribución de los reclamos totales $S$.</span>
<span id="cb52-742"><a href="#cb52-742"></a><span class="in">```{r l6g2}</span></span>
<span id="cb52-743"><a href="#cb52-743"></a><span class="in">#| warning: false</span></span>
<span id="cb52-744"><a href="#cb52-744"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-745"><a href="#cb52-745"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-746"><a href="#cb52-746"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-747"><a href="#cb52-747"></a><span class="in">ylim &lt;- c( 0, 1 )</span></span>
<span id="cb52-748"><a href="#cb52-748"></a><span class="in">ybrk &lt;- seq( ylim[1], ylim[2], 0.1 )</span></span>
<span id="cb52-749"><a href="#cb52-749"></a><span class="in">ylbl &lt;- formatC( ybrk, digits = 2, format = 'f' )</span></span>
<span id="cb52-750"><a href="#cb52-750"></a></span>
<span id="cb52-751"><a href="#cb52-751"></a><span class="in">xlim &lt;- c( min( s ), max( s ) )</span></span>
<span id="cb52-752"><a href="#cb52-752"></a><span class="in">xbrk &lt;- seq( xlim[1], xlim[2], length = 11 )</span></span>
<span id="cb52-753"><a href="#cb52-753"></a><span class="in">xlbl &lt;- paste0( formatC( xbrk / 1e6, digits = 1, format = 'f' ), 'M' )</span></span>
<span id="cb52-754"><a href="#cb52-754"></a></span>
<span id="cb52-755"><a href="#cb52-755"></a><span class="in">plt &lt;- ggplot() +</span></span>
<span id="cb52-756"><a href="#cb52-756"></a><span class="in">  geom_line( aes( x = s, y = Phi ), colour = 'orange2', linewidth = 2 ) +</span></span>
<span id="cb52-757"><a href="#cb52-757"></a><span class="in">  geom_step( aes( x = s, y = Fms ), colour = 'dodgerblue3',  linewidth = 1 ) +</span></span>
<span id="cb52-758"><a href="#cb52-758"></a><span class="in">  geom_line( aes( x = s, y = Fmax ), colour = 'olivedrab3', linewidth = 0.5 ) +</span></span>
<span id="cb52-759"><a href="#cb52-759"></a><span class="in">  geom_line( aes( x = s, y = Fmin ), colour = 'olivedrab3', linewidth = 0.5 ) +</span></span>
<span id="cb52-760"><a href="#cb52-760"></a><span class="in">  scale_x_continuous( breaks = xbrk,</span></span>
<span id="cb52-761"><a href="#cb52-761"></a><span class="in">                      labels = xlbl, </span></span>
<span id="cb52-762"><a href="#cb52-762"></a><span class="in">                      limits = xlim, </span></span>
<span id="cb52-763"><a href="#cb52-763"></a><span class="in">                      expand = c( 0.01, 0.01 ) ) +</span></span>
<span id="cb52-764"><a href="#cb52-764"></a><span class="in">  scale_y_continuous( breaks = ybrk,</span></span>
<span id="cb52-765"><a href="#cb52-765"></a><span class="in">                      labels = ylbl,</span></span>
<span id="cb52-766"><a href="#cb52-766"></a><span class="in">                      limits = ylim,</span></span>
<span id="cb52-767"><a href="#cb52-767"></a><span class="in">                      expand = c( 0.01, 0.01 ) ) +</span></span>
<span id="cb52-768"><a href="#cb52-768"></a><span class="in">  xlab( TeX( "$S$" ) ) + </span></span>
<span id="cb52-769"><a href="#cb52-769"></a><span class="in">  ylab( TeX( "$F_S$" ) ) + </span></span>
<span id="cb52-770"><a href="#cb52-770"></a><span class="in">  theme_bw() +</span></span>
<span id="cb52-771"><a href="#cb52-771"></a><span class="in">  theme( legend.position = "none" )</span></span>
<span id="cb52-772"><a href="#cb52-772"></a><span class="in">plt</span></span>
<span id="cb52-773"><a href="#cb52-773"></a><span class="in">```</span></span>
<span id="cb52-774"><a href="#cb52-774"></a></span>
<span id="cb52-775"><a href="#cb52-775"></a>:::</span>
<span id="cb52-776"><a href="#cb52-776"></a></span>
<span id="cb52-777"><a href="#cb52-777"></a>Es de notar que las variables aleatorias de los reclamos pueden seguir cualquier otra distribución, </span>
<span id="cb52-778"><a href="#cb52-778"></a>el método no depende de la distribución en cuestión, sino de que la variable que representa </span>
<span id="cb52-779"><a href="#cb52-779"></a>los reclamos tenga esperanza finita, varianza finita y la variación de tercer orden </span>
<span id="cb52-780"><a href="#cb52-780"></a>$\E\left<span class="co">[</span><span class="ot">\left|X - \E[X]\right|^3 \right</span><span class="co">]</span> &lt; +\infty$, también sea finita.</span>
<span id="cb52-781"><a href="#cb52-781"></a></span>
<span id="cb52-782"><a href="#cb52-782"></a>En la práctica se suele tomar lo que se conoce como una aproximación por el teorema de límite </span>
<span id="cb52-783"><a href="#cb52-783"></a>central.</span>
<span id="cb52-784"><a href="#cb52-784"></a></span>
<span id="cb52-785"><a href="#cb52-785"></a></span>
<span id="cb52-786"><a href="#cb52-786"></a>$$</span>
<span id="cb52-787"><a href="#cb52-787"></a>P( S \leq s )</span>
<span id="cb52-788"><a href="#cb52-788"></a>\approx \Phi\left( \frac{s - \E<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}{\sqrt{\V<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}} \right)</span>
<span id="cb52-789"><a href="#cb52-789"></a>$$</span>
<span id="cb52-790"><a href="#cb52-790"></a></span>
<span id="cb52-791"><a href="#cb52-791"></a></span>
<span id="cb52-792"><a href="#cb52-792"></a>Esto es válido siempre y cuando la cota del error de aproximación </span>
<span id="cb52-793"><a href="#cb52-793"></a>$\frac{C}{\sqrt{n}\left( 1 + \left|\frac{s - \E<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}{\sqrt{\V<span class="co">[</span><span class="ot">S</span><span class="co">]</span>}}\right|^3 \right)} \tau$, sea </span>
<span id="cb52-794"><a href="#cb52-794"></a>lo suficientemente pequeña. Además, es de notar que se está trabajando con valores que solo están </span>
<span id="cb52-795"><a href="#cb52-795"></a>entre $0$ y $1$, pequeñas variaciones pueden ser muy relevantes al nivel del ajuste de las </span>
<span id="cb52-796"><a href="#cb52-796"></a>distribuciones acumuladas.</span>
<span id="cb52-797"><a href="#cb52-797"></a></span>
<span id="cb52-798"><a href="#cb52-798"></a>Finalmente, debemos tomar en cuenta que las cotas, superior como inferior, no son funciones de </span>
<span id="cb52-799"><a href="#cb52-799"></a>de distribución acumuladas en la variable $s$, no necesariamente son siempre crecientes.</span>
<span id="cb52-800"><a href="#cb52-800"></a></span>
<span id="cb52-801"><a href="#cb52-801"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-802"><a href="#cb52-802"></a><span class="fu">## Aplicación del deducible {#deducibles}</span></span>
<span id="cb52-803"><a href="#cb52-803"></a></span>
<span id="cb52-804"><a href="#cb52-804"></a>En muchas ocasiones según las condiciones de los contratos de seguro y el apetito de riesgo del </span>
<span id="cb52-805"><a href="#cb52-805"></a>asegurador, se configura funciones deducibles sobre los reclamos. El objetivo de aplicar un </span>
<span id="cb52-806"><a href="#cb52-806"></a>deducible es evitar valores de reclamo en determinados rangos que no están acorde a las </span>
<span id="cb52-807"><a href="#cb52-807"></a>configuraciones y estructuración de productos de seguro. Por ejemplo, se puede colocar un deducible</span>
<span id="cb52-808"><a href="#cb52-808"></a>para evitar el pago de valores muy pequeños de reclamos, cuya atención incluso puede implicar</span>
<span id="cb52-809"><a href="#cb52-809"></a>costos operativos o administrativos mayores al valor mismo de los reclamos, ante esta situación </span>
<span id="cb52-810"><a href="#cb52-810"></a>se coloca una cota mínima para que de esta forma el asegurado se haga cargo por su cuenta de estos </span>
<span id="cb52-811"><a href="#cb52-811"></a>valores menores.</span>
<span id="cb52-812"><a href="#cb52-812"></a></span>
<span id="cb52-813"><a href="#cb52-813"></a>Es usual colocar mínimos en las colas de la distribución de reclamos, evitando así valores muy </span>
<span id="cb52-814"><a href="#cb52-814"></a>pequeños o valores muy grandes, pero no sería sustentable, ni financieramente o económicamente, el </span>
<span id="cb52-815"><a href="#cb52-815"></a>colocar un deducible justo donde se presenta la mayor parte de los valores de reclamos. Desde</span>
<span id="cb52-816"><a href="#cb52-816"></a>la perspectiva de un asegurado, ¿De qué serviría adquirir una póliza que no cubre precisamente los</span>
<span id="cb52-817"><a href="#cb52-817"></a>siniestros más usuales?, esta no sería una póliza apetecible en el mercado y por otra parte un </span>
<span id="cb52-818"><a href="#cb52-818"></a>producto difícil de comercializar.</span>
<span id="cb52-819"><a href="#cb52-819"></a></span>
<span id="cb52-820"><a href="#cb52-820"></a></span>
<span id="cb52-821"><a href="#cb52-821"></a>::: {.Definition #ddeducible title="Deducible"}</span>
<span id="cb52-822"><a href="#cb52-822"></a>Formalmente, un **deducible** es una función $D : \R \longrightarrow \R$ a valores </span>
<span id="cb52-823"><a href="#cb52-823"></a>reales, tal que para todo valor real $x \in \R$, se satisface la siguiente desigualdad:</span>
<span id="cb52-824"><a href="#cb52-824"></a>$D( x ) \leq x$.</span>
<span id="cb52-825"><a href="#cb52-825"></a>:::</span>
<span id="cb52-826"><a href="#cb52-826"></a></span>
<span id="cb52-827"><a href="#cb52-827"></a></span>
<span id="cb52-828"><a href="#cb52-828"></a>A continuación presentamos un lista de funciones deducibles más comunes que presenta el mercado:</span>
<span id="cb52-829"><a href="#cb52-829"></a></span>
<span id="cb52-830"><a href="#cb52-830"></a><span class="ss">1. </span>Para evitar pérdidas pequeñas se suele configurar la función deducible </span>
<span id="cb52-831"><a href="#cb52-831"></a>$$</span>
<span id="cb52-832"><a href="#cb52-832"></a>D( X ) = \max( X - d, 0 )</span>
<span id="cb52-833"><a href="#cb52-833"></a>$$</span>
<span id="cb52-834"><a href="#cb52-834"></a>que se aplicará sobre las variables aleatorias de los reclamos $X \rightsquigarrow F_X$. Así, </span>
<span id="cb52-835"><a href="#cb52-835"></a>el valor ya deducido $Z = D( X ) \rightsquigarrow F_Z( z )$, donde </span>
<span id="cb52-836"><a href="#cb52-836"></a>$$</span>
<span id="cb52-837"><a href="#cb52-837"></a>F_Z( z ) = \mathbf{1}_{[0,+\infty)}( z ) F_X( z + d )</span>
<span id="cb52-838"><a href="#cb52-838"></a>$$</span>
<span id="cb52-839"><a href="#cb52-839"></a><span class="in">```{r l6g3}</span></span>
<span id="cb52-840"><a href="#cb52-840"></a><span class="in">#| warning: false</span></span>
<span id="cb52-841"><a href="#cb52-841"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-842"><a href="#cb52-842"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-843"><a href="#cb52-843"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-844"><a href="#cb52-844"></a><span class="in">D &lt;- function( x, d ) return( max( x - d, 0 ) )</span></span>
<span id="cb52-845"><a href="#cb52-845"></a><span class="in">d &lt;- 50</span></span>
<span id="cb52-846"><a href="#cb52-846"></a><span class="in">alpha &lt;- 2</span></span>
<span id="cb52-847"><a href="#cb52-847"></a><span class="in">gamma &lt;- 4</span></span>
<span id="cb52-848"><a href="#cb52-848"></a><span class="in">tau &lt;- 5</span></span>
<span id="cb52-849"><a href="#cb52-849"></a><span class="in">theta &lt;- 80</span></span>
<span id="cb52-850"><a href="#cb52-850"></a><span class="in">n &lt;- 1e3</span></span>
<span id="cb52-851"><a href="#cb52-851"></a></span>
<span id="cb52-852"><a href="#cb52-852"></a><span class="in">xmax &lt;- 5e2</span></span>
<span id="cb52-853"><a href="#cb52-853"></a><span class="in">x &lt;- seq( 0, xmax, length = n )</span></span>
<span id="cb52-854"><a href="#cb52-854"></a><span class="in">FX &lt;- sapply( x, FUN = function( x ) ptrbeta( x, shape1 = alpha, shape2 = gamma, shape3 = tau, scale = theta ) )</span></span>
<span id="cb52-855"><a href="#cb52-855"></a><span class="in">FDX &lt;- sapply( x, FUN = function( x ) ifelse( x &gt;= d, 1, 0 ) * ptrbeta( x + d, shape1 = alpha, shape2 = gamma, shape3 = tau, scale = theta ) )</span></span>
<span id="cb52-856"><a href="#cb52-856"></a></span>
<span id="cb52-857"><a href="#cb52-857"></a><span class="in">plt &lt;- ggplot( ) +</span></span>
<span id="cb52-858"><a href="#cb52-858"></a><span class="in">  geom_line( aes( x = x, y = FX, colour = 'a' ), linewidth = 2 ) +</span></span>
<span id="cb52-859"><a href="#cb52-859"></a><span class="in">  geom_line( aes( x = x, y = FDX, colour = 'b' ), linewidth = 1 ) +</span></span>
<span id="cb52-860"><a href="#cb52-860"></a><span class="in">  scale_colour_manual( breaks = c( 'a', 'b' ), </span></span>
<span id="cb52-861"><a href="#cb52-861"></a><span class="in">                       values = c( 'dodgerblue3', 'red3' ) ) +</span></span>
<span id="cb52-862"><a href="#cb52-862"></a><span class="in">  scale_x_continuous( breaks = seq( 0, xmax, length = 11 ),</span></span>
<span id="cb52-863"><a href="#cb52-863"></a><span class="in">                      labels = formatC( seq( 0, xmax, length = 11 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-864"><a href="#cb52-864"></a><span class="in">                      limits = c( 0, xmax ), </span></span>
<span id="cb52-865"><a href="#cb52-865"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-866"><a href="#cb52-866"></a><span class="in">  scale_y_continuous( breaks = seq( 0, 1, length = 11 ),</span></span>
<span id="cb52-867"><a href="#cb52-867"></a><span class="in">                      labels = formatC( seq( 0, 1, length = 11 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-868"><a href="#cb52-868"></a><span class="in">                      limits = c( 0.0, 1.0 ), </span></span>
<span id="cb52-869"><a href="#cb52-869"></a><span class="in">                      expand = c( 0.005, 0.005 ) ) +</span></span>
<span id="cb52-870"><a href="#cb52-870"></a><span class="in">  xlab( TeX( "$x$" ) ) + </span></span>
<span id="cb52-871"><a href="#cb52-871"></a><span class="in">  ylab( TeX( "$F_X, F_{D(X)}$" ) ) + </span></span>
<span id="cb52-872"><a href="#cb52-872"></a><span class="in">  theme_bw() +</span></span>
<span id="cb52-873"><a href="#cb52-873"></a><span class="in">  theme( legend.position = "none" )</span></span>
<span id="cb52-874"><a href="#cb52-874"></a><span class="in">plot( plt )</span></span>
<span id="cb52-875"><a href="#cb52-875"></a><span class="in">```</span></span>
<span id="cb52-876"><a href="#cb52-876"></a></span>
<span id="cb52-877"><a href="#cb52-877"></a><span class="ss">2. </span>Para prevenir los excesos de pérdida (stop loss) se propone el deducible con un tope máximo</span>
<span id="cb52-878"><a href="#cb52-878"></a>dado por una constante $M &gt; 0$, el cual se aplica a las variables aleatorias de los reclamos</span>
<span id="cb52-879"><a href="#cb52-879"></a>$X \rightsquigarrow F_X$:</span>
<span id="cb52-880"><a href="#cb52-880"></a>$$</span>
<span id="cb52-881"><a href="#cb52-881"></a>D( X ) = \min( X, M )</span>
<span id="cb52-882"><a href="#cb52-882"></a>$$, </span>
<span id="cb52-883"><a href="#cb52-883"></a></span>
<span id="cb52-884"><a href="#cb52-884"></a>en este caso, si la variable aleatoria del pago correspondiente al reclamo ya deducido </span>
<span id="cb52-885"><a href="#cb52-885"></a>$Z = D( X ) \rightsquigarrow F_Z( z )$, donde: </span>
<span id="cb52-886"><a href="#cb52-886"></a>$$</span>
<span id="cb52-887"><a href="#cb52-887"></a>F_Z( z ) = \mathbf{1}_{(-\infty,M)}( z ) F_X( z ) + \mathbf{1}_{[M,+\infty)}( z )</span>
<span id="cb52-888"><a href="#cb52-888"></a>$$</span>
<span id="cb52-889"><a href="#cb52-889"></a><span class="in">```{r l6g4}</span></span>
<span id="cb52-890"><a href="#cb52-890"></a><span class="in">#| warning: false</span></span>
<span id="cb52-891"><a href="#cb52-891"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-892"><a href="#cb52-892"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-893"><a href="#cb52-893"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-894"><a href="#cb52-894"></a><span class="in">D &lt;- function( x, M ) return( min( x, M ) )</span></span>
<span id="cb52-895"><a href="#cb52-895"></a><span class="in">M &lt;- 150</span></span>
<span id="cb52-896"><a href="#cb52-896"></a><span class="in">alpha &lt;- 2</span></span>
<span id="cb52-897"><a href="#cb52-897"></a><span class="in">gamma &lt;- 4</span></span>
<span id="cb52-898"><a href="#cb52-898"></a><span class="in">tau &lt;- 5</span></span>
<span id="cb52-899"><a href="#cb52-899"></a><span class="in">theta &lt;- 80</span></span>
<span id="cb52-900"><a href="#cb52-900"></a><span class="in">n &lt;- 1e3</span></span>
<span id="cb52-901"><a href="#cb52-901"></a></span>
<span id="cb52-902"><a href="#cb52-902"></a><span class="in">xmax &lt;- 5e2</span></span>
<span id="cb52-903"><a href="#cb52-903"></a><span class="in">x &lt;- seq( 0, xmax, length = n )</span></span>
<span id="cb52-904"><a href="#cb52-904"></a><span class="in">FX &lt;- sapply( x, FUN = function( x ) ptrbeta( x, shape1 = alpha, shape2 = gamma, shape3 = tau, scale = theta ) )</span></span>
<span id="cb52-905"><a href="#cb52-905"></a><span class="in">FDX &lt;- sapply( x, FUN = function( x ) ifelse( x &lt; M, 1, 0 ) * ptrbeta( x, shape1 = alpha, shape2 = gamma, shape3 = tau, scale = theta ) +  ifelse( x &gt;= M, 1, 0 ) )</span></span>
<span id="cb52-906"><a href="#cb52-906"></a></span>
<span id="cb52-907"><a href="#cb52-907"></a><span class="in">plt &lt;- ggplot( ) +</span></span>
<span id="cb52-908"><a href="#cb52-908"></a><span class="in">  geom_line( aes( x = x, y = FX, colour = 'a' ), linewidth = 2 ) +</span></span>
<span id="cb52-909"><a href="#cb52-909"></a><span class="in">  geom_line( aes( x = x, y = FDX, colour = 'b' ), linewidth = 1 ) +</span></span>
<span id="cb52-910"><a href="#cb52-910"></a><span class="in">  scale_colour_manual( breaks = c( 'a', 'b' ), </span></span>
<span id="cb52-911"><a href="#cb52-911"></a><span class="in">                       values = c( 'dodgerblue3', 'red3' ) ) +</span></span>
<span id="cb52-912"><a href="#cb52-912"></a><span class="in">  scale_x_continuous( breaks = seq( 0, xmax, length = 11 ),</span></span>
<span id="cb52-913"><a href="#cb52-913"></a><span class="in">                      labels = formatC( seq( 0, xmax, length = 11 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-914"><a href="#cb52-914"></a><span class="in">                      limits = c( 0, xmax ), </span></span>
<span id="cb52-915"><a href="#cb52-915"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-916"><a href="#cb52-916"></a><span class="in">  scale_y_continuous( breaks = seq( 0, 1, length = 11 ),</span></span>
<span id="cb52-917"><a href="#cb52-917"></a><span class="in">                      labels = formatC( seq( 0, 1, length = 11 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-918"><a href="#cb52-918"></a><span class="in">                      limits = c( 0.0, 1.0 ), </span></span>
<span id="cb52-919"><a href="#cb52-919"></a><span class="in">                      expand = c( 0.005, 0.005 ) ) +</span></span>
<span id="cb52-920"><a href="#cb52-920"></a><span class="in">  xlab( TeX( "$x$" ) ) + </span></span>
<span id="cb52-921"><a href="#cb52-921"></a><span class="in">  ylab( TeX( "$F_X, F_{D(X)}$" ) ) + </span></span>
<span id="cb52-922"><a href="#cb52-922"></a><span class="in">  theme_bw() +</span></span>
<span id="cb52-923"><a href="#cb52-923"></a><span class="in">  theme( legend.position = "none" )</span></span>
<span id="cb52-924"><a href="#cb52-924"></a><span class="in">plot( plt )</span></span>
<span id="cb52-925"><a href="#cb52-925"></a><span class="in">```</span></span>
<span id="cb52-926"><a href="#cb52-926"></a></span>
<span id="cb52-927"><a href="#cb52-927"></a><span class="ss">3. </span>Caso mixto para evitar pérdidas pequeñas y exceso de pérdida, se propone la siguiente composición</span>
<span id="cb52-928"><a href="#cb52-928"></a>de deducibles que se aplicará sobre las variables aleatorias de los reclamos $X \rightsquigarrow F_X$:</span>
<span id="cb52-929"><a href="#cb52-929"></a>$$</span>
<span id="cb52-930"><a href="#cb52-930"></a>D( X ) = \min( \max( X - d, 0 ), M )</span>
<span id="cb52-931"><a href="#cb52-931"></a>$$</span>
<span id="cb52-932"><a href="#cb52-932"></a>en este caso, si la variable aleatoria del pago correspondiente al reclamo ya deducido </span>
<span id="cb52-933"><a href="#cb52-933"></a>$Z = D( X ) \rightsquigarrow F_Z( z )$, tenemos que $Z \rightsquigarrow F_Z$, con:</span>
<span id="cb52-934"><a href="#cb52-934"></a>$$</span>
<span id="cb52-935"><a href="#cb52-935"></a>F_Z( z ) = \mathbf{1}_{[0,M)}( z ) F_X( z + d ) + \mathbf{1}_{[M,+\infty)}( z )</span>
<span id="cb52-936"><a href="#cb52-936"></a>$$</span>
<span id="cb52-937"><a href="#cb52-937"></a><span class="in">```{r l6g5}</span></span>
<span id="cb52-938"><a href="#cb52-938"></a><span class="in">#| warning: false</span></span>
<span id="cb52-939"><a href="#cb52-939"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-940"><a href="#cb52-940"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-941"><a href="#cb52-941"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-942"><a href="#cb52-942"></a><span class="in">D &lt;- function( x, M ) return( min( max( x - d ), M ) )</span></span>
<span id="cb52-943"><a href="#cb52-943"></a><span class="in">d &lt;- 50</span></span>
<span id="cb52-944"><a href="#cb52-944"></a><span class="in">M &lt;- 150</span></span>
<span id="cb52-945"><a href="#cb52-945"></a><span class="in">alpha &lt;- 2</span></span>
<span id="cb52-946"><a href="#cb52-946"></a><span class="in">gamma &lt;- 4</span></span>
<span id="cb52-947"><a href="#cb52-947"></a><span class="in">tau &lt;- 5</span></span>
<span id="cb52-948"><a href="#cb52-948"></a><span class="in">theta &lt;- 80</span></span>
<span id="cb52-949"><a href="#cb52-949"></a><span class="in">n &lt;- 1e3</span></span>
<span id="cb52-950"><a href="#cb52-950"></a></span>
<span id="cb52-951"><a href="#cb52-951"></a><span class="in">xmax &lt;- 5e2</span></span>
<span id="cb52-952"><a href="#cb52-952"></a><span class="in">x &lt;- seq( 0, xmax, length = n )</span></span>
<span id="cb52-953"><a href="#cb52-953"></a><span class="in">FX &lt;- sapply( x, FUN = function( x ) ptrbeta( x, shape1 = alpha, shape2 = gamma, shape3 = tau, scale = theta ) )</span></span>
<span id="cb52-954"><a href="#cb52-954"></a><span class="in">FDX &lt;- sapply( x, FUN = function( x ) ifelse( x &lt; M &amp; x &gt;= d, 1, 0 ) * ptrbeta( x + d, shape1 = alpha, shape2 = gamma, shape3 = tau, scale = theta ) +  ifelse( x &gt;= M, 1, 0 ) )</span></span>
<span id="cb52-955"><a href="#cb52-955"></a></span>
<span id="cb52-956"><a href="#cb52-956"></a><span class="in">plt &lt;- ggplot( ) +</span></span>
<span id="cb52-957"><a href="#cb52-957"></a><span class="in">  geom_line( aes( x = x, y = FX, colour = 'a' ), linewidth = 2 ) +</span></span>
<span id="cb52-958"><a href="#cb52-958"></a><span class="in">  geom_line( aes( x = x, y = FDX, colour = 'b' ), linewidth = 1 ) +</span></span>
<span id="cb52-959"><a href="#cb52-959"></a><span class="in">  scale_colour_manual( breaks = c( 'a', 'b' ), </span></span>
<span id="cb52-960"><a href="#cb52-960"></a><span class="in">                       values = c( 'dodgerblue3', 'red3' ) ) +</span></span>
<span id="cb52-961"><a href="#cb52-961"></a><span class="in">  scale_x_continuous( breaks = seq( 0, xmax, length = 11 ),</span></span>
<span id="cb52-962"><a href="#cb52-962"></a><span class="in">                      labels = formatC( seq( 0, xmax, length = 11 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-963"><a href="#cb52-963"></a><span class="in">                      limits = c( 0, xmax ), </span></span>
<span id="cb52-964"><a href="#cb52-964"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-965"><a href="#cb52-965"></a><span class="in">  scale_y_continuous( breaks = seq( 0, 1, length = 11 ),</span></span>
<span id="cb52-966"><a href="#cb52-966"></a><span class="in">                      labels = formatC( seq( 0, 1, length = 11 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-967"><a href="#cb52-967"></a><span class="in">                      limits = c( 0.0, 1.0 ), </span></span>
<span id="cb52-968"><a href="#cb52-968"></a><span class="in">                      expand = c( 0.005, 0.005 ) ) +</span></span>
<span id="cb52-969"><a href="#cb52-969"></a><span class="in">  xlab( TeX( "$x$" ) ) + </span></span>
<span id="cb52-970"><a href="#cb52-970"></a><span class="in">  ylab( TeX( "$F_X, F_{D(X)}$" ) ) + </span></span>
<span id="cb52-971"><a href="#cb52-971"></a><span class="in">  theme_bw() +</span></span>
<span id="cb52-972"><a href="#cb52-972"></a><span class="in">  theme( legend.position = "none" )</span></span>
<span id="cb52-973"><a href="#cb52-973"></a><span class="in">plot( plt )</span></span>
<span id="cb52-974"><a href="#cb52-974"></a><span class="in">```</span></span>
<span id="cb52-975"><a href="#cb52-975"></a></span>
<span id="cb52-976"><a href="#cb52-976"></a><span class="ss">4. </span>Otro tipo de deducible acota el número de pagos de reclamos a un número fijo máximo de reclamos,</span>
<span id="cb52-977"><a href="#cb52-977"></a>es decir, se establece un deducible en función de la frecuencia. Usualmente, esto se realiza cuando</span>
<span id="cb52-978"><a href="#cb52-978"></a>se considera un modelo donde se dispone de la frecuencia de reclamos por póliza.</span>
<span id="cb52-979"><a href="#cb52-979"></a>$$</span>
<span id="cb52-980"><a href="#cb52-980"></a>D(N) = \min( N, W )</span>
<span id="cb52-981"><a href="#cb52-981"></a>$$</span>
<span id="cb52-982"><a href="#cb52-982"></a>con la constante $W \in \N$. Para el reclamo total, si se considera un portafolio con $n$</span>
<span id="cb52-983"><a href="#cb52-983"></a>pólizas tenemos las siguiente variación del modelo:</span>
<span id="cb52-984"><a href="#cb52-984"></a>$$</span>
<span id="cb52-985"><a href="#cb52-985"></a>S = \sum\limits_{i=1}^n \sum\limits_{j=1}^{D(N_i)} X_{i,j}</span>
<span id="cb52-986"><a href="#cb52-986"></a>$$</span>
<span id="cb52-987"><a href="#cb52-987"></a></span>
<span id="cb52-988"><a href="#cb52-988"></a><span class="ss">5. </span>En otros casos más elaborados se segmenta el riesgo cubierto, al existir variables explicativas</span>
<span id="cb52-989"><a href="#cb52-989"></a>de la naturaleza del riesgo $Y_1, \ldots, Y_m$, las cuales pueden tomar valores en un conjunto $E$</span>
<span id="cb52-990"><a href="#cb52-990"></a>solo se toma un subconjunto de valores posibles $A\subset E$, para los cuales es válida la cobertura.</span>
<span id="cb52-991"><a href="#cb52-991"></a>Así, si un reclamo $X$ se explica o caracteriza por las variables anteriores, se configura el </span>
<span id="cb52-992"><a href="#cb52-992"></a>deducible:</span>
<span id="cb52-993"><a href="#cb52-993"></a>$$</span>
<span id="cb52-994"><a href="#cb52-994"></a>D( X ) = \mathbf{1}_{A}\left( Y_1, \ldots, Y_m \right) X</span>
<span id="cb52-995"><a href="#cb52-995"></a>$$</span>
<span id="cb52-996"><a href="#cb52-996"></a></span>
<span id="cb52-997"><a href="#cb52-997"></a>Un ejemplo del anterior deducible se da en el caso de seguros de salud, donde se cubre ciertos tipos</span>
<span id="cb52-998"><a href="#cb52-998"></a>de enfermedades, usualmente se evita las enfermedades de tipo catastrófico que estén ya presentes;</span>
<span id="cb52-999"><a href="#cb52-999"></a>en otros productos se evita los gastos odontológicos, etc.</span>
<span id="cb52-1000"><a href="#cb52-1000"></a></span>
<span id="cb52-1001"><a href="#cb52-1001"></a>Los deducibles, pueden ser configurados de forma genérica para todos los asegurados o incluso </span>
<span id="cb52-1002"><a href="#cb52-1002"></a>de forma personalizada por asegurado, según los productos que estos han adquirido. En general, al </span>
<span id="cb52-1003"><a href="#cb52-1003"></a>emplear deducibles para cada uno de los reclamos individuales, el reclamo total $S$ se ve modificado, </span>
<span id="cb52-1004"><a href="#cb52-1004"></a>y toma la forma:</span>
<span id="cb52-1005"><a href="#cb52-1005"></a>$$</span>
<span id="cb52-1006"><a href="#cb52-1006"></a>S = \sum\limits_{i=1}^{N} D_i\left( X_i \right)</span>
<span id="cb52-1007"><a href="#cb52-1007"></a>$$</span>
<span id="cb52-1008"><a href="#cb52-1008"></a>Hay casos donde se aplica el deducible al grupo de siniestros que presenta una póliza o grupo de </span>
<span id="cb52-1009"><a href="#cb52-1009"></a>pólizas. Esto precisamente se lo puede ver cuando se utiliza un modelo mixto de pérdida.</span>
<span id="cb52-1010"><a href="#cb52-1010"></a>$$</span>
<span id="cb52-1011"><a href="#cb52-1011"></a>S = \sum\limits_{i=1}^n D_i\left( \sum\limits_{n=1}^{N_i} X_{i,j} \right)</span>
<span id="cb52-1012"><a href="#cb52-1012"></a>$$</span>
<span id="cb52-1013"><a href="#cb52-1013"></a></span>
<span id="cb52-1014"><a href="#cb52-1014"></a>Es de notar, que la distribución acumulada de la variable aleatoria, correspondiente a los reclamos</span>
<span id="cb52-1015"><a href="#cb52-1015"></a>ya deducidos, comienza a presentar singularidades, esto complica el estudio del comportamiento de </span>
<span id="cb52-1016"><a href="#cb52-1016"></a>los reclamos totales.</span>
<span id="cb52-1017"><a href="#cb52-1017"></a></span>
<span id="cb52-1018"><a href="#cb52-1018"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-1019"><a href="#cb52-1019"></a><span class="fu">### Algoritmo de simulación</span></span>
<span id="cb52-1020"><a href="#cb52-1020"></a>Presentamos una adaptación sencilla de los algoritmos de simulación anterior, incluyendo el caso </span>
<span id="cb52-1021"><a href="#cb52-1021"></a>que se tenga un deducible aplicado de forma uniforme a todas las pólizas. </span>
<span id="cb52-1022"><a href="#cb52-1022"></a></span>
<span id="cb52-1023"><a href="#cb52-1023"></a><span class="ss">1. </span>Seleccionar el número de simulaciones $m$,</span>
<span id="cb52-1024"><a href="#cb52-1024"></a></span>
<span id="cb52-1025"><a href="#cb52-1025"></a><span class="ss">2. </span>Se genera una muestra de tamaño $m$ de variables $N_1, \ldots, N_m$ con ley $f_N$,</span>
<span id="cb52-1026"><a href="#cb52-1026"></a></span>
<span id="cb52-1027"><a href="#cb52-1027"></a><span class="ss">3. </span>Se genera para cada $i \in <span class="sc">\{</span>1,\ldots,m<span class="sc">\}</span>$ una muestra de tamaño $N_i$ de variables aleatorias </span>
<span id="cb52-1028"><a href="#cb52-1028"></a>$X_{i,1}, \ldots X_{i,N_i}$ con ley $f_X$,</span>
<span id="cb52-1029"><a href="#cb52-1029"></a></span>
<span id="cb52-1030"><a href="#cb52-1030"></a><span class="ss">4. </span>Se establece la función deducible $D : \R \longrightarrow \R_+$ y los parámetros y condiciones</span>
<span id="cb52-1031"><a href="#cb52-1031"></a>necesarias para su definición,</span>
<span id="cb52-1032"><a href="#cb52-1032"></a></span>
<span id="cb52-1033"><a href="#cb52-1033"></a><span class="ss">5. </span>Se calcula los reclamos totales utilizando el deducible $S_1, \ldots, S_m$ para cada simulación </span>
<span id="cb52-1034"><a href="#cb52-1034"></a>$i = <span class="sc">\{</span>1, \ldots, m<span class="sc">\}</span>$, mediante la siguiente suma $S_i = \sum\limits_{j=1}^{N_i} D\left( X_{i,j} \right)$,</span>
<span id="cb52-1035"><a href="#cb52-1035"></a></span>
<span id="cb52-1036"><a href="#cb52-1036"></a><span class="ss">6. </span>Para la determinación de varios estadísticos se puede utilizar la simulación generada $<span class="sc">\{</span>S_i<span class="sc">\}</span>$</span>
<span id="cb52-1037"><a href="#cb52-1037"></a>y generar la distribución de probabilidad empírica $F_m$.</span>
<span id="cb52-1038"><a href="#cb52-1038"></a></span>
<span id="cb52-1039"><a href="#cb52-1039"></a>::: {.example #l6ex6}</span>
<span id="cb52-1040"><a href="#cb52-1040"></a>Consideremos el caso de un modelo colectivo de pérdida donde el proceso de conteo </span>
<span id="cb52-1041"><a href="#cb52-1041"></a>$N \rightsquigarrow Pois( \lambda )$ y la sucesión $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ de reclamos individuales se considera </span>
<span id="cb52-1042"><a href="#cb52-1042"></a>conformada por variables i.i.d, con distribución de probabilidad $LN( \mu, \sigma )$. El deducible </span>
<span id="cb52-1043"><a href="#cb52-1043"></a>a aplicar será una función mixta de la forma $D( X ) = \min( \max( X - d, 0 ), M )$.</span>
<span id="cb52-1044"><a href="#cb52-1044"></a></span>
<span id="cb52-1045"><a href="#cb52-1045"></a><span class="in">```{r l6c7}</span></span>
<span id="cb52-1046"><a href="#cb52-1046"></a><span class="in"># 1. selección de simulaciones</span></span>
<span id="cb52-1047"><a href="#cb52-1047"></a><span class="in">m &lt;- 5e4</span></span>
<span id="cb52-1048"><a href="#cb52-1048"></a></span>
<span id="cb52-1049"><a href="#cb52-1049"></a><span class="in"># 2. especificación de los parámetros para las distribuciones</span></span>
<span id="cb52-1050"><a href="#cb52-1050"></a><span class="in">u &lt;- 2</span></span>
<span id="cb52-1051"><a href="#cb52-1051"></a><span class="in">s &lt;- 3</span></span>
<span id="cb52-1052"><a href="#cb52-1052"></a><span class="in">lambda &lt;- 6</span></span>
<span id="cb52-1053"><a href="#cb52-1053"></a></span>
<span id="cb52-1054"><a href="#cb52-1054"></a><span class="in"># 3. se especifica la función deducible</span></span>
<span id="cb52-1055"><a href="#cb52-1055"></a><span class="in">D &lt;- function( x, d, M ) {</span></span>
<span id="cb52-1056"><a href="#cb52-1056"></a><span class="in">  return( min( max( x - d, 0 ), M ) )</span></span>
<span id="cb52-1057"><a href="#cb52-1057"></a><span class="in">}</span></span>
<span id="cb52-1058"><a href="#cb52-1058"></a></span>
<span id="cb52-1059"><a href="#cb52-1059"></a><span class="in">set.seed( 312341 )</span></span>
<span id="cb52-1060"><a href="#cb52-1060"></a></span>
<span id="cb52-1061"><a href="#cb52-1061"></a><span class="in"># 4. simulación del conteo de siniestros</span></span>
<span id="cb52-1062"><a href="#cb52-1062"></a><span class="in">N &lt;- rpois( n = m, lambda = lambda )</span></span>
<span id="cb52-1063"><a href="#cb52-1063"></a></span>
<span id="cb52-1064"><a href="#cb52-1064"></a><span class="in"># 5. simulación de la severidad de los reclamos</span></span>
<span id="cb52-1065"><a href="#cb52-1065"></a><span class="in">X &lt;- lapply( N, FUN = function( n ) rlnorm( n, meanlog = u, sdlog = s ) )</span></span>
<span id="cb52-1066"><a href="#cb52-1066"></a></span>
<span id="cb52-1067"><a href="#cb52-1067"></a><span class="in"># 6. se aplica el deducible a los reclamos</span></span>
<span id="cb52-1068"><a href="#cb52-1068"></a><span class="in">d &lt;- 100</span></span>
<span id="cb52-1069"><a href="#cb52-1069"></a><span class="in">M &lt;- 1000</span></span>
<span id="cb52-1070"><a href="#cb52-1070"></a><span class="in">DX &lt;- lapply( X, FUN = function( x ) sapply( x, FUN = function( y ) D( y, d, M ) ) )</span></span>
<span id="cb52-1071"><a href="#cb52-1071"></a></span>
<span id="cb52-1072"><a href="#cb52-1072"></a><span class="in"># 7. reclamo total, agregación por cada simulación</span></span>
<span id="cb52-1073"><a href="#cb52-1073"></a><span class="in">S &lt;- sapply( X, FUN = function( x ) ifelse( length( x ) == 0, 0, sum( x, na.rm = TRUE ) ) )</span></span>
<span id="cb52-1074"><a href="#cb52-1074"></a><span class="in">DS &lt;- sapply( DX, FUN = function( x ) ifelse( length( x ) == 0, 0, sum( x, na.rm = TRUE ) ) )</span></span>
<span id="cb52-1075"><a href="#cb52-1075"></a><span class="in">```</span></span>
<span id="cb52-1076"><a href="#cb52-1076"></a></span>
<span id="cb52-1077"><a href="#cb52-1077"></a>El efecto del deducible sobre la distribución del reclamo es evidente, produciendo así una </span>
<span id="cb52-1078"><a href="#cb52-1078"></a>densidad multimodal, como se observa en el gráfico a continuación, en el mismo incluimos dos </span>
<span id="cb52-1079"><a href="#cb52-1079"></a>histogramas, uno correspondiente a los reclamos totales sin aplicar el deducible y el otro </span>
<span id="cb52-1080"><a href="#cb52-1080"></a>el histograma de los reclamos totales aplicados el deducible.</span>
<span id="cb52-1081"><a href="#cb52-1081"></a><span class="in">```{r l6g6}</span></span>
<span id="cb52-1082"><a href="#cb52-1082"></a><span class="in">#| warning: false</span></span>
<span id="cb52-1083"><a href="#cb52-1083"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-1084"><a href="#cb52-1084"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-1085"><a href="#cb52-1085"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-1086"><a href="#cb52-1086"></a><span class="in">smax &lt;- lambda * M</span></span>
<span id="cb52-1087"><a href="#cb52-1087"></a><span class="in">fmax &lt;- 0.002</span></span>
<span id="cb52-1088"><a href="#cb52-1088"></a></span>
<span id="cb52-1089"><a href="#cb52-1089"></a><span class="in">plt &lt;- ggplot( ) +</span></span>
<span id="cb52-1090"><a href="#cb52-1090"></a><span class="in">  geom_histogram( aes( S, after_stat( density ) ), fill = 'olivedrab3', colour = 'olivedrab4', alpha = 0.3, bins = nclass.FD( DS ) ) +</span></span>
<span id="cb52-1091"><a href="#cb52-1091"></a><span class="in">  geom_histogram( aes( DS, after_stat( density ) ), fill = 'dodgerblue3', colour = 'dodgerblue4', alpha = 0.6, bins = nclass.FD( DS ) ) +</span></span>
<span id="cb52-1092"><a href="#cb52-1092"></a><span class="in">  scale_x_continuous( breaks = seq( 0, smax, length = 7 ),</span></span>
<span id="cb52-1093"><a href="#cb52-1093"></a><span class="in">                      labels = formatC( seq( 0, smax, length = 7 ), digits = 2, format = 'f' ),</span></span>
<span id="cb52-1094"><a href="#cb52-1094"></a><span class="in">                      limits = c( 0, smax ),</span></span>
<span id="cb52-1095"><a href="#cb52-1095"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-1096"><a href="#cb52-1096"></a><span class="in">  scale_y_continuous( breaks = seq( 0, fmax, length = 11 ),</span></span>
<span id="cb52-1097"><a href="#cb52-1097"></a><span class="in">                      labels = formatC( seq( 0, fmax, length = 11 ), digits = 4, format = 'f' ),</span></span>
<span id="cb52-1098"><a href="#cb52-1098"></a><span class="in">                      limits = c( 0, fmax ),</span></span>
<span id="cb52-1099"><a href="#cb52-1099"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-1100"><a href="#cb52-1100"></a><span class="in">  xlab( TeX( "$s$" ) ) + </span></span>
<span id="cb52-1101"><a href="#cb52-1101"></a><span class="in">  ylab( TeX( "$f_S$" ) ) + </span></span>
<span id="cb52-1102"><a href="#cb52-1102"></a><span class="in">  theme_bw() +</span></span>
<span id="cb52-1103"><a href="#cb52-1103"></a><span class="in">  theme( legend.position = "none" )</span></span>
<span id="cb52-1104"><a href="#cb52-1104"></a><span class="in">plot( plt )</span></span>
<span id="cb52-1105"><a href="#cb52-1105"></a><span class="in">```</span></span>
<span id="cb52-1106"><a href="#cb52-1106"></a></span>
<span id="cb52-1107"><a href="#cb52-1107"></a>Es de notar que la probabilidad del evento $<span class="sc">\{</span>S=0<span class="sc">\}</span>$ no es nula y se debe a la aplicación del </span>
<span id="cb52-1108"><a href="#cb52-1108"></a>deducible.</span>
<span id="cb52-1109"><a href="#cb52-1109"></a>$$</span>
<span id="cb52-1110"><a href="#cb52-1110"></a>\begin{split}</span>
<span id="cb52-1111"><a href="#cb52-1111"></a>P( S = 0 )</span>
<span id="cb52-1112"><a href="#cb52-1112"></a>&amp; = P\left( \left<span class="sc">\{</span> S = 0 \middle| N \in \N \right<span class="sc">\}</span> \right) <span class="sc">\\</span></span>
<span id="cb52-1113"><a href="#cb52-1113"></a>&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left<span class="sc">\{</span> S = 0 \land N = n \right<span class="sc">\}</span> \right) <span class="sc">\\</span></span>
<span id="cb52-1114"><a href="#cb52-1114"></a>&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left<span class="sc">\{</span> D( X_1 ) + \cdots + D( X_N ) = 0 \land N = n \right<span class="sc">\}</span> \right) <span class="sc">\\</span></span>
<span id="cb52-1115"><a href="#cb52-1115"></a>&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left<span class="sc">\{</span> X_1 \leq d \land \cdots \land X_N \leq d \land N = n \right<span class="sc">\}</span> \right) <span class="sc">\\</span></span>
<span id="cb52-1116"><a href="#cb52-1116"></a>&amp; = \sum\limits_{n=0}^{+\infty} P\left( X_1 \leq d \land \cdots \land X_N \leq d \land N = n \right) <span class="sc">\\</span></span>
<span id="cb52-1117"><a href="#cb52-1117"></a>&amp; = \sum\limits_{n=0}^{+\infty} P\left( X_1 \leq d \land \cdots \land X_n \leq d \middle| N = n \right)P( N = n ) <span class="sc">\\</span></span>
<span id="cb52-1118"><a href="#cb52-1118"></a>&amp; = \sum\limits_{n=0}^{+\infty} P\left( X_1 \leq d \land \cdots \land X_n \leq d \right) P( N = n ) <span class="sc">\\</span></span>
<span id="cb52-1119"><a href="#cb52-1119"></a>&amp; = \sum\limits_{n=0}^{+\infty} P\left( X \leq d \right)^n p_n <span class="sc">\\</span></span>
<span id="cb52-1120"><a href="#cb52-1120"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> P\left( X \leq d \right)^N \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-1121"><a href="#cb52-1121"></a>&amp; \approx \sum\limits_{n=0}^{n'} P( X \leq d )^n p_n,\quad </span>
<span id="cb52-1122"><a href="#cb52-1122"></a>\text{para un valor $n'$ suficientemente grande}</span>
<span id="cb52-1123"><a href="#cb52-1123"></a>\end{split}</span>
<span id="cb52-1124"><a href="#cb52-1124"></a>$$</span>
<span id="cb52-1125"><a href="#cb52-1125"></a><span class="in">```{r l6c8}</span></span>
<span id="cb52-1126"><a href="#cb52-1126"></a><span class="in">np &lt;- 1e3</span></span>
<span id="cb52-1127"><a href="#cb52-1127"></a><span class="in">ns &lt;- 0:np</span></span>
<span id="cb52-1128"><a href="#cb52-1128"></a><span class="in">PS0 &lt;- sum( ( plnorm( d, meanlog = u, sdlog = s )^ns ) * dpois( ns, lambda = lambda ) )</span></span>
<span id="cb52-1129"><a href="#cb52-1129"></a><span class="in">```</span></span>
<span id="cb52-1130"><a href="#cb52-1130"></a>$$</span>
<span id="cb52-1131"><a href="#cb52-1131"></a>P( S = 0 ) = <span class="in">`r formatC( PS0, digits = 9, format = 'f' )`</span></span>
<span id="cb52-1132"><a href="#cb52-1132"></a>$$</span>
<span id="cb52-1133"><a href="#cb52-1133"></a></span>
<span id="cb52-1134"><a href="#cb52-1134"></a>Así mismo, se puede estudiar el evento extremo, caso en el cual se paga el valor máximo que admite </span>
<span id="cb52-1135"><a href="#cb52-1135"></a>el deducible, en este caso en particular es $M$ por cada siniestro y si se producen $n$, entonces</span>
<span id="cb52-1136"><a href="#cb52-1136"></a>como máximo se pagara $n M$. Por tanto, nos interesa la probabilidad del evento </span>
<span id="cb52-1137"><a href="#cb52-1137"></a>$<span class="sc">\{</span> S\ \text{es máximo} <span class="sc">\}</span>$, el cual lo podemos calcular como:</span>
<span id="cb52-1138"><a href="#cb52-1138"></a>$$</span>
<span id="cb52-1139"><a href="#cb52-1139"></a>\begin{split}</span>
<span id="cb52-1140"><a href="#cb52-1140"></a>P( S\ \text{es máximo} )</span>
<span id="cb52-1141"><a href="#cb52-1141"></a>&amp; = P\left( \left<span class="sc">\{</span> S = NM \middle| N \in \N \right<span class="sc">\}</span> \right) <span class="sc">\\</span></span>
<span id="cb52-1142"><a href="#cb52-1142"></a>&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left<span class="sc">\{</span> S = N M \land N = n \right<span class="sc">\}</span> \right) <span class="sc">\\</span></span>
<span id="cb52-1143"><a href="#cb52-1143"></a>&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left<span class="sc">\{</span> D( X_1 ) + \cdots + D( X_N ) = N M \land N = n \right<span class="sc">\}</span> \right) <span class="sc">\\</span></span>
<span id="cb52-1144"><a href="#cb52-1144"></a>&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left<span class="sc">\{</span> X_1 - d &gt; M \land \cdots \land X_N - d  \geq M \land N = n \right<span class="sc">\}</span> \right) <span class="sc">\\</span></span>
<span id="cb52-1145"><a href="#cb52-1145"></a>&amp; = P\left( \bigcup\limits_{n=0}^{+\infty} \left<span class="sc">\{</span> X_1 &gt; M + d \land \cdots \land X_N \geq M + d \land N = n \right<span class="sc">\}</span> \right) <span class="sc">\\</span></span>
<span id="cb52-1146"><a href="#cb52-1146"></a>&amp; = \sum\limits_{n=0}^{+\infty} P\left( X_1 &gt; M + d \land \cdots \land X_N &gt; M + d \land N = n \right) <span class="sc">\\</span></span>
<span id="cb52-1147"><a href="#cb52-1147"></a>&amp; = \sum\limits_{n=0}^{+\infty} P\left( X_1 &gt; M + d \land \cdots \land X_n &gt; M + d \middle| N = n \right) P( N = n ) <span class="sc">\\</span></span>
<span id="cb52-1148"><a href="#cb52-1148"></a>&amp; = \sum\limits_{n=0}^{+\infty} P\left( X_1 &gt; M + d \land \cdots \land X_n &gt; M + d \right) P( N = n ) <span class="sc">\\</span></span>
<span id="cb52-1149"><a href="#cb52-1149"></a>&amp; = \sum\limits_{n=0}^{+\infty} P\left( X &gt; M + d \right)^n p_n <span class="sc">\\</span></span>
<span id="cb52-1150"><a href="#cb52-1150"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> P\left( X &gt; M + d \right)^N \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-1151"><a href="#cb52-1151"></a>&amp; \approx \sum\limits_{n=0}^{n'} P( X &gt; M + d )^n p_n,\quad </span>
<span id="cb52-1152"><a href="#cb52-1152"></a>\text{para un valor $n'$ suficientemente grande}</span>
<span id="cb52-1153"><a href="#cb52-1153"></a>\end{split}</span>
<span id="cb52-1154"><a href="#cb52-1154"></a>$$</span>
<span id="cb52-1155"><a href="#cb52-1155"></a></span>
<span id="cb52-1156"><a href="#cb52-1156"></a><span class="in">```{r l6c9}</span></span>
<span id="cb52-1157"><a href="#cb52-1157"></a><span class="in">PSmax &lt;- sum( ( ( 1 - plnorm( M + d, meanlog = u, sdlog = s ) )^ns ) * dpois( ns, lambda = lambda ) )</span></span>
<span id="cb52-1158"><a href="#cb52-1158"></a><span class="in">```</span></span>
<span id="cb52-1159"><a href="#cb52-1159"></a>$$</span>
<span id="cb52-1160"><a href="#cb52-1160"></a>P( S\ \text{es máximo} ) = <span class="in">`r formatC( PSmax, digits = 9, format = 'f' )`</span></span>
<span id="cb52-1161"><a href="#cb52-1161"></a>$$</span>
<span id="cb52-1162"><a href="#cb52-1162"></a>Además, podemos calcular el valor máximo esperado de $S$:</span>
<span id="cb52-1163"><a href="#cb52-1163"></a>$$</span>
<span id="cb52-1164"><a href="#cb52-1164"></a>\begin{split}</span>
<span id="cb52-1165"><a href="#cb52-1165"></a>\E\left<span class="co">[</span><span class="ot"> S \middle| S\ \text{es máximo} \right</span><span class="co">]</span></span>
<span id="cb52-1166"><a href="#cb52-1166"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> S \middle| \left\{ S = NM \middle| N \in \N \right\} \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-1167"><a href="#cb52-1167"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> S \middle| \bigcup\limits_{n=0}^{+\infty} \left\{ S = NM \land N = n \right\} \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-1168"><a href="#cb52-1168"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> NM \middle| \bigcup\limits_{n=0}^{+\infty} \left\{ N = n \right\} \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-1169"><a href="#cb52-1169"></a>&amp; = \sum\limits_{n=0}^{+\infty} \E\left<span class="co">[</span><span class="ot"> n M \middle| N = n \right</span><span class="co">]</span> P( N = n ) <span class="sc">\\</span></span>
<span id="cb52-1170"><a href="#cb52-1170"></a>&amp; = \sum\limits_{n=0}^{+\infty} n M P( N = n ) <span class="sc">\\</span></span>
<span id="cb52-1171"><a href="#cb52-1171"></a>&amp; = M \sum\limits_{n=0}^{+\infty} n P( N = n ) <span class="sc">\\</span></span>
<span id="cb52-1172"><a href="#cb52-1172"></a>&amp; = M \E\left<span class="co">[</span><span class="ot"> N \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-1173"><a href="#cb52-1173"></a>\end{split}</span>
<span id="cb52-1174"><a href="#cb52-1174"></a>$$</span>
<span id="cb52-1175"><a href="#cb52-1175"></a><span class="in">```{r l6c10}</span></span>
<span id="cb52-1176"><a href="#cb52-1176"></a><span class="in">ESmax &lt;- M * sum( ns * dpois( ns, lambda = lambda ) )</span></span>
<span id="cb52-1177"><a href="#cb52-1177"></a><span class="in">```</span></span>
<span id="cb52-1178"><a href="#cb52-1178"></a>$$</span>
<span id="cb52-1179"><a href="#cb52-1179"></a>\E\left<span class="co">[</span><span class="ot"> S \middle| S\ \text{es máximo} \right</span><span class="co">]</span> = <span class="in">`r formatC( ESmax, digits = 2, format = 'f' )`</span></span>
<span id="cb52-1180"><a href="#cb52-1180"></a>$$</span>
<span id="cb52-1181"><a href="#cb52-1181"></a></span>
<span id="cb52-1182"><a href="#cb52-1182"></a>De este razonamiento se puede evidenciar que al aplicar un deducible con cota superior, se corta </span>
<span id="cb52-1183"><a href="#cb52-1183"></a>la cola de la distribución y por tal razón no se puede esperar valores extremos por parte de la </span>
<span id="cb52-1184"><a href="#cb52-1184"></a>severidad, sino tan solo por un aumento de frecuencia, e incluso el valor máximo esperado es </span>
<span id="cb52-1185"><a href="#cb52-1185"></a>proporcional a la cota superior $M$ veces la frecuencia esperada. De ahí que, al aplicar un </span>
<span id="cb52-1186"><a href="#cb52-1186"></a>deducible con cota superior no se puede esperar un encarecimiento de primas por aumento de </span>
<span id="cb52-1187"><a href="#cb52-1187"></a>severidad, ya que los reclamos están acotados, así como el máximo esperado; lo único que puede</span>
<span id="cb52-1188"><a href="#cb52-1188"></a>encarecer la prima es un aumento de frecuencia.</span>
<span id="cb52-1189"><a href="#cb52-1189"></a></span>
<span id="cb52-1190"><a href="#cb52-1190"></a>Como ya se lo mencionó, utilizando la simulación $<span class="sc">\{</span>S_i<span class="sc">\}</span>$ podemos determinar la distribución de </span>
<span id="cb52-1191"><a href="#cb52-1191"></a>probabilidad empírica $F_m$ que aproxima la distribución de $F_S$.</span>
<span id="cb52-1192"><a href="#cb52-1192"></a><span class="in">```{r l6c11}</span></span>
<span id="cb52-1193"><a href="#cb52-1193"></a><span class="in">FeS &lt;- ecdf( S )</span></span>
<span id="cb52-1194"><a href="#cb52-1194"></a><span class="in">FeDS &lt;- ecdf( DS )</span></span>
<span id="cb52-1195"><a href="#cb52-1195"></a><span class="in">s &lt;- seq( 0, ESmax, length = 1000 )</span></span>
<span id="cb52-1196"><a href="#cb52-1196"></a><span class="in">Fes &lt;- sapply( s, FUN = FeS )</span></span>
<span id="cb52-1197"><a href="#cb52-1197"></a><span class="in">FeDs &lt;- sapply( s, FUN = FeDS )</span></span>
<span id="cb52-1198"><a href="#cb52-1198"></a><span class="in">```</span></span>
<span id="cb52-1199"><a href="#cb52-1199"></a></span>
<span id="cb52-1200"><a href="#cb52-1200"></a><span class="in">```{r l6g7}</span></span>
<span id="cb52-1201"><a href="#cb52-1201"></a><span class="in">#| warning: false</span></span>
<span id="cb52-1202"><a href="#cb52-1202"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-1203"><a href="#cb52-1203"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-1204"><a href="#cb52-1204"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-1205"><a href="#cb52-1205"></a><span class="in">Smax &lt;- ESmax</span></span>
<span id="cb52-1206"><a href="#cb52-1206"></a></span>
<span id="cb52-1207"><a href="#cb52-1207"></a><span class="in">xbrk &lt;- sort( unique( c( d, M, seq( 0, Smax, length = 7 ) ) ) )</span></span>
<span id="cb52-1208"><a href="#cb52-1208"></a><span class="in">xlbl &lt;- formatC( xbrk, digits = 0, format = 'f' )</span></span>
<span id="cb52-1209"><a href="#cb52-1209"></a><span class="in">xlim &lt;- c( 0, Smax )</span></span>
<span id="cb52-1210"><a href="#cb52-1210"></a></span>
<span id="cb52-1211"><a href="#cb52-1211"></a><span class="in">ybrk &lt;- seq( 0, 1, length = 11 )</span></span>
<span id="cb52-1212"><a href="#cb52-1212"></a><span class="in">ylbl &lt;- formatC( ybrk, digits = 2, format = 'f' )</span></span>
<span id="cb52-1213"><a href="#cb52-1213"></a><span class="in">ylim &lt;- c( 0, 1 )</span></span>
<span id="cb52-1214"><a href="#cb52-1214"></a></span>
<span id="cb52-1215"><a href="#cb52-1215"></a><span class="in">plt &lt;- ggplot( ) +</span></span>
<span id="cb52-1216"><a href="#cb52-1216"></a><span class="in">  geom_step( aes( x = s, y = Fes, colour = 'a' ), linewidth = 1 ) +</span></span>
<span id="cb52-1217"><a href="#cb52-1217"></a><span class="in">  geom_step( aes( x = s, y = FeDs, colour = 'b' ), linewidth = 1 ) +</span></span>
<span id="cb52-1218"><a href="#cb52-1218"></a><span class="in">  geom_vline( xintercept = c( d, M ), colour = 'orange', linewidth = 0.7 ) +</span></span>
<span id="cb52-1219"><a href="#cb52-1219"></a><span class="in">  geom_point( aes( 0, PS0 ), colour = 'red3', size = 3 ) +</span></span>
<span id="cb52-1220"><a href="#cb52-1220"></a><span class="in">  scale_colour_manual( breaks = c( 'a', 'b' ),</span></span>
<span id="cb52-1221"><a href="#cb52-1221"></a><span class="in">                       values = c( 'olivedrab4', 'dodgerblue4' ) ) +</span></span>
<span id="cb52-1222"><a href="#cb52-1222"></a><span class="in">  scale_x_continuous( breaks = xbrk,</span></span>
<span id="cb52-1223"><a href="#cb52-1223"></a><span class="in">                      labels = xlbl, </span></span>
<span id="cb52-1224"><a href="#cb52-1224"></a><span class="in">                      limits = xlim, </span></span>
<span id="cb52-1225"><a href="#cb52-1225"></a><span class="in">                      expand = c( 0.008, 0.008 ) ) +</span></span>
<span id="cb52-1226"><a href="#cb52-1226"></a><span class="in">  scale_y_continuous( breaks = ybrk,</span></span>
<span id="cb52-1227"><a href="#cb52-1227"></a><span class="in">                      labels = ylbl, </span></span>
<span id="cb52-1228"><a href="#cb52-1228"></a><span class="in">                      limits = ylim, </span></span>
<span id="cb52-1229"><a href="#cb52-1229"></a><span class="in">                      expand = c( 0.005, 0.005 ) ) +</span></span>
<span id="cb52-1230"><a href="#cb52-1230"></a><span class="in">  xlab( TeX( "$s$" ) ) + </span></span>
<span id="cb52-1231"><a href="#cb52-1231"></a><span class="in">  ylab( TeX( "$F_{S,m},F_{S^D,m}$" ) ) + </span></span>
<span id="cb52-1232"><a href="#cb52-1232"></a><span class="in">  theme_bw() +</span></span>
<span id="cb52-1233"><a href="#cb52-1233"></a><span class="in">  theme( legend.position = "none" )</span></span>
<span id="cb52-1234"><a href="#cb52-1234"></a><span class="in">plot( plt )</span></span>
<span id="cb52-1235"><a href="#cb52-1235"></a><span class="in">```</span></span>
<span id="cb52-1236"><a href="#cb52-1236"></a>:::</span>
<span id="cb52-1237"><a href="#cb52-1237"></a></span>
<span id="cb52-1238"><a href="#cb52-1238"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-1239"><a href="#cb52-1239"></a><span class="fu">## Algoritmo de Panjer {#algoritmo_panjer}</span></span>
<span id="cb52-1240"><a href="#cb52-1240"></a></span>
<span id="cb52-1241"><a href="#cb52-1241"></a>El siguiente algoritmo es de especial interés para determinar la densidad de probabilidad $f_S$ del</span>
<span id="cb52-1242"><a href="#cb52-1242"></a>total de reclamos $S$. Se asume que el conteo de siniestro $N$ viene dado por alguna de las </span>
<span id="cb52-1243"><a href="#cb52-1243"></a>distribuciones en la familia $(a,b,0)$ y los reclamos individuales son $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son i.i.d y </span>
<span id="cb52-1244"><a href="#cb52-1244"></a>también independientes de $N$. En ese contexto podemos observar que para cualquier $s &gt; 0$, tenemos:</span>
<span id="cb52-1245"><a href="#cb52-1245"></a>$$</span>
<span id="cb52-1246"><a href="#cb52-1246"></a>\begin{split}</span>
<span id="cb52-1247"><a href="#cb52-1247"></a>f_S( s ) </span>
<span id="cb52-1248"><a href="#cb52-1248"></a>&amp; = \sum\limits_{n=1}^{+\infty} p_n f_X^{\star n}( s ) <span class="sc">\\</span></span>
<span id="cb52-1249"><a href="#cb52-1249"></a>&amp; = p_1 f_X( s ) + \sum\limits_{n=2}^{+\infty} p_n f_X^{\star n}( s ) <span class="sc">\\</span></span>
<span id="cb52-1250"><a href="#cb52-1250"></a>&amp; = p_1 f_X( s ) + \sum\limits_{n=1}^{+\infty} p_{n+1} f_X^{\star n + 1}( s ) <span class="sc">\\</span></span>
<span id="cb52-1251"><a href="#cb52-1251"></a>&amp; = p_1 f_X( s ) + \sum\limits_{n=1}^{+\infty} \left( a + \frac{b}{n+1} \right) p_{n} f_X^{\star n + 1}( s ) <span class="sc">\\</span></span>
<span id="cb52-1252"><a href="#cb52-1252"></a>&amp; = p_1 f_X( s ) </span>
<span id="cb52-1253"><a href="#cb52-1253"></a><span class="ss">+ </span>\sum\limits_{n=1}^{+\infty} p_{n} \int\limits_0^s \left( a + \frac{b y}{s} \right) f_X( y ) f_X^{\star n}( s - y )\ dy <span class="sc">\\</span></span>
<span id="cb52-1254"><a href="#cb52-1254"></a>&amp; = p_1 f_X( s ) </span>
<span id="cb52-1255"><a href="#cb52-1255"></a><span class="ss">+ </span>\int\limits_0^s \left( a + \frac{b y}{s} \right) f_X( y ) \sum\limits_{n=1}^{+\infty} p_{n} f_X^{\star n}( s - y )\ dy <span class="sc">\\</span></span>
<span id="cb52-1256"><a href="#cb52-1256"></a>&amp; = p_1 f_X( s ) + \int\limits_0^s \left( a + \frac{b y}{s} \right) f_X( y ) f_S( s - y )\ dy</span>
<span id="cb52-1257"><a href="#cb52-1257"></a>\end{split}</span>
<span id="cb52-1258"><a href="#cb52-1258"></a>$$</span>
<span id="cb52-1259"><a href="#cb52-1259"></a>cuando $s = 0$, la probabilidad se concentra en $0$, y por tanto $f_S( 0 ) = p_0$</span>
<span id="cb52-1260"><a href="#cb52-1260"></a></span>
<span id="cb52-1261"><a href="#cb52-1261"></a>Como consecuencia del análisis anterior resulta la relación recurrente, la cual es precisamente</span>
<span id="cb52-1262"><a href="#cb52-1262"></a>explotada de forma numérica por el algoritmo de Panjer.</span>
<span id="cb52-1263"><a href="#cb52-1263"></a>$$</span>
<span id="cb52-1264"><a href="#cb52-1264"></a>f_S( s ) = p_1 f_X( s ) + \int\limits_0^s \left( a + \frac{b y}{s} \right) f_X( y ) f_S( s - y )\ dy,</span>
<span id="cb52-1265"><a href="#cb52-1265"></a>\qquad \forall s &gt; 0</span>
<span id="cb52-1266"><a href="#cb52-1266"></a>$$</span>
<span id="cb52-1267"><a href="#cb52-1267"></a></span>
<span id="cb52-1268"><a href="#cb52-1268"></a>Si se toma una discretización $0 = s_0 &lt; s_1 &lt; \cdots &lt; s_n$ para aproximar la integral anterior</span>
<span id="cb52-1269"><a href="#cb52-1269"></a>$$</span>
<span id="cb52-1270"><a href="#cb52-1270"></a>f_S\left( s_k \right) </span>
<span id="cb52-1271"><a href="#cb52-1271"></a>= p_1 f_X\left( s_k \right) + \sum\limits_{i=0}^{k-1} \left( a + \frac{b s_i}{s_k} \right) </span>
<span id="cb52-1272"><a href="#cb52-1272"></a>f_X\left( s_i \right) f_S\left( s_{k-i} \right) \left( s_{i+1} - s_i \right)</span>
<span id="cb52-1273"><a href="#cb52-1273"></a>$$</span>
<span id="cb52-1274"><a href="#cb52-1274"></a></span>
<span id="cb52-1275"><a href="#cb52-1275"></a>Al tomar un división uniforme para la malla utilizada para aproximar la integral, por ejemplo, </span>
<span id="cb52-1276"><a href="#cb52-1276"></a>$s_k = k h$, tenemos que: </span>
<span id="cb52-1277"><a href="#cb52-1277"></a>$$</span>
<span id="cb52-1278"><a href="#cb52-1278"></a>f_S\left( s_k \right) </span>
<span id="cb52-1279"><a href="#cb52-1279"></a>= p_1 f_X\left( s_k \right) + h \sum\limits_{i=0}^{k-1} \left( a + \frac{b i}{k} \right) </span>
<span id="cb52-1280"><a href="#cb52-1280"></a>f_X\left( s_i \right) f_S\left( s_{k-i} \right)</span>
<span id="cb52-1281"><a href="#cb52-1281"></a>$$</span>
<span id="cb52-1282"><a href="#cb52-1282"></a>de donde resulta una forma bien conocida para el algoritmo de Panjer. sin embargo, es importante</span>
<span id="cb52-1283"><a href="#cb52-1283"></a>tener en cuenta que una malla de paso no constante puede ser mejor adaptada para realizar la </span>
<span id="cb52-1284"><a href="#cb52-1284"></a>integral.</span>
<span id="cb52-1285"><a href="#cb52-1285"></a></span>
<span id="cb52-1286"><a href="#cb52-1286"></a>::: {.example #l6ex7}</span>
<span id="cb52-1287"><a href="#cb52-1287"></a>Consideremos el caso para un reclamo total $S$ donde el conteo de los siniestros </span>
<span id="cb52-1288"><a href="#cb52-1288"></a>$N \rightsquigarrow NBin( \alpha, p )$ y las severidades $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son i.i.d con distribución </span>
<span id="cb52-1289"><a href="#cb52-1289"></a>$LN( \mu, \sigma )$. Utilizaremos el algoritmo de Panjer para aproximar la densidad de probabilidad</span>
<span id="cb52-1290"><a href="#cb52-1290"></a>de $f_S$ de $S$.</span>
<span id="cb52-1291"><a href="#cb52-1291"></a><span class="in">```{r l6c12}</span></span>
<span id="cb52-1292"><a href="#cb52-1292"></a><span class="in">n &lt;- 7e4</span></span>
<span id="cb52-1293"><a href="#cb52-1293"></a><span class="in">p &lt;- 0.3</span></span>
<span id="cb52-1294"><a href="#cb52-1294"></a><span class="in">alpha &lt;- 3</span></span>
<span id="cb52-1295"><a href="#cb52-1295"></a><span class="in">a &lt;- 1 - p</span></span>
<span id="cb52-1296"><a href="#cb52-1296"></a><span class="in">b &lt;- ( 1 - p ) * ( alpha - 1 )</span></span>
<span id="cb52-1297"><a href="#cb52-1297"></a><span class="in">p0 &lt;- p^alpha</span></span>
<span id="cb52-1298"><a href="#cb52-1298"></a><span class="in">u &lt;- 5</span></span>
<span id="cb52-1299"><a href="#cb52-1299"></a><span class="in">s &lt;- 0.3</span></span>
<span id="cb52-1300"><a href="#cb52-1300"></a><span class="in">smax &lt;- 5e3</span></span>
<span id="cb52-1301"><a href="#cb52-1301"></a><span class="in">dist &lt;- dlnorm</span></span>
<span id="cb52-1302"><a href="#cb52-1302"></a></span>
<span id="cb52-1303"><a href="#cb52-1303"></a><span class="in">pardist &lt;- list( meanlog = u, sdlog = s )</span></span>
<span id="cb52-1304"><a href="#cb52-1304"></a><span class="in">sg &lt;- seq( 0, smax, length = n )</span></span>
<span id="cb52-1305"><a href="#cb52-1305"></a><span class="in">ds &lt;- diff( sg )</span></span>
<span id="cb52-1306"><a href="#cb52-1306"></a><span class="in">fX &lt;- sapply( sg, FUN = function( y ) do.call( dist, c( y, pardist ) ) )</span></span>
<span id="cb52-1307"><a href="#cb52-1307"></a></span>
<span id="cb52-1308"><a href="#cb52-1308"></a><span class="in">fS &lt;- p0</span></span>
<span id="cb52-1309"><a href="#cb52-1309"></a><span class="in">K &lt;- 1</span></span>
<span id="cb52-1310"><a href="#cb52-1310"></a><span class="in">p1 &lt;- ( a + b ) * p0</span></span>
<span id="cb52-1311"><a href="#cb52-1311"></a><span class="in">for ( k in 2:n ) {</span></span>
<span id="cb52-1312"><a href="#cb52-1312"></a><span class="in">  fS &lt;- c( fS, p1 * fX[ k ] + sum( ( a + b * sg[ K ] / sg[ k ] ) * fX[ K ] * fS[ rev( K ) ] * ds[ K ] ) )</span></span>
<span id="cb52-1313"><a href="#cb52-1313"></a><span class="in">  K &lt;- c( K, k )</span></span>
<span id="cb52-1314"><a href="#cb52-1314"></a><span class="in">}</span></span>
<span id="cb52-1315"><a href="#cb52-1315"></a></span>
<span id="cb52-1316"><a href="#cb52-1316"></a><span class="in">set.seed( 32141223 )</span></span>
<span id="cb52-1317"><a href="#cb52-1317"></a><span class="in">m &lt;- 1e5</span></span>
<span id="cb52-1318"><a href="#cb52-1318"></a><span class="in">N &lt;- rnbinom( n = m, size = alpha, prob = p )</span></span>
<span id="cb52-1319"><a href="#cb52-1319"></a><span class="in">X &lt;- lapply( N, FUN = function( n ) rlnorm( n, meanlog = u, sdlog = s ) )</span></span>
<span id="cb52-1320"><a href="#cb52-1320"></a><span class="in">S &lt;- sapply( X, FUN = function( x ) sum( x, na.rm = TRUE ) )</span></span>
<span id="cb52-1321"><a href="#cb52-1321"></a><span class="in">```</span></span>
<span id="cb52-1322"><a href="#cb52-1322"></a></span>
<span id="cb52-1323"><a href="#cb52-1323"></a>El algoritmo de Panjer suele tener problemas para ajustarse en los primeros valores de la </span>
<span id="cb52-1324"><a href="#cb52-1324"></a>densidad $f_S$, tal como lo muestra el gráfico a continuación, usualmente hay una sobre estimación.</span>
<span id="cb52-1325"><a href="#cb52-1325"></a>Además, el algoritmo solo es válido cuando el conteo de siniestros pertenece a la familia</span>
<span id="cb52-1326"><a href="#cb52-1326"></a>de distribuciones $(a,b,0)$.</span>
<span id="cb52-1327"><a href="#cb52-1327"></a><span class="in">```{r l6g8}</span></span>
<span id="cb52-1328"><a href="#cb52-1328"></a><span class="in">#| warning: false</span></span>
<span id="cb52-1329"><a href="#cb52-1329"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-1330"><a href="#cb52-1330"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-1331"><a href="#cb52-1331"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-1332"><a href="#cb52-1332"></a><span class="in">fmax &lt;- 0.0007</span></span>
<span id="cb52-1333"><a href="#cb52-1333"></a></span>
<span id="cb52-1334"><a href="#cb52-1334"></a><span class="in">plt &lt;- ggplot( ) +</span></span>
<span id="cb52-1335"><a href="#cb52-1335"></a><span class="in">  geom_histogram( aes( S, after_stat( density ) ), fill = 'dodgerblue4', colour = 'white', alpha = 0.6, bins = nclass.FD( S ) ) +</span></span>
<span id="cb52-1336"><a href="#cb52-1336"></a><span class="in">  geom_line( aes( x = sg, y = fS ), colour = 'purple3', linewidth = 1 ) +</span></span>
<span id="cb52-1337"><a href="#cb52-1337"></a><span class="in">  scale_x_continuous( breaks = seq( 0, smax, length = 7 ),</span></span>
<span id="cb52-1338"><a href="#cb52-1338"></a><span class="in">                      labels = formatC( seq( 0, smax, length = 7 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-1339"><a href="#cb52-1339"></a><span class="in">                      limits = c( 0, smax ), </span></span>
<span id="cb52-1340"><a href="#cb52-1340"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-1341"><a href="#cb52-1341"></a><span class="in">  scale_y_continuous( breaks = seq( 0, fmax, length = 11 ),</span></span>
<span id="cb52-1342"><a href="#cb52-1342"></a><span class="in">                      labels = formatC( seq( 0, fmax, length = 11 ), digits = 4, format = 'f' ),</span></span>
<span id="cb52-1343"><a href="#cb52-1343"></a><span class="in">                      limits = c( 0, fmax ),</span></span>
<span id="cb52-1344"><a href="#cb52-1344"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-1345"><a href="#cb52-1345"></a><span class="in">  xlab( TeX( "$s$" ) ) + </span></span>
<span id="cb52-1346"><a href="#cb52-1346"></a><span class="in">  ylab( TeX( "$f_S$" ) ) + </span></span>
<span id="cb52-1347"><a href="#cb52-1347"></a><span class="in">  theme_bw() +</span></span>
<span id="cb52-1348"><a href="#cb52-1348"></a><span class="in">  theme( legend.position = "none" )</span></span>
<span id="cb52-1349"><a href="#cb52-1349"></a><span class="in">plot( plt )</span></span>
<span id="cb52-1350"><a href="#cb52-1350"></a><span class="in">```</span></span>
<span id="cb52-1351"><a href="#cb52-1351"></a></span>
<span id="cb52-1352"><a href="#cb52-1352"></a><span class="in">```{r l6g9}</span></span>
<span id="cb52-1353"><a href="#cb52-1353"></a><span class="in">#| warning: false</span></span>
<span id="cb52-1354"><a href="#cb52-1354"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-1355"><a href="#cb52-1355"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-1356"><a href="#cb52-1356"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-1357"><a href="#cb52-1357"></a><span class="in">e &lt;- cumsum( fS[ -1 ] * ds ) - ecdf( S )( sg[ -1 ] )</span></span>
<span id="cb52-1358"><a href="#cb52-1358"></a></span>
<span id="cb52-1359"><a href="#cb52-1359"></a><span class="in">eb &lt;- max( abs( e ) )</span></span>
<span id="cb52-1360"><a href="#cb52-1360"></a></span>
<span id="cb52-1361"><a href="#cb52-1361"></a><span class="in">plt &lt;- ggplot() +</span></span>
<span id="cb52-1362"><a href="#cb52-1362"></a><span class="in">  geom_histogram( aes( x = e, y = after_stat( density ) ), fill = 'grey50', colour = 'dodgerblue3', bins = nclass.scott( e ) ) +</span></span>
<span id="cb52-1363"><a href="#cb52-1363"></a><span class="in">  scale_y_continuous( labels = label_scientific( digits = 2 ) ) +</span></span>
<span id="cb52-1364"><a href="#cb52-1364"></a><span class="in">  ylab( TeX( "$e$" ) ) +</span></span>
<span id="cb52-1365"><a href="#cb52-1365"></a><span class="in">  theme_bw()</span></span>
<span id="cb52-1366"><a href="#cb52-1366"></a><span class="in">plot( plt )</span></span>
<span id="cb52-1367"><a href="#cb52-1367"></a><span class="in">```</span></span>
<span id="cb52-1368"><a href="#cb52-1368"></a>:::</span>
<span id="cb52-1369"><a href="#cb52-1369"></a></span>
<span id="cb52-1370"><a href="#cb52-1370"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-1371"><a href="#cb52-1371"></a><span class="fu">## Estimación usando la transformada de Fourier {#estimacion_transformada_fourier}</span></span>
<span id="cb52-1372"><a href="#cb52-1372"></a></span>
<span id="cb52-1373"><a href="#cb52-1373"></a>Se puede utilizar la transformada de Fourier para determinar la densidad de la suma </span>
<span id="cb52-1374"><a href="#cb52-1374"></a>$S_n = \sum\limits_{i=1}^n X_i$ de varias variables aleatorias </span>
<span id="cb52-1375"><a href="#cb52-1375"></a>$X_1 \rightsquigarrow f_{X_1}, \ldots, X_n \rightsquigarrow f_{X_n}$ que son independientes, pero </span>
<span id="cb52-1376"><a href="#cb52-1376"></a>que podrían ser o no idénticamente distribuidas. Claramente, la densidad de probabilidad de $S$</span>
<span id="cb52-1377"><a href="#cb52-1377"></a>está dada por la convolución de las densidades de probabilidad de cada una de las variables </span>
<span id="cb52-1378"><a href="#cb52-1378"></a>aleatorias $X_1, \ldots, X_n$.</span>
<span id="cb52-1379"><a href="#cb52-1379"></a>$$</span>
<span id="cb52-1380"><a href="#cb52-1380"></a>f_S = f_{X_1} \star \cdots \star f_{X_n}</span>
<span id="cb52-1381"><a href="#cb52-1381"></a>$$</span>
<span id="cb52-1382"><a href="#cb52-1382"></a>sin embargo esta convolución implica el realizar una interacción en $n$-dimensiones.</span>
<span id="cb52-1383"><a href="#cb52-1383"></a></span>
<span id="cb52-1384"><a href="#cb52-1384"></a>Si las las variables aleatorias $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son independientes sabemos además que </span>
<span id="cb52-1385"><a href="#cb52-1385"></a>$$</span>
<span id="cb52-1386"><a href="#cb52-1386"></a>\Fo\left( f_S \right) = \prod\limits_{i=1}^n \Fo\left( f_{X_i} \right)</span>
<span id="cb52-1387"><a href="#cb52-1387"></a>$$</span>
<span id="cb52-1388"><a href="#cb52-1388"></a></span>
<span id="cb52-1389"><a href="#cb52-1389"></a>Por otra parte, con lo anterior sabemos que es posible aproximar numéricamente cada $\Fo\left( f_{X_i} \right)$ </span>
<span id="cb52-1390"><a href="#cb52-1390"></a>con una serie $<span class="sc">\{</span>\hat{f}_{i,j}<span class="sc">\}</span>$ dada por la discretización de la transformada de Fourier y su aplicación </span>
<span id="cb52-1391"><a href="#cb52-1391"></a>sobre la discretización de la densidad de probabilidad $f_{i,k} = f_{X_i}( s_k )$. Por tanto, para cada </span>
<span id="cb52-1392"><a href="#cb52-1392"></a>de las densidades con $i \in <span class="sc">\{</span>1, \ldots, n<span class="sc">\}</span>$ y $\omega_j = \frac{j}{b-a}$ con $j \in <span class="sc">\{</span>0,\ldots, N-1<span class="sc">\}</span>$, </span>
<span id="cb52-1393"><a href="#cb52-1393"></a>se puede calcular de forma separada las aproximaciones a cada una de las transformadas</span>
<span id="cb52-1394"><a href="#cb52-1394"></a>$$</span>
<span id="cb52-1395"><a href="#cb52-1395"></a>\Fo( f_{X_i} )\left( \omega_j \right)  </span>
<span id="cb52-1396"><a href="#cb52-1396"></a>\approx \hat{f}_{i,j} </span>
<span id="cb52-1397"><a href="#cb52-1397"></a>= h \exp\left( -2\pi i \omega_j a \right) \left( \DFT\left<span class="co">[</span><span class="ot"> \{f_{i,k}\} \right</span><span class="co">]</span>  \right)_j</span>
<span id="cb52-1398"><a href="#cb52-1398"></a>$$</span>
<span id="cb52-1399"><a href="#cb52-1399"></a></span>
<span id="cb52-1400"><a href="#cb52-1400"></a>con lo anterior, también, se puede realizar una aproximación a la trasformada de Fourier </span>
<span id="cb52-1401"><a href="#cb52-1401"></a>$\Fo\left( f_S \right)$ de la densidad de probabilidad que buscamos $f_S$, como el producto de sus </span>
<span id="cb52-1402"><a href="#cb52-1402"></a>transformadas de Fourier.</span>
<span id="cb52-1403"><a href="#cb52-1403"></a>$$</span>
<span id="cb52-1404"><a href="#cb52-1404"></a>\Fo( f_{S} )\left( \omega_j \right)  </span>
<span id="cb52-1405"><a href="#cb52-1405"></a>= \prod\limits_{i=1}^n \Fo\left( f_{X_i} \right)\left( \omega_j \right)</span>
<span id="cb52-1406"><a href="#cb52-1406"></a>\approx \prod\limits_{i=1}^n \hat{f}_{i,j}</span>
<span id="cb52-1407"><a href="#cb52-1407"></a>$$</span>
<span id="cb52-1408"><a href="#cb52-1408"></a></span>
<span id="cb52-1409"><a href="#cb52-1409"></a>utilizando la inversión de la transformada de Fourier discreta podemos calcular una serie que </span>
<span id="cb52-1410"><a href="#cb52-1410"></a>precisamente aproxima a la densidad $f_S$</span>
<span id="cb52-1411"><a href="#cb52-1411"></a>$$</span>
<span id="cb52-1412"><a href="#cb52-1412"></a><span class="sc">\{</span> f_{S}( s_k ) <span class="sc">\}</span></span>
<span id="cb52-1413"><a href="#cb52-1413"></a>\approx \Re\left( \DFT^{-1}\left[ \left<span class="sc">\{</span> \frac{1}{h} \exp\left( 2\pi i \omega_j a \right) </span>
<span id="cb52-1414"><a href="#cb52-1414"></a>\prod\limits_{i=1}^n \hat{f}_{i,j} \right<span class="sc">\}</span> \right] \right)</span>
<span id="cb52-1415"><a href="#cb52-1415"></a>$$</span>
<span id="cb52-1416"><a href="#cb52-1416"></a></span>
<span id="cb52-1417"><a href="#cb52-1417"></a><span class="in">```{r l6c13}</span></span>
<span id="cb52-1418"><a href="#cb52-1418"></a><span class="in">N &lt;- 50000</span></span>
<span id="cb52-1419"><a href="#cb52-1419"></a><span class="in">set.seed(94312)</span></span>
<span id="cb52-1420"><a href="#cb52-1420"></a><span class="in">alpha &lt;- sample( x = seq( 1, 20, length = 40 ), size = 50, replace = TRUE )</span></span>
<span id="cb52-1421"><a href="#cb52-1421"></a><span class="in">theta &lt;- 3</span></span>
<span id="cb52-1422"><a href="#cb52-1422"></a><span class="in">b &lt;- sum( sapply( alpha, FUN = function( a ) qgamma( 0.99, shape = a, scale = theta ) ) )</span></span>
<span id="cb52-1423"><a href="#cb52-1423"></a><span class="in">a &lt;- 0</span></span>
<span id="cb52-1424"><a href="#cb52-1424"></a><span class="in">h &lt;- ( b - a ) / N</span></span>
<span id="cb52-1425"><a href="#cb52-1425"></a><span class="in">n &lt;- 0:N</span></span>
<span id="cb52-1426"><a href="#cb52-1426"></a><span class="in">s &lt;- a + n * h</span></span>
<span id="cb52-1427"><a href="#cb52-1427"></a><span class="in">w &lt;- n / ( b - a )</span></span>
<span id="cb52-1428"><a href="#cb52-1428"></a><span class="in">eta &lt;- h * exp( -2 * pi * 1i * w * a )</span></span>
<span id="cb52-1429"><a href="#cb52-1429"></a><span class="in">fX &lt;- lapply( alpha, function( a ) sapply( s, FUN = function( sk ) dgamma( sk, shape = a, scale = theta ) ) )</span></span>
<span id="cb52-1430"><a href="#cb52-1430"></a><span class="in">Fof &lt;- lapply( fX, FUN = function( fi ) eta * fft( fi ) )</span></span>
<span id="cb52-1431"><a href="#cb52-1431"></a><span class="in">FoS &lt;- Fof[[ 1 ]]</span></span>
<span id="cb52-1432"><a href="#cb52-1432"></a><span class="in">for ( i in 2:length( fX ) ) {</span></span>
<span id="cb52-1433"><a href="#cb52-1433"></a><span class="in">  FoS &lt;- FoS * Fof[[ i ]]</span></span>
<span id="cb52-1434"><a href="#cb52-1434"></a><span class="in">}</span></span>
<span id="cb52-1435"><a href="#cb52-1435"></a><span class="in">fS &lt;- fft( eta^(-1) * FoS, inverse = TRUE ) / ( N + 1 )</span></span>
<span id="cb52-1436"><a href="#cb52-1436"></a><span class="in">fS &lt;- Re( fS )</span></span>
<span id="cb52-1437"><a href="#cb52-1437"></a><span class="in">FS &lt;- cumsum( fS ) * h</span></span>
<span id="cb52-1438"><a href="#cb52-1438"></a><span class="in">fs &lt;- sapply( s, FUN = function( sk ) dgamma( sk, shape = sum( alpha ), scale = theta ) )</span></span>
<span id="cb52-1439"><a href="#cb52-1439"></a><span class="in">Fs &lt;- sapply( s, FUN = function( sk ) pgamma( sk, shape = sum( alpha ), scale = theta ) )</span></span>
<span id="cb52-1440"><a href="#cb52-1440"></a><span class="in">```</span></span>
<span id="cb52-1441"><a href="#cb52-1441"></a></span>
<span id="cb52-1442"><a href="#cb52-1442"></a><span class="in">```{r l6g10}</span></span>
<span id="cb52-1443"><a href="#cb52-1443"></a><span class="in">#| warning: false</span></span>
<span id="cb52-1444"><a href="#cb52-1444"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-1445"><a href="#cb52-1445"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-1446"><a href="#cb52-1446"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-1447"><a href="#cb52-1447"></a><span class="in">plt &lt;- ggplot() +</span></span>
<span id="cb52-1448"><a href="#cb52-1448"></a><span class="in">  geom_line( aes( x = s, y = fs ), colour = 'darkred', linewidth = 1 ) + </span></span>
<span id="cb52-1449"><a href="#cb52-1449"></a><span class="in">  geom_point( aes( x = s, y = fS ), colour = 'olivedrab3', size = 0.2 ) + </span></span>
<span id="cb52-1450"><a href="#cb52-1450"></a><span class="in">  xlab( TeX( "$x$" ) ) + </span></span>
<span id="cb52-1451"><a href="#cb52-1451"></a><span class="in">  ylab( TeX( "$f_{S}(x)$" ) ) + </span></span>
<span id="cb52-1452"><a href="#cb52-1452"></a><span class="in">  theme_bw()</span></span>
<span id="cb52-1453"><a href="#cb52-1453"></a><span class="in">plot( plt )</span></span>
<span id="cb52-1454"><a href="#cb52-1454"></a><span class="in">```</span></span>
<span id="cb52-1455"><a href="#cb52-1455"></a></span>
<span id="cb52-1456"><a href="#cb52-1456"></a>A pesar que la aproximación a la densidad de probabilidad parece ser buena, la condición de </span>
<span id="cb52-1457"><a href="#cb52-1457"></a>normalización, no es satisfecha, como muestra el siguiente ejemplo. Ello sugiere que al </span>
<span id="cb52-1458"><a href="#cb52-1458"></a>algoritmo de estimación de la densidad hay que realizarle algún ajuste o en su defecto incrementar </span>
<span id="cb52-1459"><a href="#cb52-1459"></a>la precisión numérica.</span>
<span id="cb52-1460"><a href="#cb52-1460"></a><span class="in">```{r l6g11}</span></span>
<span id="cb52-1461"><a href="#cb52-1461"></a><span class="in">#| warning: false</span></span>
<span id="cb52-1462"><a href="#cb52-1462"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-1463"><a href="#cb52-1463"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-1464"><a href="#cb52-1464"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-1465"><a href="#cb52-1465"></a><span class="in">plt &lt;- ggplot() +</span></span>
<span id="cb52-1466"><a href="#cb52-1466"></a><span class="in">  geom_line( aes( x = s, y = Fs ), colour = 'darkred', linewidth = 1 ) + </span></span>
<span id="cb52-1467"><a href="#cb52-1467"></a><span class="in">  geom_point( aes( x = s, y = FS ), colour = 'olivedrab3', size = 0.2 ) + </span></span>
<span id="cb52-1468"><a href="#cb52-1468"></a><span class="in">  geom_hline( yintercept = 1, color = 'dodgerblue2', linewidth = 0.1 ) +</span></span>
<span id="cb52-1469"><a href="#cb52-1469"></a><span class="in">  xlab( TeX( "$x$" ) ) + </span></span>
<span id="cb52-1470"><a href="#cb52-1470"></a><span class="in">  ylab( TeX( "$F_{S}(x)$" ) ) + </span></span>
<span id="cb52-1471"><a href="#cb52-1471"></a><span class="in">  theme_bw()</span></span>
<span id="cb52-1472"><a href="#cb52-1472"></a><span class="in">plot( plt )</span></span>
<span id="cb52-1473"><a href="#cb52-1473"></a><span class="in">```</span></span>
<span id="cb52-1474"><a href="#cb52-1474"></a></span>
<span id="cb52-1475"><a href="#cb52-1475"></a><span class="in">```{r l6g12}</span></span>
<span id="cb52-1476"><a href="#cb52-1476"></a><span class="in">#| warning: false</span></span>
<span id="cb52-1477"><a href="#cb52-1477"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-1478"><a href="#cb52-1478"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-1479"><a href="#cb52-1479"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-1480"><a href="#cb52-1480"></a><span class="in">e &lt;- fS - fs</span></span>
<span id="cb52-1481"><a href="#cb52-1481"></a><span class="in">eb &lt;- max( abs( e ) )</span></span>
<span id="cb52-1482"><a href="#cb52-1482"></a></span>
<span id="cb52-1483"><a href="#cb52-1483"></a><span class="in">plt &lt;- ggplot() +</span></span>
<span id="cb52-1484"><a href="#cb52-1484"></a><span class="in">  geom_histogram( aes( x = e, y = after_stat( density ) ), fill = 'grey50', colour = 'dodgerblue3', bins = nclass.scott( e ) ) + </span></span>
<span id="cb52-1485"><a href="#cb52-1485"></a><span class="in">  scale_y_continuous( labels = label_scientific( digits = 4 ) ) +</span></span>
<span id="cb52-1486"><a href="#cb52-1486"></a><span class="in">  ylab( TeX( "$e$" ) ) + </span></span>
<span id="cb52-1487"><a href="#cb52-1487"></a><span class="in">  theme_bw()</span></span>
<span id="cb52-1488"><a href="#cb52-1488"></a><span class="in">plot( plt )</span></span>
<span id="cb52-1489"><a href="#cb52-1489"></a><span class="in">```</span></span>
<span id="cb52-1490"><a href="#cb52-1490"></a></span>
<span id="cb52-1491"><a href="#cb52-1491"></a>Utilizando la misma idea anterior, se puede aproximar cada uno de los términos presentes</span>
<span id="cb52-1492"><a href="#cb52-1492"></a>en la serie que determina la densidad de probabilidad $f_S$ de un modelo colectivo. Se selecciona un </span>
<span id="cb52-1493"><a href="#cb52-1493"></a>número máximo $M \in \N$ de términos a ser considerados en la serie, $M$ lo suficientemente grande </span>
<span id="cb52-1494"><a href="#cb52-1494"></a>como para que la siguiente aproximación resulte adecuada.</span>
<span id="cb52-1495"><a href="#cb52-1495"></a>$$</span>
<span id="cb52-1496"><a href="#cb52-1496"></a><span class="sc">\{</span> f_{S}( s_k ) <span class="sc">\}</span></span>
<span id="cb52-1497"><a href="#cb52-1497"></a>\approx  \Re\left( \DFT^{-1}\left[ \sum\limits_{n=1}^{M} \left<span class="sc">\{</span> \frac{1}{h} \exp\left( 2\pi i \omega_j a \right) </span>
<span id="cb52-1498"><a href="#cb52-1498"></a>\prod\limits_{i=1}^n \hat{f}_{i,j} \right<span class="sc">\}</span>\ p_n \right] \right),</span>
<span id="cb52-1499"><a href="#cb52-1499"></a>\qquad \forall s_k &gt; 0</span>
<span id="cb52-1500"><a href="#cb52-1500"></a>$$</span>
<span id="cb52-1501"><a href="#cb52-1501"></a></span>
<span id="cb52-1502"><a href="#cb52-1502"></a></span>
<span id="cb52-1503"><a href="#cb52-1503"></a>para el caso cuando $s_o = 0$, tenemos que $f_S( s_0 ) = f_S( 0 ) = p_0$.</span>
<span id="cb52-1504"><a href="#cb52-1504"></a></span>
<span id="cb52-1505"><a href="#cb52-1505"></a><span class="in">```{r l6c14}</span></span>
<span id="cb52-1506"><a href="#cb52-1506"></a><span class="in">M &lt;- 200</span></span>
<span id="cb52-1507"><a href="#cb52-1507"></a><span class="in">N &lt;- 7e4</span></span>
<span id="cb52-1508"><a href="#cb52-1508"></a></span>
<span id="cb52-1509"><a href="#cb52-1509"></a><span class="in">p &lt;- 0.3</span></span>
<span id="cb52-1510"><a href="#cb52-1510"></a><span class="in">alpha &lt;- 3</span></span>
<span id="cb52-1511"><a href="#cb52-1511"></a><span class="in">pn &lt;- dnbinom( 0:M, size = alpha, prob = p )</span></span>
<span id="cb52-1512"><a href="#cb52-1512"></a></span>
<span id="cb52-1513"><a href="#cb52-1513"></a><span class="in">u &lt;- 5</span></span>
<span id="cb52-1514"><a href="#cb52-1514"></a><span class="in">s &lt;- 0.3</span></span>
<span id="cb52-1515"><a href="#cb52-1515"></a></span>
<span id="cb52-1516"><a href="#cb52-1516"></a><span class="in">b &lt;- 5e3</span></span>
<span id="cb52-1517"><a href="#cb52-1517"></a><span class="in">a &lt;- 0</span></span>
<span id="cb52-1518"><a href="#cb52-1518"></a><span class="in">h &lt;- ( b - a ) / N</span></span>
<span id="cb52-1519"><a href="#cb52-1519"></a><span class="in">n &lt;- 0:N</span></span>
<span id="cb52-1520"><a href="#cb52-1520"></a><span class="in">sg &lt;- a + n * h</span></span>
<span id="cb52-1521"><a href="#cb52-1521"></a><span class="in">w &lt;- n / ( b - a )</span></span>
<span id="cb52-1522"><a href="#cb52-1522"></a><span class="in">eta &lt;- h * exp( -2 * pi * 1i * w * a )</span></span>
<span id="cb52-1523"><a href="#cb52-1523"></a><span class="in">f &lt;- sapply( sg, FUN = function( sk ) dlnorm( sk, meanlog = u, sdlog = s ) )</span></span>
<span id="cb52-1524"><a href="#cb52-1524"></a><span class="in">Fof &lt;- eta * fft( f )</span></span>
<span id="cb52-1525"><a href="#cb52-1525"></a><span class="in">FoS &lt;- rep( 0, N + 1 )</span></span>
<span id="cb52-1526"><a href="#cb52-1526"></a><span class="in">for ( n in 1:M ) {</span></span>
<span id="cb52-1527"><a href="#cb52-1527"></a><span class="in">  FoS &lt;- FoS + pn[ n + 1 ] * Fof^n</span></span>
<span id="cb52-1528"><a href="#cb52-1528"></a><span class="in">}</span></span>
<span id="cb52-1529"><a href="#cb52-1529"></a><span class="in">fS &lt;- fft( eta^(-1) * FoS, inverse = TRUE ) / ( N + 1 )</span></span>
<span id="cb52-1530"><a href="#cb52-1530"></a><span class="in">fS &lt;- Re( fS )</span></span>
<span id="cb52-1531"><a href="#cb52-1531"></a><span class="in">fS[1] = pn[1]</span></span>
<span id="cb52-1532"><a href="#cb52-1532"></a></span>
<span id="cb52-1533"><a href="#cb52-1533"></a><span class="in">set.seed( 32141223 )</span></span>
<span id="cb52-1534"><a href="#cb52-1534"></a><span class="in">m &lt;- 1e5</span></span>
<span id="cb52-1535"><a href="#cb52-1535"></a><span class="in">N &lt;- rnbinom( n = m, size = alpha, prob = p )</span></span>
<span id="cb52-1536"><a href="#cb52-1536"></a><span class="in">X &lt;- lapply( N, FUN = function( n ) rlnorm( n, meanlog = u, sdlog = s ) )</span></span>
<span id="cb52-1537"><a href="#cb52-1537"></a><span class="in">S &lt;- sapply( X, FUN = function( x ) sum( x, na.rm = TRUE ) )</span></span>
<span id="cb52-1538"><a href="#cb52-1538"></a><span class="in">```</span></span>
<span id="cb52-1539"><a href="#cb52-1539"></a></span>
<span id="cb52-1540"><a href="#cb52-1540"></a><span class="in">```{r l6g13}</span></span>
<span id="cb52-1541"><a href="#cb52-1541"></a><span class="in">#| warning: false</span></span>
<span id="cb52-1542"><a href="#cb52-1542"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-1543"><a href="#cb52-1543"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-1544"><a href="#cb52-1544"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-1545"><a href="#cb52-1545"></a><span class="in">fmax &lt;- 0.0007</span></span>
<span id="cb52-1546"><a href="#cb52-1546"></a><span class="in">smax &lt;- 5e3</span></span>
<span id="cb52-1547"><a href="#cb52-1547"></a></span>
<span id="cb52-1548"><a href="#cb52-1548"></a><span class="in">plt &lt;- ggplot() +</span></span>
<span id="cb52-1549"><a href="#cb52-1549"></a><span class="in">  geom_histogram( aes( S, after_stat( density ) ), fill = 'dodgerblue4', colour = 'white', alpha = 0.6, bins = nclass.FD( S ) ) +</span></span>
<span id="cb52-1550"><a href="#cb52-1550"></a><span class="in">  geom_line( aes( x = sg, y = fS ), colour = 'purple3', linewidth = 1 ) +</span></span>
<span id="cb52-1551"><a href="#cb52-1551"></a><span class="in">  scale_x_continuous( breaks = seq( 0, b, length = 7 ),</span></span>
<span id="cb52-1552"><a href="#cb52-1552"></a><span class="in">                      labels = formatC( seq( 0, smax, length = 7 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-1553"><a href="#cb52-1553"></a><span class="in">                      limits = c( 0, smax ), </span></span>
<span id="cb52-1554"><a href="#cb52-1554"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-1555"><a href="#cb52-1555"></a><span class="in">  scale_y_continuous( breaks = seq( 0, fmax, length = 11 ),</span></span>
<span id="cb52-1556"><a href="#cb52-1556"></a><span class="in">                      labels = formatC( seq( 0, fmax, length = 11 ), digits = 4, format = 'f' ),</span></span>
<span id="cb52-1557"><a href="#cb52-1557"></a><span class="in">                      limits = c( 0, fmax ),</span></span>
<span id="cb52-1558"><a href="#cb52-1558"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-1559"><a href="#cb52-1559"></a><span class="in">  xlab( TeX( "$s$" ) ) + </span></span>
<span id="cb52-1560"><a href="#cb52-1560"></a><span class="in">  ylab( TeX( "$f_S$" ) ) + </span></span>
<span id="cb52-1561"><a href="#cb52-1561"></a><span class="in">  theme_bw() +</span></span>
<span id="cb52-1562"><a href="#cb52-1562"></a><span class="in">  theme( legend.position = "none" )</span></span>
<span id="cb52-1563"><a href="#cb52-1563"></a><span class="in">plot( plt )</span></span>
<span id="cb52-1564"><a href="#cb52-1564"></a><span class="in">```</span></span>
<span id="cb52-1565"><a href="#cb52-1565"></a></span>
<span id="cb52-1566"><a href="#cb52-1566"></a><span class="in">```{r l6g14}</span></span>
<span id="cb52-1567"><a href="#cb52-1567"></a><span class="in">#| warning: false</span></span>
<span id="cb52-1568"><a href="#cb52-1568"></a><span class="in">#| out.width: '70%'</span></span>
<span id="cb52-1569"><a href="#cb52-1569"></a><span class="in">#| fig.align: 'center'</span></span>
<span id="cb52-1570"><a href="#cb52-1570"></a><span class="in">#| class.source: 'fold-hide'</span></span>
<span id="cb52-1571"><a href="#cb52-1571"></a><span class="in">e &lt;- cumsum( fS[ -1 ] * diff( sg ) ) - ecdf( S )( sg[-1] )</span></span>
<span id="cb52-1572"><a href="#cb52-1572"></a></span>
<span id="cb52-1573"><a href="#cb52-1573"></a><span class="in">eb &lt;- max( abs( e ) )</span></span>
<span id="cb52-1574"><a href="#cb52-1574"></a></span>
<span id="cb52-1575"><a href="#cb52-1575"></a><span class="in">plt &lt;- ggplot() +</span></span>
<span id="cb52-1576"><a href="#cb52-1576"></a><span class="in">  geom_histogram( aes( x = e, y = after_stat( density ) ), fill = 'grey50', colour = 'dodgerblue3', bins = nclass.FD( e ) ) +</span></span>
<span id="cb52-1577"><a href="#cb52-1577"></a><span class="in">  scale_y_continuous( labels = label_scientific( digits = 2 ) ) +</span></span>
<span id="cb52-1578"><a href="#cb52-1578"></a><span class="in">  ylab( TeX( "$e$" ) ) +</span></span>
<span id="cb52-1579"><a href="#cb52-1579"></a><span class="in">  theme_bw()</span></span>
<span id="cb52-1580"><a href="#cb52-1580"></a><span class="in">plot( plt )</span></span>
<span id="cb52-1581"><a href="#cb52-1581"></a><span class="in">```</span></span>
<span id="cb52-1582"><a href="#cb52-1582"></a></span>
<span id="cb52-1583"><a href="#cb52-1583"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-1584"><a href="#cb52-1584"></a><span class="fu">## Temporalidad y ajustes del número de reclamos {#temporalidad_numero_reclamos}</span></span>
<span id="cb52-1585"><a href="#cb52-1585"></a></span>
<span id="cb52-1586"><a href="#cb52-1586"></a>Hasta el momento no hemos tomado en cuenta cierta componente de temporalidad que muestra la </span>
<span id="cb52-1587"><a href="#cb52-1587"></a>frecuencia de los reclamos. Debemos ser muy consientes que los reclamos se producen en el tiempo</span>
<span id="cb52-1588"><a href="#cb52-1588"></a>y que el número de estos dependerá del periodo de exposición de cada uno de los asegurados, en otras</span>
<span id="cb52-1589"><a href="#cb52-1589"></a>palabras en la estimación de la frecuencia se debe tomar en cuenta que las pólizas tienen un periodo</span>
<span id="cb52-1590"><a href="#cb52-1590"></a>de cobertura, una fecha inicial y una fecha final. </span>
<span id="cb52-1591"><a href="#cb52-1591"></a></span>
<span id="cb52-1592"><a href="#cb52-1592"></a>Más puntualmente, para una inferencia sencilla si estimamos reclamos de pólizas que duran 2 años</span>
<span id="cb52-1593"><a href="#cb52-1593"></a>entonces la frecuencia del número de reclamos $N$ será bianual. Si por el contrario se quiere </span>
<span id="cb52-1594"><a href="#cb52-1594"></a>utilizar esta frecuencia para estimar el número de reclamos para pólizas con cobertura anual </span>
<span id="cb52-1595"><a href="#cb52-1595"></a>entonces, es necesario realizar un ajuste acorde.</span>
<span id="cb52-1596"><a href="#cb52-1596"></a></span>
<span id="cb52-1597"><a href="#cb52-1597"></a></span>
<span id="cb52-1598"><a href="#cb52-1598"></a>::: {.Definition #der title="Exposición al riesgo"}</span>
<span id="cb52-1599"><a href="#cb52-1599"></a>Dando algo más de sentido matemático a este razonamiento, a cada póliza podemos asociar su </span>
<span id="cb52-1600"><a href="#cb52-1600"></a>respectiva **exposición al riesgo**, que no es más que el ancho de intervalo dado por la fecha </span>
<span id="cb52-1601"><a href="#cb52-1601"></a>inicial de la póliza, menos la fecha final de la póliza. Usualmente la unidad que su utiliza para </span>
<span id="cb52-1602"><a href="#cb52-1602"></a>medir este intervalo es en años, pero puede cambiársela, siempre y cuando la formulación del modelo </span>
<span id="cb52-1603"><a href="#cb52-1603"></a>sea clara y el uso de estas unidades sea consistente para cálculos futuros. Así si tenemos $n$ </span>
<span id="cb52-1604"><a href="#cb52-1604"></a>pólizas para cada una de ellas hay un tiempo de inicio $s_i$ y un tiempo $e_i$ final, para todo </span>
<span id="cb52-1605"><a href="#cb52-1605"></a>$i \in <span class="sc">\{</span>1, \ldots, n<span class="sc">\}</span>$, así la exposición al riesgo $ER_i$ está dada por una distancia $d$</span>
<span id="cb52-1606"><a href="#cb52-1606"></a>$$</span>
<span id="cb52-1607"><a href="#cb52-1607"></a>ER_i = d( s_i, e_i )</span>
<span id="cb52-1608"><a href="#cb52-1608"></a>$$</span>
<span id="cb52-1609"><a href="#cb52-1609"></a>:::</span>
<span id="cb52-1610"><a href="#cb52-1610"></a></span>
<span id="cb52-1611"><a href="#cb52-1611"></a></span>
<span id="cb52-1612"><a href="#cb52-1612"></a>Por ejemplo, una buena distancia puede ser</span>
<span id="cb52-1613"><a href="#cb52-1613"></a>$$</span>
<span id="cb52-1614"><a href="#cb52-1614"></a>d( s, e ) = \frac{<span class="sc">\#</span> \left<span class="sc">\{</span> \text{días entre $s$ y $e$} \right<span class="sc">\}</span>}{365.25}</span>
<span id="cb52-1615"><a href="#cb52-1615"></a>$$</span>
<span id="cb52-1616"><a href="#cb52-1616"></a>En la librería <span class="in">`lubridate`</span> de R, tenemos una implementación que puede utilizarse fácilmente para</span>
<span id="cb52-1617"><a href="#cb52-1617"></a>calcular la distancia en años entre dos fechas dadas.</span>
<span id="cb52-1618"><a href="#cb52-1618"></a><span class="in">```{r l6c15}</span></span>
<span id="cb52-1619"><a href="#cb52-1619"></a><span class="in">s &lt;- ymd( '1951-04-09' )</span></span>
<span id="cb52-1620"><a href="#cb52-1620"></a><span class="in">e &lt;- ymd( '2025-04-09' )</span></span>
<span id="cb52-1621"><a href="#cb52-1621"></a><span class="in">d1 &lt;- interval( s, e ) / dyears( 1 )</span></span>
<span id="cb52-1622"><a href="#cb52-1622"></a><span class="in">d2 &lt;- length( seq( s, e, by = 'day') ) / 365.25</span></span>
<span id="cb52-1623"><a href="#cb52-1623"></a><span class="in">```</span></span>
<span id="cb52-1624"><a href="#cb52-1624"></a></span>
<span id="cb52-1625"><a href="#cb52-1625"></a>La idea es ajustar la estimación de la frecuencia de forma proporcional a la exposición al riesgo, </span>
<span id="cb52-1626"><a href="#cb52-1626"></a>esto se puede realizar postulando que la variable aleatoria del conteo de siniestros, tienen una </span>
<span id="cb52-1627"><a href="#cb52-1627"></a>esperanza proporcional a la exposición al riesgo.</span>
<span id="cb52-1628"><a href="#cb52-1628"></a>$$</span>
<span id="cb52-1629"><a href="#cb52-1629"></a>\E\left<span class="co">[</span><span class="ot"> N \right</span><span class="co">]</span> = \lambda ER</span>
<span id="cb52-1630"><a href="#cb52-1630"></a>$$</span>
<span id="cb52-1631"><a href="#cb52-1631"></a>además se puede ajustar la distribución de probabilidad que se desee estimar en función del </span>
<span id="cb52-1632"><a href="#cb52-1632"></a>parámetro $\lambda$, es así que para las distribuciones de probabilidad discretas que hemos </span>
<span id="cb52-1633"><a href="#cb52-1633"></a>introducido con anterioridad, tenemos la siguiente modificación.</span>
<span id="cb52-1634"><a href="#cb52-1634"></a></span>
<span id="cb52-1635"><a href="#cb52-1635"></a><span class="ss">1.  </span>Para la distribución de Poisson, tenemos la ley de probabilidad</span>
<span id="cb52-1636"><a href="#cb52-1636"></a>$$</span>
<span id="cb52-1637"><a href="#cb52-1637"></a>P( N = k ) = \exp\left( -\lambda ER \right) \frac{( \lambda ER )^k}{k!}, \qquad</span>
<span id="cb52-1638"><a href="#cb52-1638"></a>\forall k \in \N</span>
<span id="cb52-1639"><a href="#cb52-1639"></a>$$</span>
<span id="cb52-1640"><a href="#cb52-1640"></a>entonces $N \rightsquigarrow Pois( \lambda ER )$.</span>
<span id="cb52-1641"><a href="#cb52-1641"></a></span>
<span id="cb52-1642"><a href="#cb52-1642"></a>En caso de disponer de una muestra de $N_1, \ldots, N_m$ de variables aleatorias independientes, </span>
<span id="cb52-1643"><a href="#cb52-1643"></a>y por otra parte exposiciones al riesgo $ER_1, \ldots, ER_m$ asociadas a cada una de las variables</span>
<span id="cb52-1644"><a href="#cb52-1644"></a>aleatorias, de tal forma que $N_i \rightsquigarrow Pois( \lambda ER_i )$, entonces la función</span>
<span id="cb52-1645"><a href="#cb52-1645"></a>de verosimilitud logarítmica toma la forma:</span>
<span id="cb52-1646"><a href="#cb52-1646"></a>$$</span>
<span id="cb52-1647"><a href="#cb52-1647"></a>\ell( \lambda ) </span>
<span id="cb52-1648"><a href="#cb52-1648"></a>= - \lambda \sum\limits_{i=1}^m ER_i </span>
<span id="cb52-1649"><a href="#cb52-1649"></a><span class="ss">+ </span>\sum\limits_{i=1}^m N_i \log\left( ER_i \right) </span>
<span id="cb52-1650"><a href="#cb52-1650"></a><span class="ss">+ </span>\sum\limits_{i=1}^m N_i \log\left( \lambda \right) </span>
<span id="cb52-1651"><a href="#cb52-1651"></a><span class="ss">- </span>\sum\limits_{i=1}^m \log\left( N_i! \right)</span>
<span id="cb52-1652"><a href="#cb52-1652"></a>$$</span>
<span id="cb52-1653"><a href="#cb52-1653"></a>en este caso el estimador por maximización de verosimilitud es bien sencillo de determinar y está </span>
<span id="cb52-1654"><a href="#cb52-1654"></a>dado por:</span>
<span id="cb52-1655"><a href="#cb52-1655"></a>$$</span>
<span id="cb52-1656"><a href="#cb52-1656"></a>\lambda = \frac{\sum\limits_{i=1}^m N_i}{\sum\limits_{i=1}^m ER_i }</span>
<span id="cb52-1657"><a href="#cb52-1657"></a>$$</span>
<span id="cb52-1658"><a href="#cb52-1658"></a></span>
<span id="cb52-1659"><a href="#cb52-1659"></a><span class="ss">2.  </span>Para la distribución binomial begativa, tenemos que si</span>
<span id="cb52-1660"><a href="#cb52-1660"></a>$$</span>
<span id="cb52-1661"><a href="#cb52-1661"></a>\lambda ER = \alpha \frac{1-p}{p} \Rightarrow p = \frac{\alpha}{\lambda ER + \alpha}</span>
<span id="cb52-1662"><a href="#cb52-1662"></a>$$</span>
<span id="cb52-1663"><a href="#cb52-1663"></a>de donde la ley de probabilidad queda modificada como </span>
<span id="cb52-1664"><a href="#cb52-1664"></a>$$</span>
<span id="cb52-1665"><a href="#cb52-1665"></a>P( N = k ) </span>
<span id="cb52-1666"><a href="#cb52-1666"></a>= \frac{\Gamma( \alpha + k )}{\Gamma(k+1) \Gamma(\alpha)} </span>
<span id="cb52-1667"><a href="#cb52-1667"></a>\left( \frac{\alpha}{\lambda ER + \alpha} \right)^\alpha \left( \frac{\lambda ER}{\lambda ER + \alpha} \right)^k, \qquad</span>
<span id="cb52-1668"><a href="#cb52-1668"></a>\forall k \in \N</span>
<span id="cb52-1669"><a href="#cb52-1669"></a>$$</span>
<span id="cb52-1670"><a href="#cb52-1670"></a>entonces $N \rightsquigarrow NBinom\left( \alpha, \frac{\alpha}{\lambda ER + \alpha} \right)$.</span>
<span id="cb52-1671"><a href="#cb52-1671"></a></span>
<span id="cb52-1672"><a href="#cb52-1672"></a>Similar que antes, si disponemos de una muestra de $N_1, \ldots, N_m$ de variables aleatorias </span>
<span id="cb52-1673"><a href="#cb52-1673"></a>independientes y también exposiciones al riesgo $ER_1, \ldots, ER_m$ asociadas a cada una de las </span>
<span id="cb52-1674"><a href="#cb52-1674"></a>variables aleatorias, de tal forma que </span>
<span id="cb52-1675"><a href="#cb52-1675"></a>$N_i \rightsquigarrow NBinom\left( \alpha, \frac{\alpha}{\lambda ER_i + \alpha} \right)$, entonces </span>
<span id="cb52-1676"><a href="#cb52-1676"></a>la función de verosimilitud logarítmica toma la forma:</span>
<span id="cb52-1677"><a href="#cb52-1677"></a>$$</span>
<span id="cb52-1678"><a href="#cb52-1678"></a>\begin{split}</span>
<span id="cb52-1679"><a href="#cb52-1679"></a>\ell( \alpha, \lambda )</span>
<span id="cb52-1680"><a href="#cb52-1680"></a>&amp; = \sum\limits_{i=1}^m \log \Gamma( \alpha + N_i ) </span>
<span id="cb52-1681"><a href="#cb52-1681"></a><span class="ss">- </span>\sum\limits_{i=1}^m \log \Gamma( N_i + 1 ) </span>
<span id="cb52-1682"><a href="#cb52-1682"></a><span class="ss">- </span>m \log \Gamma( \alpha ) <span class="sc">\\</span></span>
<span id="cb52-1683"><a href="#cb52-1683"></a>&amp; + \sum\limits_{i=1}^m N_i \log\left( \lambda \right) </span>
<span id="cb52-1684"><a href="#cb52-1684"></a><span class="ss">+ </span>\sum\limits_{i=1}^m N_i \log\left( ER_i \right) </span>
<span id="cb52-1685"><a href="#cb52-1685"></a><span class="ss">- </span>\sum\limits_{i=1}^m N_i \log\left( \lambda ER_i + \alpha \right) </span>
<span id="cb52-1686"><a href="#cb52-1686"></a><span class="ss">+ </span>m \alpha \log\left( \alpha \right) <span class="sc">\\</span></span>
<span id="cb52-1687"><a href="#cb52-1687"></a>&amp; - \alpha \sum\limits_{i=1}^m \log\left( \lambda ER_i + \alpha \right)</span>
<span id="cb52-1688"><a href="#cb52-1688"></a>\end{split}</span>
<span id="cb52-1689"><a href="#cb52-1689"></a>$$</span>
<span id="cb52-1690"><a href="#cb52-1690"></a></span>
<span id="cb52-1691"><a href="#cb52-1691"></a><span class="ss">3.  </span>Para la distribución binomial, tenemos que si</span>
<span id="cb52-1692"><a href="#cb52-1692"></a>$$</span>
<span id="cb52-1693"><a href="#cb52-1693"></a>\lambda ER = np \Rightarrow p = \frac{\lambda ER}{n}</span>
<span id="cb52-1694"><a href="#cb52-1694"></a>$$</span>
<span id="cb52-1695"><a href="#cb52-1695"></a>de donde la ley de probabilidad queda modificada como</span>
<span id="cb52-1696"><a href="#cb52-1696"></a>$$</span>
<span id="cb52-1697"><a href="#cb52-1697"></a>P( N = k ) = \binom{n}{k} \left( \frac{\lambda ER}{n} \right)^k \left( 1 - \frac{\lambda ER}{n} \right)^{n-k}, </span>
<span id="cb52-1698"><a href="#cb52-1698"></a>\qquad \forall k \in <span class="sc">\{</span>0,\ldots, n<span class="sc">\}</span></span>
<span id="cb52-1699"><a href="#cb52-1699"></a>$$</span>
<span id="cb52-1700"><a href="#cb52-1700"></a>entonces $N \rightsquigarrow Binom\left( n, \frac{\lambda ER}{n} \right)$</span>
<span id="cb52-1701"><a href="#cb52-1701"></a></span>
<span id="cb52-1702"><a href="#cb52-1702"></a>Mismo razonamiento, si disponemos de una muestra de $N_1, \ldots, N_m$ de variables aleatorias </span>
<span id="cb52-1703"><a href="#cb52-1703"></a>independientes y también exposiciones al riesgo $ER_1, \ldots, ER_m$ asociadas a cada una de las </span>
<span id="cb52-1704"><a href="#cb52-1704"></a>variables aleatorias, de tal forma que </span>
<span id="cb52-1705"><a href="#cb52-1705"></a>$N_i \rightsquigarrow  Binom\left( n, \frac{\lambda ER_i}{n} \right)$, entonces la función de </span>
<span id="cb52-1706"><a href="#cb52-1706"></a>verosimilitud logarítmica toma la forma:</span>
<span id="cb52-1707"><a href="#cb52-1707"></a>$$</span>
<span id="cb52-1708"><a href="#cb52-1708"></a>\begin{split}</span>
<span id="cb52-1709"><a href="#cb52-1709"></a>\ell( n, \lambda )</span>
<span id="cb52-1710"><a href="#cb52-1710"></a>&amp; = m \log( n! )</span>
<span id="cb52-1711"><a href="#cb52-1711"></a><span class="ss">- </span>\sum\limits_{i=1}^m \log( N_i! ) </span>
<span id="cb52-1712"><a href="#cb52-1712"></a><span class="ss">- </span>\sum\limits_{i=1}^m \log( (n - N_i)! ) <span class="sc">\\</span></span>
<span id="cb52-1713"><a href="#cb52-1713"></a>&amp; + \sum\limits_{i=1}^m N_i \log \lambda </span>
<span id="cb52-1714"><a href="#cb52-1714"></a><span class="ss">+ </span>\sum\limits_{i=1}^m N_i \log ER_i</span>
<span id="cb52-1715"><a href="#cb52-1715"></a><span class="ss">- </span>n \sum\limits_{i=1}^m N_i <span class="sc">\\</span></span>
<span id="cb52-1716"><a href="#cb52-1716"></a>&amp; + n \sum\limits_{i=1}^m \log\left( 1 - \frac{\lambda ER_i}{n} \right) </span>
<span id="cb52-1717"><a href="#cb52-1717"></a><span class="ss">- </span>\sum\limits_{i=1}^m N_i \log\left( 1 - \frac{\lambda ER_i}{n} \right) </span>
<span id="cb52-1718"><a href="#cb52-1718"></a>\end{split}</span>
<span id="cb52-1719"><a href="#cb52-1719"></a>$$</span>
<span id="cb52-1720"><a href="#cb52-1720"></a></span>
<span id="cb52-1721"><a href="#cb52-1721"></a>En los tres casos anteriores, hemos desarrollado una metodología para la estimación de la </span>
<span id="cb52-1722"><a href="#cb52-1722"></a>distribución de frecuencia de los reclamos, tomando en cuenta la exposición al riesgo de cada </span>
<span id="cb52-1723"><a href="#cb52-1723"></a>una de las pólizas a las cuales estos reclamos corresponden.</span>
<span id="cb52-1724"><a href="#cb52-1724"></a></span>
<span id="cb52-1725"><a href="#cb52-1725"></a>::: {.example #l6ex8}</span>
<span id="cb52-1726"><a href="#cb52-1726"></a>Ahora bien, pongamos en aplicación todo lo aprendido hasta el momento. Para ello, trabajaremos</span>
<span id="cb52-1727"><a href="#cb52-1727"></a>con información de pólizas de un seguro de salud. La información está compuesta de dos objetos,</span>
<span id="cb52-1728"><a href="#cb52-1728"></a>uno la producción de pólizas y dos los reclamos de varios productos asociados al ramo.</span>
<span id="cb52-1729"><a href="#cb52-1729"></a></span>
<span id="cb52-1730"><a href="#cb52-1730"></a>La información corresponde a un seguro de salud el cual tiene pólizas individuales y colectivas, </span>
<span id="cb52-1731"><a href="#cb52-1731"></a>para cada una de sus contratos se especifica un deducible de la forma </span>
<span id="cb52-1732"><a href="#cb52-1732"></a>$D( X ) = \min( \max( X - d, 0 ), M )$, donde precisamente $d$ es lo que se conoce como el deducible</span>
<span id="cb52-1733"><a href="#cb52-1733"></a>y $M$ como el monto máximo de cobertura. </span>
<span id="cb52-1734"><a href="#cb52-1734"></a></span>
<span id="cb52-1735"><a href="#cb52-1735"></a><span class="in">```{r l6c16}</span></span>
<span id="cb52-1736"><a href="#cb52-1736"></a><span class="in">load( '../RData/production_claims_health.RData' )</span></span>
<span id="cb52-1737"><a href="#cb52-1737"></a><span class="in">```</span></span>
<span id="cb52-1738"><a href="#cb52-1738"></a></span>
<span id="cb52-1739"><a href="#cb52-1739"></a>El objeto con la producción de pólizas tienen la siguiente estructura. Es un objeto con una forma </span>
<span id="cb52-1740"><a href="#cb52-1740"></a>usual que uno puede encontrar en las bases de producción de un asegurador. Se incluye en particular</span>
<span id="cb52-1741"><a href="#cb52-1741"></a>campos de especial interés como la fecha de nacimiento <span class="in">`bdate`</span>, el inicio de vigencia de la </span>
<span id="cb52-1742"><a href="#cb52-1742"></a>cobertura <span class="in">`start`</span> y el final de vigencia de la cobertura <span class="in">`end`</span>.</span>
<span id="cb52-1743"><a href="#cb52-1743"></a><span class="in">```{r l6t1}</span></span>
<span id="cb52-1744"><a href="#cb52-1744"></a><span class="in">#| echo: true</span></span>
<span id="cb52-1745"><a href="#cb52-1745"></a><span class="in">#| out-width: '100%'</span></span>
<span id="cb52-1746"><a href="#cb52-1746"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-1747"><a href="#cb52-1747"></a></span>
<span id="cb52-1748"><a href="#cb52-1748"></a><span class="in">production[ 1:10 ] %&gt;%</span></span>
<span id="cb52-1749"><a href="#cb52-1749"></a><span class="in">  kable(</span></span>
<span id="cb52-1750"><a href="#cb52-1750"></a><span class="in">    label = NA,</span></span>
<span id="cb52-1751"><a href="#cb52-1751"></a><span class="in">    caption = 'Pólizas',</span></span>
<span id="cb52-1752"><a href="#cb52-1752"></a><span class="in">    row.names = FALSE,</span></span>
<span id="cb52-1753"><a href="#cb52-1753"></a><span class="in">    align = 'llllrrrrrrrl',</span></span>
<span id="cb52-1754"><a href="#cb52-1754"></a><span class="in">    digits = c( 0, 0, 0, 0, 0, 2, 2, 2, 0, 0, 0, 0 ),</span></span>
<span id="cb52-1755"><a href="#cb52-1755"></a><span class="in">    format.args = list( big.mark = ',', decimal.mark = '.', scientific = FALSE ),</span></span>
<span id="cb52-1756"><a href="#cb52-1756"></a><span class="in">    escape = FALSE,</span></span>
<span id="cb52-1757"><a href="#cb52-1757"></a><span class="in">    centering = TRUE,</span></span>
<span id="cb52-1758"><a href="#cb52-1758"></a><span class="in">    booktabs = TRUE,</span></span>
<span id="cb52-1759"><a href="#cb52-1759"></a><span class="in">    longtable = TRUE ) %&gt;%</span></span>
<span id="cb52-1760"><a href="#cb52-1760"></a><span class="in">  kable_classic( </span></span>
<span id="cb52-1761"><a href="#cb52-1761"></a><span class="in">    full_width = FALSE, </span></span>
<span id="cb52-1762"><a href="#cb52-1762"></a><span class="in">    html_font = "Cambria", </span></span>
<span id="cb52-1763"><a href="#cb52-1763"></a><span class="in">    position = 'center', </span></span>
<span id="cb52-1764"><a href="#cb52-1764"></a><span class="in">    latex_options = c( 'hold_position', 'repeat_header', 'scale_down' ) ) %&gt;%</span></span>
<span id="cb52-1765"><a href="#cb52-1765"></a><span class="in">  scroll_box( width = "100%", height = "500px" )</span></span>
<span id="cb52-1766"><a href="#cb52-1766"></a><span class="in">```</span></span>
<span id="cb52-1767"><a href="#cb52-1767"></a></span>
<span id="cb52-1768"><a href="#cb52-1768"></a>Los reclamos se detallan en la tabla a continuación. En la información no se dispone del valor </span>
<span id="cb52-1769"><a href="#cb52-1769"></a>original del reclamo, sino tan solo del valor pagado, después de aplicar la función deducible $D$.</span>
<span id="cb52-1770"><a href="#cb52-1770"></a>En la misma información se incluye el deducible $d$ y el monto de máximo de cobertura $M$ que se </span>
<span id="cb52-1771"><a href="#cb52-1771"></a>utilizó para aplicar la deducción.</span>
<span id="cb52-1772"><a href="#cb52-1772"></a><span class="in">```{r l6t2}</span></span>
<span id="cb52-1773"><a href="#cb52-1773"></a><span class="in">#| echo: true</span></span>
<span id="cb52-1774"><a href="#cb52-1774"></a><span class="in">#| out-width: '100%'</span></span>
<span id="cb52-1775"><a href="#cb52-1775"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-1776"><a href="#cb52-1776"></a><span class="in">claims[ 1:10 ] %&gt;%</span></span>
<span id="cb52-1777"><a href="#cb52-1777"></a><span class="in">  kable(</span></span>
<span id="cb52-1778"><a href="#cb52-1778"></a><span class="in">    label = NA,</span></span>
<span id="cb52-1779"><a href="#cb52-1779"></a><span class="in">    caption = 'Reclamos',</span></span>
<span id="cb52-1780"><a href="#cb52-1780"></a><span class="in">    row.names = FALSE,</span></span>
<span id="cb52-1781"><a href="#cb52-1781"></a><span class="in">    align = 'lllllrrrll',</span></span>
<span id="cb52-1782"><a href="#cb52-1782"></a><span class="in">    digits = c( 0, 0, 0, 0, 0, 0, 2, 0, 0, 0 ),</span></span>
<span id="cb52-1783"><a href="#cb52-1783"></a><span class="in">    format.args = list( big.mark = ',', decimal.mark = '.', scientific = FALSE ),</span></span>
<span id="cb52-1784"><a href="#cb52-1784"></a><span class="in">    escape = FALSE,</span></span>
<span id="cb52-1785"><a href="#cb52-1785"></a><span class="in">    centering = TRUE,</span></span>
<span id="cb52-1786"><a href="#cb52-1786"></a><span class="in">    booktabs = TRUE, </span></span>
<span id="cb52-1787"><a href="#cb52-1787"></a><span class="in">    longtable = TRUE ) %&gt;%</span></span>
<span id="cb52-1788"><a href="#cb52-1788"></a><span class="in">  kable_classic( </span></span>
<span id="cb52-1789"><a href="#cb52-1789"></a><span class="in">    full_width = FALSE, </span></span>
<span id="cb52-1790"><a href="#cb52-1790"></a><span class="in">    html_font = "Cambria", </span></span>
<span id="cb52-1791"><a href="#cb52-1791"></a><span class="in">    position = 'center', </span></span>
<span id="cb52-1792"><a href="#cb52-1792"></a><span class="in">    latex_options = c( 'hold_position', 'repeat_header', 'scale_down' ) ) %&gt;%</span></span>
<span id="cb52-1793"><a href="#cb52-1793"></a><span class="in">  scroll_box( width = "100%", height = "500px" )</span></span>
<span id="cb52-1794"><a href="#cb52-1794"></a><span class="in">```</span></span>
<span id="cb52-1795"><a href="#cb52-1795"></a></span>
<span id="cb52-1796"><a href="#cb52-1796"></a>Primero definimos algunos parámetros que consideramos serán útiles en el desarrollo del ejemplo.</span>
<span id="cb52-1797"><a href="#cb52-1797"></a>Lo primero es definir las fechas que marcan el periodo para el cual estamos interesados en estudiar,</span>
<span id="cb52-1798"><a href="#cb52-1798"></a>con ello seleccionamos la periodicidad con la cual vamos a medir la frecuencia de los reclamos, </span>
<span id="cb52-1799"><a href="#cb52-1799"></a>en este caso de forma anual <span class="in">`year`</span>. También, seleccionamos de antemano unas edades para formar </span>
<span id="cb52-1800"><a href="#cb52-1800"></a>grupos de riesgo por edad. </span>
<span id="cb52-1801"><a href="#cb52-1801"></a><span class="in">```{r l6c17}</span></span>
<span id="cb52-1802"><a href="#cb52-1802"></a><span class="in">idate &lt;- ymd( '2018-01-01' )</span></span>
<span id="cb52-1803"><a href="#cb52-1803"></a><span class="in">edate &lt;- ymd( '2021-01-01' )</span></span>
<span id="cb52-1804"><a href="#cb52-1804"></a><span class="in">sdate &lt;- seq( idate, edate, by = 'year' )</span></span>
<span id="cb52-1805"><a href="#cb52-1805"></a><span class="in">dates &lt;- data.table( di = sdate[ -length( sdate ) ], de = sdate[ -1 ] )</span></span>
<span id="cb52-1806"><a href="#cb52-1806"></a><span class="in">dates[ , tid := 1 ]</span></span>
<span id="cb52-1807"><a href="#cb52-1807"></a><span class="in">xgs &lt;- c( 0, 20, 40, 60, Inf )</span></span>
<span id="cb52-1808"><a href="#cb52-1808"></a><span class="in">```</span></span>
<span id="cb52-1809"><a href="#cb52-1809"></a></span>
<span id="cb52-1810"><a href="#cb52-1810"></a>Para generar un modelo de pérdida, asumiremos que la frecuencia de los siniestros $N$ es </span>
<span id="cb52-1811"><a href="#cb52-1811"></a>independiente de los reclamos $<span class="sc">\{</span>X_i<span class="sc">\}</span>$. Con ellos estaremos en la capacidad de formular un </span>
<span id="cb52-1812"><a href="#cb52-1812"></a>modelo colectivo de riesgo.</span>
<span id="cb52-1813"><a href="#cb52-1813"></a></span>
<span id="cb52-1814"><a href="#cb52-1814"></a>Ahora tratamos la información correspondiente a la producción de las pólizas, en particular </span>
<span id="cb52-1815"><a href="#cb52-1815"></a>extrayendo las pólizas que intersectan con los periodo de observación y creando los grupos de </span>
<span id="cb52-1816"><a href="#cb52-1816"></a>edades <span class="in">`xg`</span>.</span>
<span id="cb52-1817"><a href="#cb52-1817"></a><span class="in">```{r l6c18}</span></span>
<span id="cb52-1818"><a href="#cb52-1818"></a><span class="in">production[ , tid := 1 ]</span></span>
<span id="cb52-1819"><a href="#cb52-1819"></a><span class="in">prod_prep &lt;- merge.data.table( dates, production, by = 'tid', all.x = TRUE, allow.cartesian = TRUE )</span></span>
<span id="cb52-1820"><a href="#cb52-1820"></a><span class="in">prod_prep[ , tid := NULL ]</span></span>
<span id="cb52-1821"><a href="#cb52-1821"></a><span class="in">prod_prep &lt;- prod_prep[ start &lt; de &amp; end &gt;= di ]</span></span>
<span id="cb52-1822"><a href="#cb52-1822"></a><span class="in">prod_prep[ , fi := pmax( start, di ) ]</span></span>
<span id="cb52-1823"><a href="#cb52-1823"></a><span class="in">prod_prep[ , fe := pmin( end, de ) ]</span></span>
<span id="cb52-1824"><a href="#cb52-1824"></a><span class="in">prod_prep[ , fm := fi + ( fe - fi ) / 2 ]</span></span>
<span id="cb52-1825"><a href="#cb52-1825"></a><span class="in">prod_prep[ , x := pmax( round( interval( bdate, fm ) / dyears( 1 ), 0 ), 0 ) ]</span></span>
<span id="cb52-1826"><a href="#cb52-1826"></a><span class="in">prod_prep[ , xg := cut( x = x, breaks = xgs, include.lowest = TRUE, ordered_result = TRUE, right = FALSE ) ]</span></span>
<span id="cb52-1827"><a href="#cb52-1827"></a></span>
<span id="cb52-1828"><a href="#cb52-1828"></a><span class="in">noclaims_prep &lt;- unique( prod_prep[ , list( policy, id, sex, xg, bdate, di, de, N = 0, S = 0 ) ] )</span></span>
<span id="cb52-1829"><a href="#cb52-1829"></a><span class="in">noclaims_prep &lt;- noclaims_prep[ , list( policy, id, sex, xg, bdate, di, de, N, S ) ]</span></span>
<span id="cb52-1830"><a href="#cb52-1830"></a><span class="in">```</span></span>
<span id="cb52-1831"><a href="#cb52-1831"></a></span>
<span id="cb52-1832"><a href="#cb52-1832"></a>Así mismo, trabajamos con la información correspondiente a los reclamos. Primeramente los agregados</span>
<span id="cb52-1833"><a href="#cb52-1833"></a>por código único de siniestro <span class="in">`idc`</span>, fecha de siniestro <span class="in">`cdate`</span> y periodo de observación <span class="in">`di`</span> a </span>
<span id="cb52-1834"><a href="#cb52-1834"></a><span class="in">`de`</span>, esto para agrupar los reclamos que corresponden a un solo siniestros por periodo. Luego, </span>
<span id="cb52-1835"><a href="#cb52-1835"></a>filtramos los siniestros que solo se presentan en el periodo de observación. También, se cuenta </span>
<span id="cb52-1836"><a href="#cb52-1836"></a>cuantos siniestros presenta cada asegurado según por su código único de identificación <span class="in">`id`</span> y </span>
<span id="cb52-1837"><a href="#cb52-1837"></a>también la póliza a la que pertenecen <span class="in">`policy`</span>.</span>
<span id="cb52-1838"><a href="#cb52-1838"></a></span>
<span id="cb52-1839"><a href="#cb52-1839"></a>Finalmente, se hace una estadística de frecuencia por cada grupo de riesgo dados por el sexo </span>
<span id="cb52-1840"><a href="#cb52-1840"></a><span class="in">`sex`</span> y el grupo de edad <span class="in">`xg`</span>. En particular se calcula el indicador para la familia de Panjer, </span>
<span id="cb52-1841"><a href="#cb52-1841"></a>esto con la finalidad de caracterizar el tipo de distribución que determina la frecuencia </span>
<span id="cb52-1842"><a href="#cb52-1842"></a>de los reclamos.</span>
<span id="cb52-1843"><a href="#cb52-1843"></a><span class="in">```{r l6c19}</span></span>
<span id="cb52-1844"><a href="#cb52-1844"></a><span class="in">claims_prep &lt;- claims[ , list( DX = sum( claim ) ), by = list( policy, id, idc, type, sex, bdate, cdate ) ]</span></span>
<span id="cb52-1845"><a href="#cb52-1845"></a><span class="in">claims_prep[ , x := round( interval( bdate, cdate ) / dyears( 1 ), 0 ) ]</span></span>
<span id="cb52-1846"><a href="#cb52-1846"></a><span class="in">claims_prep[ , xg := cut( x = x, breaks = xgs, include.lowest = TRUE, ordered_result = TRUE, right = FALSE ) ]</span></span>
<span id="cb52-1847"><a href="#cb52-1847"></a><span class="in">claims_prep[ , tid := 1 ]</span></span>
<span id="cb52-1848"><a href="#cb52-1848"></a><span class="in">claims_prep &lt;- merge.data.table( dates, claims_prep, by = c( 'tid' ), all.x = TRUE, allow.cartesian = TRUE )</span></span>
<span id="cb52-1849"><a href="#cb52-1849"></a><span class="in">claims_prep[ , tid := NULL ]</span></span>
<span id="cb52-1850"><a href="#cb52-1850"></a><span class="in">claims_prep &lt;- claims_prep[ cdate &gt;= di &amp; cdate &lt; de ]</span></span>
<span id="cb52-1851"><a href="#cb52-1851"></a><span class="in">claims_prep &lt;- claims_prep[ , list( N = .N, S = sum( DX ) ), by = list( policy, id, sex, xg, bdate, di, de ) ]</span></span>
<span id="cb52-1852"><a href="#cb52-1852"></a><span class="in">claims_prep &lt;- rbind( claims_prep, noclaims_prep )</span></span>
<span id="cb52-1853"><a href="#cb52-1853"></a><span class="in">claims_prep &lt;- claims_prep[ , list( N = sum( N ), S = sum( S ) ), by = list( policy, id, sex, xg, bdate, di, de ) ]</span></span>
<span id="cb52-1854"><a href="#cb52-1854"></a></span>
<span id="cb52-1855"><a href="#cb52-1855"></a><span class="in">count &lt;- copy( claims_prep )</span></span>
<span id="cb52-1856"><a href="#cb52-1856"></a><span class="in">count &lt;- count[ , list( fn = .N, S = sum( S ) ), by = list( sex, xg, N ) ]</span></span>
<span id="cb52-1857"><a href="#cb52-1857"></a></span>
<span id="cb52-1858"><a href="#cb52-1858"></a><span class="in">expand &lt;- count[ , list( N = max( N ) ), by = list( sex, xg ) ]</span></span>
<span id="cb52-1859"><a href="#cb52-1859"></a><span class="in">expand &lt;- expand[ , list( N = seq( 0, N, 1 ) ), by = list( sex, xg ) ]</span></span>
<span id="cb52-1860"><a href="#cb52-1860"></a></span>
<span id="cb52-1861"><a href="#cb52-1861"></a><span class="in">count &lt;- merge.data.table( expand, count, by = c( 'sex', 'xg', 'N' ), all.x = TRUE )</span></span>
<span id="cb52-1862"><a href="#cb52-1862"></a><span class="in">count[ is.na( fn ), fn := 0 ]</span></span>
<span id="cb52-1863"><a href="#cb52-1863"></a><span class="in">count[ is.na( S ), S := 0 ]</span></span>
<span id="cb52-1864"><a href="#cb52-1864"></a><span class="in">setorder( count, sex, xg, N )</span></span>
<span id="cb52-1865"><a href="#cb52-1865"></a><span class="in">count[ , pn := fn / sum( fn ), by = list( sex, xg ) ]</span></span>
<span id="cb52-1866"><a href="#cb52-1866"></a><span class="in">count[ , vn := shift( pn, fill = 0 ), by = list( sex, xg ) ]</span></span>
<span id="cb52-1867"><a href="#cb52-1867"></a><span class="in">count[ vn != 0, vn := N * pn / vn ]</span></span>
<span id="cb52-1868"><a href="#cb52-1868"></a><span class="in">count[ vn == 0, vn := 0 ]</span></span>
<span id="cb52-1869"><a href="#cb52-1869"></a></span>
<span id="cb52-1870"><a href="#cb52-1870"></a><span class="in">grpcl &lt;- unique( count[ , list( sex, xg ) ] )</span></span>
<span id="cb52-1871"><a href="#cb52-1871"></a><span class="in">grpcl[ , grp := paste0( sex, ' ', xg ) ]</span></span>
<span id="cb52-1872"><a href="#cb52-1872"></a><span class="in">setorder( grpcl, sex, xg )</span></span>
<span id="cb52-1873"><a href="#cb52-1873"></a></span>
<span id="cb52-1874"><a href="#cb52-1874"></a><span class="in">count[ , grp := factor( paste0( sex, ' ', xg ), labels = grpcl$grp, ordered = TRUE ) ]</span></span>
<span id="cb52-1875"><a href="#cb52-1875"></a><span class="in">claims_prep[ , grp := factor( paste0( sex, ' ', xg ), labels = grpcl$grp, ordered = TRUE ) ]</span></span>
<span id="cb52-1876"><a href="#cb52-1876"></a><span class="in">```</span></span>
<span id="cb52-1877"><a href="#cb52-1877"></a></span>
<span id="cb52-1878"><a href="#cb52-1878"></a>Los grupos de riesgo, que designaremos con un índice $g$, los hemos seleccionado para estudiar la </span>
<span id="cb52-1879"><a href="#cb52-1879"></a>frecuencia y severidad de los reclamos, estos son los siguientes:</span>
<span id="cb52-1880"><a href="#cb52-1880"></a><span class="in">```{r l6t3}</span></span>
<span id="cb52-1881"><a href="#cb52-1881"></a><span class="in">#| echo: true</span></span>
<span id="cb52-1882"><a href="#cb52-1882"></a><span class="in">#| out-width: '100%'</span></span>
<span id="cb52-1883"><a href="#cb52-1883"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-1884"><a href="#cb52-1884"></a><span class="in">grpcl %&gt;%</span></span>
<span id="cb52-1885"><a href="#cb52-1885"></a><span class="in">  kable(</span></span>
<span id="cb52-1886"><a href="#cb52-1886"></a><span class="in">    label = NA,</span></span>
<span id="cb52-1887"><a href="#cb52-1887"></a><span class="in">    caption = 'Grupos de clasificación del riesgo',</span></span>
<span id="cb52-1888"><a href="#cb52-1888"></a><span class="in">    row.names = FALSE,</span></span>
<span id="cb52-1889"><a href="#cb52-1889"></a><span class="in">    col.names = c( 'sex', '$x_g$', 'grupo' ),</span></span>
<span id="cb52-1890"><a href="#cb52-1890"></a><span class="in">    align = 'lll',</span></span>
<span id="cb52-1891"><a href="#cb52-1891"></a><span class="in">    digits = c( 0, 0, 0 ),</span></span>
<span id="cb52-1892"><a href="#cb52-1892"></a><span class="in">    format.args = list( big.mark = ',', decimal.mark = '.', scientific = FALSE ),</span></span>
<span id="cb52-1893"><a href="#cb52-1893"></a><span class="in">    escape = FALSE,</span></span>
<span id="cb52-1894"><a href="#cb52-1894"></a><span class="in">    centering = TRUE,</span></span>
<span id="cb52-1895"><a href="#cb52-1895"></a><span class="in">    booktabs = TRUE ) %&gt;%</span></span>
<span id="cb52-1896"><a href="#cb52-1896"></a><span class="in">  kable_classic( full_width = FALSE, html_font = "Cambria", position = "center" ) %&gt;%</span></span>
<span id="cb52-1897"><a href="#cb52-1897"></a><span class="in">  scroll_box( width = "100%", height = "500px" )</span></span>
<span id="cb52-1898"><a href="#cb52-1898"></a><span class="in">```</span></span>
<span id="cb52-1899"><a href="#cb52-1899"></a></span>
<span id="cb52-1900"><a href="#cb52-1900"></a>El gráfico a continuación muestra el comportamiento del indicador $v_n = n \frac{p_n}{p_{n-1}}$, </span>
<span id="cb52-1901"><a href="#cb52-1901"></a>para cada uno de los grupos $g$ de riesgo.</span>
<span id="cb52-1902"><a href="#cb52-1902"></a><span class="in">```{r l6g15}</span></span>
<span id="cb52-1903"><a href="#cb52-1903"></a><span class="in">#| warning: false</span></span>
<span id="cb52-1904"><a href="#cb52-1904"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-1905"><a href="#cb52-1905"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-1906"><a href="#cb52-1906"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-1907"><a href="#cb52-1907"></a><span class="in">plt &lt;- ggplot( ) +</span></span>
<span id="cb52-1908"><a href="#cb52-1908"></a><span class="in">  geom_point( data = count, aes( x = N, y = vn ), colour = 'red3', size = 0.5 ) +</span></span>
<span id="cb52-1909"><a href="#cb52-1909"></a><span class="in">  facet_wrap( vars( grp ), ncol = 4 ) +</span></span>
<span id="cb52-1910"><a href="#cb52-1910"></a><span class="in">  xlab( TeX( "$n$" ) ) + </span></span>
<span id="cb52-1911"><a href="#cb52-1911"></a><span class="in">  ylab( TeX( "$v_n$" ) ) + </span></span>
<span id="cb52-1912"><a href="#cb52-1912"></a><span class="in">  theme_bw() +</span></span>
<span id="cb52-1913"><a href="#cb52-1913"></a><span class="in">  theme( legend.position = "none" )</span></span>
<span id="cb52-1914"><a href="#cb52-1914"></a><span class="in">plot( plt )</span></span>
<span id="cb52-1915"><a href="#cb52-1915"></a><span class="in">```</span></span>
<span id="cb52-1916"><a href="#cb52-1916"></a></span>
<span id="cb52-1917"><a href="#cb52-1917"></a>Como hemos evidenciado, para todos los casos en consideración el indicador $v_n$ tiene un tendencia </span>
<span id="cb52-1918"><a href="#cb52-1918"></a>creciente y se evidencia un crecimiento con orden lineal, esto sugiere que la distribución discreta </span>
<span id="cb52-1919"><a href="#cb52-1919"></a>más adecuada para explicar la frecuencia de los reclamos para cada grupo es una binomial negativa </span>
<span id="cb52-1920"><a href="#cb52-1920"></a>$N \rightsquigarrow NBin( \alpha, p )$. Para la estimación por maximización de verosimilitud, </span>
<span id="cb52-1921"><a href="#cb52-1921"></a>hacemos uso de la función <span class="in">`fitdist`</span> con la cual estimaremos los parámetros dentro de una familia </span>
<span id="cb52-1922"><a href="#cb52-1922"></a>de distribuciones binomiales negativas.</span>
<span id="cb52-1923"><a href="#cb52-1923"></a></span>
<span id="cb52-1924"><a href="#cb52-1924"></a>Por su parte, la función de verosimilitud logarítmica para la frecuencia tiene la siguiente forma </span>
<span id="cb52-1925"><a href="#cb52-1925"></a>para cada grupo $g$.</span>
<span id="cb52-1926"><a href="#cb52-1926"></a>$$</span>
<span id="cb52-1927"><a href="#cb52-1927"></a>\begin{split}</span>
<span id="cb52-1928"><a href="#cb52-1928"></a>\ell_g( \alpha, p ) </span>
<span id="cb52-1929"><a href="#cb52-1929"></a>&amp; = \sum\limits_{i=1}^{n_g} </span>
<span id="cb52-1930"><a href="#cb52-1930"></a>\left<span class="sc">\{</span> \log\left( \Gamma( \alpha + N_i ) \right)</span>
<span id="cb52-1931"><a href="#cb52-1931"></a><span class="ss">- </span>\log\left( \Gamma(N_i + 1) \right) </span>
<span id="cb52-1932"><a href="#cb52-1932"></a><span class="ss">- </span>\log\left( \Gamma(\alpha) \right) </span>
<span id="cb52-1933"><a href="#cb52-1933"></a><span class="ss">+ </span>\alpha \log(p) </span>
<span id="cb52-1934"><a href="#cb52-1934"></a><span class="ss">+ </span>N_i \log( 1 - p ) \right<span class="sc">\}</span> <span class="sc">\\</span></span>
<span id="cb52-1935"><a href="#cb52-1935"></a>&amp; = \sum\limits_{i=1}^{n_g} </span>
<span id="cb52-1936"><a href="#cb52-1936"></a>\left<span class="sc">\{</span> \log\left( \Gamma( \alpha + N_i ) \right)</span>
<span id="cb52-1937"><a href="#cb52-1937"></a><span class="ss">- </span>\log\left( \Gamma(N_i + 1) \right) \right<span class="sc">\}</span></span>
<span id="cb52-1938"><a href="#cb52-1938"></a><span class="ss">- </span>n_g \log\left( \Gamma(\alpha) \right)</span>
<span id="cb52-1939"><a href="#cb52-1939"></a><span class="ss">+ </span>n_g \alpha \log(p) </span>
<span id="cb52-1940"><a href="#cb52-1940"></a><span class="ss">+ </span>n \log( 1 - p )</span>
<span id="cb52-1941"><a href="#cb52-1941"></a>\end{split}</span>
<span id="cb52-1942"><a href="#cb52-1942"></a>$$</span>
<span id="cb52-1943"><a href="#cb52-1943"></a>Como ya lo mencionamos, para cada grupo $g$ podemos maximizar la verosimilitud logarítmica de la </span>
<span id="cb52-1944"><a href="#cb52-1944"></a>frecuencia utilizando la función <span class="in">`fitdist`</span> del paquete <span class="in">`fitdistrplus`</span>.</span>
<span id="cb52-1945"><a href="#cb52-1945"></a><span class="in">```{r l6c20}</span></span>
<span id="cb52-1946"><a href="#cb52-1946"></a><span class="in">#| warning: false</span></span>
<span id="cb52-1947"><a href="#cb52-1947"></a><span class="in">fit_count &lt;- list()</span></span>
<span id="cb52-1948"><a href="#cb52-1948"></a><span class="in">estim_frec &lt;- NULL</span></span>
<span id="cb52-1949"><a href="#cb52-1949"></a></span>
<span id="cb52-1950"><a href="#cb52-1950"></a><span class="in">for ( g in grpcl$grp ) {</span></span>
<span id="cb52-1951"><a href="#cb52-1951"></a><span class="in">  </span></span>
<span id="cb52-1952"><a href="#cb52-1952"></a><span class="in">  fit_count[[ g ]] &lt;- fitdistrplus::fitdist( </span></span>
<span id="cb52-1953"><a href="#cb52-1953"></a><span class="in">    claims_prep[ grp == g ]$N, </span></span>
<span id="cb52-1954"><a href="#cb52-1954"></a><span class="in">    distr = dnbinom, </span></span>
<span id="cb52-1955"><a href="#cb52-1955"></a><span class="in">    method = 'mle', </span></span>
<span id="cb52-1956"><a href="#cb52-1956"></a><span class="in">    keepdata = TRUE, </span></span>
<span id="cb52-1957"><a href="#cb52-1957"></a><span class="in">    discrete = TRUE )</span></span>
<span id="cb52-1958"><a href="#cb52-1958"></a><span class="in">  </span></span>
<span id="cb52-1959"><a href="#cb52-1959"></a><span class="in">  </span></span>
<span id="cb52-1960"><a href="#cb52-1960"></a><span class="in">  estim_frec &lt;- rbind(</span></span>
<span id="cb52-1961"><a href="#cb52-1961"></a><span class="in">    estim_frec,</span></span>
<span id="cb52-1962"><a href="#cb52-1962"></a><span class="in">    data.table( grp = g, </span></span>
<span id="cb52-1963"><a href="#cb52-1963"></a><span class="in">                a = fit_count[[ g ]]$estimate[1], </span></span>
<span id="cb52-1964"><a href="#cb52-1964"></a><span class="in">                EN = fit_count[[ g ]]$estimate[2], </span></span>
<span id="cb52-1965"><a href="#cb52-1965"></a><span class="in">                loglik = fit_count[[ g ]]$loglik,</span></span>
<span id="cb52-1966"><a href="#cb52-1966"></a><span class="in">                aic = fit_count[[ g ]]$aic,</span></span>
<span id="cb52-1967"><a href="#cb52-1967"></a><span class="in">                bic = fit_count[[ g ]]$bic )</span></span>
<span id="cb52-1968"><a href="#cb52-1968"></a><span class="in">  )</span></span>
<span id="cb52-1969"><a href="#cb52-1969"></a><span class="in">}</span></span>
<span id="cb52-1970"><a href="#cb52-1970"></a><span class="in">estim_frec[ , p := a / ( a + EN ) ]</span></span>
<span id="cb52-1971"><a href="#cb52-1971"></a><span class="in">estim_frec[ , SDN := sqrt( a * ( 1 - p ) / p^2 ) ]</span></span>
<span id="cb52-1972"><a href="#cb52-1972"></a><span class="in">estim_frec &lt;- estim_frec[ , list( grp, a, p, EN, SDN, loglik, aic, bic )]</span></span>
<span id="cb52-1973"><a href="#cb52-1973"></a><span class="in">```</span></span>
<span id="cb52-1974"><a href="#cb52-1974"></a></span>
<span id="cb52-1975"><a href="#cb52-1975"></a>En la lista que hemos creado <span class="in">`fit_count`</span> hemos almacenado cada una de los objetos con las </span>
<span id="cb52-1976"><a href="#cb52-1976"></a>estimaciones de la frecuencia para cada uno de los grupos. A continuación, presentamos los </span>
<span id="cb52-1977"><a href="#cb52-1977"></a>resultados de la estimación para la frecuencia.</span>
<span id="cb52-1978"><a href="#cb52-1978"></a><span class="in">```{r l6t4}</span></span>
<span id="cb52-1979"><a href="#cb52-1979"></a><span class="in">#| echo: true</span></span>
<span id="cb52-1980"><a href="#cb52-1980"></a><span class="in">#| results: asis</span></span>
<span id="cb52-1981"><a href="#cb52-1981"></a><span class="in">#| out-width: '100%'</span></span>
<span id="cb52-1982"><a href="#cb52-1982"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-1983"><a href="#cb52-1983"></a><span class="in">estim_frec %&gt;%</span></span>
<span id="cb52-1984"><a href="#cb52-1984"></a><span class="in">  kable(</span></span>
<span id="cb52-1985"><a href="#cb52-1985"></a><span class="in">    label = NA,</span></span>
<span id="cb52-1986"><a href="#cb52-1986"></a><span class="in">    caption = 'Estimación de frecuencia',</span></span>
<span id="cb52-1987"><a href="#cb52-1987"></a><span class="in">    row.names = FALSE,</span></span>
<span id="cb52-1988"><a href="#cb52-1988"></a><span class="in">    col.names = c( '$g$', '$\\alpha$', '$p$', '$\\E[ N ]$', '$\\sqrt{\\V[ N ]}$', '$\\ell( n, p )$', '$AIC$', '$BIC$' ),</span></span>
<span id="cb52-1989"><a href="#cb52-1989"></a><span class="in">    align = 'lrrrrrrr',</span></span>
<span id="cb52-1990"><a href="#cb52-1990"></a><span class="in">    digits = c( 0, 5, 5, 5, 5,  5, 2, 2 ),</span></span>
<span id="cb52-1991"><a href="#cb52-1991"></a><span class="in">    format.args = list( big.mark = ',', decimal.mark = '.', scientific = FALSE ),</span></span>
<span id="cb52-1992"><a href="#cb52-1992"></a><span class="in">    escape = FALSE,</span></span>
<span id="cb52-1993"><a href="#cb52-1993"></a><span class="in">    centering = TRUE,</span></span>
<span id="cb52-1994"><a href="#cb52-1994"></a><span class="in">    booktabs = TRUE ) %&gt;%</span></span>
<span id="cb52-1995"><a href="#cb52-1995"></a><span class="in">  kable_classic( full_width = FALSE, html_font = "Cambria", position = "center" ) %&gt;%</span></span>
<span id="cb52-1996"><a href="#cb52-1996"></a><span class="in">  scroll_box( width = "100%", height = "500px" )</span></span>
<span id="cb52-1997"><a href="#cb52-1997"></a><span class="in">```</span></span>
<span id="cb52-1998"><a href="#cb52-1998"></a></span>
<span id="cb52-1999"><a href="#cb52-1999"></a>Ahora, nos enfocamos en estudiar la severidad de los reclamos. Desde un inicio sabemos que los </span>
<span id="cb52-2000"><a href="#cb52-2000"></a>valores de los reclamos ya vienen censurados, a causa de la aplicación de la función deducible $D$,</span>
<span id="cb52-2001"><a href="#cb52-2001"></a>como consecuencia tenemos pérdida de información que no podemos recuperar, por tal razón es de </span>
<span id="cb52-2002"><a href="#cb52-2002"></a>esperar que la función de distribución acumulada de los reclamos deducidos $D(X)$ tenga </span>
<span id="cb52-2003"><a href="#cb52-2003"></a>singularidades. Si buscamos utilizar el método de máxima verosimilitud para la estimación de la </span>
<span id="cb52-2004"><a href="#cb52-2004"></a>mejor distribución, debemos hacer uso de la expresión completa que presentamos en \ref{eq:loglik}. </span>
<span id="cb52-2005"><a href="#cb52-2005"></a><span class="in">```{r l6c21}</span></span>
<span id="cb52-2006"><a href="#cb52-2006"></a><span class="in">sev_claims &lt;- claims[ , list( policy, id, idc, type, sex, bdate, cdate, deductible, amount, claim ) ]</span></span>
<span id="cb52-2007"><a href="#cb52-2007"></a><span class="in">sev_claims[ , x := round( interval( bdate, cdate ) / dyears( 1 ), 0 ) ]</span></span>
<span id="cb52-2008"><a href="#cb52-2008"></a><span class="in">sev_claims[ , xg := cut( x = x, breaks = xgs, include.lowest = TRUE, ordered_result = TRUE, right = FALSE ) ]</span></span>
<span id="cb52-2009"><a href="#cb52-2009"></a><span class="in">sev_claims[ , tid := 1 ]</span></span>
<span id="cb52-2010"><a href="#cb52-2010"></a><span class="in">sev_claims &lt;- merge.data.table( dates, sev_claims, by = c( 'tid' ), all.x = TRUE, allow.cartesian = TRUE )</span></span>
<span id="cb52-2011"><a href="#cb52-2011"></a><span class="in">sev_claims &lt;- sev_claims[ cdate &gt;= di &amp; cdate &lt; de ]</span></span>
<span id="cb52-2012"><a href="#cb52-2012"></a><span class="in">sev_claims[ , tid := NULL ]</span></span>
<span id="cb52-2013"><a href="#cb52-2013"></a><span class="in">sev_claims[ , grp := factor( paste0( sex, ' ', xg ), labels = grpcl$grp, ordered = TRUE ) ]</span></span>
<span id="cb52-2014"><a href="#cb52-2014"></a><span class="in">```</span></span>
<span id="cb52-2015"><a href="#cb52-2015"></a></span>
<span id="cb52-2016"><a href="#cb52-2016"></a>Los histogramas a continuación muestran como se distribuyen los reclamos ya censurados por cada </span>
<span id="cb52-2017"><a href="#cb52-2017"></a>grupos de riesgo.</span>
<span id="cb52-2018"><a href="#cb52-2018"></a><span class="in">```{r l6g16}</span></span>
<span id="cb52-2019"><a href="#cb52-2019"></a><span class="in">#| warning: false</span></span>
<span id="cb52-2020"><a href="#cb52-2020"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-2021"><a href="#cb52-2021"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-2022"><a href="#cb52-2022"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-2023"><a href="#cb52-2023"></a><span class="in">xlim &lt;- c( 0, 1e3 )</span></span>
<span id="cb52-2024"><a href="#cb52-2024"></a><span class="in">xbrk &lt;- seq( xlim[1], xlim[2], length = 5 )</span></span>
<span id="cb52-2025"><a href="#cb52-2025"></a><span class="in">xlbl &lt;- xbrk</span></span>
<span id="cb52-2026"><a href="#cb52-2026"></a></span>
<span id="cb52-2027"><a href="#cb52-2027"></a><span class="in">bins &lt;- sev_claims[ , list( bins = nclass.scott( claim ) ), by = list( grp ) ]</span></span>
<span id="cb52-2028"><a href="#cb52-2028"></a></span>
<span id="cb52-2029"><a href="#cb52-2029"></a><span class="in">plt &lt;- ggplot( ) +</span></span>
<span id="cb52-2030"><a href="#cb52-2030"></a><span class="in">  geom_histogram( data = sev_claims, aes( claim, after_stat( density ) ), </span></span>
<span id="cb52-2031"><a href="#cb52-2031"></a><span class="in">                  fill = 'dodgerblue3', colour = 'dodgerblue4', alpha = 0.3, </span></span>
<span id="cb52-2032"><a href="#cb52-2032"></a><span class="in">                  bins = min( bins$bins ) ) +</span></span>
<span id="cb52-2033"><a href="#cb52-2033"></a><span class="in">  facet_wrap( vars( grp ), scale = 'free_x', ncol = 4 ) +</span></span>
<span id="cb52-2034"><a href="#cb52-2034"></a><span class="in">  scale_x_continuous( breaks = xbrk,</span></span>
<span id="cb52-2035"><a href="#cb52-2035"></a><span class="in">                      labels = xlbl,</span></span>
<span id="cb52-2036"><a href="#cb52-2036"></a><span class="in">                      limits = xlim,</span></span>
<span id="cb52-2037"><a href="#cb52-2037"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-2038"><a href="#cb52-2038"></a><span class="in">  xlab( TeX( "$D(X)$" ) ) + </span></span>
<span id="cb52-2039"><a href="#cb52-2039"></a><span class="in">  ylab( TeX( "$f_{D(X)}$" ) ) + </span></span>
<span id="cb52-2040"><a href="#cb52-2040"></a><span class="in">  theme_bw() +</span></span>
<span id="cb52-2041"><a href="#cb52-2041"></a><span class="in">  theme( legend.position = "none" )</span></span>
<span id="cb52-2042"><a href="#cb52-2042"></a><span class="in">plot( plt )</span></span>
<span id="cb52-2043"><a href="#cb52-2043"></a><span class="in">```</span></span>
<span id="cb52-2044"><a href="#cb52-2044"></a></span>
<span id="cb52-2045"><a href="#cb52-2045"></a>Por no incrementar la complejidad del ejemplo, asumiremos que los reclamos $X$ por cada grupo de</span>
<span id="cb52-2046"><a href="#cb52-2046"></a>riesgo son i.i.d. y estos siguen como distribución alguna presente en la familia log-normal, es </span>
<span id="cb52-2047"><a href="#cb52-2047"></a>decir $X \rightsquigarrow LN( \mu, \sigma )$. Además, es de notar que el razonamiento es válido para </span>
<span id="cb52-2048"><a href="#cb52-2048"></a>cualquier otra distribución. Más aún, sabemos que para cada reclamo $i$-ésimo se aplicó un deducible </span>
<span id="cb52-2049"><a href="#cb52-2049"></a>$d_i$ y un monto máximo asegurado $M_i$ determinado por la cobertura de la póliza y estos valores a</span>
<span id="cb52-2050"><a href="#cb52-2050"></a>su vez determinan el deducible $D_i$, la distribución de probabilidad para los valores aleatorios ya </span>
<span id="cb52-2051"><a href="#cb52-2051"></a>deducidos $Z = D_i(X)$, según lo ya estudiado en \@ref(deducibles), tiene la forma:</span>
<span id="cb52-2052"><a href="#cb52-2052"></a>$$</span>
<span id="cb52-2053"><a href="#cb52-2053"></a>F( z ) = \mathbf{1}_{[0,M_i)}( z ) F_X( z + d_i ) + \mathbf{1}_{[M_i,+\infty)}( z )</span>
<span id="cb52-2054"><a href="#cb52-2054"></a>$$</span>
<span id="cb52-2055"><a href="#cb52-2055"></a></span>
<span id="cb52-2056"><a href="#cb52-2056"></a>Entonces, tomando en cuenta la forma general que hemos desarrollado en \@ref(eq:loglik) y la </span>
<span id="cb52-2057"><a href="#cb52-2057"></a>forma anterior para la distribución acumulada de probabilidad, podemos determinar una expresión más </span>
<span id="cb52-2058"><a href="#cb52-2058"></a>precisa para la función de verosimilitud logarítmica, donde debemos tomar en cuenta las </span>
<span id="cb52-2059"><a href="#cb52-2059"></a>singularidades que producen los deducibles para cada póliza.</span>
<span id="cb52-2060"><a href="#cb52-2060"></a>$$</span>
<span id="cb52-2061"><a href="#cb52-2061"></a>\begin{split}</span>
<span id="cb52-2062"><a href="#cb52-2062"></a>\ell( \mu, \sigma )</span>
<span id="cb52-2063"><a href="#cb52-2063"></a>&amp; = \sum\limits_{x_i \in \Dif F} \log \left( f(x_i,\mu, \sigma) \right) </span>
<span id="cb52-2064"><a href="#cb52-2064"></a><span class="ss">+ </span>\sum\limits_{x_i \notin \Dif F} \log \left( F\left( x_i, \mu, \sigma \right) - F\left( x_i-, \mu, \sigma \right) \right) <span class="sc">\\</span></span>
<span id="cb52-2065"><a href="#cb52-2065"></a>&amp; = \sum\limits_{x_i \notin<span class="sc">\{</span>0,M_i<span class="sc">\}</span>} \log \left( f(x_i,\mu, \sigma) \right) </span>
<span id="cb52-2066"><a href="#cb52-2066"></a><span class="ss">+ </span>\sum\limits_{x_i \in<span class="sc">\{</span>0,M_i<span class="sc">\}</span>} \log \left( F\left( x_i, \mu, \sigma \right) - F\left( x_i-, \mu, \sigma \right) \right) <span class="sc">\\</span></span>
<span id="cb52-2067"><a href="#cb52-2067"></a>&amp; = \sum\limits_{x_i \notin <span class="sc">\{</span>0,M_i<span class="sc">\}</span>} </span>
<span id="cb52-2068"><a href="#cb52-2068"></a>\log \left( \frac{1}{x_i\sqrt{2\pi} \sigma}  \exp\left( -\frac{(\ln(x_i) - \mu)^2}{\sigma^2} \right) \right) </span>
<span id="cb52-2069"><a href="#cb52-2069"></a><span class="ss">+ </span>\sum\limits_{x_i = M_i} \log \left( 1 - F\left( M_i-, \mu, \sigma \right) \right) </span>
<span id="cb52-2070"><a href="#cb52-2070"></a><span class="ss">+ </span>\sum\limits_{x_i = 0} \log \left( F\left( 0, \mu, \sigma \right) - 0 \right) <span class="sc">\\</span></span>
<span id="cb52-2071"><a href="#cb52-2071"></a>&amp; = -\sum\limits_{x_i \notin<span class="sc">\{</span>0,M_i<span class="sc">\}</span>} \left<span class="sc">\{</span></span>
<span id="cb52-2072"><a href="#cb52-2072"></a>\frac{(\ln(x_i) - \mu)^2}{\sigma^2}</span>
<span id="cb52-2073"><a href="#cb52-2073"></a>+\log \left( x_i \right) </span>
<span id="cb52-2074"><a href="#cb52-2074"></a>+\log \left( \sqrt{2\pi} \sigma \right) \right<span class="sc">\}</span></span>
<span id="cb52-2075"><a href="#cb52-2075"></a><span class="ss">+ </span>\sum\limits_{x_i = M_i} \log \left( 1 - \frac{1}{\sqrt{2\pi} \sigma} \int\limits_{0}^{M_i + d_i} \frac{1}{y} \exp\left( -\frac{(\ln(y) - \mu)^2}{\sigma^2} \right)\ dy \right) <span class="sc">\\</span> </span>
<span id="cb52-2076"><a href="#cb52-2076"></a>&amp; + \sum\limits_{x_i = 0} \log \left( \frac{1}{\sqrt{2\pi} \sigma} \int\limits_{0}^{d_i} \frac{1}{y} \exp\left( -\frac{(\ln(y) - \mu)^2}{\sigma^2} \right)\ dy \right) <span class="sc">\\</span></span>
<span id="cb52-2077"><a href="#cb52-2077"></a>\end{split}</span>
<span id="cb52-2078"><a href="#cb52-2078"></a>$$</span>
<span id="cb52-2079"><a href="#cb52-2079"></a></span>
<span id="cb52-2080"><a href="#cb52-2080"></a>Preparamos la función de verosimilitud en R, en este caso debemos construirla explícitamente, sin la </span>
<span id="cb52-2081"><a href="#cb52-2081"></a>ayuda de alguna función en un paquete, esto se debe a que el deducible $d$ y el monto máximo de </span>
<span id="cb52-2082"><a href="#cb52-2082"></a>cobertura $M$ varían entre pólizas. Esta construcción debe ser realizada para cada grupo de riesgo y</span>
<span id="cb52-2083"><a href="#cb52-2083"></a>a su vez debemos maximizar cada una de las verosimilitudes logarítmicas, esto lo podemos realizar</span>
<span id="cb52-2084"><a href="#cb52-2084"></a>de forma integrada utilizando un bucle de programación <span class="in">`for`</span> y el método de optimización no </span>
<span id="cb52-2085"><a href="#cb52-2085"></a>lineal <span class="in">`nloptr`</span> del paquete con el mismo nombre.</span>
<span id="cb52-2086"><a href="#cb52-2086"></a><span class="in">```{r l6c22}</span></span>
<span id="cb52-2087"><a href="#cb52-2087"></a><span class="in">#| warning: false</span></span>
<span id="cb52-2088"><a href="#cb52-2088"></a><span class="in">Fd &lt;- plnorm</span></span>
<span id="cb52-2089"><a href="#cb52-2089"></a><span class="in">fd &lt;- dlnorm</span></span>
<span id="cb52-2090"><a href="#cb52-2090"></a></span>
<span id="cb52-2091"><a href="#cb52-2091"></a><span class="in">theta0 &lt;- c( 1, 1 )</span></span>
<span id="cb52-2092"><a href="#cb52-2092"></a><span class="in">loglik_max &lt;- list()</span></span>
<span id="cb52-2093"><a href="#cb52-2093"></a><span class="in">estim_sev &lt;- NULL</span></span>
<span id="cb52-2094"><a href="#cb52-2094"></a></span>
<span id="cb52-2095"><a href="#cb52-2095"></a><span class="in">for ( g in grpcl$grp ) {</span></span>
<span id="cb52-2096"><a href="#cb52-2096"></a><span class="in">  </span></span>
<span id="cb52-2097"><a href="#cb52-2097"></a><span class="in">  datsev &lt;- sev_claims[ grp == g ]</span></span>
<span id="cb52-2098"><a href="#cb52-2098"></a><span class="in">  </span></span>
<span id="cb52-2099"><a href="#cb52-2099"></a><span class="in">  # Definimos la función de verosimilitud logarítmica para cada grupo</span></span>
<span id="cb52-2100"><a href="#cb52-2100"></a><span class="in">  lglk &lt;- function( theta ) {</span></span>
<span id="cb52-2101"><a href="#cb52-2101"></a><span class="in">    </span></span>
<span id="cb52-2102"><a href="#cb52-2102"></a><span class="in">    # suma en puntos de continuidad</span></span>
<span id="cb52-2103"><a href="#cb52-2103"></a><span class="in">    l &lt;- sum( sapply( datsev[ claim &gt; 0 &amp; claim &lt; amount ]$claim,</span></span>
<span id="cb52-2104"><a href="#cb52-2104"></a><span class="in">                      FUN = function( x ) log( fd( x, meanlog = theta[ 1 ], sdlog = theta[ 2 ] ) ) ) )</span></span>
<span id="cb52-2105"><a href="#cb52-2105"></a><span class="in">    </span></span>
<span id="cb52-2106"><a href="#cb52-2106"></a><span class="in">    # suma en las discontinuidades</span></span>
<span id="cb52-2107"><a href="#cb52-2107"></a><span class="in">    # singularidad en la parte superior, hacia el máximo monto</span></span>
<span id="cb52-2108"><a href="#cb52-2108"></a><span class="in">    sg &lt;- datsev[ claim == amount, list( x = amount + deductible ) ]</span></span>
<span id="cb52-2109"><a href="#cb52-2109"></a><span class="in">    sg &lt;- sg$x</span></span>
<span id="cb52-2110"><a href="#cb52-2110"></a><span class="in">    </span></span>
<span id="cb52-2111"><a href="#cb52-2111"></a><span class="in">    if ( length( sg ) &gt; 0 ) {</span></span>
<span id="cb52-2112"><a href="#cb52-2112"></a><span class="in">      l &lt;- l + sum( sapply( sg, FUN = function( x ) log( 1 - Fd( x, meanlog = theta[ 1 ], sdlog = theta[ 2 ] ) ) ) )  </span></span>
<span id="cb52-2113"><a href="#cb52-2113"></a><span class="in">    }</span></span>
<span id="cb52-2114"><a href="#cb52-2114"></a><span class="in">    </span></span>
<span id="cb52-2115"><a href="#cb52-2115"></a><span class="in">    # singularidad en la parte inferior, hacia el deducible</span></span>
<span id="cb52-2116"><a href="#cb52-2116"></a><span class="in">    sg &lt;- datsev[ claim == 0, list( x = deductible ) ]</span></span>
<span id="cb52-2117"><a href="#cb52-2117"></a><span class="in">    sg &lt;- sg$x</span></span>
<span id="cb52-2118"><a href="#cb52-2118"></a><span class="in">    </span></span>
<span id="cb52-2119"><a href="#cb52-2119"></a><span class="in">    if ( length( sg ) &gt; 0 ) {</span></span>
<span id="cb52-2120"><a href="#cb52-2120"></a><span class="in">      l &lt;- l + sum( sapply( sg, FUN = function( x ) log( Fd( x, meanlog = theta[ 1 ], sdlog = theta[ 2 ] ) ) ) )  </span></span>
<span id="cb52-2121"><a href="#cb52-2121"></a><span class="in">    }</span></span>
<span id="cb52-2122"><a href="#cb52-2122"></a><span class="in">    </span></span>
<span id="cb52-2123"><a href="#cb52-2123"></a><span class="in">    return( -l ) # con menos ya que el optimizador minimiza</span></span>
<span id="cb52-2124"><a href="#cb52-2124"></a><span class="in">  }</span></span>
<span id="cb52-2125"><a href="#cb52-2125"></a><span class="in">  </span></span>
<span id="cb52-2126"><a href="#cb52-2126"></a><span class="in">  dlglk &lt;- function( x ) nl.grad( x, lglk )</span></span>
<span id="cb52-2127"><a href="#cb52-2127"></a><span class="in">  </span></span>
<span id="cb52-2128"><a href="#cb52-2128"></a><span class="in">  # Maximización de la verosimilitud</span></span>
<span id="cb52-2129"><a href="#cb52-2129"></a><span class="in">  loglik_max[[ g ]] &lt;- nloptr(</span></span>
<span id="cb52-2130"><a href="#cb52-2130"></a><span class="in">    x0 = theta0,</span></span>
<span id="cb52-2131"><a href="#cb52-2131"></a><span class="in">    eval_f = lglk,</span></span>
<span id="cb52-2132"><a href="#cb52-2132"></a><span class="in">    eval_grad_f = dlglk,</span></span>
<span id="cb52-2133"><a href="#cb52-2133"></a><span class="in">    lb = c( 0, 0 ),</span></span>
<span id="cb52-2134"><a href="#cb52-2134"></a><span class="in">    ub = c( Inf, Inf ),</span></span>
<span id="cb52-2135"><a href="#cb52-2135"></a><span class="in">    opts = list( maxeval = 1e4, </span></span>
<span id="cb52-2136"><a href="#cb52-2136"></a><span class="in">                 ftol_abs = 1e-15,</span></span>
<span id="cb52-2137"><a href="#cb52-2137"></a><span class="in">                 xtol_abs = c( 1e-12, 1e-12 ),</span></span>
<span id="cb52-2138"><a href="#cb52-2138"></a><span class="in">                 algorithm = 'NLOPT_LD_LBFGS' ) )</span></span>
<span id="cb52-2139"><a href="#cb52-2139"></a><span class="in">  </span></span>
<span id="cb52-2140"><a href="#cb52-2140"></a><span class="in">  estim_sev &lt;- rbind( </span></span>
<span id="cb52-2141"><a href="#cb52-2141"></a><span class="in">    estim_sev, </span></span>
<span id="cb52-2142"><a href="#cb52-2142"></a><span class="in">    data.table( grp = g, </span></span>
<span id="cb52-2143"><a href="#cb52-2143"></a><span class="in">                n = nrow( datsev ),</span></span>
<span id="cb52-2144"><a href="#cb52-2144"></a><span class="in">                meanlog = loglik_max[[ g ]]$solution[ 1 ], </span></span>
<span id="cb52-2145"><a href="#cb52-2145"></a><span class="in">                sdlog = loglik_max[[ g ]]$solution[ 2 ],</span></span>
<span id="cb52-2146"><a href="#cb52-2146"></a><span class="in">                loglik = -loglik_max[[ g ]]$objective )</span></span>
<span id="cb52-2147"><a href="#cb52-2147"></a><span class="in">  )</span></span>
<span id="cb52-2148"><a href="#cb52-2148"></a><span class="in">}</span></span>
<span id="cb52-2149"><a href="#cb52-2149"></a></span>
<span id="cb52-2150"><a href="#cb52-2150"></a><span class="in">estim_sev[ , EX := exp( meanlog + 0.5 * sdlog^2 ) ]</span></span>
<span id="cb52-2151"><a href="#cb52-2151"></a><span class="in">estim_sev[ , SDX := sqrt( ( exp( sdlog^2 ) - 1 ) * exp( 2 * meanlog + sdlog^2 ) ) ]</span></span>
<span id="cb52-2152"><a href="#cb52-2152"></a><span class="in">estim_sev[ , aic := 2 * 2 - 2 * loglik ]</span></span>
<span id="cb52-2153"><a href="#cb52-2153"></a><span class="in">estim_sev[ , bic := 2 * log( n ) - 2 * loglik ]</span></span>
<span id="cb52-2154"><a href="#cb52-2154"></a><span class="in">```</span></span>
<span id="cb52-2155"><a href="#cb52-2155"></a></span>
<span id="cb52-2156"><a href="#cb52-2156"></a>En este caso tenemos un problema donde existe convergencia para cada una de las </span>
<span id="cb52-2157"><a href="#cb52-2157"></a>optimizaciones por verosimilitud sin embargo, en la práctica un bucle de esta naturaleza puede </span>
<span id="cb52-2158"><a href="#cb52-2158"></a>implicar un costo computacional significativo en memoría y tiempo. Dependiendo de la dimensión</span>
<span id="cb52-2159"><a href="#cb52-2159"></a>del problema, se recomienda usar algunas técnicas que utilicen cálculo en paralelo o manejo óptimo </span>
<span id="cb52-2160"><a href="#cb52-2160"></a>de memoria, en algunas otras circunstancias puede ser conveniente utilizar un método de </span>
<span id="cb52-2161"><a href="#cb52-2161"></a>descomposición por *batchs* de información.</span>
<span id="cb52-2162"><a href="#cb52-2162"></a></span>
<span id="cb52-2163"><a href="#cb52-2163"></a>Los resultados de la estimación mediante maximización de verosimilitud para la severidad de los </span>
<span id="cb52-2164"><a href="#cb52-2164"></a>reclamos, los presentamos en la tabla a continuación.</span>
<span id="cb52-2165"><a href="#cb52-2165"></a><span class="in">```{r l6t5}</span></span>
<span id="cb52-2166"><a href="#cb52-2166"></a><span class="in">#| echo: true</span></span>
<span id="cb52-2167"><a href="#cb52-2167"></a><span class="in">#| out-width: '100%'</span></span>
<span id="cb52-2168"><a href="#cb52-2168"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-2169"><a href="#cb52-2169"></a><span class="in">estim_sev %&gt;%</span></span>
<span id="cb52-2170"><a href="#cb52-2170"></a><span class="in">  kable(</span></span>
<span id="cb52-2171"><a href="#cb52-2171"></a><span class="in">    label = NA,</span></span>
<span id="cb52-2172"><a href="#cb52-2172"></a><span class="in">    caption = 'Estimación de severidad de los reclamos',</span></span>
<span id="cb52-2173"><a href="#cb52-2173"></a><span class="in">    row.names = FALSE,</span></span>
<span id="cb52-2174"><a href="#cb52-2174"></a><span class="in">    col.names = c( '$g$', '$n$', '$\\mu$', '$\\sigma$', '$\\ell( \\mu, \\sigma )$', '$\\E[ X ]$', </span></span>
<span id="cb52-2175"><a href="#cb52-2175"></a><span class="in">                   '$\\sqrt{\\V[ X ]}$', '$AIC$', '$BIC$' ),</span></span>
<span id="cb52-2176"><a href="#cb52-2176"></a><span class="in">    align = 'lrrrrrrrr',</span></span>
<span id="cb52-2177"><a href="#cb52-2177"></a><span class="in">    digits = c( 0, 0, 5, 5, 5, 2, 2, 2, 2 ),</span></span>
<span id="cb52-2178"><a href="#cb52-2178"></a><span class="in">    format.args = list( big.mark = ',', decimal.mark = '.', scientific = FALSE ),</span></span>
<span id="cb52-2179"><a href="#cb52-2179"></a><span class="in">    escape = FALSE,</span></span>
<span id="cb52-2180"><a href="#cb52-2180"></a><span class="in">    centering = TRUE,</span></span>
<span id="cb52-2181"><a href="#cb52-2181"></a><span class="in">    booktabs = TRUE ) %&gt;%</span></span>
<span id="cb52-2182"><a href="#cb52-2182"></a><span class="in">  kable_classic( full_width = FALSE, html_font = "Cambria", position = "center" ) %&gt;%</span></span>
<span id="cb52-2183"><a href="#cb52-2183"></a><span class="in">  scroll_box( width = "100%", height = "500px" )</span></span>
<span id="cb52-2184"><a href="#cb52-2184"></a><span class="in">```</span></span>
<span id="cb52-2185"><a href="#cb52-2185"></a></span>
<span id="cb52-2186"><a href="#cb52-2186"></a>Sumarizando, hemos determinado para cada grupo de riesgo $g$ una distribución para la variable </span>
<span id="cb52-2187"><a href="#cb52-2187"></a>aleatoria correspondiente al número de reclamos $N_g \rightsquigarrow NBinom( \alpha_g, p_g )$, de </span>
<span id="cb52-2188"><a href="#cb52-2188"></a>igual forma hemos estimado una distribución para la severidad de los reclamos </span>
<span id="cb52-2189"><a href="#cb52-2189"></a>$X \rightsquigarrow LN( \mu_g, \sigma_g )$. </span>
<span id="cb52-2190"><a href="#cb52-2190"></a></span>
<span id="cb52-2191"><a href="#cb52-2191"></a>Es de notar que la estimación de la variable $N_g$ del número de siniestro se lo realizó por </span>
<span id="cb52-2192"><a href="#cb52-2192"></a>individuo y por cada periodo de observación <span class="in">`di`</span> a <span class="in">`de`</span>, esto nos permite estimar una frecuencia </span>
<span id="cb52-2193"><a href="#cb52-2193"></a>anualizada, debido a los anchos de los intervalos de observación. Pero si se considera pólizas con</span>
<span id="cb52-2194"><a href="#cb52-2194"></a>periodos de cobertura diferentes, hay que realizar el respectivo ajuste por la exposición al riesgo.</span>
<span id="cb52-2195"><a href="#cb52-2195"></a></span>
<span id="cb52-2196"><a href="#cb52-2196"></a>El modelo de colectivo para este caso en particular debe tomar en cuenta el número de </span>
<span id="cb52-2197"><a href="#cb52-2197"></a>individuos asegurados $n_g$ en el total de pólizas por cada grupo de riesgo $g$. Esto bajo el </span>
<span id="cb52-2198"><a href="#cb52-2198"></a>supuesto que todas las pólizas de las $n_g$ tiene la misma exposición al riesgo de un año, si no es</span>
<span id="cb52-2199"><a href="#cb52-2199"></a>el caso habrá que realizar ajustes en la variable $N_g$ que cuenta el número de reclamos.</span>
<span id="cb52-2200"><a href="#cb52-2200"></a>$$</span>
<span id="cb52-2201"><a href="#cb52-2201"></a>S_g = \sum\limits_{i=1}^{n_g} \sum\limits_{j=1}^{N_g} D_{g,i}\left( X_{g,i,j} \right)</span>
<span id="cb52-2202"><a href="#cb52-2202"></a>$$</span>
<span id="cb52-2203"><a href="#cb52-2203"></a></span>
<span id="cb52-2204"><a href="#cb52-2204"></a>La perdida total que sumariza cada grupo de riesgo $g$, es la dada por la expresión:</span>
<span id="cb52-2205"><a href="#cb52-2205"></a>$$</span>
<span id="cb52-2206"><a href="#cb52-2206"></a>S = \sum\limits_{g \in G} S_g</span>
<span id="cb52-2207"><a href="#cb52-2207"></a>= \sum\limits_{g \in G} \sum\limits_{i=1}^{n_g} \sum\limits_{j=1}^{N_g} D_{g,i}\left( X_{g,i,j} \right)</span>
<span id="cb52-2208"><a href="#cb52-2208"></a>$$</span>
<span id="cb52-2209"><a href="#cb52-2209"></a>Para realizar el cálculo de los valores deducidos se puede examinar la expresión del deducible, </span>
<span id="cb52-2210"><a href="#cb52-2210"></a>con ello llegamos al siguiente resultado.</span>
<span id="cb52-2211"><a href="#cb52-2211"></a>$$</span>
<span id="cb52-2212"><a href="#cb52-2212"></a>\begin{split}</span>
<span id="cb52-2213"><a href="#cb52-2213"></a>\E\left<span class="co">[</span><span class="ot">D(X)\right</span><span class="co">]</span></span>
<span id="cb52-2214"><a href="#cb52-2214"></a>&amp; = \int\limits_0^{+\infty} D( x ) dF( x ) <span class="sc">\\</span></span>
<span id="cb52-2215"><a href="#cb52-2215"></a>&amp; = \int\limits_0^{+\infty} \min\left( \max( x - d, 0 ), M \right) dF( x ) <span class="sc">\\</span></span>
<span id="cb52-2216"><a href="#cb52-2216"></a>&amp; = \int\limits_d^{M+d} ( x - d ) dF( x ) + \int\limits_{M+d}^{+\infty} M dF( x ) <span class="sc">\\</span></span>
<span id="cb52-2217"><a href="#cb52-2217"></a>&amp; = \int\limits_d^{M+d} x dF( x ) - d P\left( d \leq X \leq M + d \right) + M P\left( X &gt; M + d \right) <span class="sc">\\</span></span>
<span id="cb52-2218"><a href="#cb52-2218"></a>&amp; = \int\limits_d^{M+d} x dF( x ) - d \left( F( M + d ) - F( d ) \right) + M \left( 1 - F( M + d ) \right) <span class="sc">\\</span></span>
<span id="cb52-2219"><a href="#cb52-2219"></a>&amp; = \int\limits_d^{M+d} x dF( x ) + M + d\ F( d ) - ( M + d ) F( M + d )</span>
<span id="cb52-2220"><a href="#cb52-2220"></a>\end{split}</span>
<span id="cb52-2221"><a href="#cb52-2221"></a>$$</span>
<span id="cb52-2222"><a href="#cb52-2222"></a></span>
<span id="cb52-2223"><a href="#cb52-2223"></a>La integral a la izquierda pude ser calculada con el uso de una aproximación numérica a la integral.</span>
<span id="cb52-2224"><a href="#cb52-2224"></a>Por su parte, los términos asociados a la probabilidad pueden ser calculados utilizando la </span>
<span id="cb52-2225"><a href="#cb52-2225"></a>función de distribución acumulada de la variable aleatoria de los reclamos $X$.</span>
<span id="cb52-2226"><a href="#cb52-2226"></a><span class="in">```{r l6c23}</span></span>
<span id="cb52-2227"><a href="#cb52-2227"></a><span class="in">estim &lt;- merge.data.table( estim_frec[ , list( grp, EN, SDN ) ], </span></span>
<span id="cb52-2228"><a href="#cb52-2228"></a><span class="in">                           estim_sev[ , list( grp, EX, SDX, meanlog, sdlog ) ], by = 'grp' )</span></span>
<span id="cb52-2229"><a href="#cb52-2229"></a><span class="in">```</span></span>
<span id="cb52-2230"><a href="#cb52-2230"></a></span>
<span id="cb52-2231"><a href="#cb52-2231"></a>Ahora configuramos un posible portafolio, el cual ya en la práctica debe considerar los objetivos</span>
<span id="cb52-2232"><a href="#cb52-2232"></a>comerciales para la venta de diferentes productos de seguro. Para cada grupo de riesgo $g$ se puede</span>
<span id="cb52-2233"><a href="#cb52-2233"></a>considerar un número de póliza de un determinado producto, caracterizados por su deducible $d$</span>
<span id="cb52-2234"><a href="#cb52-2234"></a>y monto máximo asegurado $M$. Así, para grupo de riesgo $g$ y producto $r$</span>
<span id="cb52-2235"><a href="#cb52-2235"></a>$$</span>
<span id="cb52-2236"><a href="#cb52-2236"></a>S_{g,r} = \sum\limits_{i=1}^{n_{g,r}} \sum\limits_{j=1}^{N_g} D\left( X_{i,j} \right)</span>
<span id="cb52-2237"><a href="#cb52-2237"></a>$$</span>
<span id="cb52-2238"><a href="#cb52-2238"></a>El valor esperado y varianza de cada uno de estos reclamos totales por grupo de riesgo $g$ y </span>
<span id="cb52-2239"><a href="#cb52-2239"></a>producto $r$, están dados por:</span>
<span id="cb52-2240"><a href="#cb52-2240"></a>$$</span>
<span id="cb52-2241"><a href="#cb52-2241"></a>\begin{split}</span>
<span id="cb52-2242"><a href="#cb52-2242"></a>\E\left<span class="co">[</span><span class="ot"> S_{g,r} \right</span><span class="co">]</span> </span>
<span id="cb52-2243"><a href="#cb52-2243"></a>&amp; = n_{g,r} \E\left<span class="co">[</span><span class="ot"> N_g \right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot"> D( X_g ) \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-2244"><a href="#cb52-2244"></a>\V\left<span class="co">[</span><span class="ot"> S_{g,r} \right</span><span class="co">]</span> </span>
<span id="cb52-2245"><a href="#cb52-2245"></a>&amp; = n_{g,r} \left( \E\left<span class="co">[</span><span class="ot"> N_g \right</span><span class="co">]</span> \V\left<span class="co">[</span><span class="ot"> D( X_g ) \right</span><span class="co">]</span> + \V\left<span class="co">[</span><span class="ot"> N_g \right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot"> D( X_g ) \right</span><span class="co">]</span>^2 \right)</span>
<span id="cb52-2246"><a href="#cb52-2246"></a>\end{split}</span>
<span id="cb52-2247"><a href="#cb52-2247"></a>$$</span>
<span id="cb52-2248"><a href="#cb52-2248"></a>El reclamo total por grupo de riesgo $g$, tan solo resulta de la suma de los reclamos totales por </span>
<span id="cb52-2249"><a href="#cb52-2249"></a>cada producto.</span>
<span id="cb52-2250"><a href="#cb52-2250"></a>$$</span>
<span id="cb52-2251"><a href="#cb52-2251"></a>S_g = \sum\limits_{r=1}^{R} S_{g,r}</span>
<span id="cb52-2252"><a href="#cb52-2252"></a>$$</span>
<span id="cb52-2253"><a href="#cb52-2253"></a>de igual forma su valor esperado y varianza están dados por:</span>
<span id="cb52-2254"><a href="#cb52-2254"></a>$$</span>
<span id="cb52-2255"><a href="#cb52-2255"></a>\begin{split}</span>
<span id="cb52-2256"><a href="#cb52-2256"></a>\E\left<span class="co">[</span><span class="ot"> S_g \right</span><span class="co">]</span> = \sum\limits_{r=1}^R \E\left<span class="co">[</span><span class="ot"> S_{g,r} \right</span><span class="co">]</span></span>
<span id="cb52-2257"><a href="#cb52-2257"></a>&amp; = \sum\limits_{r=1}^R n_{g,r} \E\left<span class="co">[</span><span class="ot"> N_g \right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot"> D( X_g ) \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-2258"><a href="#cb52-2258"></a>\V\left<span class="co">[</span><span class="ot"> S_{g} \right</span><span class="co">]</span> = \sum\limits_{r=1}^R \V\left<span class="co">[</span><span class="ot"> S_{g,r} \right</span><span class="co">]</span></span>
<span id="cb52-2259"><a href="#cb52-2259"></a>&amp; = \sum\limits_{r=1}^R n_{g,r} \left( \E\left<span class="co">[</span><span class="ot"> N_g \right</span><span class="co">]</span> \V\left<span class="co">[</span><span class="ot"> D( X_g ) \right</span><span class="co">]</span> + \V\left<span class="co">[</span><span class="ot"> N_g \right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot"> D( X_g ) \right</span><span class="co">]</span>^2 \right)</span>
<span id="cb52-2260"><a href="#cb52-2260"></a>\end{split}</span>
<span id="cb52-2261"><a href="#cb52-2261"></a>$$</span>
<span id="cb52-2262"><a href="#cb52-2262"></a></span>
<span id="cb52-2263"><a href="#cb52-2263"></a><span class="in">```{r l6c24}</span></span>
<span id="cb52-2264"><a href="#cb52-2264"></a><span class="in">prods &lt;- data.table( ngr = c( 1000, 800, 600, 400, 200 ), </span></span>
<span id="cb52-2265"><a href="#cb52-2265"></a><span class="in">                     d = c( 20, 20, 20, 20, 20 ), </span></span>
<span id="cb52-2266"><a href="#cb52-2266"></a><span class="in">                     M = c( 2e4, 2e4, 2.5e4, 3e4, 4e4 ) )</span></span>
<span id="cb52-2267"><a href="#cb52-2267"></a><span class="in">prods[ , id := 1 ]</span></span>
<span id="cb52-2268"><a href="#cb52-2268"></a><span class="in">grpcl[ , id := 1 ]</span></span>
<span id="cb52-2269"><a href="#cb52-2269"></a><span class="in">prods &lt;- merge.data.table( prods, grpcl, by = 'id', allow.cartesian = TRUE )</span></span>
<span id="cb52-2270"><a href="#cb52-2270"></a><span class="in">grpcl[ , id := NULL ]</span></span>
<span id="cb52-2271"><a href="#cb52-2271"></a><span class="in">prods[ , id := NULL ]</span></span>
<span id="cb52-2272"><a href="#cb52-2272"></a></span>
<span id="cb52-2273"><a href="#cb52-2273"></a><span class="in">prods &lt;- merge.data.table( prods, estim, by = 'grp', allow.cartesian = TRUE )</span></span>
<span id="cb52-2274"><a href="#cb52-2274"></a><span class="in">setorder( prods, sex, xg, -d )</span></span>
<span id="cb52-2275"><a href="#cb52-2275"></a><span class="in">prods[ , r := 1 ]</span></span>
<span id="cb52-2276"><a href="#cb52-2276"></a><span class="in">prods[ , r := cumsum( r ), by = list( sex, xg ) ]</span></span>
<span id="cb52-2277"><a href="#cb52-2277"></a><span class="in">intf &lt;- function( meanlog, sdlog, d, M, k ) integrate( function( x ) ( x - d )^k * fd( x, meanlog = meanlog, sdlog = sdlog ), lower = d, upper = M, abs.tol = 1e-15 )$value</span></span>
<span id="cb52-2278"><a href="#cb52-2278"></a></span>
<span id="cb52-2279"><a href="#cb52-2279"></a><span class="in">prods[ , EDX := mapply( FUN = intf, meanlog, sdlog, d, M, 1 ) + M * ( 1 - Fd( M + d ) )]</span></span>
<span id="cb52-2280"><a href="#cb52-2280"></a><span class="in">prods[ , EDX2 := mapply( FUN = intf, meanlog, sdlog, d, M, 2 ) + M^2 * ( 1 - Fd( M + d ) ) ]</span></span>
<span id="cb52-2281"><a href="#cb52-2281"></a><span class="in">prods[ , SDDX := sqrt( EDX2 - EDX^2 ) ]</span></span>
<span id="cb52-2282"><a href="#cb52-2282"></a></span>
<span id="cb52-2283"><a href="#cb52-2283"></a><span class="in">prods[ , ES := ngr * EN * EDX ]</span></span>
<span id="cb52-2284"><a href="#cb52-2284"></a><span class="in">prods[ , SDS := sqrt( ngr * ( EN * SDDX^2 + SDN^2 * EDX^2 ) ) ]</span></span>
<span id="cb52-2285"><a href="#cb52-2285"></a><span class="in">```</span></span>
<span id="cb52-2286"><a href="#cb52-2286"></a></span>
<span id="cb52-2287"><a href="#cb52-2287"></a><span class="in">```{r l6t6}</span></span>
<span id="cb52-2288"><a href="#cb52-2288"></a><span class="in">#| echo: true</span></span>
<span id="cb52-2289"><a href="#cb52-2289"></a><span class="in">#| out-width: '100%'</span></span>
<span id="cb52-2290"><a href="#cb52-2290"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-2291"><a href="#cb52-2291"></a><span class="in">prods[ , list( sex, xg, r, ngr, d, M, EN, SDN, EX, SDX, EDX, SDDX, ES, SDS ) ] %&gt;%</span></span>
<span id="cb52-2292"><a href="#cb52-2292"></a><span class="in">  kable(</span></span>
<span id="cb52-2293"><a href="#cb52-2293"></a><span class="in">    label = NA,</span></span>
<span id="cb52-2294"><a href="#cb52-2294"></a><span class="in">    caption = 'Estimación de los reclamos totales',</span></span>
<span id="cb52-2295"><a href="#cb52-2295"></a><span class="in">    row.names = FALSE,</span></span>
<span id="cb52-2296"><a href="#cb52-2296"></a><span class="in">    col.names = c( 'sex', '$x_g$', '$r$', '$n_{g,r}$', '$d$', '$M$', '$\\E[ N ]$', '$\\sqrt{\\V[ N ]}$',</span></span>
<span id="cb52-2297"><a href="#cb52-2297"></a><span class="in">                   '$\\E[ X ]$', '$\\sqrt{\\V[ X ]}$', '$\\E[ D(X) ]$', '$\\sqrt{\\V[ D(X) ]}$',</span></span>
<span id="cb52-2298"><a href="#cb52-2298"></a><span class="in">                   '$\\E[ S_{g,r} ]$', '$\\sqrt{\\V[ S_{g,r} ]}$' ),</span></span>
<span id="cb52-2299"><a href="#cb52-2299"></a><span class="in">    align = 'llrrrrrrrrrrr',</span></span>
<span id="cb52-2300"><a href="#cb52-2300"></a><span class="in">    digits = c( 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2 ),</span></span>
<span id="cb52-2301"><a href="#cb52-2301"></a><span class="in">    format.args = list( big.mark = ',', decimal.mark = '.', scientific = FALSE ),</span></span>
<span id="cb52-2302"><a href="#cb52-2302"></a><span class="in">    escape = FALSE,</span></span>
<span id="cb52-2303"><a href="#cb52-2303"></a><span class="in">    centering = TRUE,</span></span>
<span id="cb52-2304"><a href="#cb52-2304"></a><span class="in">    booktabs = TRUE,</span></span>
<span id="cb52-2305"><a href="#cb52-2305"></a><span class="in">    longtable = TRUE ) %&gt;%</span></span>
<span id="cb52-2306"><a href="#cb52-2306"></a><span class="in">  kable_classic( </span></span>
<span id="cb52-2307"><a href="#cb52-2307"></a><span class="in">    full_width = FALSE, </span></span>
<span id="cb52-2308"><a href="#cb52-2308"></a><span class="in">    html_font = "Cambria", </span></span>
<span id="cb52-2309"><a href="#cb52-2309"></a><span class="in">    position = 'center', </span></span>
<span id="cb52-2310"><a href="#cb52-2310"></a><span class="in">    latex_options = c( 'hold_position', 'repeat_header', 'scale_down' ) ) %&gt;%</span></span>
<span id="cb52-2311"><a href="#cb52-2311"></a><span class="in">  scroll_box( width = "100%", height = "500px" )</span></span>
<span id="cb52-2312"><a href="#cb52-2312"></a><span class="in">```</span></span>
<span id="cb52-2313"><a href="#cb52-2313"></a>:::</span>
<span id="cb52-2314"><a href="#cb52-2314"></a></span>
<span id="cb52-2315"><a href="#cb52-2315"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-2316"><a href="#cb52-2316"></a><span class="fu">## Modelos con variables explicativas {#modelos_variables_explicativas}</span></span>
<span id="cb52-2317"><a href="#cb52-2317"></a>En algunos casos más generales, donde la población presenta heterogeneidad respecto del riesgo al</span>
<span id="cb52-2318"><a href="#cb52-2318"></a>cual están expuestos, como también de las dimensiones de sus reclamos, se considera que existen </span>
<span id="cb52-2319"><a href="#cb52-2319"></a>variables aleatorias adicionales $Y_1, \ldots, Y_n$ que determinan el número de reclamos $N$ y </span>
<span id="cb52-2320"><a href="#cb52-2320"></a>el valor de los siniestros $<span class="sc">\{</span>X_i<span class="sc">\}</span>$. Es decir no hay independencia entre $<span class="sc">\{</span>Y_j<span class="sc">\}</span>$ y $N$ así </span>
<span id="cb52-2321"><a href="#cb52-2321"></a>como tampoco entre $<span class="sc">\{</span>Y_j<span class="sc">\}</span>$ y $<span class="sc">\{</span>X_i<span class="sc">\}</span>$. Es así que un modelo colectivo $S = \sum\limits_{i=1}^N X_i$</span>
<span id="cb52-2322"><a href="#cb52-2322"></a>su estudio, estimación y tarificación debe ser realizada de forma condicional respecto de las </span>
<span id="cb52-2323"><a href="#cb52-2323"></a>variables aleatorias explicativas $<span class="sc">\{</span>Y_j<span class="sc">\}</span>$,</span>
<span id="cb52-2324"><a href="#cb52-2324"></a>$$</span>
<span id="cb52-2325"><a href="#cb52-2325"></a>\E<span class="co">[</span><span class="ot"> S </span><span class="co">]</span> </span>
<span id="cb52-2326"><a href="#cb52-2326"></a>= \E\left<span class="co">[</span><span class="ot"> \E\left[ S \middle| Y_1, \ldots, Y_n \right] \right</span><span class="co">]</span></span>
<span id="cb52-2327"><a href="#cb52-2327"></a>$$</span>
<span id="cb52-2328"><a href="#cb52-2328"></a>de donde es necesario estimar cada una de las esperanzas condicionadas </span>
<span id="cb52-2329"><a href="#cb52-2329"></a>$\E\left<span class="co">[</span><span class="ot"> S \middle| Y_1, \ldots, Y_n \right</span><span class="co">]</span>$.</span>
<span id="cb52-2330"><a href="#cb52-2330"></a></span>
<span id="cb52-2331"><a href="#cb52-2331"></a>En la práctica las variables explicativas $<span class="sc">\{</span> Y_j <span class="sc">\}</span>$ suelen ser seleccionadas para caracterizar </span>
<span id="cb52-2332"><a href="#cb52-2332"></a>el perfil de riesgo de cada cliente. Para su selección se suele utilizar algunos criterios de tipo </span>
<span id="cb52-2333"><a href="#cb52-2333"></a>económico, financiero, legal y estadístico.</span>
<span id="cb52-2334"><a href="#cb52-2334"></a></span>
<span id="cb52-2335"><a href="#cb52-2335"></a><span class="co">&lt;!-------------------------------------------------------------------------------------------------&gt;</span></span>
<span id="cb52-2336"><a href="#cb52-2336"></a><span class="fu">## Proceso estocástico de reclamos totales {#proceso_estocastico_reclamos}</span></span>
<span id="cb52-2337"><a href="#cb52-2337"></a></span>
<span id="cb52-2338"><a href="#cb52-2338"></a>Hasta el momento no hemos considerado que los reclamos se producen en el tiempo, que cada reclamo</span>
<span id="cb52-2339"><a href="#cb52-2339"></a>está bien vinculado al tiempo; es más podemos identificar algunos instantes en el tiempo que le </span>
<span id="cb52-2340"><a href="#cb52-2340"></a>corresponde, tenemos así el tiempo cuando se suscita el siniestro o tiempo de ocurrencia, el tiempo </span>
<span id="cb52-2341"><a href="#cb52-2341"></a>de aviso cuando se comunica al asegurador el siniestro y un tiempo de pago. Los dos últimos</span>
<span id="cb52-2342"><a href="#cb52-2342"></a>no son directos asociados al evento del siniestro sino están asociados a otras variables que pueden</span>
<span id="cb52-2343"><a href="#cb52-2343"></a>afectar la demora para comunicar un siniestro por parte del asegurado y la demora para cancelarlo</span>
<span id="cb52-2344"><a href="#cb52-2344"></a>por parte del asegurador.</span>
<span id="cb52-2345"><a href="#cb52-2345"></a></span>
<span id="cb52-2346"><a href="#cb52-2346"></a>Así por tanto si tenemos una secuencia de siniestros $<span class="sc">\{</span>X_n<span class="sc">\}</span>_{n\in\N^*}$, estos los podemos </span>
<span id="cb52-2347"><a href="#cb52-2347"></a>considerar ordenados en el tiempo conforme han venido presentándose en instantes </span>
<span id="cb52-2348"><a href="#cb52-2348"></a>$0= T_0 \leq T_1 \leq \cdots \leq T_n \leq \cdots$, es decir se le asocia a los reclamos $<span class="sc">\{</span>X_n<span class="sc">\}</span>$ la </span>
<span id="cb52-2349"><a href="#cb52-2349"></a>secuencia de los **tiempos de arribo** $<span class="sc">\{</span>T_n<span class="sc">\}</span>_{n\in\N}$, donde $T_{n+1} \geq T_n$, para </span>
<span id="cb52-2350"><a href="#cb52-2350"></a>cualquier $n \in \N$. Ciertamente, es de esperar que los tiempos de arribo sean variables </span>
<span id="cb52-2351"><a href="#cb52-2351"></a>aleatorias y están asociados a la frecuencia $N$ en un periodo dado, ya que $N$ cuenta los tiempos</span>
<span id="cb52-2352"><a href="#cb52-2352"></a>de arribo hasta un instante dado $t \geq 0$, bajo esta perspectiva transformamos a $N$ en una </span>
<span id="cb52-2353"><a href="#cb52-2353"></a>variable aleatoria dependiente del tiempo, en lo que se conoce como un **proceso estocástico**.</span>
<span id="cb52-2354"><a href="#cb52-2354"></a>$$</span>
<span id="cb52-2355"><a href="#cb52-2355"></a>N( t )</span>
<span id="cb52-2356"><a href="#cb52-2356"></a>= <span class="sc">\#</span>\left<span class="sc">\{</span> n \in \N\ \middle|\ T_n \leq t \right<span class="sc">\}</span> </span>
<span id="cb52-2357"><a href="#cb52-2357"></a>= \sum\limits_{n=0}^{+\infty} \mathbf{1}_{(-\infty,t]}\left( T_n \right)</span>
<span id="cb52-2358"><a href="#cb52-2358"></a>$$</span>
<span id="cb52-2359"><a href="#cb52-2359"></a></span>
<span id="cb52-2360"><a href="#cb52-2360"></a>Inmediatamente de este razonamiento, resulta que los reclamos totales también se transforman en </span>
<span id="cb52-2361"><a href="#cb52-2361"></a>proceso estocástico, conforme se van considerando los arribos de los reclamos.</span>
<span id="cb52-2362"><a href="#cb52-2362"></a>$$</span>
<span id="cb52-2363"><a href="#cb52-2363"></a>S( t ) = \sum\limits_{i=1}^{N( t )} X_i</span>
<span id="cb52-2364"><a href="#cb52-2364"></a>$$</span>
<span id="cb52-2365"><a href="#cb52-2365"></a>donde claramente, como hemos venido haciéndolo, si $N(t) = 0$, entonces la suma total de reclamos</span>
<span id="cb52-2366"><a href="#cb52-2366"></a>es cero, $S(t) = 0$.</span>
<span id="cb52-2367"><a href="#cb52-2367"></a></span>
<span id="cb52-2368"><a href="#cb52-2368"></a>Además, junto con lo anterior, se pueden identificar las variables aleatorias de </span>
<span id="cb52-2369"><a href="#cb52-2369"></a>**tiempos entre arribos**, dadas por las diferencias entre tiempos de arribo contiguos</span>
<span id="cb52-2370"><a href="#cb52-2370"></a>$$</span>
<span id="cb52-2371"><a href="#cb52-2371"></a>W_n = T_n - T_{n-1},\quad \forall n \in \N^*</span>
<span id="cb52-2372"><a href="#cb52-2372"></a>$$</span>
<span id="cb52-2373"><a href="#cb52-2373"></a></span>
<span id="cb52-2374"><a href="#cb52-2374"></a>Un hipótesis bien común en el modelamiento de un proceso de pérdida agregada utilizando esta </span>
<span id="cb52-2375"><a href="#cb52-2375"></a>aproximación es asumir que los tiempos entre arribo $<span class="sc">\{</span>W_n<span class="sc">\}</span>$ son independientes entre si, es decir,</span>
<span id="cb52-2376"><a href="#cb52-2376"></a>el momento que se producen cada uno de los siniestros es de forma independiente. También se suele</span>
<span id="cb52-2377"><a href="#cb52-2377"></a>suponer independencia entre los tiempos entre arribo $<span class="sc">\{</span>W_n<span class="sc">\}</span>$ y las variables que representan </span>
<span id="cb52-2378"><a href="#cb52-2378"></a>la magnitud de cada uno de los reclamos $<span class="sc">\{</span>X_n<span class="sc">\}</span>$.</span>
<span id="cb52-2379"><a href="#cb52-2379"></a></span>
<span id="cb52-2380"><a href="#cb52-2380"></a>Los resultados para el cálculo de la esperanza y la varianza se pueden obtener de forma similar</span>
<span id="cb52-2381"><a href="#cb52-2381"></a>a lo que realizamos en la sección \@ref(modelo_individual).</span>
<span id="cb52-2382"><a href="#cb52-2382"></a>$$</span>
<span id="cb52-2383"><a href="#cb52-2383"></a>\begin{split}</span>
<span id="cb52-2384"><a href="#cb52-2384"></a>\E<span class="co">[</span><span class="ot">S(t)</span><span class="co">]</span></span>
<span id="cb52-2385"><a href="#cb52-2385"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> \sum\limits_{i=1}^{N(t)} X_i \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-2386"><a href="#cb52-2386"></a>&amp; = \sum\limits_{n=0}^{+\infty} \E\left<span class="co">[</span><span class="ot"> \sum\limits_{i=1}^n X_i\ \middle|\ N(t) = n \right</span><span class="co">]</span>P( N(t) = n )</span>
<span id="cb52-2387"><a href="#cb52-2387"></a>\quad \text{utilizando la esperanza condicional} <span class="sc">\\</span></span>
<span id="cb52-2388"><a href="#cb52-2388"></a>&amp; = 0 P( N(t) = 0 ) + \sum\limits_{n=1}^{+\infty} </span>
<span id="cb52-2389"><a href="#cb52-2389"></a>\E\left<span class="co">[</span><span class="ot"> \sum\limits_{i=1}^n X_i\ \middle|\ N(t) = n \right</span><span class="co">]</span>P( N(t) = n ) <span class="sc">\\</span></span>
<span id="cb52-2390"><a href="#cb52-2390"></a>&amp; = \sum\limits_{n=1}^{+\infty} \sum\limits_{i=1}^n \E\left<span class="co">[</span><span class="ot"> X_i \mid N(t) = n \right</span><span class="co">]</span>P( N(t) = n )</span>
<span id="cb52-2391"><a href="#cb52-2391"></a>\quad \text{linealidad de la esperanza} <span class="sc">\\</span></span>
<span id="cb52-2392"><a href="#cb52-2392"></a>&amp; = \sum\limits_{n=0}^{+\infty} n \E\left<span class="co">[</span><span class="ot"> X \mid N(t) = n \right</span><span class="co">]</span>P( N(t) = n )</span>
<span id="cb52-2393"><a href="#cb52-2393"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son idénticamente distribuidas} <span class="sc">\\</span></span>
<span id="cb52-2394"><a href="#cb52-2394"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> X \right</span><span class="co">]</span> \sum\limits_{n=0}^{+\infty} n P( N(t) = n )</span>
<span id="cb52-2395"><a href="#cb52-2395"></a>\quad \text{si $X$ y $N(t)$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-2396"><a href="#cb52-2396"></a>&amp; = \E<span class="co">[</span><span class="ot"> N(t) </span><span class="co">]</span> \E<span class="co">[</span><span class="ot"> X </span><span class="co">]</span> </span>
<span id="cb52-2397"><a href="#cb52-2397"></a>\end{split}</span>
<span id="cb52-2398"><a href="#cb52-2398"></a>$$</span>
<span id="cb52-2399"><a href="#cb52-2399"></a></span>
<span id="cb52-2400"><a href="#cb52-2400"></a>el segundo momento de $S(t)$ se calcula de forma similar</span>
<span id="cb52-2401"><a href="#cb52-2401"></a>$$</span>
<span id="cb52-2402"><a href="#cb52-2402"></a>\begin{split}</span>
<span id="cb52-2403"><a href="#cb52-2403"></a>\E<span class="co">[</span><span class="ot">S(t)^2</span><span class="co">]</span></span>
<span id="cb52-2404"><a href="#cb52-2404"></a>&amp; = \E\left<span class="co">[</span><span class="ot"> \left( \sum\limits_{i=1}^{N(t)} X_i \right)^2 \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb52-2405"><a href="#cb52-2405"></a>&amp; = \sum\limits_{n=0}^\infty \E\left<span class="co">[</span><span class="ot"> \sum\limits_{i, j=1}^n X_i X_j \middle| N(t) = n \right</span><span class="co">]</span> P( N = n ) </span>
<span id="cb52-2406"><a href="#cb52-2406"></a>\quad \text{propiedades de la esperanza condicional} <span class="sc">\\</span></span>
<span id="cb52-2407"><a href="#cb52-2407"></a>&amp; = \sum\limits_{n=0}^\infty \sum\limits_{i, j=1}^n \E\left<span class="co">[</span><span class="ot"> X_i X_j \right</span><span class="co">]</span> P( N(t) = n ) </span>
<span id="cb52-2408"><a href="#cb52-2408"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ y $N(t)$ son independientes} <span class="sc">\\</span></span>
<span id="cb52-2409"><a href="#cb52-2409"></a>&amp; = \sum\limits_{n=0}^\infty \left( \sum\limits_{i=1}^n \E\left<span class="co">[</span><span class="ot"> X_i^2 \right</span><span class="co">]</span> </span>
<span id="cb52-2410"><a href="#cb52-2410"></a><span class="ss">+ </span>\sum\limits_{i,j=1,i\neq j}^n \E\left<span class="co">[</span><span class="ot"> X_i X_j \right</span><span class="co">]</span> \right) P( N(t) = n ) <span class="sc">\\</span></span>
<span id="cb52-2411"><a href="#cb52-2411"></a>&amp; = \sum\limits_{n=0}^\infty \left( n \E\left<span class="co">[</span><span class="ot"> X^2 \right</span><span class="co">]</span> + n(n-1) \E\left<span class="co">[</span><span class="ot"> X \right</span><span class="co">]</span>^2 \right) P( N(t) = n ) </span>
<span id="cb52-2412"><a href="#cb52-2412"></a>\quad \text{si $<span class="sc">\{</span>X_i<span class="sc">\}</span>$ son i.i.d} <span class="sc">\\</span></span>
<span id="cb52-2413"><a href="#cb52-2413"></a>&amp; = \E\left<span class="co">[</span><span class="ot">N(t)\right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot">X^2\right</span><span class="co">]</span> + \E\left<span class="co">[</span><span class="ot">N(t)^2\right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span>^2 </span>
<span id="cb52-2414"><a href="#cb52-2414"></a><span class="ss">- </span>\E\left<span class="co">[</span><span class="ot">N(t)\right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span>^2 <span class="sc">\\</span></span>
<span id="cb52-2415"><a href="#cb52-2415"></a>&amp; = \E\left<span class="co">[</span><span class="ot">N(t)\right</span><span class="co">]</span> \V\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span> + \E\left<span class="co">[</span><span class="ot">N(t)^2\right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span>^2</span>
<span id="cb52-2416"><a href="#cb52-2416"></a>\end{split}</span>
<span id="cb52-2417"><a href="#cb52-2417"></a>$$</span>
<span id="cb52-2418"><a href="#cb52-2418"></a></span>
<span id="cb52-2419"><a href="#cb52-2419"></a>y finalmente la varianza de $S(t)$</span>
<span id="cb52-2420"><a href="#cb52-2420"></a>$$</span>
<span id="cb52-2421"><a href="#cb52-2421"></a>\begin{split}</span>
<span id="cb52-2422"><a href="#cb52-2422"></a>\V\left<span class="co">[</span><span class="ot">S(t)\right</span><span class="co">]</span></span>
<span id="cb52-2423"><a href="#cb52-2423"></a>&amp; = \E\left<span class="co">[</span><span class="ot">S(t)^2\right</span><span class="co">]</span> - \E\left<span class="co">[</span><span class="ot">S(t)\right</span><span class="co">]</span>^2 <span class="sc">\\</span></span>
<span id="cb52-2424"><a href="#cb52-2424"></a>&amp; = \E\left<span class="co">[</span><span class="ot">N(t)\right</span><span class="co">]</span> \V\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span> </span>
<span id="cb52-2425"><a href="#cb52-2425"></a><span class="ss">+ </span>\E\left<span class="co">[</span><span class="ot">N(t)^2\right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span>^2 - \E\left<span class="co">[</span><span class="ot">N(t)\right</span><span class="co">]</span>^2 \E\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span>^2 <span class="sc">\\</span></span>
<span id="cb52-2426"><a href="#cb52-2426"></a>&amp; = \E\left<span class="co">[</span><span class="ot">N(t)\right</span><span class="co">]</span> \V\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span> + \V\left<span class="co">[</span><span class="ot">N(t)\right</span><span class="co">]</span> \E\left<span class="co">[</span><span class="ot">X\right</span><span class="co">]</span>^2</span>
<span id="cb52-2427"><a href="#cb52-2427"></a>\end{split}</span>
<span id="cb52-2428"><a href="#cb52-2428"></a>$$</span>
<span id="cb52-2429"><a href="#cb52-2429"></a>Si trabajamos bajo la hipótesis que los tiempos entre arribos $<span class="sc">\{</span>W_n<span class="sc">\}</span>$ son i.i.d, con distribución</span>
<span id="cb52-2430"><a href="#cb52-2430"></a>de probabilidad común $F_W$. Podemos comprender y estudiar de una forma un poco más sencilla el </span>
<span id="cb52-2431"><a href="#cb52-2431"></a>proceso estocástico atado a la frecuencia de los siniestros $N$.</span>
<span id="cb52-2432"><a href="#cb52-2432"></a></span>
<span id="cb52-2433"><a href="#cb52-2433"></a>Notemos primeramente que se tienen la siguiente igualdad entre los eventos </span>
<span id="cb52-2434"><a href="#cb52-2434"></a>$$</span>
<span id="cb52-2435"><a href="#cb52-2435"></a><span class="sc">\{</span>N(t) = n<span class="sc">\}</span></span>
<span id="cb52-2436"><a href="#cb52-2436"></a>= <span class="sc">\{</span>T_n \leq \land T_{n+1} &gt; t<span class="sc">\}</span></span>
<span id="cb52-2437"><a href="#cb52-2437"></a>= <span class="sc">\{</span>T_n \leq t <span class="sc">\}</span> \cap <span class="sc">\{</span> T_{n+1} \leq t<span class="sc">\}</span>^c</span>
<span id="cb52-2438"><a href="#cb52-2438"></a>= <span class="sc">\{</span>T_n \leq t <span class="sc">\}</span> \setminus <span class="sc">\{</span> T_{n+1} \leq t<span class="sc">\}</span></span>
<span id="cb52-2439"><a href="#cb52-2439"></a>$$</span>
<span id="cb52-2440"><a href="#cb52-2440"></a>además es de observar que $<span class="sc">\{</span> T_{n+1} \leq t<span class="sc">\}</span> \subset <span class="sc">\{</span> T_{n} \leq t<span class="sc">\}</span>$. Con todo esto en </span>
<span id="cb52-2441"><a href="#cb52-2441"></a>consideración para cualquier $n &gt; 0$.</span>
<span id="cb52-2442"><a href="#cb52-2442"></a>$$</span>
<span id="cb52-2443"><a href="#cb52-2443"></a>\begin{split}</span>
<span id="cb52-2444"><a href="#cb52-2444"></a>P( N(t) = n )</span>
<span id="cb52-2445"><a href="#cb52-2445"></a>&amp; = P( T_n \leq t \land T_{n+1} &gt; t ) <span class="sc">\\</span></span>
<span id="cb52-2446"><a href="#cb52-2446"></a>&amp; = P( <span class="sc">\{</span>T_n \leq t <span class="sc">\}</span> \setminus <span class="sc">\{</span> T_{n+1} \leq t<span class="sc">\}</span> ) <span class="sc">\\</span></span>
<span id="cb52-2447"><a href="#cb52-2447"></a>&amp; = P( T_n \leq t ) - P( T_{n+1} \leq t ) <span class="sc">\\</span></span>
<span id="cb52-2448"><a href="#cb52-2448"></a>&amp; = F_W^{\star n}( t ) - F_W^{\star n + 1}( t )</span>
<span id="cb52-2449"><a href="#cb52-2449"></a>\end{split}</span>
<span id="cb52-2450"><a href="#cb52-2450"></a>$$</span>
<span id="cb52-2451"><a href="#cb52-2451"></a></span>
<span id="cb52-2452"><a href="#cb52-2452"></a>el caso $n = 0$ también es sencillo</span>
<span id="cb52-2453"><a href="#cb52-2453"></a>$$</span>
<span id="cb52-2454"><a href="#cb52-2454"></a>\begin{split}</span>
<span id="cb52-2455"><a href="#cb52-2455"></a>P( N(t) = 0 )</span>
<span id="cb52-2456"><a href="#cb52-2456"></a>&amp; = P( T_0 \leq t \land T_1 &gt; t ) <span class="sc">\\</span></span>
<span id="cb52-2457"><a href="#cb52-2457"></a>&amp; = P( <span class="sc">\{</span>T_0 \leq t <span class="sc">\}</span> \setminus <span class="sc">\{</span> T_1 \leq t<span class="sc">\}</span> ) <span class="sc">\\</span></span>
<span id="cb52-2458"><a href="#cb52-2458"></a>&amp; = P( T_0 \leq t ) - P( T_1 \leq t ) <span class="sc">\\</span></span>
<span id="cb52-2459"><a href="#cb52-2459"></a>&amp; = 1 - F_W^{\star 1}( t ) <span class="sc">\\</span></span>
<span id="cb52-2460"><a href="#cb52-2460"></a>&amp; = F_W^{\star 0}( t ) - F_W^{\star 1}( t )</span>
<span id="cb52-2461"><a href="#cb52-2461"></a>\end{split}</span>
<span id="cb52-2462"><a href="#cb52-2462"></a>$$</span>
<span id="cb52-2463"><a href="#cb52-2463"></a></span>
<span id="cb52-2464"><a href="#cb52-2464"></a>De lo anterior resulta que la esperanza de $N(t)$, está dada por la siguiente serie.</span>
<span id="cb52-2465"><a href="#cb52-2465"></a>$$</span>
<span id="cb52-2466"><a href="#cb52-2466"></a>\begin{split}</span>
<span id="cb52-2467"><a href="#cb52-2467"></a>\E<span class="co">[</span><span class="ot"> N( t ) </span><span class="co">]</span></span>
<span id="cb52-2468"><a href="#cb52-2468"></a>&amp; = \sum\limits_{n=0}^{+\infty} n P( N(t) = n ) <span class="sc">\\</span></span>
<span id="cb52-2469"><a href="#cb52-2469"></a>&amp; = \sum\limits_{n=0}^{+\infty} n \left( F_W^{\star n}( t ) - F_W^{\star n + 1}( t ) \right) <span class="sc">\\</span></span>
<span id="cb52-2470"><a href="#cb52-2470"></a>&amp; = 0\left( F_W^{\star 0}( t ) - F_W^{\star 1}( t ) \right) </span>
<span id="cb52-2471"><a href="#cb52-2471"></a><span class="ss">+ </span>1\left( F_W^{\star 1}( t ) - F_W^{\star 2}( t ) \right) </span>
<span id="cb52-2472"><a href="#cb52-2472"></a><span class="ss">+ </span>2\left( F_W^{\star 2}( t ) - F_W^{\star 3}( t ) \right) </span>
<span id="cb52-2473"><a href="#cb52-2473"></a><span class="ss">+ </span>\cdots <span class="sc">\\</span></span>
<span id="cb52-2474"><a href="#cb52-2474"></a>&amp; = \sum\limits_{n=1}^{+\infty} F_W^{\star n}( t )</span>
<span id="cb52-2475"><a href="#cb52-2475"></a>\end{split}</span>
<span id="cb52-2476"><a href="#cb52-2476"></a>$$</span>
<span id="cb52-2477"><a href="#cb52-2477"></a></span>
<span id="cb52-2478"><a href="#cb52-2478"></a><span class="fu">### Algoritmo de simulación</span></span>
<span id="cb52-2479"><a href="#cb52-2479"></a></span>
<span id="cb52-2480"><a href="#cb52-2480"></a><span class="ss">1. </span>Se selecciona el número adecuado de simulaciones $m \in \N^*$,</span>
<span id="cb52-2481"><a href="#cb52-2481"></a></span>
<span id="cb52-2482"><a href="#cb52-2482"></a><span class="ss">2. </span>Se selecciona el número de simulaciones de tiempos de arribo $M \in \N^*$,</span>
<span id="cb52-2483"><a href="#cb52-2483"></a></span>
<span id="cb52-2484"><a href="#cb52-2484"></a><span class="ss">3. </span>Dada la distribución de los tiempos entre arribos $F_W$ para cada simulación $i \in <span class="sc">\{</span>1, \ldots, m<span class="sc">\}</span>$</span>
<span id="cb52-2485"><a href="#cb52-2485"></a>se genera una muestra $W_{i,1}, \ldots, W_{i,M}$ de tamaño de $M$,</span>
<span id="cb52-2486"><a href="#cb52-2486"></a></span>
<span id="cb52-2487"><a href="#cb52-2487"></a><span class="ss">4. </span>Para cada simulación $i \in <span class="sc">\{</span>1, \ldots, m<span class="sc">\}</span>$ y cada $n \in <span class="sc">\{</span>0, \ldots, M<span class="sc">\}</span>$ calculamos los</span>
<span id="cb52-2488"><a href="#cb52-2488"></a>tiempos de arribo $T_{i,0},\ldots, T_{i,M}$</span>
<span id="cb52-2489"><a href="#cb52-2489"></a>$$</span>
<span id="cb52-2490"><a href="#cb52-2490"></a>T_{i,0} = 0,\qquad</span>
<span id="cb52-2491"><a href="#cb52-2491"></a>T_{i,n} = \sum\limits_{k=1}^n W_{i,k}</span>
<span id="cb52-2492"><a href="#cb52-2492"></a>$$</span>
<span id="cb52-2493"><a href="#cb52-2493"></a></span>
<span id="cb52-2494"><a href="#cb52-2494"></a><span class="ss">5. </span>Se toma una malla de discretización en el tiempo $0 = t_0 &lt; t_1 &lt; \cdots &lt; t_p = T$ y calculamos</span>
<span id="cb52-2495"><a href="#cb52-2495"></a>para cada simulación $i \in <span class="sc">\{</span>1,\ldots,m<span class="sc">\}</span>$ y tiempo $t_l$, con $l \in <span class="sc">\{</span>0,\ldots,p<span class="sc">\}</span>$.</span>
<span id="cb52-2496"><a href="#cb52-2496"></a>$$</span>
<span id="cb52-2497"><a href="#cb52-2497"></a>N_{i,l} = \#\left\{ n \in \N\ \middle|\ T_{i,n} \leq t_l \right<span class="sc">\}</span></span>
<span id="cb52-2498"><a href="#cb52-2498"></a>= \sum\limits_{n=0}^{M} \mathbf{1}_{(-\infty,t_l]}\left( T_n \right)</span>
<span id="cb52-2499"><a href="#cb52-2499"></a>$$</span>
<span id="cb52-2500"><a href="#cb52-2500"></a>precisamente para cada simulación $i$, el término $N_{i,l}$ es una aproximación al proceso </span>
<span id="cb52-2501"><a href="#cb52-2501"></a>$N( t_l )$ evaluado en el tiempo $t_l$. Así se puede tener la aproximación de la media </span>
<span id="cb52-2502"><a href="#cb52-2502"></a>$$</span>
<span id="cb52-2503"><a href="#cb52-2503"></a>\E\left<span class="co">[</span><span class="ot"> N( t_l ) \right</span><span class="co">]</span> \approx \frac{1}{m} \sum\limits_{i=1}^m N_{i,l}</span>
<span id="cb52-2504"><a href="#cb52-2504"></a>$$</span>
<span id="cb52-2505"><a href="#cb52-2505"></a></span>
<span id="cb52-2506"><a href="#cb52-2506"></a><span class="ss">6. </span>Con la simulación el proceso estocástico $N$ podemos ahora proceder a simular los reclamos totales. </span>
<span id="cb52-2507"><a href="#cb52-2507"></a>Para cada simulación $i \in <span class="sc">\{</span>1,\ldots,m<span class="sc">\}</span>$, tomamos una muestra de forma independiente e igualmente</span>
<span id="cb52-2508"><a href="#cb52-2508"></a>distribuida de los reclamos individuales $X_{i,1}, \ldots, X_{i,N_{i,p}}$, la cual tiene tamaño </span>
<span id="cb52-2509"><a href="#cb52-2509"></a>$N_{i,p}$, y son tomados de la distribución de probabilidad $F_X$</span>
<span id="cb52-2510"><a href="#cb52-2510"></a></span>
<span id="cb52-2511"><a href="#cb52-2511"></a><span class="ss">7. </span>Para cada simulación $i \in <span class="sc">\{</span>1,\ldots, m<span class="sc">\}</span>$ y cada tiempo $t_l$ con $l \in <span class="sc">\{</span>0,\ldots,p<span class="sc">\}</span>$, </span>
<span id="cb52-2512"><a href="#cb52-2512"></a>calculamos la suma</span>
<span id="cb52-2513"><a href="#cb52-2513"></a>$$</span>
<span id="cb52-2514"><a href="#cb52-2514"></a>S_{i,l} = \sum\limits_{j=1}^{N_{i,l}} X_{i,j}</span>
<span id="cb52-2515"><a href="#cb52-2515"></a>$$</span>
<span id="cb52-2516"><a href="#cb52-2516"></a>cada $S_{i,l}$ es una aproximación al proceso del total de reclamos $S(t_l)$ precisamente en el </span>
<span id="cb52-2517"><a href="#cb52-2517"></a>tiempo $t_l$. Así resulta la aproximación</span>
<span id="cb52-2518"><a href="#cb52-2518"></a>$$</span>
<span id="cb52-2519"><a href="#cb52-2519"></a>\E\left<span class="co">[</span><span class="ot"> S( t_l ) \right</span><span class="co">]</span> \approx \frac{1}{m} \sum\limits_{i=1}^m S_{i,l}</span>
<span id="cb52-2520"><a href="#cb52-2520"></a>$$</span>
<span id="cb52-2521"><a href="#cb52-2521"></a></span>
<span id="cb52-2522"><a href="#cb52-2522"></a><span class="ss">8. </span>Además, para cada instante $t_l$, se puede aproximar la función de distribución acumulada </span>
<span id="cb52-2523"><a href="#cb52-2523"></a>$F_{S(t_l)}$ de la variable aleatoria $S( t_l )$ utilizando la distribución acumulada empírica</span>
<span id="cb52-2524"><a href="#cb52-2524"></a>generada con la muestra $S_{1,l},\ldots,S_{m,l}$. Para cualquier $s \in \R$, tenemos la aproximación</span>
<span id="cb52-2525"><a href="#cb52-2525"></a>$$</span>
<span id="cb52-2526"><a href="#cb52-2526"></a>F_{S(t_l)}( s ) \approx F_{m,l}( s ) </span>
<span id="cb52-2527"><a href="#cb52-2527"></a>= \frac{1}{m} \sum\limits_{i=1}^m \mathbf{1}_{(-\infty,s]}\left( S_{i,l} \right)</span>
<span id="cb52-2528"><a href="#cb52-2528"></a>$$</span>
<span id="cb52-2529"><a href="#cb52-2529"></a>El algoritmo de simulación anterior tiene una falencia, no se sabe a priori que valor $M$ se debe</span>
<span id="cb52-2530"><a href="#cb52-2530"></a>escoger para simular de forma correcta los procesos $N$ y $S$ hasta un tiempo máximo $T$ dado. Esto</span>
<span id="cb52-2531"><a href="#cb52-2531"></a>implica que si $M$ no es del tamaño adecuado, las estimaciones que se realice utilizando la </span>
<span id="cb52-2532"><a href="#cb52-2532"></a>simulación va a degradarse conforme avanza el tiempo.</span>
<span id="cb52-2533"><a href="#cb52-2533"></a></span>
<span id="cb52-2534"><a href="#cb52-2534"></a>::: {.example #l6ex9}</span>
<span id="cb52-2535"><a href="#cb52-2535"></a>El siguiente ejemplo es de especial atención ya que es utilizado en muchas aplicaciones, podemos </span>
<span id="cb52-2536"><a href="#cb52-2536"></a>considerar el caso donde el tiempo entre arribos $<span class="sc">\{</span>W_n<span class="sc">\}</span>$ es i.i.d y con distribución de </span>
<span id="cb52-2537"><a href="#cb52-2537"></a>probabilidad común $F_W$ dada por una ley exponencial $Exp( \lambda )$. Un resultado clásico muestra </span>
<span id="cb52-2538"><a href="#cb52-2538"></a>que la suma de $n$ exponenciales sigue una ley gamma $Gamma(n,\lambda)$, esto implica que </span>
<span id="cb52-2539"><a href="#cb52-2539"></a>$T_n = W_1 + \cdots + W_n \rightsquigarrow Gamma( n, \lambda )$ lo que quiere decir que la convolución </span>
<span id="cb52-2540"><a href="#cb52-2540"></a>$F_W^{\star n}$ es una $Gamma( n, \lambda )$. Así por tanto, el proceso estocástico de conteo </span>
<span id="cb52-2541"><a href="#cb52-2541"></a>$N(t) = <span class="sc">\#</span>\left<span class="sc">\{</span> n \in \N\ \middle|\ T_n \leq t \right<span class="sc">\}</span>$ tiene las siguientes probabilidades</span>
<span id="cb52-2542"><a href="#cb52-2542"></a>$$</span>
<span id="cb52-2543"><a href="#cb52-2543"></a>\begin{split}</span>
<span id="cb52-2544"><a href="#cb52-2544"></a>P( N( t ) = n )</span>
<span id="cb52-2545"><a href="#cb52-2545"></a>&amp; = F_W^{\star n}( t ) - F_W^{\star n + 1}( t ) <span class="sc">\\</span></span>
<span id="cb52-2546"><a href="#cb52-2546"></a>&amp; = \exp( -\lambda t ) \sum\limits_{k=n}^{+\infty} \frac{(\lambda t)^k}{k!} </span>
<span id="cb52-2547"><a href="#cb52-2547"></a><span class="ss">- </span>\exp( -\lambda t ) \sum\limits_{k={n+1}}^{+\infty} \frac{(\lambda t)^k}{k!} <span class="sc">\\</span></span>
<span id="cb52-2548"><a href="#cb52-2548"></a>&amp; = \exp( -\lambda t ) \frac{(\lambda t)^n}{n!}</span>
<span id="cb52-2549"><a href="#cb52-2549"></a>\end{split}</span>
<span id="cb52-2550"><a href="#cb52-2550"></a>$$</span>
<span id="cb52-2551"><a href="#cb52-2551"></a></span>
<span id="cb52-2552"><a href="#cb52-2552"></a>En conclusión $N(t)$ tiene como distribución una ley de Poisson $Pois( \lambda t )$, en particular</span>
<span id="cb52-2553"><a href="#cb52-2553"></a>se conoce a $N$ como un proceso de Poisson.</span>
<span id="cb52-2554"><a href="#cb52-2554"></a>:::</span>
<span id="cb52-2555"><a href="#cb52-2555"></a></span>
<span id="cb52-2556"><a href="#cb52-2556"></a><span class="in">```{r l6c25}</span></span>
<span id="cb52-2557"><a href="#cb52-2557"></a><span class="in">m &lt;- 1000</span></span>
<span id="cb52-2558"><a href="#cb52-2558"></a><span class="in">lambda &lt;- 10</span></span>
<span id="cb52-2559"><a href="#cb52-2559"></a><span class="in">M &lt;- 30</span></span>
<span id="cb52-2560"><a href="#cb52-2560"></a><span class="in">p &lt;- 365</span></span>
<span id="cb52-2561"><a href="#cb52-2561"></a><span class="in">u &lt;- 4</span></span>
<span id="cb52-2562"><a href="#cb52-2562"></a><span class="in">s &lt;- 2</span></span>
<span id="cb52-2563"><a href="#cb52-2563"></a></span>
<span id="cb52-2564"><a href="#cb52-2564"></a><span class="in">set.seed( 432147 )</span></span>
<span id="cb52-2565"><a href="#cb52-2565"></a><span class="in">W &lt;- lapply( 1:m, FUN = function( n ) rexp( M, rate = lambda ) )</span></span>
<span id="cb52-2566"><a href="#cb52-2566"></a><span class="in">Tn &lt;- lapply( W, FUN = cumsum )</span></span>
<span id="cb52-2567"><a href="#cb52-2567"></a><span class="in">Tnmax &lt;- max( sapply( Tn, FUN = max ) )</span></span>
<span id="cb52-2568"><a href="#cb52-2568"></a><span class="in">t &lt;- seq( 0, Tnmax, length = p )</span></span>
<span id="cb52-2569"><a href="#cb52-2569"></a></span>
<span id="cb52-2570"><a href="#cb52-2570"></a><span class="in">N &lt;- lapply( Tn, FUN = function( Tk ) sapply( t, FUN = function( t ) sum( Tk &lt;= t ) ) )</span></span>
<span id="cb52-2571"><a href="#cb52-2571"></a><span class="in">Nmax &lt;- max( sapply( N, FUN = function( Ni ) last( Ni ) ) )</span></span>
<span id="cb52-2572"><a href="#cb52-2572"></a></span>
<span id="cb52-2573"><a href="#cb52-2573"></a><span class="in">set.seed( 7324312 )</span></span>
<span id="cb52-2574"><a href="#cb52-2574"></a><span class="in">X &lt;- lapply( N, FUN = function( Ni ) rlnorm( last( Ni ), meanlog = u, sdlog = s ) )</span></span>
<span id="cb52-2575"><a href="#cb52-2575"></a><span class="in">S &lt;- lapply( 1:m, FUN = function( i ) {</span></span>
<span id="cb52-2576"><a href="#cb52-2576"></a><span class="in">  Si &lt;- cumsum( X[[ i ]] )</span></span>
<span id="cb52-2577"><a href="#cb52-2577"></a><span class="in">  return( sapply( N[[ i ]], FUN = function( Nj ) ifelse( Nj == 0, 0, Si[ Nj ] ) ) )</span></span>
<span id="cb52-2578"><a href="#cb52-2578"></a><span class="in">} )</span></span>
<span id="cb52-2579"><a href="#cb52-2579"></a><span class="in">Smax &lt;- max( sapply( S, FUN = function( Si ) last( Si ) ) )</span></span>
<span id="cb52-2580"><a href="#cb52-2580"></a></span>
<span id="cb52-2581"><a href="#cb52-2581"></a><span class="in">EN &lt;- lambda * t</span></span>
<span id="cb52-2582"><a href="#cb52-2582"></a><span class="in">EeN &lt;- sapply( 1:p, FUN = function( l ) mean( sapply( 1:m, function( i ) N[[ i ]][ l ] ) ) )</span></span>
<span id="cb52-2583"><a href="#cb52-2583"></a></span>
<span id="cb52-2584"><a href="#cb52-2584"></a><span class="in">ES &lt;- EN * exp( u + 0.5 * s^2 )</span></span>
<span id="cb52-2585"><a href="#cb52-2585"></a><span class="in">EeS &lt;- sapply( 1:p, FUN = function( l ) mean( sapply( 1:m, function( i ) S[[ i ]][ l ] ) ) )</span></span>
<span id="cb52-2586"><a href="#cb52-2586"></a><span class="in">```</span></span>
<span id="cb52-2587"><a href="#cb52-2587"></a></span>
<span id="cb52-2588"><a href="#cb52-2588"></a>En el gráfico a continuación presentamos todos los procesos de conteo $N_{i}$ simulados, como es de</span>
<span id="cb52-2589"><a href="#cb52-2589"></a>esperarse son funciones de escalera, siempre crecientes, que toman solo valores positivos.</span>
<span id="cb52-2590"><a href="#cb52-2590"></a><span class="in">```{r l6g17}</span></span>
<span id="cb52-2591"><a href="#cb52-2591"></a><span class="in">#| warning: false</span></span>
<span id="cb52-2592"><a href="#cb52-2592"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-2593"><a href="#cb52-2593"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-2594"><a href="#cb52-2594"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-2595"><a href="#cb52-2595"></a><span class="in">Sord &lt;- order( sapply( 1:m, FUN = function( j ) last( S[[j]] ) ) )</span></span>
<span id="cb52-2596"><a href="#cb52-2596"></a><span class="in">Ndat &lt;- NULL</span></span>
<span id="cb52-2597"><a href="#cb52-2597"></a><span class="in">for ( j in 1:m ) {</span></span>
<span id="cb52-2598"><a href="#cb52-2598"></a><span class="in">  Ndat &lt;- rbindlist( list( Ndat, data.table( t = t, m = as.factor( Sord[ j ] ), N = N[[ j ]], S = S[[ j ]] ) ) )</span></span>
<span id="cb52-2599"><a href="#cb52-2599"></a><span class="in">}</span></span>
<span id="cb52-2600"><a href="#cb52-2600"></a><span class="in">cols &lt;- wes_palette( m, name = "FantasticFox1", type = "continuous")</span></span>
<span id="cb52-2601"><a href="#cb52-2601"></a></span>
<span id="cb52-2602"><a href="#cb52-2602"></a><span class="in">time &lt;- t </span></span>
<span id="cb52-2603"><a href="#cb52-2603"></a></span>
<span id="cb52-2604"><a href="#cb52-2604"></a><span class="in">plt &lt;- ggplot( ) +</span></span>
<span id="cb52-2605"><a href="#cb52-2605"></a><span class="in">  geom_step( data = Ndat, aes( x = t, y = N, group = m, colour = m ), linewidth = 0.2 ) +</span></span>
<span id="cb52-2606"><a href="#cb52-2606"></a><span class="in">  geom_line( aes( x = time, y = EN, colour = 'a' ), linewidth = 1.5 ) +</span></span>
<span id="cb52-2607"><a href="#cb52-2607"></a><span class="in">  geom_line( aes( x = time, y = EeN, colour = 'b' ), linewidth = 1 ) +</span></span>
<span id="cb52-2608"><a href="#cb52-2608"></a><span class="in">  scale_color_manual( breaks = c( as.factor( 1:m ), 'a', 'b' ), </span></span>
<span id="cb52-2609"><a href="#cb52-2609"></a><span class="in">                      values = c( cols, 'dodgerblue3', 'olivedrab3' ) ) +</span></span>
<span id="cb52-2610"><a href="#cb52-2610"></a><span class="in">  scale_x_continuous( breaks = seq( 0, Tnmax, length = 11 ),</span></span>
<span id="cb52-2611"><a href="#cb52-2611"></a><span class="in">                      labels = formatC( seq( 0, Tnmax, length = 11 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-2612"><a href="#cb52-2612"></a><span class="in">                      limits = c( 0, Tnmax ), </span></span>
<span id="cb52-2613"><a href="#cb52-2613"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-2614"><a href="#cb52-2614"></a><span class="in">  scale_y_continuous( breaks = seq( 0, Nmax, length = 11 ), </span></span>
<span id="cb52-2615"><a href="#cb52-2615"></a><span class="in">                      labels = formatC( seq( 0, Nmax, length = 11 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-2616"><a href="#cb52-2616"></a><span class="in">                      limits = c( 0, Nmax ), </span></span>
<span id="cb52-2617"><a href="#cb52-2617"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-2618"><a href="#cb52-2618"></a><span class="in">  xlab( TeX( "$t$" ) ) + </span></span>
<span id="cb52-2619"><a href="#cb52-2619"></a><span class="in">  ylab( TeX( "$N(t)$" ) ) + </span></span>
<span id="cb52-2620"><a href="#cb52-2620"></a><span class="in">  theme_bw() +</span></span>
<span id="cb52-2621"><a href="#cb52-2621"></a><span class="in">  theme( legend.position = "none" )</span></span>
<span id="cb52-2622"><a href="#cb52-2622"></a><span class="in">plot( plt )</span></span>
<span id="cb52-2623"><a href="#cb52-2623"></a><span class="in">```</span></span>
<span id="cb52-2624"><a href="#cb52-2624"></a></span>
<span id="cb52-2625"><a href="#cb52-2625"></a>El gráfico a continuación presenta la simulación de los procesos correspondientes al total de </span>
<span id="cb52-2626"><a href="#cb52-2626"></a>reclamos, conforme avanza el tiempo. De igual manera los procesos $S_i$ son funciones de escalera,</span>
<span id="cb52-2627"><a href="#cb52-2627"></a>siempre crecientes, con saltos correspondientes a los reclamos individuales.</span>
<span id="cb52-2628"><a href="#cb52-2628"></a><span class="in">```{r l6g18}</span></span>
<span id="cb52-2629"><a href="#cb52-2629"></a><span class="in">#| warning: false</span></span>
<span id="cb52-2630"><a href="#cb52-2630"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-2631"><a href="#cb52-2631"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-2632"><a href="#cb52-2632"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-2633"><a href="#cb52-2633"></a><span class="in">Sqmax &lt;- quantile( sapply( S, FUN = function( Si ) last( Si ) ), probs = 0.99 )</span></span>
<span id="cb52-2634"><a href="#cb52-2634"></a></span>
<span id="cb52-2635"><a href="#cb52-2635"></a><span class="in">plt &lt;- ggplot( ) +</span></span>
<span id="cb52-2636"><a href="#cb52-2636"></a><span class="in">  geom_step( data = Ndat, aes( x = t, y = S, group = m, colour = m ), linewidth = 0.2 ) +</span></span>
<span id="cb52-2637"><a href="#cb52-2637"></a><span class="in">  geom_line( aes( x = time, y = ES, colour = 'a' ), linewidth = 1.5 ) +</span></span>
<span id="cb52-2638"><a href="#cb52-2638"></a><span class="in">  geom_line( aes( x = time, y = EeS, colour = 'b' ), linewidth = 1 ) +</span></span>
<span id="cb52-2639"><a href="#cb52-2639"></a><span class="in">  scale_color_manual( breaks = c( as.factor( 1:m ), 'a', 'b' ), </span></span>
<span id="cb52-2640"><a href="#cb52-2640"></a><span class="in">                      values = c( cols, 'dodgerblue3', 'olivedrab3' ) ) +</span></span>
<span id="cb52-2641"><a href="#cb52-2641"></a><span class="in">  scale_x_continuous( breaks = seq( 0, Tnmax, length = 11 ),</span></span>
<span id="cb52-2642"><a href="#cb52-2642"></a><span class="in">                      labels = formatC( seq( 0, Tnmax, length = 11 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-2643"><a href="#cb52-2643"></a><span class="in">                      limits = c( 0, Tnmax ), expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-2644"><a href="#cb52-2644"></a><span class="in">  scale_y_continuous( breaks = seq( 0, Sqmax, length = 11 ),</span></span>
<span id="cb52-2645"><a href="#cb52-2645"></a><span class="in">                      labels = formatC( seq( 0, Sqmax, length = 11 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-2646"><a href="#cb52-2646"></a><span class="in">                      limits = c( 0, Sqmax ), expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-2647"><a href="#cb52-2647"></a><span class="in">  xlab( TeX( "$t$" ) ) + </span></span>
<span id="cb52-2648"><a href="#cb52-2648"></a><span class="in">  ylab( TeX( "$S(t)$" ) ) + </span></span>
<span id="cb52-2649"><a href="#cb52-2649"></a><span class="in">  theme_bw() +</span></span>
<span id="cb52-2650"><a href="#cb52-2650"></a><span class="in">  theme( legend.position = "none" )</span></span>
<span id="cb52-2651"><a href="#cb52-2651"></a><span class="in">plot( plt )</span></span>
<span id="cb52-2652"><a href="#cb52-2652"></a><span class="in">```</span></span>
<span id="cb52-2653"><a href="#cb52-2653"></a></span>
<span id="cb52-2654"><a href="#cb52-2654"></a>Como se describe en el paso 8 del algoritmo de simulación, para cada tiempo $t_l$ se puede estimar</span>
<span id="cb52-2655"><a href="#cb52-2655"></a>la distribución de probabilidad de la variable aleatoria $S(t_l)$.</span>
<span id="cb52-2656"><a href="#cb52-2656"></a><span class="in">```{r l6c26}</span></span>
<span id="cb52-2657"><a href="#cb52-2657"></a><span class="in">FeS &lt;- lapply( 1:p, FUN = function( l ) ecdf( sapply( S, FUN = function( Si ) Si[ l ] ) ) )</span></span>
<span id="cb52-2658"><a href="#cb52-2658"></a><span class="in">ns &lt;- 1e3</span></span>
<span id="cb52-2659"><a href="#cb52-2659"></a><span class="in">s &lt;- seq( 0, Smax, length = ns )</span></span>
<span id="cb52-2660"><a href="#cb52-2660"></a><span class="in">Fes &lt;- lapply( FeS, FUN = function( FeSl ) sapply( s, FUN = FeSl ) )</span></span>
<span id="cb52-2661"><a href="#cb52-2661"></a><span class="in">```</span></span>
<span id="cb52-2662"><a href="#cb52-2662"></a></span>
<span id="cb52-2663"><a href="#cb52-2663"></a>La figura a continuación muestra cada una de las distribuciones de probabilidad empíricas estimadas </span>
<span id="cb52-2664"><a href="#cb52-2664"></a>$F_{m,l}$. Se puede observar que conforme avanza el tiempo, aumenta la probabilidad de observar </span>
<span id="cb52-2665"><a href="#cb52-2665"></a>valores mayores del proceso $S$ correspondiente al total de reclamos.</span>
<span id="cb52-2666"><a href="#cb52-2666"></a><span class="in">```{r l6g19}</span></span>
<span id="cb52-2667"><a href="#cb52-2667"></a><span class="in">#| warning: false</span></span>
<span id="cb52-2668"><a href="#cb52-2668"></a><span class="in">#| out-width: '70%'</span></span>
<span id="cb52-2669"><a href="#cb52-2669"></a><span class="in">#| fig-align: center</span></span>
<span id="cb52-2670"><a href="#cb52-2670"></a><span class="in">#| code-fold: true</span></span>
<span id="cb52-2671"><a href="#cb52-2671"></a><span class="in">FeSdat &lt;- NULL</span></span>
<span id="cb52-2672"><a href="#cb52-2672"></a><span class="in">for ( j in 1:p ) {</span></span>
<span id="cb52-2673"><a href="#cb52-2673"></a><span class="in">  FeSdat &lt;- rbindlist( list( FeSdat, data.table( s = s, m = as.factor( j ), Fes = Fes[[ j ]] ) ) )</span></span>
<span id="cb52-2674"><a href="#cb52-2674"></a><span class="in">}</span></span>
<span id="cb52-2675"><a href="#cb52-2675"></a><span class="in">cols &lt;- wes_palette( p, name = "FantasticFox1", type = "continuous")</span></span>
<span id="cb52-2676"><a href="#cb52-2676"></a></span>
<span id="cb52-2677"><a href="#cb52-2677"></a><span class="in">plt &lt;- ggplot( ) +</span></span>
<span id="cb52-2678"><a href="#cb52-2678"></a><span class="in">  geom_step( data = FeSdat, aes( x = s, y = Fes, group = m, colour = m ), linewidth = 0.1 ) +</span></span>
<span id="cb52-2679"><a href="#cb52-2679"></a><span class="in">  scale_color_manual( values = c( cols ) ) +</span></span>
<span id="cb52-2680"><a href="#cb52-2680"></a><span class="in">  scale_x_continuous( breaks = seq( 0, Smax, length = 5 ),</span></span>
<span id="cb52-2681"><a href="#cb52-2681"></a><span class="in">                      labels = formatC( seq( 0, Smax, length = 5 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-2682"><a href="#cb52-2682"></a><span class="in">                      limits = c( 0, Smax ), </span></span>
<span id="cb52-2683"><a href="#cb52-2683"></a><span class="in">                      expand = c( 0, 0 ) ) +</span></span>
<span id="cb52-2684"><a href="#cb52-2684"></a><span class="in">  scale_y_continuous( breaks = seq( 0, 1, length = 11 ),</span></span>
<span id="cb52-2685"><a href="#cb52-2685"></a><span class="in">                      labels = formatC( seq( 0, 1, length = 11 ), digits = 2, format = 'f' ), </span></span>
<span id="cb52-2686"><a href="#cb52-2686"></a><span class="in">                      limits = c( 0, 1 ), </span></span>
<span id="cb52-2687"><a href="#cb52-2687"></a><span class="in">                      expand = c( 0.005, 0.005 ) ) +</span></span>
<span id="cb52-2688"><a href="#cb52-2688"></a><span class="in">  xlab( TeX( "$S$" ) ) + </span></span>
<span id="cb52-2689"><a href="#cb52-2689"></a><span class="in">  ylab( TeX( "$F_{m,l}$" ) ) + </span></span>
<span id="cb52-2690"><a href="#cb52-2690"></a><span class="in">  theme_bw() +</span></span>
<span id="cb52-2691"><a href="#cb52-2691"></a><span class="in">  theme( legend.position = "none" )</span></span>
<span id="cb52-2692"><a href="#cb52-2692"></a></span>
<span id="cb52-2693"><a href="#cb52-2693"></a><span class="in">plot( plt )</span></span>
<span id="cb52-2694"><a href="#cb52-2694"></a><span class="in">```</span></span>
<span id="cb52-2695"><a href="#cb52-2695"></a></span>
<span id="cb52-2696"><a href="#cb52-2696"></a><span class="in">```{r l6end}</span></span>
<span id="cb52-2697"><a href="#cb52-2697"></a><span class="in">#| echo: FALSE</span></span>
<span id="cb52-2698"><a href="#cb52-2698"></a><span class="in"># rm( list = ls()[ ls() != 'def.chunk.hook' ] )</span></span>
<span id="cb52-2699"><a href="#cb52-2699"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/pedroguarderas/seguros_generales/edit/main/lectura_06.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/pedroguarderas/seguros_generales/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>